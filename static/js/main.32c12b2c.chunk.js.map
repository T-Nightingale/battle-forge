{"version":3,"sources":["components/empty-state/index.js","illustrations/error.svg","components/error-boundry/index.js","utils/files.js","utils/misc.js","hooks/index.js","components/footer/index.js","assets/battleforged_anvil.png","utils/colors.js","routes/modals/index.jsx","components/dropdown/index.jsx","components/MainNav/index.jsx","components/CustomCircularProgress/index.tsx","utils/format.js","utils/math.js","utils/data.js","routes/faction/focus.js","components/styled-table/index.tsx","routes/faction/organization.js","routes/faction/overview.js","components/roster/power-card.jsx","routes/faction/powers.js","components/roster/rule-list.jsx","components/roster/weapon-list.jsx","components/roster/relic-card.jsx","routes/faction/relics.js","routes/faction/rules.js","components/roster/strategy-card.jsx","routes/faction/strategies.js","components/roster/modals/index.jsx","components/roster/option-list.jsx","components/roster/unit-stats.jsx","components/roster/unit-card.jsx","routes/faction/units.js","routes/faction/weapons.js","routes/faction/index.js","routes/factions/factions.js","routes/factions/mission_generator.js","routes/factions/overview.js","utils/markdown.jsx","routes/factions/rules.js","routes/factions/index.js","routes/games/index.js","components/bootstrap/index.jsx","components/print/weapon-list.jsx","components/print/index.jsx","routes/factions/modals/index.jsx","utils/constants.js","routes/Lists/modals/index.jsx","routes/Lists/index.js","styles/style.js","routes/PageNotFound.js","routes/Privacy.jsx","routes/rosters/modals/index.jsx","routes/rosters/index.js","routes/Rules.jsx","assets/battle_forged_wide.png","components/gallery/index.jsx","routes/Splash.jsx","utils/images.js","routes/Updates.jsx","routes/Core.js","App.tsx","serviceWorker.js","index.js"],"names":["EmptyState","props","variant","size","Box","display","flexDirection","alignItems","justifyContent","textAlign","image","flex","src","alt","title","mb","description","style","width","button","Typography","sx","mt","defaultProps","type","padding","ErrorBoundary","state","hasError","eventId","error","errorInfo","children","this","Container","ErrorIllustration","Component","downloadFile","exportObj","exportName","dataStr","encodeURIComponent","downloadAnchorNode","document","createElement","setAttribute","body","appendChild","click","remove","readFileContent","file","reader","FileReader","Promise","resolve","reject","onload","event","target","result","onerror","readAsText","customMerge","object","sources","mergeWith","objValue","srcValue","insert","arr","index","newItem","slice","getWindowDimensions","window","innerWidth","height","innerHeight","PointsCacheContext","React","createContext","DataContext","Wrapper","styled","div","invariantViolation","Error","ModalContext","showModal","hideModal","displayName","ModalProvider","container","rootComponent","HTMLElement","useState","modals","setModals","useCallback","key","modal","extraProps","newModals","contextValue","useMemo","Provider","value","Fragment","ModalRoot","component","ModalRenderer","memo","rest","RootComponent","undefined","mountNode","setMountNode","useEffect","createPortal","Object","keys","map","generateModalKey","count","isFunctionalComponent","prototype","isReactComponent","useModal","context","useContext","setExtraProps","isShown","setShown","breadCrumbDefaults","factions","rules","games","missions","quickstart","updates","privacy","lists","Footer","dimensions","windowDimensions","setWindowDimensions","handleResize","addEventListener","removeEventListener","useWindowDimensions","flexGrow","Link","href","className","Date","getFullYear","getTextColor","rgb","Math","round","parseInt","r","g","b","hexToRgb","hex","exec","colors","red","id","name","import","pink","purple","deepPurple","indigo","blue","lightBlue","cyan","teal","green","lightGreen","lime","yellow","amber","orange","deepOrange","brown","gray","blueGray","getColor","colorId","camelCase","THEMES","label","UserPreferences","userPrefs","setUserPrefs","localUserPrefs","setLocalUserPrefs","colorOptions","values","color","MenuItem","primaryColor","Dialog","open","fullWidth","maxWidth","onClose","DialogTitle","DialogContent","FormGroup","FormControl","FormLabel","RadioGroup","row","theme","onChange","FormControlLabel","control","Radio","my","InputLabel","Select","labelId","Checkbox","showBeta","checked","developerMode","DialogActions","Button","onClick","Dropdown","as","isOpen","setIsOpen","anchorElement","setAnchorElement","handleClose","handleOpen","currentTarget","DrawerHeader","spacing","mixins","toolbar","navItems","icon","Home","to","toAbs","Search","position","borderRadius","shape","backgroundColor","alpha","palette","common","white","marginRight","marginLeft","SearchIconWrapper","pointerEvents","StyledInputBase","InputBase","paddingLeft","transition","transitions","create","breakpoints","up","MainNav","searchMode","setSearchMode","appState","setAppState","contextActions","history","useHistory","hideUserPreferences","showUserPreferences","useTheme","setOpen","handleDrawerOpen","handleDrawerClose","avatar","createAvatar","seed","random","toString","fullScreen","useMediaQuery","numActionsToShow","length","enableSearch","AppBar","Toolbar","IconButton","edge","mr","push","startIcon","IGR","noWrap","fontSize","fontWeight","textTransform","action","paddingRight","anchorOrigin","vertical","horizontal","transformOrigin","anchorEl","MenuListProps","dense","ListItemIcon","ListItemText","searchText","autoFocus","placeholder","inputProps","SwipeableDrawer","onOpen","flexShrink","boxSizing","anchor","ListItemButton","Avatar","primary","Divider","List","item","ListItem","CustomCircularProgress","CircularProgress","disableShrink","mode","animationDuration","left","circularProgressClasses","circle","strokeLinecap","thickness","formatModel","model","unit","faction","data","options","weaponOrderer","weapon","get","getWeapon","ruleOrderer","rule","getRule","hideCount","equipString","weapons","orderBy","formatWeapon","join","rulesString","formatRule","modelCount","min","ruleId","ruleData","inputs","input","weaponData","weaponCount","weaponMount","mount","wepName","wepMount","LEVEL_TO_NAME","formatLevel","level","round5","x","getRandomItem","floor","getRandomItems","numItems","sort","DataAPI","cache","root","getCache","setCache","factionList","globalWeapons","globalUnits","units","globalRules","globalPowers","powers","globalStrategies","strategies","globalPerks","perks","globalSetbacks","setbacks","globalRelics","relics","globalModels","models","globalTerrain","terrain","globalPowerCategories","powerCategories","rootWeapons","rootRules","rootPhases","phases","rootStrategies","rootPerks","rootSetbacks","rootGameTypes","gameTypes","rootTerrain","rootMissions","rootPowerCategories","CONSTANTS","baseStats","movement","shoot","fight","courage","reflexes","wounds","defense","baseCost","woundsCost","courageCost","defenseCost","apCost","damageCost","movementCost","dummyTarget","agility","max","getGameType","gameType","getRawCategories","categories","getNameLists","nameLists","sortBy","getNameList","listId","getRandomName","list","firstNames","uniq","middleNames","lastNames","getRandomMaleName","getRandomFemaleName","getRawPhases","getPhase","categoryId","getOrganizations","organizations","getRawOrganizations","getOrganizationSlotsRaw","organization","getOrganizationCategory","category","getCategories","getRawPowerCategories","getPowerCategories","getPowerCategory","getTerrain","getCategory","ruleName","weaponName","weaponId","getModel","modelName","modelId","getModelList","modelList","filter","getPower","powerName","powerId","getStrategy","strategyName","strategyId","getRawAlliances","alliances","getAlliance","allianceName","getAlliances","getFactions","getRawFaction","factionName","getSubfactionNameList","subfactionList","subfactions","Set","has","subfactionKey","subfaction","hasSubfactions","thing","getFaction","mapValues","strat","source","getSubfaction","subfactionName","getFactionWithSubfaction","subfactionData","subfactionFilter","subfactionset","restricted","pickBy","getAllKeywords","keywords","getUnits","forEach","keyword","add","Array","from","getPowers","getStrategies","getPerks","getSetbacks","getSetback","setbackId","getPerk","perkId","getRelics","getRelic","relicId","getRelicCost","relic","console","log","getUnit","unitId","getModels","modelMap","option","replaceModel","castArray","addedModel","theModel","modelData","addModel","getAllModels","intersection","reduce","currModels","concat","getAddTerm","addLimit","addTerm","getModelAddTerm","modelLimit","limitSplit","split","getAddLimitTermUnit","getAddTermUnit","getAdditionalModelsList","upgrades","modelIndex","upgradeCount","modelPoints","trunc","getModelTotalPoints","modelStats","addList","text","points","modelIds","limit","choiceLimit","getOptionsList","unitData","selectedModels","selectedModelsRaw","unitTotalModels","sum","modelAddTerm","isEach","addedList","totalCost","addedWeaponList","addedListString","addedMod","mod","numThisModel","numThisModelRaw","totalOldCost","replaceLimit","modelReplaceLimit","replaceTerm","modelReplaceTerm","moddedModel","replaceTarget","replacedWith","replacedWithList","replaceList","newModModel","totalCostDiff","toNumber","all","replacedModel","replaceWeapon","replaceTermCount","replaceThingList","replacedWeapon","getWeaponCostForModel","withWeapon","replaceWith","cost","replaceRule","replace","getRuleCostForModel","withRule","replaceWithId","shortDescription","description_short","ruleInputs","ruleDescription","addWeapon","added","newCost","addRule","addedThing","removeRule","replaceWeaponList","avgCost","mean","getPowerCharge","power","dummyShooter","cachedPoints","psychicCost","effects","effect","pts","charge","finalCharge","clamp","getUnitPoints","modelWithUnitRules","modelPts","resolveVariable","variableName","variables","combinedVars","constants","val","isNil","isNumber","resolvePointsRecurse","pointsArray","isArray","total","arrItem","multiply","subtract","divide","resolvePoints","getModelPoints","weaponPoints","getModelWeaponPoints","rulePoints","getModelRulePoints","ptsTotal","defenseIncrease","getWeaponCostAverage","getRuleCostAverage","modifiedWeapon","weaponMountMult","isString","getWeaponPoints","wep","weps","weaponModelMult","short","weaponAP","ap","weaponRules","range","rangeCost","rangePoints","medium","isGrenade","attacks","resolvedPoints","damage","number","isFinite","reverse","JSON","stringify","getWeaponList","weaponList","getRulesList","ruleList","getWeapons","weaponsSet","weaponsList","wepList","getAllWeapons2","allWeapons","getAllWeapons","getAllRules","allRules","getAllWeaponRules","rulesSet","rulesList","wepy","profiles","hidden","getWeaponRules","flat","getModelRules","getRules","modelRules","getMissions","getMissionScenarios","getMissionWeather","weather","getMissionConditions","conditions","getMissionSecondaries","secondaries","mergeGlobalData","game","gameData","Focus","rawSubfactions","setSubfaction","factionColor","textColor","align","background","breakInside","Card","border","CardHeader","py","CardContent","disabled","StyledTableRow","TableRow","th","hover","Organization","nameFilter","strategy","toLowerCase","includes","org","orgSlots","p","Table","TableBody","categoryData","organizationData","TableCell","Overview","strengths","weaknesses","sortedPowers","secondaryAction","link","secondary","PowerCard","flavor","Powers","unitPhases","groupBy","phaseOrder","cat","phaseId","phaseIdx","phaseStrategies","sourceLength","sortedStrategies","phaseData","RuleList","toggler","twoColumn","showName","showRules","setShowRules","btnStyle","borderColor","marginBottom","block","Collapse","in","toUpperCase","stuff","WeaponList","twoColumns","factionSecondaryColor","secondary_color","textColorSecondary","thStyle","showWeapons","setShowWeapons","TableContainer","TableHead","weaponProfile","renderRules","dummyModel","RelicCard","printMode","relicCost","Relics","RELIC_TYPES","equipment","ability","groupedRelics","relicType","relicIdxKey","relicsType","sortedRelics","Rules","weaponsSorted","StrategyCard","Strategies","phaseKey","DescriptionModal","closeButton","UnitDebugModal","modelSelection","setModelSelection","unitPoints","unitModels","baseModelPoints","modelWeaponPoints","modelRulePoints","modelWeapons","striped","responsive","weaponPointsForModel","rulePointsForModel","OptionList","showOptions","setShowOptions","renderOptionList","opt","UnitStats","powerSpecialty","save","combinedString","perk","setback","str","unitPowerSpecialty","marginTop","modelString","renderAdditionalModels","UnitCard","subfactionId","unitOptions","embeddedOptions","toggle","focusView","showContext","unitWeapons","unitRules","weaponRuleList","unitSubfactions","subfac","unitSetbacksCount","hideUnitDescription","showUnitDescription","hideUnitDebug","showUnitDebug","customName","faBook","faBug","renderOptions","renderModelRules","renderModelExtraRules","Units","unitFilter","filterByFocus","pinnedUnits","setPinnedUnits","currentPage","setCurrentPage","pinned_units","unitsFiltered","numPages","ceil","sortOrder","first","second","findIndex","o","unitCategories","categoryOrder","handlePinUnit","omit","catIndex","categoryUnits","onPinUnit","pinned","mx","Pagination","page","scrollTo","top","yCoordinate","Weapons","allSteps","steps","selector","content","stepInteraction","match","params","gameName","someData","coreData","fetchFaction","setData","isLoading","refreshFaction","isMobile","down","isTourOpen","setIsTourOpen","activeTab","setActiveTab","retryCount","setRetryCount","globalData","buyLinks","rawFaction","DEFAULT_FILTER","enqueueSnackbar","useSnackbar","fileDialog","useRef","setCustomData","passedData","newGameData","customData","uploadFaction","preventDefault","then","armyObject","parse","e","newArmyData","appearance","newData","set","factionId","catch","message","current","reportUrl","multiple","ref","overflow","TABS","Forces","rawData","Legends","isModified","hiddenTabs","onMouseEnter","onMouseLeave","faExclamationCircle","Popover","disableRestoreFocus","version","bgcolor","pb","borderBottom","Tabs","newValue","tab","rosterTab","Tab","a11yProps","accentColor","onRequestClose","rounded","onAfterOpen","overflowY","onBeforeClose","Factions","deleteFaction","Number","allianceKey","allianceData","gutterBottom","Grid","xs","md","columns","sm","CardActionArea","goToFaction","CardMedia","url","CardActions","stopPropagation","MissionGenerator","mission","weathers","randomMission","setRandomMission","randomWeather","setRandomWeather","randomSecondary","setRandomSecondary","enableWeather","setEnableWeather","Sync","victory_conditions","sanitizeId","MarkdownRenderer","paragraph","h1","h2","h3","h4","h5","h6","a","el","element","getElementById","y","getBoundingClientRect","pageYOffset","behavior","img","maxHeight","StyledRules","gameRules","skirmishRules","gameTypeData","gameTypeName","isEqual","mdRenderer","terrains","components","rehypePlugins","RehypeToc","headings","rowSpacing","columnSpacing","rel","condition","nope","fetchGame","refreshData","coreGame","uploadFile","uploadList","listObject","forces","listName","uuidv4","setLists","resetCache","listData","newFactionList","omitBy","armyData","Scenarios","factionTab","Games","refreshAllData","gameTypesRaw","gamesUnsorted","gameCategories","refreshFactions","gamesTab","gameKey","idx","faCheckCircle","gameId","deleteGame","InputNumber","defaultValue","allowReset","changeValue","Stack","direction","TextField","inputMode","pattern","PrintView","listType","listTypeName","find","myType","totalForcePoints","force","legend","totalSP","totalForceReservePoints","legendLimit","forceFactionId","forceSubFactionId","forceFaction","thStyle2","forceCategories","forceUnits","factionRelics","forceLegends","filteredCategories","catKey","myUnit","flatWeps","uniqBy","allWeaponRules","weaponsRules","allSortedRules","allSortedWeapons","allPowerSpecialties","powerSp","powerSpecialtySet","unitIdx","selectedWeapons","selectedRules","unitSetbacks","unitPerks","unitLevel","experience","selectedOptionsList","phase","LIST_TYPES","UpdateList","updateList","oldListName","oldListType","setListName","setListType","BASE_THEME","MuiCardContent","styleOverrides","paddingBottom","MuiTabScrollButton","typography","fontFamily","PowerSpecialtySelector","powerCats","specialtyOptions","ChooseSubFaction","setSubFaction","forceId","disablePadding","AddLegend","addLegend","legends","sortedLegends","listLegendSet","filteredLegends","ListSubheader","AddForce","addForce","setFaction","subFaction","firstFaction","listAlliance","alliance","filteredAlliances","theFactions","filteredFactions","orgKey","subFactionId","AddUnit","addUnit","sortedUnits","ViewStrategies","phaseIndex","ViewPowers","powerSpecialties","powerCatSet","ViewUnit","injuryText","actionReference","ReferenceRules","ViewActionReference","isSkirmish","ViewLegend","EditUnit","setUnitOptions","setUnitPowerSpecialty","setUnitName","selectedOptions","hasPowerRule","renderOption","optIndex","selectedChoices","changeFuncCheck","newVal","shouldDisable","controlId","EditUnitCampaign","setUnitPerks","setUnitSetbacks","updateUnit","showPerkLevel","setShowPerkLevel","unitPerksData","unitSetbacksData","selectedSetbacks","selectedPerks","filteredSetbacks","perksByLevel","perkOrder","levelProgress","formattedLevel","perksLeft","canGetPerk","now","setbackCost","delete","faDice","thePerks","availablePerks","faChevronDown","faChevronUp","perkCost","faCheck","faTimes","PrintStyles","orgs","shouldStartEditMode","editMode","setEditMode","showReserves","setShowReserves","componentRef","doPrint","useReactToPrint","pageStyle","forceReserves","availableSetbacks","processUnits","daUnits","theUnit","unitKey","optionList","modelCounts","optItem","optIdx","selections","oldModelCounts","totalModels","indValue","itemIdx","selected","calculateUnitPoints","theLegend","legendKey","reserves","forceFactionIds","hideAddForce","showAddForce","allFactionsLoaded","every","factionUnits","factionUrl","updateForce","mappedForces","newArr","addUnitToForce","showingReserves","theForce","hideChooseSubfaction","showChooseSubfaction","hideAddUnit","showAddUnit","hideAddLegend","showAddLegend","hideEditUnit","showEditUnit","hideEditUnitCampaign","showEditUnitCampaign","hideViewUnit","showViewUnit","hideViewLegend","showViewLegend","hideViewStrategies","showViewStrategies","hideViewPowers","showViewPowers","hideViewActionReference","showViewActionReference","hideUpdateList","showUpdateList","Add","SPMult","LegendMult","validationErrors","totalLegends","exceededLegends","forceSubfaction","unitCatCount","unitDiff","createTheme","ThemeProvider","ScopedCssBaseline","renderPrintMode","wordBreak","Alert","severity","strategyPoints","victoryPoints","rawForceFaction","factionPowers","hasPowers","factionStrategies","faUser","zIndex","legendId","unitCopy","moveUnitReserves","faArrowRight","moveUnitForce","faArrowLeft","deleteUnit","RouterLink","normal","active","childLink","Code","PageNotFound","location","pathname","Privacy","ShareList","copyToClipboard","origin","AddList","setGameId","useLocation","queryParams","URLSearchParams","search","shareData","gamesRaw","rawLists","listsByGame","importList","atob","goToList","navigator","clipboard","writeText","err","hideAddList","showAddList","hideShareList","showShareList","hideEditList","showEditList","categoryLists","filteredLists","btoa","shareList","QuickRules","activeGameTypeData","activeRules","rulesTab","AutoPlaySwipeableViews","autoPlay","SwipeableViews","imgs","imgPath","SwipeableTextMobileStepper","images","activeStep","setActiveStep","maxSteps","Paper","square","elevation","pl","axis","onChangeIndex","step","enableMouseEvents","abs","MobileStepper","nextButton","prevActiveStep","backButton","shuffle","banners","iconSize","mrender","margin","randomImage","CARDS","backgroundImage","backgroundPosition","backgroundSize","logo","credit","card","useToc","Core","path","opts","optPath","optData","contextData","loc","locationTitle","ignoredPathes","breadCrumbTitles","usePageTitle","pt","exact","Splash","Updates","Faction","Rosters","Lists","updateCache","myData","usePointsCache","dataFetcher","myUrl","localData","localStorage","getItem","localPrefs","setUrl","overwrite","setIsLoading","isError","setIsError","updateData","setItem","fetchGameSystems","factionsUrl","fetchData","resultData","fetchFactions","fetchNameLists","namelistsUrl","fetchGameUpdates","updatesUrl","fetchTextData","fetchRules","rulesUrl","fetchSkirmishRules","fetchAllData","reset","resultDataNameLists","resultDataUpdates","resultDataRules","resultSkirmishRules","allData","lastFetch","someUrl","fetch","json","gameUrl","fullFactionUrl","test","factionData","newDataWithFaction","deep","stack","gameid","updateGameData","updatedData","useDataFetcher","browserTheme","userTheme","themeId","userPrimaryColor","notistackRef","createRef","onClickDismiss","closeSnackbar","serverUrl","process","REACT_APP_API","client","createClient","maxSnack","CssBaseline","Boolean","hostname","ReactDOM","render","basename","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.32c12b2c.chunk.js","sourcesContent":["import { Box, Typography } from \"@mui/material\";\nimport React from \"react\";\nfunction EmptyState(props) {\n  let variant;\n\n  switch (props.size) {\n    case \"small\":\n      variant = \"h6\";\n      break;\n\n    case \"medium\":\n      variant = \"h6\";\n      break;\n\n    case \"large\":\n      variant = \"h4\";\n      break;\n\n    default:\n      variant = \"h5\";\n      break;\n  }\n\n  return (\n    <Box\n      display=\"flex\"\n      flexDirection=\"column\"\n      alignItems=\"center\"\n      justifyContent=\"center\"\n      textAlign=\"center\"\n    >\n      {props.image && (\n        <Box display=\"flex\" flex={1}>\n          <img\n            src={props.image}\n            alt={props.title}\n            mb={props.title || props.description ? 2 : 0}\n            style={{ width: '100%' }}\n          />\n        </Box>\n      )}\n\n      {props.title && (\n        <Box mb={!props.description && props.button ? 2 : 0.5}>\n          <Typography sx={{ mt: 2 }} variant={variant}>{props.title}</Typography>\n        </Box>\n      )}\n\n      {props.description && (\n        <Box mb={props.button && 3}>\n          <Typography variant=\"body1\">{props.description}</Typography>\n        </Box>\n      )}\n\n      {props.button && props.button}\n    </Box>\n  );\n}\n\nEmptyState.defaultProps = {\n  type: \"page\",\n  size: \"medium\",\n  padding: 2,\n};\n\nexport default EmptyState;\n","export default __webpack_public_path__ + \"static/media/error.c16de614.svg\";","import React, { Component } from \"react\";\n\nimport PropTypes from \"prop-types\";\n\n// import * as Sentry from \"@sentry/browser\";\n\nimport EmptyState from \"components/empty-state\";\n\nimport ErrorIllustration from \"illustrations/error.svg\";\nimport { Container } from \"@mui/material\";\n\nclass ErrorBoundary extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      hasError: false,\n      eventId: null,\n    };\n  }\n\n  static getDerivedStateFromError(error) {\n    return { hasError: true };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    // Sentry.withScope((scope) => {\n    //   scope.setExtras(errorInfo);\n\n    //   const eventId = Sentry.captureException(error);\n\n    //   this.setState({\n    //     eventId: eventId,\n    //   });\n    // });\n  }\n\n  render() {\n    // Properties\n    const { children } = this.props;\n\n    const { hasError } = this.state;\n\n    if (hasError) {\n      return (\n        <Container>\n          <EmptyState\n            image={ErrorIllustration}\n            title=\"Something went wrong\"\n            description=\"The app failed to load\"\n          />\n        </Container>\n      );\n    }\n\n    return children;\n  }\n}\n\nErrorBoundary.propTypes = {\n  // Properties\n  children: PropTypes.array.isRequired,\n};\n\nexport default ErrorBoundary;\n","export const downloadFile = (exportObj, type, exportName) => {\n    const dataStr = `${type};charset=utf-8,` + encodeURIComponent(exportObj);\n    const downloadAnchorNode = document.createElement('a');\n    downloadAnchorNode.setAttribute(\"href\",     dataStr);\n    downloadAnchorNode.setAttribute(\"download\", exportName);\n    document.body.appendChild(downloadAnchorNode); // required for firefox\n    downloadAnchorNode.click();\n    downloadAnchorNode.remove();\n  }\n\n  export const readFileContent = (file) => {\n    const reader = new FileReader()\n    return new Promise((resolve, reject) => {\n      reader.onload = event => resolve(event.target.result)\n      reader.onerror = error => reject(error)\n      reader.readAsText(file)\n    })\n  };\n\n  export const isUrl = (s) => {\n    var regexp = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-/]))?/\n    return regexp.test(s);\n  }","import { mergeWith } from 'lodash';\nexport function customMerge(object, sources) {\n  return mergeWith(object, sources, ((objValue, srcValue) => {\n    if (srcValue === undefined) {\n      return undefined;\n    }\n  }))\n}\n\nexport const insert = (arr, index, newItem) => [\n  ...arr.slice(0, index),\n  newItem,\n  ...arr.slice(index)\n];","import { get, omitBy } from \"lodash\";\nimport { mergeWith, set } from \"lodash/fp\";\nimport React, {\n  memo, useCallback, useContext, useEffect, useMemo, useState\n} from \"react\";\nimport { createPortal } from \"react-dom\";\nimport ReactGA from \"react-ga\";\nimport { useLocation } from 'react-router-dom';\nimport styled from \"styled-components\";\nimport { isUrl } from \"utils/files\";\nimport { customMerge } from \"utils/misc\";\n\nexport const useDataFetcher = (myUrl) => {\n  const localData = JSON.parse(localStorage.getItem(\"data\") || \"{}\");\n  const localPrefs = JSON.parse(localStorage.getItem(\"userPrefs\") || \"{}\");\n  const [data, setData] = useState(localData);\n  const [userPrefs, setUserPrefs] = useState(localPrefs);\n  const [appState, setAppState] = useState({});\n  const [url, setUrl] = useState(\n    myUrl || \"https://raw.githubusercontent.com/wargame-engine/root/master/\"\n  );\n  // Directly overwrite faction related stuff\n  const overwrite = new Set([\n    \"powerCategories\",\n    \"weather\",\n    \"secondaries\",\n    \"missions\",\n    \"buyLinks\",\n    \"units\",\n    \"powers\",\n    \"terrain\",\n    \"strategies\",\n    \"weapons\",\n    \"rules\",\n    \"perks\",\n    \"models\",\n    \"subfactions\",\n    \"setbacks\",\n    \"relics\",\n    \"categories\",\n    \"organizations\",\n    \"alliances\",\n  ]);\n  // const missionUrl = \"/data/missions/index.json\";\n  const ruleUrl = \"/data/rules.md\";\n  const skirmishRuleUrl = \"/data/rules_skirmish.md\";\n  const [isLoading, setIsLoading] = useState(false);\n  const [isError, setIsError] = useState(false);\n\n  const updateUserPrefs = (myData) => {\n    const newData = {\n      ...userPrefs,\n      ...myData,\n    };\n    localStorage.setItem(\"userPrefs\", JSON.stringify(newData));\n    setUserPrefs(newData);\n  };\n  const updateData = (myData) => {\n    localStorage.setItem(\"data\", JSON.stringify(myData));\n    setData(myData);\n  };\n  const fetchGameSystems = React.useCallback(async (factionsUrl) => {\n    return fetchData(`${factionsUrl || url}index.json`)\n      .then((resultData) => {\n        return resultData;\n      })\n      .catch((e) => {});\n  }, [url]);\n  const fetchFactions = async (factionsUrl) => {\n    return fetchData(`${factionsUrl}index.json`)\n      .then((resultData) => {\n        return resultData;\n      })\n      .catch((e) => {});\n  };\n  // const fetchMissions = async (missionsUrl) => {\n  //   return fetchData(missionsUrl || missionUrl)\n  //     .then((resultData) => {\n  //       return resultData;\n  //     })\n  //     .catch((e) => Promise.reject(e));\n  // };\n  const fetchNameLists = React.useCallback(async (namelistsUrl) => {\n    return fetchData(`${namelistsUrl || url}namelists.json`)\n      .then((resultData) => {\n        return resultData;\n      })\n      .catch((e) => Promise.reject(e));\n  }, [url]);\n  const fetchGameUpdates = React.useCallback(async (updatesUrl) => {\n    return fetchTextData(`${updatesUrl || url}updates.md`)\n      .then((resultData) => {\n        return resultData;\n      })\n      .catch((e) => Promise.reject(e));\n  }, [url]);\n  const fetchRules = React.useCallback(async (rulesUrl) => {\n    return fetchTextData(rulesUrl || ruleUrl)\n      .then((resultData) => {\n        return resultData;\n      })\n      .catch((e) => Promise.reject(e));\n  }, []);\n  const fetchSkirmishRules = React.useCallback(async (rulesUrl) => {\n    return fetchTextData(rulesUrl || skirmishRuleUrl)\n      .then((resultData) => {\n        return resultData;\n      })\n      .catch((e) => Promise.reject(e));\n  }, []);\n  const fetchAllData = React.useCallback(async (reset = false) => {\n    const resultData = await fetchGameSystems();\n    // const resultDataMissions = await fetchMissions();\n    const resultDataNameLists = await fetchNameLists();\n    const resultDataUpdates = await fetchGameUpdates();\n    const resultDataRules = await fetchRules();\n    const resultSkirmishRules = await fetchSkirmishRules();\n    const allData = {\n      lastFetch: Date.now(),\n      gameData: {\n        ...get(data, \"gameData\", {}),\n        ...resultData,\n        globalData: {\n          ...get(data, \"gameData.globalData\", {}),\n          ...get(resultData, \"globalData\", {}),\n          all: {\n            ...get(data, \"gameData.globalData.all\", {}),\n            ...get(resultData, \"globalData.all\", {}),\n            nameLists: resultDataNameLists,\n          },\n        },\n      },\n      customData: reset\n        ? {}\n        : {\n            ...get(data, \"customData\", {}),\n          },\n      updates: resultDataUpdates,\n      gameRules: resultDataRules,\n      skirmishRules: resultSkirmishRules,\n      lists: get(data, \"lists\", {}),\n    };\n    updateData(allData);\n    return allData;\n  }, [data, fetchGameSystems, fetchGameUpdates, fetchNameLists, fetchRules, fetchSkirmishRules]);\n  useEffect(() => {\n    const hasGameData = !Object.keys(get(data, `gameData.games`, {})).length;\n    const MAX_CACHE_AGE = 2 * 60 * 60 * 1000; // 2 hours\n    if (hasGameData || Date.now() - get(data, `lastFetch`, 0) > MAX_CACHE_AGE) {\n      fetchAllData();\n    }\n  }, [data, fetchAllData, url]);\n\n  const refreshData = (gameid) => {\n    const gameUrl = get(data, `gameData.games[${gameid}].url`);\n    if (!gameUrl) {\n      return Promise.resolve({});\n    }\n    return fetchFactions(`${gameUrl}`)\n      .then((gameData) => {\n        let newData = {\n          ...data,\n          gameData: {\n            ...get(data, \"gameData\", {}),\n            games: {\n              ...get(data, \"gameData.games\", {}),\n              [gameid]: {\n                ...get(data, `gameData.games[${gameid}]`),\n                ...gameData,\n              },\n            },\n          },\n          customData: {\n            games: {\n              ...get(data, \"customData.games\", {}),\n              [gameid]: {},\n            },\n          },\n        };\n        updateData(newData);\n        return gameData;\n      })\n      .catch((error) => {\n        return Promise.resolve({});\n      });\n  };\n\n  const refreshFaction = (gameid, factionName) => {\n    return fetchFaction(gameid, factionName)\n      .then((gameData) => {\n        let newData = {\n          ...data,\n          customData: {\n            games: {\n              ...get(data, \"customData.games\", {}),\n            },\n          },\n        };\n        if (get(data, `customData.games[${gameid}]`)) {\n          newData.customData.games[gameid] = {\n            ...get(data, `customData.games[${gameid}]`, {}),\n            factions: {\n              ...get(data, `customData.games[${gameid}].factions`, {}),\n              [factionName]: {},\n            },\n          };\n        }\n        updateData(newData);\n        return gameData;\n      })\n      .catch((error) => {\n        return Promise.resolve({});\n      });\n  };\n\n  const fetchTextData = async (someUrl) => {\n    setIsError(false);\n    setIsLoading(true);\n    try {\n      const result = await fetch(someUrl);\n      const resultData = await result.text();\n      setIsLoading(false);\n      return resultData;\n    } catch (error) {\n      setIsError(true);\n      setIsLoading(false);\n      return Promise.reject(error);\n    }\n  };\n\n  const fetchData = async (someUrl) => {\n    setIsError(false);\n    setIsLoading(true);\n    try {\n      const result = await fetch(someUrl);\n      const resultData = await result.json();\n      setIsLoading(false);\n      return resultData;\n    } catch (error) {\n      setIsError(true);\n      setIsLoading(false);\n      return Promise.reject(error);\n    }\n  };\n\n  const updateGameData = (gameName, updatedData) => {\n    const newData = {\n      ...data,\n      games: {\n        ...get(data, \"games\", {}),\n        [gameName]: {\n          ...[get(data, `games[${gameName}]`, {}), updatedData].reduce(\n            customMerge\n          ),\n        },\n      },\n    };\n    updateData(newData);\n  };\n\n  const fetchFaction = (gameName, factionName) => {\n    const fetch = async () => {\n      const gameUrl =\n        get(data, `gameData.games[${gameName}].url`) ||\n        get(data, `customData.games[${gameName}].url`);\n      if (!gameUrl) {\n        return Promise.resolve({});\n      }\n      const gameData = await fetchFactions(`${gameUrl}`);\n      const newData = set(\n        `gameData.games.${gameName}`,\n        { ...gameData, ...get(data, `gameData.games.${gameName}`, {}) },\n        data\n      );\n      const factionUrl =\n        get(\n          newData,\n          `gameData.games[${gameName}].factions[${factionName}].url`\n        ) ||\n        get(\n          newData,\n          `customData.games[${gameName}].factions[${factionName}].url`\n        );\n      if (!factionUrl) {\n        return Promise.resolve({});\n      }\n      const fullFactionUrl = isUrl(factionUrl)\n        ? factionUrl\n        : `${gameUrl}${factionUrl}`;\n      const factionData = await fetchData(fullFactionUrl);\n      const newDataWithFaction = set(\n        `gameData.games.${gameName}.factions.${factionName}`,\n        {\n          ...get(gameData, `factions[${factionName}]`, {}),\n          ...get(\n            data,\n            `gameData.games[${gameName}].factions[${factionName}]`,\n            {}\n          ),\n          ...factionData,\n        },\n        newData\n      );\n      updateData(newDataWithFaction);\n      return factionData;\n    };\n    return fetch();\n  };\n\n  const fetchGame = (gameid) => {\n    const fetch = async () => {\n      const gameUrl = get(data, `gameData.games[${gameid}].url`);\n      if (!gameUrl) {\n        return Promise.resolve({});\n      }\n      return fetchFactions(`${gameUrl}`)\n        .then((gameData) => {\n          let newData = {\n            ...data,\n            gameData: {\n              ...get(data, \"gameData\", {}),\n              games: {\n                ...get(data, \"gameData.games\", {}),\n                [gameid]: {\n                  ...gameData,\n                  ...omitBy(\n                    get(data, `gameData.games[${gameid}]`, {}),\n                    (game) => game.url\n                  ),\n                },\n              },\n            },\n          };\n          updateData(newData);\n          return gameData;\n        })\n        .catch((error) => {\n          return Promise.resolve({});\n        });\n    };\n    fetch();\n  };\n\n  const deep = mergeWith(\n    (objValue, srcValue, key, object, source, stack) => {\n      if (overwrite.has(key)) {\n        return srcValue;\n      }\n    },\n    get(data, \"gameData\", {}),\n    get(data, \"customData\", {})\n  );\n  const mergedData = {\n    ...data,\n    gameData: deep,\n  };\n  return [\n    {\n      data: mergedData,\n      coreData: data,\n      isLoading,\n      isError,\n      refreshFaction,\n      setUrl,\n      fetchFaction,\n      fetchGame,\n      setData: updateData,\n      updateGameData,\n      refreshData,\n      refreshAllData: fetchAllData,\n      appState,\n      setAppState,\n      userPrefs,\n      setUserPrefs: updateUserPrefs,\n    },\n  ];\n};\n\nexport const usePointsCache = () => {\n  // const localData = JSON.parse(localStorage.getItem(\"pointsCache\") || \"{}\");\n  //let data = { ...localData };\n  let data = {};\n\n  const updateCache = (myData) => {\n    //localStorage.setItem('pointsCache', JSON.stringify(myData));\n    data = myData;\n  };\n\n  const setCache = (key, value) => {\n    updateCache({\n      ...data,\n      [key]: value,\n    });\n  };\n\n  const getCache = (key) => {\n    return data[key];\n  };\n\n  const resetCache = () => {\n    updateCache({});\n  };\n\n  return { getCache, setCache, resetCache };\n};\n\nexport const usePageTracking = () => {\n  const location = window.location;\n  const [initialized, setInitialized] = useState(false);\n\n  useEffect(() => {\n    if (!window.location.href.includes(\"localhost\")) {\n      ReactGA.initialize(\"UA-191175744-1\");\n      setInitialized(true);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (initialized) {\n      ReactGA.pageview(location.pathname + location.search);\n    }\n  }, [initialized, location]);\n};\n\nfunction getWindowDimensions() {\n  const { innerWidth: width, innerHeight: height } = window;\n  return {\n    width,\n    height,\n  };\n}\n\nexport function useWindowDimensions() {\n  const [windowDimensions, setWindowDimensions] = useState(\n    getWindowDimensions()\n  );\n\n  useEffect(() => {\n    function handleResize() {\n      setWindowDimensions(getWindowDimensions());\n    }\n\n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, []);\n\n  return windowDimensions;\n}\n\nexport const PointsCacheContext = React.createContext({});\nexport const DataContext = React.createContext({});\n\nexport function usePortal() {\n  const portalElRef = React.useRef(document.createElement(\"div\"));\n\n  React.useEffect(() => {\n    const theRef = portalElRef.current;\n    document.body.appendChild(theRef);\n\n    return () => {\n      if (theRef) {\n        document.body.removeChild();\n      }\n    };\n  }, [portalElRef]);\n\n  const Portal = React.useCallback(\n    ({ children }) => {\n      if (portalElRef.current != null)\n        return createPortal(children, portalElRef.current);\n      return null;\n    },\n    [portalElRef]\n  );\n\n  return Portal;\n}\n\n// Usage\n// const ModalPortal = usePortal();\n\n// return (\n//   <DialogPortal>\n//     <div className=\"overlay\">\n//       <div className=\"content\">\n//         <h2>This header is inside modal</h2>\n//       </div>\n//     </div>\n//   </ModalPortal>\n// )\n\nconst Wrapper = styled.div`\n  font-size: var(--sev1-size);\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  padding: 2em;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(0, 0, 0, 0.7);\n  z-index: 1000;\n`;\n\n/**\n * Throw error when ModalContext is used outside of context provider\n */\nconst invariantViolation = () => {\n  throw new Error(\n    \"Attempted to call useModal outside of modal context. Make sure your app is rendered inside ModalProvider.\"\n  );\n};\n\n/**\n * Modal Context Object\n */\nexport const ModalContext = React.createContext({\n  showModal: invariantViolation,\n  hideModal: invariantViolation,\n});\nModalContext.displayName = \"ModalContext\";\n\n/**\n * Modal Provider\n *\n * Provides modal context and renders ModalRoot.\n */\nexport const ModalProvider = ({ container, rootComponent, children }) => {\n  if (container && !(container instanceof HTMLElement)) {\n    throw new Error(`Container must specify DOM element to mount modal root into.\n    This behavior has changed in 3.0.0. Please use \\`rootComponent\\` prop instead.\n    See: https://github.com/mpontus/react-modal-hook/issues/18`);\n  }\n  const [modals, setModals] = useState({});\n  const showModal = useCallback(\n    (key, modal, extraProps) =>\n      setModals((modals) => ({\n        ...modals,\n        [key]: { modal, extraProps },\n      })),\n    []\n  );\n  const hideModal = useCallback(\n    (key) =>\n      setModals((modals) => {\n        if (!modals[key]) {\n          return modals;\n        }\n        const newModals = { ...modals };\n        delete newModals[key];\n        return newModals;\n      }),\n    []\n  );\n  const contextValue = useMemo(() => ({ showModal, hideModal }), [hideModal, showModal]);\n\n  return (\n    <ModalContext.Provider value={contextValue}>\n      <React.Fragment>\n        {children}\n        <ModalRoot\n          modals={modals}\n          component={rootComponent}\n          container={container}\n        />\n      </React.Fragment>\n    </ModalContext.Provider>\n  );\n};\n\n/**\n * Component responsible for rendering the modal.\n *\n * The identity of `Component` may change dependeing on the inputs passed to\n * `useModal`. If we simply rendered `<Component />` then the modal would be\n * susceptible to rerenders whenever one of the inputs change.\n */\nconst ModalRenderer = memo((props) => {\n  const { component, extraProps, ...rest } = props;\n  return component({ extraProps, ...rest });\n});\n\n/**\n * Modal Root\n *\n * Renders modals using react portal.\n */\nexport const ModalRoot = memo(\n  ({ modals, container, component: RootComponent = React.Fragment }) => {\n    const [mountNode, setMountNode] = useState(undefined);\n\n    // This effect will not be ran in the server environment\n    useEffect(() => setMountNode(container || document.body), [container]);\n\n    return mountNode\n      ? createPortal(\n          <RootComponent>\n            {Object.keys(modals).map((key) => {\n              return (\n                <Wrapper>\n                  <ModalRenderer\n                    key={key}\n                    component={modals[key].modal}\n                    extraProps={modals[key].extraProps}\n                  />\n                </Wrapper>\n              );\n            })}\n          </RootComponent>,\n          mountNode\n        )\n      : null;\n  }\n);\n\n/**\n * Utility function to generate unique number per component instance\n */\nconst generateModalKey = (() => {\n  let count = 0;\n\n  return () => `${++count}`;\n})();\n\n/**\n * Check whether the argument is a stateless component.\n *\n * We take advantage of the stateless nature of functional components to be\n * inline the rendering of the modal component as part of another immutable\n * component.\n *\n * This is necessary for allowing the modal to update based on the inputs passed\n * as the second argument to useModal without unmounting the previous version of\n * the modal component.\n */\nconst isFunctionalComponent = (Component) => {\n  const prototype = Component.prototype;\n\n  return !prototype || !prototype.isReactComponent;\n};\n\n/**\n * React hook for showing modal windows\n */\nexport const useModal = (component, inputs = []) => {\n  if (!isFunctionalComponent(component)) {\n    throw new Error(\n      \"Only stateless components can be used as an argument to useModal. You have probably passed a class component where a function was expected.\"\n    );\n  }\n\n  const key = useMemo(generateModalKey, []);\n  const modal = useMemo(() => component, [component]);\n  const context = useContext(ModalContext);\n  const [extraProps, setExtraProps] = useState({});\n  const [isShown, setShown] = useState(false);\n  const showModal = useCallback((extraProps) => {\n    setShown(true)\n    return setExtraProps(extraProps);\n  }, []);\n  const hideModal = useCallback(() => setShown(false), []);\n\n  useEffect(() => {\n    if (isShown) {\n      context.showModal(key, modal, extraProps);\n    } else {\n      context.hideModal(key);\n    }\n\n    // Hide modal when parent component unmounts\n    return () => context.hideModal(key);\n  }, [modal, isShown, context, key, extraProps]);\n\n  return [showModal, hideModal];\n};\n\nconst initialState = { session: null, user: null };\nexport const AuthContext = React.createContext(initialState);\n\nexport function AuthProvider({ children }) {\n  // const client = useClient();\n  // const [state, setState] = useState(initialState);\n  // const userId = get(state, 'user.id');\n\n  // useEffect(() => {\n  //   const session = client.auth.session();\n  //   setState({ session, user: session?.user ?? null });\n  // }, []);\n  \n  // async function getProfile() {\n  //   try {\n  //     const user = client.auth.user();\n\n  //     let { data, error, status } = await client\n  //       .from(\"profiles\")\n  //       .select(`username, website, avatar_url`)\n  //       .eq(\"id\", userId)\n  //       .single();\n\n  //     // if (error && status !== 406) {\n  //     //   setError(error);\n  //     // }\n\n  //     if (data) {\n  //       setState({ ...state, profile: data });\n  //     }\n  //   } catch (error) {\n  //     // alert(error.message);\n  //   }\n  // }\n\n  // async function updateProfile({ username, website, avatar_url }) {\n  //   try {\n  //     const user = client.auth.user();\n\n  //     const updates = {\n  //       id: user.id,\n  //       username,\n  //       website,\n  //       avatar_url,\n  //       updated_at: new Date(),\n  //     };\n\n  //     const result = await client.from(\"profiles\").upsert(updates, {\n  //       returning: \"minimal\", // Don't return the value after inserting\n  //     });\n\n  //     setState({ ...state, profile: { ...state?.profile, username, website, avatar_url }});\n  //     return result;\n  //   } catch (error) {\n  //     throw error;\n  //   }\n  // }\n\n  // useEffect(() => {\n  //   if (!userId) {\n  //     setState({ ...state, profile: null });\n  //   } else {\n  //     getProfile();\n  //   }\n  // }, [ userId ]);\n\n  // useAuthStateChange((event, session) => {\n  //   setState({ session, user: session?.user ?? null });\n  // });\n\n  // const data = {\n  //   ...state,\n  //   updateProfile\n  // };\n\n  //return <AuthContext.Provider value={data}>{children}</AuthContext.Provider>;\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined)\n    throw Error(\"useAuth must be used within AuthProvider\");\n  return context;\n}\n\nconst breadCrumbDefaults = {\n  '': 'Home',\n  factions: 'Factions',\n  rules: 'Rules',\n  games: 'Games',\n  missions: 'Missions',\n  quickstart: 'Rules',\n  updates: 'Updates',\n  privacy: 'Privacy Policy',\n  lists: 'Rosters'\n};\n\nexport function usePageTitle(opts = {}) {\n  const { path: optPath, optData } = opts;\n  const [{ data: contextData }] = React.useContext(DataContext);\n  const data = optData ?? contextData;\n  const loc = useLocation();\n  const path = optPath ?? loc.pathname;\n  const [ locationTitle ] = path.split('/').slice(-1);\n  //const ignoredPathes = new Set(['lists']);\n  const ignoredPathes = new Set([]);\n  const titles = React.useMemo(() => {\n    const breadCrumbTitles = {\n      ...breadCrumbDefaults\n    };\n    Object.keys(get(data, 'gameData.games', {})).forEach((gameId) => {\n      const game = get(data, `gameData.games[${gameId}]`);\n      Object.keys(get(game, 'factions', {})).forEach((factionId) => {\n        const faction = get(data, `gameData.games[${gameId}].factions[${factionId}]`);\n        breadCrumbTitles[factionId] = faction.name;\n      });\n      breadCrumbTitles[gameId] = game.name;\n    });\n    const lists = get(data, 'lists', {});\n    Object.keys(lists).forEach((listId) => {\n      const list = lists[listId];\n      breadCrumbTitles[listId] = list.name;\n    });\n    return breadCrumbTitles;\n  }, [ data ]);\n  let title = titles[locationTitle] || locationTitle;\n  title = ignoredPathes.has(title) ? null : title;\n  return title;\n};\n","import React from \"react\";\nimport { Container, Box } from \"@mui/material\";\nimport { useWindowDimensions } from \"hooks\";\nimport './footer.css';\nimport { Link } from '@mui/material';\n\n// {'Miniatures from '} <a href=\"http://khurasanminiatures.tripod.com/\">Khurasan Miniatures</a>\nexport const Footer = () => {\n  const dimensions = useWindowDimensions();\n  return (\n    <Container>\n      <Box display=\"flex\" sx={{ mt: 2, mb: 2 }}>\n        <Box display=\"flex\" flexGrow={1}>\n          {/* <a href=\"/updates\" target=\"_blank\"> {'Updates'}</a>\n              <a href=\"https://github.com/wargame-engine\" target=\"_blank\">\n                {\" \"}\n                {\"Github\"}\n              </a>\n              <a href=\"https://discord.gg/M9sets4\" target=\"_blank\">\n                {\" \"}\n                {\"Discord\"}\n              </a> */}\n          <Link href=\"/privacy\"> {\"Privacy Policy\"}</Link>\n          {/* <a href=\"https://www.patreon.com/bePatron?u=36845786\" target=\"_blank\"> {'Patreon'}</a> */}\n        </Box>\n        <Box className={dimensions.width > 768 ? \"text-right\" : \"\"}>\n          &#169; <Link href=\"https://www.indiegamerules.com\">Indie Game Rules</Link>{\" \"}\n          {new Date().getFullYear()}\n        </Box>\n      </Box>\n    </Container>\n  );\n};\n","export default __webpack_public_path__ + \"static/media/battleforged_anvil.60c74805.png\";","import {\n  red,\n  pink,\n  purple,\n  deepPurple,\n  indigo,\n  blue,\n  lightBlue,\n  cyan,\n  teal,\n  green,\n  lightGreen,\n  lime,\n  yellow,\n  amber,\n  orange,\n  deepOrange,\n  brown,\n  grey as gray,\n  blueGrey as blueGray,\n} from \"@mui/material/colors\";\nimport { camelCase } from 'lodash';\n\nexport function getTextColor(rgb) {\n  // http://www.w3.org/TR/AERT#color-contrast\n  const brightness = Math.round(((parseInt(rgb.r) * 299) +\n    (parseInt(rgb.g) * 587) +\n    (parseInt(rgb.b) * 114)) / 1000);\n  const textColour = (brightness > 150) ? '#3E3E3E' : 'white';\n  return textColour;\n}\n\nexport function componentToHex(c) {\n  var hex = c.toString(16);\n  return hex.length === 1 ? \"0\" + hex : hex;\n}\n\nexport function rgbToHex(r, g, b) {\n  return \"#\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\n}\n\nexport function hexToRgb(hex) {\n  var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n  return result ? {\n    r: parseInt(result[1], 16),\n    g: parseInt(result[2], 16),\n    b: parseInt(result[3], 16)\n  } : null;\n}\n\nexport const colors = {\n  red: {\n    id: \"red\",\n    name: \"Red\",\n    import: red,\n  },\n\n  pink: {\n    id: \"pink\",\n    name: \"Pink\",\n    import: pink,\n  },\n\n  purple: {\n    id: \"purple\",\n    name: \"Purple\",\n    import: purple,\n  },\n\n  deepPurple: {\n    id: \"deep-purple\",\n    name: \"Deep Purple\",\n    import: deepPurple,\n  },\n\n  indigo: {\n    id: \"indigo\",\n    name: \"Indigo\",\n    import: indigo,\n  },\n\n  blue: {\n    id: \"blue\",\n    name: \"Blue\",\n    import: blue,\n  },\n\n  lightBlue: {\n    id: \"light-blue\",\n    name: \"Light Blue\",\n    import: lightBlue,\n  },\n\n  cyan: {\n    id: \"cyan\",\n    name: \"Cyan\",\n    import: cyan,\n  },\n\n  teal: {\n    id: \"teal\",\n    name: \"Teal\",\n    import: teal,\n  },\n\n  green: {\n    id: \"green\",\n    name: \"Green\",\n    import: green,\n  },\n\n  lightGreen: {\n    id: \"light-green\",\n    name: \"Light Green\",\n    import: lightGreen,\n  },\n\n  lime: {\n    id: \"lime\",\n    name: \"Lime\",\n    import: lime,\n  },\n\n  yellow: {\n    id: \"yellow\",\n    name: \"Yellow\",\n    import: yellow,\n  },\n\n  amber: {\n    id: \"amber\",\n    name: \"Amber\",\n    import: amber,\n  },\n\n  orange: {\n    id: \"orange\",\n    name: \"Orange\",\n    import: orange,\n  },\n\n  deepOrange: {\n    id: \"deep-orange\",\n    name: \"Deep Orange\",\n    import: deepOrange,\n  },\n\n  brown: {\n    id: \"brown\",\n    name: \"Brown\",\n    import: brown,\n  },\n\n  gray: {\n    id: \"gray\",\n    name: \"Gray\",\n    import: gray,\n  },\n\n  blueGray: {\n    id: \"blue-gray\",\n    name: \"Blue Gray\",\n    import: blueGray,\n  },\n};\n\nexport const getColor = (colorId) => {\n  if (!colorId) {\n    return null;\n  }\n\n  colorId = camelCase(colorId);\n\n  return colors[colorId];\n};","import {\n  Checkbox, FormControl, FormControlLabel, FormGroup, FormLabel, InputLabel, MenuItem, Radio, RadioGroup, Select\n} from \"@mui/material\";\nimport Button from \"@mui/material/Button\";\nimport Dialog from \"@mui/material/Dialog\";\nimport DialogActions from \"@mui/material/DialogActions\";\nimport DialogContent from \"@mui/material/DialogContent\";\nimport DialogTitle from \"@mui/material/DialogTitle\";\nimport React, { useState } from \"react\";\nimport { colors } from 'utils/colors';\n\nconst THEMES = [\n  { label: \"Light\", value: \"light\" },\n  { label: \"Dark\", value: \"dark\" },\n];\n\nexport const UserPreferences = (props) => {\n  const { hideModal, userPrefs, setUserPrefs } = props;\n  const [localUserPrefs, setLocalUserPrefs] = useState(userPrefs);\n  const colorOptions = Object.values(colors).map((color, index) => {\n    return <MenuItem key={index} value={color.id}>{color.name}</MenuItem>;\n  });\n  const primaryColor = localUserPrefs?.primaryColor;\n  return (\n    <>\n      <Dialog open fullWidth maxWidth=\"sm\" onClose={hideModal}>\n        <DialogTitle>Settings</DialogTitle>\n        <DialogContent>\n          <FormGroup>\n            <FormControl component=\"fieldset\">\n              <FormLabel component=\"legend\">Theme</FormLabel>\n              <RadioGroup\n                row\n                aria-label=\"theme-radio\"\n                name=\"theme-radio-group\"\n                value={localUserPrefs?.theme}\n                onChange={(event) => {\n                  setLocalUserPrefs({\n                    ...localUserPrefs,\n                    theme: event.target.value,\n                  });\n                }}\n              >\n                {THEMES.map((type) => (\n                  <FormControlLabel\n                    key={type.value}\n                    value={type.value}\n                    control={<Radio />}\n                    label={type.label}\n                  />\n                ))}\n              </RadioGroup>\n            </FormControl>\n          </FormGroup>\n          <FormGroup sx={{ my: 1 }}>\n            <FormControl>\n              <InputLabel id=\"primary-color-label\">Primary Color</InputLabel>\n              <Select\n                labelId=\"primary-color-label\"\n                id=\"primary-color\"\n                value={primaryColor}\n                label=\"Primary Color\"\n                onChange={(event) => {\n                  setLocalUserPrefs({\n                    ...localUserPrefs,\n                    primaryColor: event.target.value,\n                  })\n                }}\n              >\n                {colorOptions}\n              </Select>\n            </FormControl>\n          </FormGroup>\n          <FormGroup>\n            <FormControl component=\"fieldset\">\n              <FormControlLabel\n                control={\n                  <Checkbox\n                    onChange={() =>\n                      setLocalUserPrefs({\n                        ...localUserPrefs,\n                        showBeta: !localUserPrefs.showBeta,\n                      })\n                    }\n                    checked={localUserPrefs.showBeta}\n                  />\n                }\n                label=\"Show Beta Content\"\n              />\n            </FormControl>\n          </FormGroup>\n          <FormGroup>\n            <FormControl component=\"fieldset\">\n              <FormControlLabel\n                control={\n                  <Checkbox\n                    onChange={() =>\n                      setLocalUserPrefs({\n                        ...localUserPrefs,\n                        developerMode: !localUserPrefs.developerMode,\n                      })\n                    }\n                    checked={localUserPrefs.developerMode}\n                  />\n                }\n                label=\"Enable Developer Mode\"\n              />\n            </FormControl>\n          </FormGroup>\n        </DialogContent>\n        <DialogActions>\n          <Button color=\"secondary\" onClick={hideModal}>\n            Cancel\n          </Button>\n          <Button\n            color=\"primary\"\n            onClick={() => {\n              setUserPrefs(localUserPrefs);\n              hideModal();\n            }}\n          >\n            Save\n          </Button>{\" \"}\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n","import React from \"react\";\n\nexport const Dropdown = (props) => {\n  const { children, as } = props;\n  const [isOpen, setIsOpen] = React.useState(false);\n  const [anchorElement, setAnchorElement] = React.useState(null);\n  const handleClose = () => {\n    setIsOpen(false);\n    setAnchorElement(null);\n  }\n  const handleOpen = (event) => {\n    setIsOpen(true);\n    setAnchorElement(event.currentTarget);\n  }\n  if (!children || !(typeof children === 'function')) {\n    return <></>;\n  }\n  return (\n    <>\n      <as onClick={(event) => setIsOpen(true)} />\n      {children({\n        open: isOpen,\n        handleClose,\n        handleOpen,\n        anchorElement\n      })}\n    </>\n  );\n};\n","import { createAvatar } from \"@dicebear/avatars\";\nimport * as style from \"@dicebear/personas\";\nimport { Home } from '@mui/icons-material';\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\nimport FeaturedPlayListIcon from '@mui/icons-material/FeaturedPlayList';\nimport MenuIcon from '@mui/icons-material/Menu';\nimport MenuBookIcon from '@mui/icons-material/MenuBook';\nimport SearchIcon from '@mui/icons-material/Search';\nimport SettingsIcon from '@mui/icons-material/Settings';\nimport { ListItemButton, Menu, MenuItem } from '@mui/material';\nimport AppBar from '@mui/material/AppBar';\nimport Avatar from '@mui/material/Avatar';\nimport Box from '@mui/material/Box';\nimport Button from '@mui/material/Button';\nimport Container from '@mui/material/Container';\nimport Divider from '@mui/material/Divider';\nimport IconButton from '@mui/material/IconButton';\nimport InputBase from '@mui/material/InputBase';\nimport List from '@mui/material/List';\nimport ListItem from '@mui/material/ListItem';\nimport ListItemIcon from '@mui/material/ListItemIcon';\nimport ListItemText from '@mui/material/ListItemText';\nimport { alpha, styled, useTheme } from '@mui/material/styles';\nimport useMediaQuery from \"@mui/material/useMediaQuery\";\nimport SwipeableDrawer from '@mui/material/SwipeableDrawer';\nimport Toolbar from '@mui/material/Toolbar';\nimport Typography from '@mui/material/Typography';\nimport IGR from \"assets/battleforged_anvil.png\";\nimport { DataContext, useModal } from \"hooks\";\nimport Dice6 from 'mdi-material-ui/Dice6';\nimport Discord from 'mdi-material-ui/Discord';\nimport Github from 'mdi-material-ui/Github';\nimport Newspaper from 'mdi-material-ui/Newspaper';\nimport React from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { UserPreferences } from \"routes/modals\";\nimport MoreVertIcon from '@mui/icons-material/MoreVert';\nimport { Dropdown } from \"components/dropdown\";\n\nconst drawerWidth = 250;\n\nconst DrawerHeader = styled('div')(({ theme }) => ({\n  display: 'flex',\n  alignItems: 'center',\n  padding: theme.spacing(0, 1),\n  // necessary for content to be below app bar\n  ...theme.mixins.toolbar,\n  justifyContent: 'flex-end',\n}));\n\n// const Avatar = styled.div`\n//   background-color: var(--colors-hr);\n//   padding: 5px;\n//   display: inline-block;\n//   &:hover {\n//     box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);\n//   }\n// `;\n\nconst navItems = [\n  {\n    id: 'home',\n    name: 'Home',\n    icon: <Home />,\n    to: '/'\n  },\n  {\n    id: 'games',\n    name: 'Games',\n    icon: <Dice6 />,\n    to: '/games'\n  },\n  {\n    id: 'lists',\n    name: 'Rosters',\n    icon: <FeaturedPlayListIcon />,\n    to: '/lists'\n  },\n  {\n    id: 'rules',\n    name: 'Rules',\n    icon: <MenuBookIcon />,\n    to: '/rules'\n  },\n  {\n    id: 'news',\n    name: 'Updates',\n    icon: <Newspaper />,\n    to: '/updates'\n  },\n  {\n    id: 'divider'\n  },\n  {\n    id: 'github',\n    name: 'Github',\n    icon: <Github />,\n    toAbs: 'https://github.com/wargame-engine'\n  },\n  {\n    id: 'discord',\n    name: 'Discord',\n    icon: <Discord />,\n    toAbs: 'https://discord.com/invite/M9sets4'\n  }\n];\n\nconst Search = styled('div')(({ theme }) => ({\n  position: 'relative',\n  borderRadius: theme.shape.borderRadius,\n  backgroundColor: alpha(theme.palette.common.white, 0.15),\n  '&:hover': {\n    backgroundColor: alpha(theme.palette.common.white, 0.25),\n  },\n  marginRight: theme.spacing(2),\n  marginLeft: 0,\n  width: '100%',\n  // marginLeft: theme.spacing(3),\n  // width: 'auto',\n  // [theme.breakpoints.up('sm')]: {\n\n  // },\n}));\n\nconst SearchIconWrapper = styled('div')(({ theme }) => ({\n  padding: theme.spacing(0, 2),\n  height: '100%',\n  position: 'absolute',\n  pointerEvents: 'none',\n  display: 'flex',\n  alignItems: 'center',\n  justifyContent: 'center',\n}));\n\nconst StyledInputBase = styled(InputBase)(({ theme }) => ({\n  color: 'inherit',\n  '& .MuiInputBase-input': {\n    padding: theme.spacing(1, 1, 1, 0),\n    // vertical padding + font size from searchIcon\n    paddingLeft: `calc(1em + ${theme.spacing(4)})`,\n    transition: theme.transitions.create('width'),\n    width: '100%',\n    [theme.breakpoints.up('md')]: {\n      width: '20ch',\n    },\n  },\n}));\n\nexport const MainNav = (props) => {\n  // const locationTitle = usePageTitle();\n  const [searchMode, setSearchMode] = React.useState(false);\n  const [{ userPrefs, setUserPrefs, appState, setAppState }] = React.useContext(DataContext);\n  const { contextActions } = appState;\n  const history = useHistory();\n  const [showUserPreferences, hideUserPreferences] = useModal(\n    ({ extraProps }) => (\n      <UserPreferences\n        {...props}\n        hideModal={hideUserPreferences}\n        setUserPrefs={setUserPrefs}\n        userPrefs={userPrefs}\n        {...extraProps}\n      />\n    ),\n    [userPrefs]\n  );\n  // const [showSignUpDialog, hideSignUpDialog] = useModal(\n  //   ({ extraProps }) => (\n  //     <SignUpDialog\n  //       {...props}\n  //       hideModal={hideSignUpDialog}\n  //       setUserPrefs={setUserPrefs}\n  //       userPrefs={userPrefs}\n  //       {...extraProps}\n  //     />\n  //   ),\n  //   [userPrefs]\n  // );\n  const theme = useTheme();\n  const [open, setOpen] = React.useState(false);\n  // const [auth, setAuth] = React.useState(true);\n  // const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null);\n  // const handleMenu = (event) => {\n  //   setAnchorEl(event.currentTarget);\n  // };\n\n  // const handleClose = () => {\n  //   setAnchorEl(null);\n  // };\n\n  const handleDrawerOpen = () => {\n    setOpen(true);\n  };\n\n  const handleDrawerClose = () => {\n    setOpen(false);\n  };\n\n  // const handleOpenSettings = () => {\n  //   showUserPreferences();\n  //   handleClose();\n  // };\n  const handleSignIn = () => {\n    // showSignUpDialog()\n  }\n  // const { profile } = useAuth();\n  // const userName = get(profile, \"username\", \"Anonymous\");\n  const avatar = React.useMemo(() => {\n    return createAvatar(style, {\n      seed: Math.random().toString()\n    });\n  }, []);\n  const fullScreen = useMediaQuery(theme.breakpoints.up(\"sm\"));\n  const numActionsToShow = fullScreen ? contextActions?.length : (2 - (appState.enableSearch ? 1 : 0));\n  return (\n    <>\n      <AppBar position=\"sticky\">\n        <Container maxWidth=\"lg\">\n          {!searchMode && <Toolbar style={{ padding: 0 }}>\n            <IconButton\n              color=\"inherit\"\n              aria-label=\"open drawer\"\n              onClick={handleDrawerOpen}\n              edge=\"start\"\n              sx={{ mr: 1 }}\n            >\n              <MenuIcon />\n            </IconButton>\n            {/* <Box display=\"flex\" flexGrow={1} style={{ whiteSpace: 'nowrap', overflow: 'hidden' }}>\n              <Typography color=\"inherit\" variant=\"h6\" style={{ minWidth: 0, textOverflow: 'ellipsis' }}>\n                {locationTitle}\n              </Typography>\n            </Box> */}\n            <Button onClick={() => history.push('/games')} sx={{ color: 'inherit' }} startIcon={<img src={IGR} alt=\"igr\" style={{ height: fullScreen ? '35px' : '30px'}} />}>\n              <Typography noWrap fontSize={fullScreen ? 20 : 18} fontWeight=\"bold\" sx={{ color: 'inherit' }} style={{ textTransform: 'none' }}>\n                Battle Forge\n              </Typography>\n            </Button>\n            <Box flex={1}></Box>\n            <>\n              {contextActions?.slice(0, numActionsToShow)?.map((action, index) => (\n                <IconButton\n                  size=\"large\"\n                  color=\"inherit\"\n                  title={action.name}\n                  onClick={() => action.onClick()}\n                >\n                  {action.icon}\n                </IconButton>\n              ))}\n              {!!appState.enableSearch && <IconButton\n                size=\"large\"\n                aria-label=\"show more\"\n                color=\"inherit\"\n                onClick={() => {\n                  setSearchMode(true);\n                }}\n              >\n                <SearchIcon />\n              </IconButton>}\n              {!!(contextActions?.length - numActionsToShow  > 0) && <Dropdown>\n                {({ handleClose, open, handleOpen, anchorElement }) => (\n                  <>\n                    <IconButton sx={{ color: 'inherit' }} style={{ paddingRight: 0 }} onClick={handleOpen}>\n                      <MoreVertIcon />\n                    </IconButton>\n                    <Menu\n                      anchorOrigin={{\n                        vertical: \"bottom\",\n                        horizontal: \"right\",\n                      }}\n                      transformOrigin={{\n                        vertical: \"top\",\n                        horizontal: \"right\",\n                      }}\n                      anchorEl={anchorElement}\n                      id=\"basic-menu\"\n                      open={open}\n                      onClose={handleClose}\n                      MenuListProps={{\n                        dense: true,\n                        onClick: handleClose,\n                        \"aria-labelledby\": \"basic-button\",\n                      }}\n                    >\n                      {contextActions?.slice(numActionsToShow)?.map((action, index) => (\n                        <MenuItem onClick={() => action.onClick()}>\n                          <ListItemIcon>\n                            {action.icon}\n                          </ListItemIcon>\n                          <ListItemText>{action.name}</ListItemText>\n                        </MenuItem>\n                      ))}\n                    </Menu>\n                  </>\n                )}\n              </Dropdown>}\n            </>\n          </Toolbar>}\n          {!!searchMode && <Toolbar style={{ padding: 0 }}>\n            <IconButton\n              color=\"inherit\"\n              aria-label=\"open drawer\"\n              onClick={() => {\n                setSearchMode(false);\n                setAppState({ ...appState, searchText: '' })\n              }}\n              edge=\"start\"\n              sx={{ mr: 2 }}\n            >\n              <ArrowBackIcon />\n            </IconButton>\n            <Search>\n              <SearchIconWrapper>\n                <SearchIcon />\n              </SearchIconWrapper>\n              <StyledInputBase\n                autoFocus\n                placeholder=\"Search…\"\n                inputProps={{ 'aria-label': 'search' }}\n                value={appState?.searchText}\n                onChange={(event) => {\n                  const value = event?.target?.value;\n                  setAppState({ ...appState, searchText: value })\n                }}\n              />\n            </Search>\n          </Toolbar>}\n        </Container>\n      </AppBar>\n      <SwipeableDrawer\n        onOpen={handleDrawerOpen}\n        onClose={handleDrawerClose}\n        sx={{\n          width: drawerWidth,\n          flexShrink: 0,\n          '& .MuiDrawer-paper': {\n            width: drawerWidth,\n            boxSizing: 'border-box',\n          },\n        }}\n        anchor=\"left\"\n        open={open}\n      >\n        <DrawerHeader sx={{ justifyContent: 'start' }}>\n          <ListItemButton onClick={handleSignIn}>\n            <ListItemIcon>\n              <Avatar sx={{ backgroundColor: 'background.paper' }} src={`data:image/svg+xml;utf8,${encodeURIComponent(\n                avatar\n              )}`} />\n            </ListItemIcon>\n            <ListItemText primary={\"Sign In\"} />\n          </ListItemButton>\n        </DrawerHeader>\n        <Box>\n          <Divider />\n          <List>\n            {navItems.map((item, index) => {\n            if (item.id === 'divider') {\n              return <Divider />;\n            }\n            return (\n              <ListItem button key={index} onClick={() => { item.toAbs ? window.open(item.toAbs, \"_blank\") : history.push(item.to);  handleDrawerClose(); }}>\n                <ListItemIcon>\n                  {item.icon}\n                </ListItemIcon>\n                <ListItemText primary={item.name} />\n              </ListItem>\n            )}\n          )}\n          </List>\n          <Divider />\n          <ListItem button onClick={() => { showUserPreferences(); handleDrawerClose(); }}>\n            <ListItemIcon>\n              <SettingsIcon />\n            </ListItemIcon>\n            <ListItemText primary=\"Settings\" />\n          </ListItem>\n        </Box>\n      </SwipeableDrawer>\n    </>\n  );\n};\n","import CircularProgress, {\n  circularProgressClasses,\n  CircularProgressProps,\n} from '@mui/material/CircularProgress';\nimport Box from '@mui/material/Box';\n\nexport default function CustomCircularProgress(props: CircularProgressProps) {\n  return (\n    <Box sx={{ position: 'relative' }}>\n      {/* <CircularProgress\n        variant=\"determinate\"\n        sx={{\n          color: (theme) =>\n            theme.palette.grey[theme.palette.mode === 'light' ? 200 : 800],\n        }}\n        size={40}\n        thickness={4}\n        {...props}\n        value={100}\n      /> */}\n      <CircularProgress\n        variant=\"indeterminate\"\n        disableShrink\n        sx={{\n          color: (theme) => (theme.palette.mode === 'light' ? '#1a90ff' : '#308fe8'),\n          animationDuration: '550ms',\n          left: 0,\n          [`& .${circularProgressClasses.circle}`]: {\n            strokeLinecap: 'round',\n          },\n        }}\n        size={40}\n        thickness={4}\n        {...props}\n      />\n    </Box>\n  );\n}","import { orderBy, get } from 'lodash';\n\nexport const formatModel = (model, unit, faction, data, options = {}) => {\n  const weaponOrderer = (weapon) => {\n    return get(data.getWeapon(weapon.id || weapon, faction), 'name');\n  }\n  const ruleOrderer = (rule) => {\n    return get(data.getRule(rule.id || rule, faction), 'name');\n  }\n  const { hideCount } = options;\n  const rules = [...(unit.rules || []), ...(model.rules || [])];\n  const equipString = (model.weapons && model.weapons.length) ? ` equipped with (${orderBy((model.weapons || []), weaponOrderer, ['asc']).map((weapon) => {\n    return formatWeapon(weapon, faction, data);\n  }).join(', ') || \"No Weapons\"})` : '';\n  const rulesString = (rules && rules.length) ? ` with specials (${orderBy((rules || []), ruleOrderer, ['asc']).map((rule) => {\n    return formatRule(rule, faction, data);\n  }).join(', ') || \"-\"})` : '';\n  const modelCount = hideCount ? '' : `${model.min || 1}x `;\n  return (\n    `${modelCount}${model.name} ${equipString}${rulesString}`\n  );\n}\n\nexport const formatRule = (rule, faction, data) => {\n  const ruleId = rule.id || rule;\n  const ruleData = data.getRule(ruleId, faction);\n  return (ruleData.inputs ? `${ruleData.name}(${ruleData.inputs.map((input) => rule[input]).join(', ')})` : ruleData.name);\n}\n\nexport const formatWeapon = (weapon, faction, data, options={}) => {\n  const weaponData = data.getWeapon(weapon.id || weapon, faction);\n  const weaponCount = weapon.count;\n  const weaponMount = weapon.mount;\n  const wepName = weapon.name ? ` ${weapon.name} (${weaponData.name})` : weaponData.name;\n  const wepMount = weaponMount ? ` [${weaponMount.join ? weaponMount.join(', ') : weaponMount}]` : '';\n  return `${`${wepName}${weaponCount ? `(${weaponCount})` : ''}`}${wepMount}`;\n}\n\nconst LEVEL_TO_NAME = {\n  0: '',\n  1: 'Rank I',\n  2: 'Rank II',\n  3: 'Rank III',\n  4: 'Rank IV',\n  5: 'Rank V',\n  6: 'Rank VI',\n  7: 'Rank VII',\n  8: 'Rank VIII',\n  9: 'Rank IX',\n  10: 'Rank X',\n}\n\nexport const formatLevel = (level) => {\n  return LEVEL_TO_NAME[level];\n}","export function round5(x) {\n  return (x % 5) >= 2.5 ? parseInt(x / 5) * 5 + 5 : parseInt(x / 5) * 5;\n}\n\nexport function getRandomItem(arr) {\n  return arr[Math.floor(Math.random() * arr.length)];\n}\n\nexport function getRandomItems(arr, numItems) { \n  return arr.sort(() => 0.5 - Math.random()).slice(0, numItems);\n}\n\nexport function roundBias(number) {\n  return (number >= 0 || -1) * Math.round(Math.abs(number));\n}\n\nexport function romanize(num) {\n  if (isNaN(num))\n    return NaN;\n  var digits = String(+num).split(\"\"),\n    key = [\"\", \"C\", \"CC\", \"CCC\", \"CD\", \"D\", \"DC\", \"DCC\", \"DCCC\", \"CM\",\n      \"\", \"X\", \"XX\", \"XXX\", \"XL\", \"L\", \"LX\", \"LXX\", \"LXXX\", \"XC\",\n      \"\", \"I\", \"II\", \"III\", \"IV\", \"V\", \"VI\", \"VII\", \"VIII\", \"IX\"],\n    roman = \"\",\n    i = 3;\n  while (i--)\n    roman = (key[+digits.pop() + (i * 10)] || \"\") + roman;\n  return Array(+digits.join(\"\") + 1).join(\"M\") + roman;\n}","import { castArray, clamp, get, intersection, isArray, isNil, isNumber, isString, mapValues, mean, mergeWith, pickBy, sortBy, sum, toNumber, uniq } from 'lodash';\nimport { formatModel, formatWeapon } from 'utils/format';\nimport { getRandomItem, round5 } from 'utils/math';\n\nexport const DataAPI = (data, cache = {}, root={}) => {\n  const getCache = cache.getCache || (() => { });\n  const setCache = cache.setCache || (() => { });\n  // const resetCache = cache.resetCache || (() => { });\n  const factionList = Object.values(data.factions || {});\n  const globalWeapons = data.weapons || {};\n  const globalUnits = data.units || {};\n  const globalRules = data.rules || {};\n  const globalPowers = data.powers || {};\n  const globalStrategies = data.strategies || {};\n  const globalPerks = data.perks || {};\n  const globalSetbacks = data.setbacks || {};\n  const globalRelics = data.relics || {};\n  const globalModels = data.models || {};\n  const globalTerrain = data.terrain || {};\n  const globalPowerCategories = data.powerCategories || {};\n  const rootWeapons = root.weapons || {};\n  const rootRules = root.rules || {};\n  const rootPhases = root.phases || {};\n  const rootStrategies = root.strategies || {};\n  const rootPerks = root.perks || {};\n  const rootSetbacks = root.setbacks || {};\n  const rootGameTypes = root.gameTypes || {};\n  const rootTerrain = root.terrain || {};\n  const rootMissions = root.missions || {};\n  const rootPowerCategories = root.powerCategories || {};\n\n  const CONSTANTS = {\n    baseStats: {\n      movement: 6,\n      shoot: 5,\n      fight: 5,\n      courage: 5,\n      reflexes: 5,\n      wounds: 1,\n      defense: 5,\n      baseCost: 5\n    },\n    woundsCost: 5,\n    courageCost: 2,\n    defenseCost: 2,\n    apCost: 1,\n    damageCost: 5,\n    movementCost: 1\n  }\n\n  const dummyTarget = {\n    name: \"Battle Brother\",\n    courage: 7,\n    shoot: 6,\n    fight: 6,\n    defense: 8,\n    movement: 5,\n    reflexes: 7,\n    agility: 6,\n    wounds: 1,\n    weapons: [{ \"id\": \"marine_rifle\" }, \"at_grenade\", \"ccw\", \"marine_pistol\"],\n    min: 4,\n    max: 9\n  };\n\n  // const dummyFaction = {\n  //   units: {}\n  // }\n\n  const getGameType = (gameType) => {\n    return rootGameTypes[gameType] || {};\n  }\n\n  const getRawCategories = () => {\n    return data.categories || {};\n  }\n\n  const getNameLists = () => {\n    const nameLists = {...get(root, 'nameLists', {})};\n    return sortBy(Object.keys(nameLists).map((key) => ({\n      id: key,\n      ...nameLists[key]\n    })), 'name');\n  }\n\n  const getNameList = (listId) => {\n    return get(root, `nameLists[${listId}]`, {});\n  }\n\n  const getRandomName = (listId) => {\n    const list = getNameList(listId);\n    const firstNames = uniq([...get(list, 'male.first', []), ...get(list, 'any.first', []), ...get(list, 'female.first', [])]);\n    const middleNames = uniq([...get(list, 'male.middle', []), ...get(list, 'any.middle', []), ...get(list, 'female.middle', [])]);\n    const lastNames = uniq([...get(list, 'male.last', []), ...get(list, 'any.last', []), ...get(list, 'female.last', [])]);\n    return `${getRandomItem(firstNames)}${middleNames.length ? ' ' + getRandomItem(middleNames) : ''}${lastNames.length ? ' ' + getRandomItem(lastNames) : ''}`;\n  }\n\n  const getRandomMaleName = (listId) => {\n    const list = getNameList(listId);\n    const firstNames = uniq([...get(list, 'male.first', []), ...get(list, 'any.first', [])]);\n    const middleNames = uniq([...get(list, 'male.middle', []), ...get(list, 'any.middle', [])]);\n    const lastNames = uniq([...get(list, 'male.last', []), ...get(list, 'any.last', [])]);\n    return `${getRandomItem(firstNames)}${middleNames.length ? ' ' + getRandomItem(middleNames) : ''}${lastNames.length ? ' ' + getRandomItem(lastNames) : ''}`;\n  }\n\n  const getRandomFemaleName = (listId) => {\n    const list = getNameList(listId);\n    const firstNames = uniq([...get(list, 'female.first', []), ...get(list, 'any.first', [])]);\n    const middleNames = uniq([...get(list, 'female.middle', []), ...get(list, 'any.middle', [])]);\n    const lastNames = uniq([...get(list, 'female.last', []), ...get(list, 'any.last', [])]);\n    return `${getRandomItem(firstNames)}${middleNames.length ? ' ' + getRandomItem(middleNames) : ''}${lastNames.length ? ' ' + getRandomItem(lastNames) : ''}`;\n  }\n\n  const getRawPhases = () => {\n    return { ...rootPhases, ...(data.phases || {}) };\n  }\n\n  const getPhase = (categoryId) => {\n    return rootPhases[categoryId] || (data.phases || {})[categoryId] || {};\n  }\n\n  const getOrganizations = () => {\n    return Object.values(data.organizations || {});\n  }\n\n  const getRawOrganizations = () => {\n    return data.organizations || {};\n  }\n\n  const getOrganizationSlotsRaw = (organization) => {\n    return Object.keys(organization.categories || {});\n  }\n\n  const getOrganizationCategory = (organization, category) => {\n    return get(organization, `categories[${category}]`, {});\n  }\n\n  const getCategories = () => {\n    return Object.values(data.categories || {});\n  }\n\n  const getRawPowerCategories = (faction) => {\n    return { ...rootPowerCategories, ...(faction.powerCategories || {}) };\n  }\n\n  const getPowerCategories = (faction) => {\n    return Object.values(faction.powerCategories || {});\n  }\n\n  const getPowerCategory = (categoryId, faction) => {\n    return (faction.powerCategories || {})[categoryId] || {};\n  }\n\n  const getTerrain = () => {\n    return Object.values({ ...rootTerrain, ...globalTerrain });\n  }\n\n  const getCategory = (categoryId) => {\n    return (data.categories || {})[categoryId] || {};\n  }\n\n  const getRule = (ruleName, faction) => {\n    const ruleId = ruleName.id || ruleName;\n    return (faction.rules || {})[ruleId] || { name: `${ruleId} not found`, id: ruleId };\n  };\n\n  const getWeapon = (weaponName, faction) => {\n    const weaponId = weaponName.id || weaponName;\n    return faction.weapons[weaponId] || { id: `${weaponId} not found`, name: `${weaponId} not found` };\n  };\n\n  const getModel = (modelName, faction) => {\n    const modelId = modelName.id || modelName;\n    return (faction.models || {})[modelId] || { id: `${modelId} not found`, name: `${modelId} not found` };\n  };\n\n  const getModelList = (modelList, faction) => {\n    const models = modelList.map((modelName) => getModel(modelName, faction)).filter(model => !!model);\n    return sortBy(models, 'name');\n  };\n\n  const getPower = (powerName, faction) => {\n    const powerId = powerName.id || powerName;\n    return faction.powers[powerId] || { name: `${powerId} not found`, description: `Could not find power ${powerId}` };\n  }\n\n  const getStrategy = (strategyName, faction) => {\n    const strategyId = strategyName.id || strategyName;\n    return faction.strategies[strategyId] || { name: `${strategyId} not found` };\n  }\n\n  const getRawAlliances = () => {\n    return data.alliances || {};\n  }\n\n  const getAlliance = (allianceName) => {\n    return get(data, `alliances[${allianceName}]`, {});\n  };\n\n  const getAlliances = () => {\n    return Object.values(data.alliances || {});\n  }\n\n  const getFactions = () => {\n    return factionList;\n  };\n\n  const getRawFaction = (factionName) => {\n    return get(data, `factions[${factionName}]`, {});\n  };\n\n  const getSubfactionNameList = (subfactionList, subfactions) => {\n    if (new Set(subfactionList).has('none')) {\n      return '';\n    }\n    const listString = subfactionList.map((subfactionKey) => subfactions[subfactionKey] || '')\n      .filter((name) => !!name)\n      .map((subfaction) => subfaction.name).join(', ');\n    return listString;\n  }\n\n  const hasSubfactions = (thing) => {\n    if (!thing.subfactions) {\n      return false;\n    }\n    if (new Set(thing.subfactions).has('none')) {\n      return false;\n    }\n    return thing.subfactions.length;\n  }\n\n  const getFaction = (factionName) => {\n    const faction = get(data, `factions[${factionName}]`, {});\n    const subfactionList = get(faction, `subfactions`, {});\n    return {\n      ...faction,\n      powerCategories: { ...rootPowerCategories, ...globalPowerCategories, ...(faction.powerCategories || {}) },\n      models: { ...globalModels, ...(faction.models || {}) },\n      powers: {\n        ...mapValues(globalPowers, (strat) => ({\n          ...strat,\n          source: `${data.name} - Core`\n        })),\n        ...mapValues((faction.powers || {}), (strat) => ({\n          ...strat,\n          source: hasSubfactions(strat) ? `${data.name} - ${faction.name} - ${getSubfactionNameList(strat.subfactions, subfactionList)}` : `${data.name} - ${faction.name}`\n        })),\n      },\n      strategies: {\n        ...mapValues(rootStrategies, (strat) => ({\n          ...strat,\n          source: `${data.name} - Core`\n        })),\n        ...mapValues(globalStrategies, (strat) => ({\n          ...strat,\n          source: `${data.name} - Core`\n        })),\n        ...mapValues((faction.strategies || {}), (strat) => ({\n          ...strat,\n          source: hasSubfactions(strat) ? `${data.name} - ${faction.name} - ${getSubfactionNameList(strat.subfactions, subfactionList)}` : `${data.name} - ${faction.name}`\n        })),\n      },\n      perks: { ...rootPerks, ...globalPerks, ...(faction.perks || {}) },\n      setbacks: { ...rootSetbacks, ...globalSetbacks, ...(faction.setbacks || {}) },\n      weapons: { ...rootWeapons, ...globalWeapons, ...(faction.weapons || {}) },\n      rules: { ...rootRules, ...globalRules, ...(faction.rules || {}) },\n      units: { ...globalUnits, ...(faction.units || {}) },\n      relics: {\n        ...mapValues(globalRelics, (strat) => ({\n          ...strat,\n          source: `${data.name} - Core`\n        })),\n        ...mapValues((faction.relics || {}), (strat) => ({\n          ...strat,\n          source: hasSubfactions(strat) ? `${data.name} - ${faction.name} - ${getSubfactionNameList(strat.subfactions, subfactionList)}` : `${data.name} - ${faction.name}`\n        })),\n      }\n    };\n  };\n\n  const getSubfaction = (factionName, subfactionName) => {\n    return get(data, `factions[${factionName}].subfactions[${subfactionName}]`, {});\n  };\n\n  const getFactionWithSubfaction = (factionName, subfaction) => {\n    const subfactionName = subfaction;\n    const faction = getFaction(factionName);\n    // const subfactionList = get(faction, `subfactions`, {});\n    const subfactionData = get(faction, `subfactions[${subfactionName}]`, {});\n    const subfactionFilter = (thing) => {\n      const subfactionset = new Set(get(thing, 'subfactions', []));\n      return subfactionset.has(subfaction) || (subfactionset.size === 0) || (subfactionset.has('none') && !subfactionData.restricted);\n    };\n    // const nonefilter = (thing) => {\n    //   const subfactionset = new Set(get(thing, 'subfactions', []));\n    //   return subfactionset.has('none') || (subfactionset.size === 0) || (subfactionset.has('none') && !subfactionData.restricted);\n    // };\n    // Filter unit options by subfaction\n    const units = mapValues(pickBy(get(faction, 'units', {}), subfactionFilter), ((unit) => {\n      return {\n        ...unit,\n        options: get(unit, 'options', []).filter(subfactionFilter),\n        models: get(unit, 'models', []).map((model) => {\n          return {\n            ...model,\n            options: get(model, 'options', []).filter(subfactionFilter)\n          }\n        })\n      }\n    }));\n    const dataWithSubfaction = {\n      ...faction,\n      color: faction.color,\n      units: units,\n      powers: mapValues(pickBy(get(faction, 'powers', {}), subfactionFilter), (strat) => ({\n        ...strat\n      })),\n      relics: mapValues(pickBy(get(faction, 'relics', {}), subfactionFilter), (strat) => ({\n        ...strat\n      })),\n      strategies: mapValues(pickBy(get(faction, 'strategies', {}), subfactionFilter), (strat) => ({\n        ...strat\n      }))\n    };\n    return dataWithSubfaction;\n  };\n\n  const getAllKeywords = (faction) => {\n    const keywords = new Set();\n    getUnits(faction).forEach((unit) => {\n      (unit.keywords || []).forEach((keyword) => {\n        if (!keywords.has(keyword)) {\n          keywords.add(keyword);\n        }\n      })\n    });\n    return Array.from(keywords);\n  }\n\n  const getPowers = (faction) => {\n    return Object.values({ ...(faction.powers || {}) });\n  }\n\n  const getStrategies = (faction) => {\n    return Object.values({ ...(faction.strategies || {})});\n  }\n\n  const getPerks = (faction) => {\n    const perks = {...get(faction, 'perks', {})};\n    return sortBy(Object.keys(perks).map((key) => ({\n      id: key,\n      ...perks[key]\n    })), 'name');\n  }\n\n  const getSetbacks = (faction) => {\n    const setbacks = {...get(faction, 'setbacks', {})};\n    return sortBy(Object.keys(setbacks).map((key) => ({\n      id: key,\n      ...setbacks[key]\n    })), 'name');\n  }\n\n  const getSetback = (faction, setbackId) => {\n    if (!faction || !setbackId) {\n      return {};\n    }\n    const setbacks = { ...get(faction, 'setbacks', {})};\n    return setbacks[setbackId];\n  }\n\n  const getPerk = (faction, perkId) => {\n    if (!faction || !perkId) {\n      return {};\n    }\n    const perks = { ...get(faction, 'perks', {})};\n    return perks[perkId];\n  }\n\n  const getRelics = (faction) => {\n    if (!faction) {\n      return [];\n    }\n    const relics = {...globalRelics, ...get(faction, 'relics', {})};\n    return sortBy(Object.keys(relics).map((key) => ({\n      id: key,\n      ...relics[key]\n    })), 'name');\n  }\n\n  const getRelic = (faction, relicId) => {\n    if (!faction || !relicId) {\n      return {};\n    }\n    const relics = { ...get(faction, 'relics', {})};\n    return relics[relicId];\n  }\n\n  const getRelicCost = (relic, faction) => {\n    if (!relic) {\n      console.log(relic, 'not found');\n      return 0;\n    }\n    return get(relic, 'points', 0);\n  }\n\n  const getUnits = (faction) => {\n    if (!faction || !faction.units) {\n      return [];\n    }\n    const units = {...faction.units};\n    return sortBy(Object.keys(units).map((key) => ({\n      id: key,\n      ...units[key]\n    })), 'name');\n  };\n\n  const getUnit = (faction, unitId) => {\n    if (!faction || !faction.units) {\n      return {};\n    }\n    const units = {...faction.units};\n    return units[unitId];\n  };\n\n  const getModels = (unit, faction) => {\n    const modelMap = [];\n    const models = (unit.models || []);\n    models.forEach((model) => {\n      modelMap.push(model);\n      (model.options || []).forEach((option) => {\n        if (option.replaceModel) {\n          const addModels = castArray(option.replaceModel);\n          addModels.forEach((addedModel) => {\n            const theModel = getModel(addedModel, faction);\n            const modelData = { id: addedModel, ...theModel };\n            modelMap.push(modelData);\n          })\n        }\n      })\n    });\n    (unit.options || []).forEach((option) => {\n      if (option.addModel) {\n        const addModels = castArray(option.addModel);\n        addModels.forEach((addedModel) => {\n          const theModel = getModel(addedModel, faction);\n          const modelData = { id: addedModel, ...theModel };\n          if (theModel) {\n            modelMap.push(modelData);\n          }\n        })\n      }\n    })\n    // models.forEach((model) => {\n    //   const optionalRules = (model.options || []).map((option) => option.addRule || option.replaceRule).reduce(concat, []).filter((rule) => !!rule);\n    //   const rules = [...(model.rules || []), ...optionalRules];\n    //   rules.forEach((rule) => {\n    //     const ruleData = getRule(rule, faction);\n    //     const ruleEffects = ruleData.effects || [];\n    //     ruleEffects.forEach((effect) => {\n    //       if (effect.type === 'spawnModel') {\n    //         const spawnedModelsList = castArray(effect.model || []);\n    //         spawnedModelsList.forEach((modelId) => {\n    //           const modelData = getModel(modelId, faction);\n    //           modelMap.push(modelData);\n    //         });\n    //       }\n    //     })\n    //   });\n    // });\n    return uniq(modelMap);\n  }\n\n  const getAllModels = (faction, options = { filter: {} }) => {\n    const { filter } = options;\n    const keywords = filter.keywords || [];\n    return getUnits(faction)\n      .filter((unit) => {\n        return (keywords.length) ? intersection(keywords, (unit.keywords || [\"Infantry\"])).length : true\n      })\n      .reduce((currModels, unit) => {\n        return currModels.concat(getModels(unit, faction).map((model) => ({ ...model, rules: [...(model.rules || []), ...(unit.rules || [])] })));\n      }, []);\n  };\n\n  const getAddTerm = (addLimit) => {\n    let addTerm = '';\n    if (addLimit && addLimit > 1) {\n      addTerm = ` up to ${addLimit}x`;\n    }\n    if (addLimit && addLimit === 1) {\n      addTerm = ' one';\n    }\n    return addTerm;\n  }\n\n  const getModelAddTerm = (modelLimit, model) => {\n    let addTerm = '';\n    const limitSplit = typeof modelLimit === \"string\" ? modelLimit.split('/') : null;\n    if (!modelLimit && model.max > 1) {\n      addTerm = ' any';\n    }\n    if (modelLimit === 'all') {\n      addTerm = 'all ';\n    }\n    if (modelLimit && modelLimit > 1) {\n      addTerm = ` up to ${modelLimit}x `;\n    }\n    if (modelLimit && modelLimit === 1 && model.max > 1) {\n      addTerm = ` ${modelLimit}x `;\n    }\n    if (limitSplit && limitSplit.length === 2) {\n      addTerm = ` ${limitSplit[0]}x for each ${limitSplit[1]}x `;\n    }\n    return addTerm;\n  }\n\n  const getAddLimitTermUnit = (addLimit) => {\n    let addTerm = ' any model';\n    const limitSplit = typeof addLimit === \"string\" ? addLimit.split('/') : null;\n    if (addLimit && addLimit > 1) {\n      addTerm = ` up to ${addLimit}x models`;\n    }\n    if (addLimit && addLimit === 1) {\n      addTerm = ' one model';\n    }\n    if (addLimit && addLimit === 'all') {\n      addTerm = ' all models';\n    }\n    if (limitSplit && limitSplit.length === 2) {\n      addTerm = ` ${limitSplit[0]}x for each ${limitSplit[1]}x models in the unit`;\n    }\n    return addTerm;\n  }\n\n  const getAddTermUnit = (addLimit) => {\n    let addTerm = '';\n    if (addLimit && addLimit > 1) {\n      addTerm = ` up to ${addLimit}x of`;\n    }\n    if (addLimit && addLimit === 1) {\n      addTerm = ' one';\n    }\n    return addTerm;\n  }\n\n  // const canSpawnModel = (rule, faction) => {\n  //   const ruleData = getRule(rule, faction);\n  //   const models = (ruleData.effects || []).map((effect) => effect.model).filter((model) => !!model);\n  //   return models.map((model) => {\n  //     const rules = model.rules || [];\n  //     // Additional Models\n  //     const modelStats = `${(model.weapons || []).map((weapon) => {\n  //       const weaponData = getWeapon(weapon.id || weapon, faction);\n  //       const weaponCount = weapon.count || 1;\n  //       return `${weaponCount > 1 ? `${weapon.count}x ` : ''}(${weaponData.name}${weapon.mount ? ` [${weapon.mount.join(', ')}]` : ''}`;\n  //     }).join(', ') || \"No Weapons\"})${rules && rules.length ? ` with specials (${(rules || []).map((rule) => {\n  //       const ruleId = rule.id || rule;\n  //       const ruleData = getRule(ruleId, faction);\n  //       return (ruleData.inputs ? `${ruleData.name}(${ruleData.inputs.map((input) => rule[input]).join(', ')})` : ruleData.name);\n  //     }).join(', ') || \"-\"})` : ''}`;\n  //     return `${model.name} equipped with ${modelStats}`;\n  //   });\n  // }\n\n  const getAdditionalModelsList = (unit, faction) => {\n    const upgrades = [];\n    (unit.models || []).forEach((model, modelIndex) => {\n      // const rules = [...(unit.rules || []), ...(model.rules || [])];\n      const min = get(model, 'min', 1);\n      const max = get(model, 'max', 1);\n      // Additional Models\n      if (min < max) {\n        const upgradeCount = max - min === 1 ? undefined : max - min;\n        const addTerm = getAddTerm(upgradeCount);\n        const modelPoints = Math.trunc(getModelTotalPoints({\n          ...model,\n          rules: [\n            ...(model.rules || []),\n            ...(unit.rules || [])\n          ]\n        }, faction));\n        const modelStats = formatModel(model, unit, faction, {getWeapon, getRule}, { hideCount: true });\n        const addList = [\n          {\n            text: `${modelStats} for ${modelPoints}pts${upgradeCount > 1 ? ` each` : ''}`,\n            points: modelPoints,\n            modelIds: [ modelIndex ],\n            limit: max - min,\n            choiceLimit: max - min,\n            models: true,\n          }\n        ]\n        upgrades.push({ option: `Add ${addTerm}`, list: sortBy(addList, 'points') })\n      }\n    });\n    return upgrades;\n  };\n\n  const getOptionsList = (unit, faction, unitData = { selectedModels: {}, selectedModelsRaw: {} }) => {\n    const { selectedModels, selectedModelsRaw } = unitData;\n    const unitTotalModels = sum(Object.values(selectedModels));\n    let upgrades = [];\n    upgrades = upgrades.concat(getAdditionalModelsList(unit, faction));\n    // Check any additional model first\n    if (unit.options) {\n      (unit.options || []).forEach((option) => {\n        if (option.addModel) {\n          const model = castArray(option.addModel || []);\n          const modelLimit = option.modelLimit;\n          const modelAddTerm = getAddTerm(modelLimit);\n          const isEach = modelLimit > 1 || typeof modelLimit === 'string' || (model.max > 1 && !modelLimit);\n          const addList = model.map((addedList) => {\n            let totalCost = 0;\n            const addedWeaponList = castArray(addedList);\n            const addedListString = addedWeaponList.map((addedMod) => {\n              const addedModel = getModel(addedMod, faction);\n              const rules = [...(unit.rules || []), ...(addedModel.rules || [])];\n              const modelPoints = Math.trunc(getModelTotalPoints({\n                ...addedModel,\n                rules\n              }, faction));\n              totalCost += modelPoints;\n              const modelStats = formatModel(addedModel, unit, faction, {getWeapon, getRule}, { hideCount: true });\n              return `${modelStats}`;\n            }).join(' and ');\n            return {\n              text: `${addedListString} for ${Math.trunc(totalCost)}pts${isEach ? ' each' : ''}`,\n              points: totalCost,\n              limit: (modelLimit || 1) * (model.max || 1),\n              choiceLimit: (modelLimit || 1) * (model.max || 1),\n              model: addedWeaponList,\n              modelIds: addedWeaponList,\n              models: true\n            };\n          });\n          upgrades.push({ option: `Add ${modelAddTerm}`, list: sortBy(addList, 'points') })\n        }\n      })\n    }\n    getModels(unit, faction).forEach((mod, modelIndex) => {\n      const modelId = mod.id || modelIndex;\n      const numThisModel = selectedModels[modelId];\n      const numThisModelRaw = selectedModelsRaw[modelId];\n      const model = {\n        ...mod,\n        rules: [\n          ...(mod.rules || []),\n          ...(unit.rules || [])\n        ]\n      };\n      if (model.options) {\n        model.options.forEach((option) => {\n          if (option.replaceModel) {\n            let totalOldCost = 0;\n            const replaceLimit = option.limit;\n            let modelReplaceLimit = option.modelLimit;\n            const replaceTerm = getAddTerm(replaceLimit, model);\n            const modelReplaceTerm = getModelAddTerm(modelReplaceLimit, model);\n            const isEach = replaceLimit > 1 || modelReplaceLimit > 1 || typeof modelReplaceLimit === 'string' || (model.max > 1 && !modelReplaceLimit);\n            // Get current model cost\n            const moddedModel = {\n              ...model,\n              rules: [\n                ...(model.rules || []),\n                ...(unit.rules || [])\n              ]\n            };\n            totalOldCost += Math.trunc(getModelTotalPoints(moddedModel, faction, false));\n            const replaceTarget = castArray(option.replaceModel || [])\n              .map((replacedWith) => {\n                let totalCost = 0;\n                const replacedWithList = castArray(replacedWith);\n                const replaceList = replacedWithList.map((addedMod) => {\n                  const addedModel = getModel(addedMod, faction);\n                  const rules = [...(unit.rules || []), ...(addedModel.rules || [])];\n                  const newModModel = {\n                    ...addedModel,\n                    rules\n                  };\n                  const modelPoints = Math.trunc(getModelTotalPoints(newModModel, faction, false));\n                  totalCost += modelPoints;\n                  const modelStats = formatModel(addedModel, unit, faction, {getWeapon, getRule}, { hideCount: true });\n                  return `${modelStats}`;\n                }).join(' and ');\n                const totalCostDiff = Math.trunc(totalCost - totalOldCost);\n                const limitSplit = typeof modelReplaceLimit === \"string\" ? modelReplaceLimit.split('/') : null;\n                if (limitSplit && limitSplit.length === 2) {\n                  modelReplaceLimit = Math.floor((toNumber(limitSplit[0]) / toNumber(limitSplit[1])) * numThisModelRaw);\n                }\n                return {\n                  text: `${replaceList} for ${totalCostDiff}pts${isEach ? ' each' : ''}`,\n                  points: totalCostDiff,\n                  all: modelReplaceLimit === 'all',\n                  model: replacedWithList,\n                  replacedModel: [ modelIndex ],\n                  modelIds: replacedWithList,\n                  models: false,\n                  limit: ((modelReplaceLimit === \"all\" ? 1 : modelReplaceLimit) || numThisModelRaw) * (replaceLimit || 1),\n                  choiceLimit: ((modelReplaceLimit === \"all\" ? 1 : modelReplaceLimit) || numThisModelRaw) * (replaceLimit || 1)\n                };\n              });\n              upgrades.push({ option: `Replace ${modelReplaceTerm} ${model.name} with${replaceTerm}`, list: sortBy(replaceTarget, 'points') });\n          }\n          if (option.replaceWeapon) {\n            let totalOldCost = 0;\n            const count = option.count || 1;\n            const replaceTermCount = getAddTerm(count, model);\n            const replaceLimit = option.limit;\n            let modelReplaceLimit = option.modelLimit;\n            const replaceTerm = getAddTerm(replaceLimit, model);\n            const modelReplaceTerm = getModelAddTerm(modelReplaceLimit, model);\n            const isEach = replaceLimit > 1 || modelReplaceLimit > 1 || typeof modelReplaceLimit === 'string' || (model.max > 1 && !modelReplaceLimit);\n            const replaceWeaponList = castArray(option.replaceWeapon);\n            const replaceThingList = replaceWeaponList.map((replacedWeapon) => {\n              totalOldCost += getWeaponCostForModel(replacedWeapon, model, faction);\n              return formatWeapon(replacedWeapon, faction, { getWeapon });\n            }).join(' and ');\n            const replaceTarget = castArray(option.withWeapon || [])\n              .map((replacedWith) => {\n                let totalCost = 0;\n                const replacedWithList = castArray(replacedWith);\n                const replaceList = replacedWithList.map((replaceWith) => {\n                  totalCost += getWeaponCostForModel(replaceWith, model, faction);\n                  return formatWeapon(replaceWith, faction, { getWeapon });\n                }).join(' and ');\n                const cost = Math.trunc(totalCost - totalOldCost);\n                const limitSplit = typeof modelReplaceLimit === \"string\" ? modelReplaceLimit.split('/') : null;\n                if (limitSplit && limitSplit.length === 2) {\n                  modelReplaceLimit = Math.floor((toNumber(limitSplit[0]) / toNumber(limitSplit[1])) * numThisModel);\n                }\n                return {\n                  text: `${replaceList} for ${cost}pts${isEach ? ' each' : ''}`,\n                  points: cost,\n                  all: modelReplaceLimit === 'all',\n                  weapons: replacedWithList,\n                  limit: ((modelReplaceLimit === \"all\" ? 1 : modelReplaceLimit) || numThisModel) * (replaceLimit || 1) * count,\n                  choiceLimit: ((modelReplaceLimit === \"all\" ? 1 : modelReplaceLimit) || numThisModel) * (replaceLimit || 1) * count\n                };\n              });\n              upgrades.push({ option: `Replace ${modelReplaceTerm} ${model.name} ${replaceTerm === 'all ' || replaceLimit > 1 ? `models` : `model`}${count > 1 ? ` ${replaceTermCount}` : ''} ${replaceThingList} with${replaceTerm}`, list: sortBy(replaceTarget, 'points') });\n          }\n          if (option.replaceRule) {\n            let totalOldCost = 0;\n            const count = option.count || 1;\n            const replaceTermCount = getAddTerm(count, model);\n            const replaceLimit = option.limit;\n            let modelReplaceLimit = option.modelLimit;\n            let replaceTerm = '';\n            if (replaceLimit && replaceLimit > 1) {\n              replaceTerm = `up to ${replaceLimit}x `;\n            }\n            if (!replaceLimit && model.max > 1) {\n              replaceTerm = 'any ';\n            }\n            if (!replaceLimit === 'all') {\n              replaceTerm = 'all ';\n            }\n            const isEach = replaceLimit > 1 || modelReplaceLimit > 1 || typeof modelReplaceLimit === 'string' || (model.max > 1 && !modelReplaceLimit);\n            const replaceWeaponList = castArray(option.replaceRule);\n            const replaceThingList = replaceWeaponList.map((replacedWeapon) => {\n              const replace = replacedWeapon.id || replacedWeapon;\n              const ruleData = getRule(replace, faction);\n              totalOldCost += getRuleCostForModel(replacedWeapon, model, faction);\n              return `${ruleData.inputs ? `${ruleData.name}(${ruleData.inputs.map((input) => replacedWeapon[input]).join(', ')})` : ruleData.name}`;\n            }).join(' and ');\n            const replaceTarget = castArray(option.withRule)\n              .map((replacedWith) => {\n                let totalCost = 0;\n                const replacedWithList = castArray(replacedWith);\n                const replaceList = replacedWithList.map((replaceWith) => {\n                  const replaceWithId = replaceWith.id || replaceWith;\n                  let ruleData = getRule(replaceWithId, faction);\n                  const shortDescription = ruleData.description_short ? ` (${ruleData.description_short})` : '';\n                  const ruleInputs = ruleData.inputs ? `(${(ruleData.inputs || []).map((input) => replaceWith[input]).join(', ')})` : '';\n                  const ruleDescription = shortDescription || ruleInputs || '';\n                  totalCost += getRuleCostForModel(replacedWith, model, faction);\n                  return `${ruleData.name}${ruleDescription}`;\n                }).join(' and ');\n                const totalCostDiff = Math.trunc(totalCost - totalOldCost);\n                const limitSplit = typeof modelReplaceLimit === \"string\" ? modelReplaceLimit.split('/') : null;\n                if (limitSplit && limitSplit.length === 2) {\n                  modelReplaceLimit = Math.floor((toNumber(limitSplit[0]) / toNumber(limitSplit[1])) * numThisModel);\n                }\n                return {\n                  text: `${replaceList} for ${totalCostDiff}pts${isEach ? ' each' : ''}`,\n                  points: totalCostDiff,\n                  rules: replacedWithList,\n                  all: modelReplaceLimit === 'all',\n                  limit: ((modelReplaceLimit === \"all\" ? 1 : modelReplaceLimit) || numThisModel) * (replaceLimit || 1) * count,\n                  choiceLimit: ((modelReplaceLimit === \"all\" ? 1 : modelReplaceLimit) || numThisModel) * (replaceLimit || 1) * count\n                };\n              });\n              upgrades.push({ option: `Replace ${replaceTerm}${model.name} ${replaceTerm === 'all ' || replaceTerm === 'any ' ? 'models' : 'model'}${count > 1 ? ` ${replaceTermCount}` : ''} ${replaceThingList} with`, list: sortBy(replaceTarget, 'points') });\n          }\n          if (option.addWeapon) {\n            const count = option.count || 1;\n            const replaceTermCount = getAddTerm(count, model);\n            const addLimit = option.limit;\n            let modelLimit = option.modelLimit;\n            const addTerm = getAddTerm(addLimit);\n            let modelAddTerm = getModelAddTerm(modelLimit, model);\n            const isEach = addLimit > 1 || modelLimit > 1 || typeof modelLimit === 'string' || (model.max > 1 && !modelLimit);\n            const weapon = castArray(option.addWeapon);\n            const addList = weapon.map((addedList) => {\n              let totalCost = 0;\n              const addedWeaponList = castArray(addedList);\n              const addedListString = addedWeaponList.map((added) => {\n                const newCost = getWeaponCostForModel(added, model, faction);\n                totalCost += newCost;\n                return formatWeapon(added, faction, { getWeapon });\n              }).join(' and ');\n              const cost = Math.trunc(totalCost);\n              const limitSplit = typeof modelLimit === \"string\" ? modelLimit.split('/') : null;\n              if (limitSplit && limitSplit.length === 2) {\n                modelLimit = Math.floor((toNumber(limitSplit[0]) / toNumber(limitSplit[1])) * numThisModel);\n              }\n              return {\n                text: `${addedListString} for ${cost}pts${isEach ? ' each' : ''}`,\n                points: cost,\n                all: modelLimit === 'all',\n                weapons: addedWeaponList,\n                limit: ((modelLimit === \"all\" ? 1 : modelLimit) || numThisModel) * (addLimit || 1) * count,\n                choiceLimit: ((modelLimit === \"all\" ? 1 : modelLimit) || numThisModel) * (addLimit || weapon.length) * count\n              };\n            });\n            upgrades.push({ option: `Upgrade ${modelAddTerm} ${model.name}${count > 1 ? ` ${replaceTermCount}` : ''} with${addTerm}`, list: sortBy(addList, 'points') });\n          }\n          if (option.addRule) {\n            const weapon = castArray(option.addRule || []);\n            const count = option.count || 1;\n            const replaceTermCount = getAddTerm(count, model);\n            const addLimit = option.limit;\n            let modelLimit = option.modelLimit;\n            const addTerm = getAddTerm(addLimit, model);\n            let modelAddTerm = getModelAddTerm(modelLimit, model);\n            const isEach = addLimit > 1 || modelLimit > 1 || typeof modelLimit === 'string' || (model.max > 1 && !modelLimit);\n            const addList = weapon.map((addedList) => {\n              let totalCost = 0;\n              const addedWeaponList = castArray(addedList);\n              const addedListString = addedWeaponList.map((added) => {\n                const addedThing = added.id || added;\n                let thing = getRule(addedThing, faction);\n                const newCost = getRuleCostForModel(added, model, faction);\n                totalCost += newCost;\n                const shortDescription = thing.description_short ? ` (${thing.description_short})` : '';\n                const ruleInputs = thing.inputs ? `(${(thing.inputs || []).map((input) => added[input]).join(', ')})` : '';\n                const ruleDescription = shortDescription || ruleInputs || '';\n                const ruleName = `${thing.name}${ruleDescription}`;\n                return `${ruleName}`;\n              }).join(' and ');\n              const name = addedList.name ? `${addedList.name} (${addedListString})` : `${addedListString}`;\n              const cost = Math.trunc(totalCost);\n              const limitSplit = typeof modelLimit === \"string\" ? modelLimit.split('/') : null;\n              if (limitSplit && limitSplit.length === 2) {\n                modelLimit = Math.floor((toNumber(limitSplit[0]) / toNumber(limitSplit[1])) * numThisModel);\n              }\n              return {\n                text: `${name} for ${cost}pts${isEach ? ' each' : ''}`,\n                points: cost,\n                all: modelLimit === 'all',\n                rules: addedWeaponList,\n                limit: ((modelLimit === \"all\" ? 1 : modelLimit) || numThisModel) * (addLimit || 1) * count,\n                choiceLimit: ((modelLimit === \"all\" ? 1 : modelLimit) || numThisModel) * (addLimit || weapon.length) * count\n              };\n            });\n            upgrades.push({ option: `Upgrade ${modelAddTerm} ${model.name} ${modelAddTerm === 'all ' || modelAddTerm === 'any ' ? 'models' : 'model'}${count > 1 ? ` ${replaceTermCount}` : ''} with${addTerm}`, list: sortBy(addList, 'points') })\n          }\n          if (option.removeRule) {\n            const weapon = castArray(option.removeRule || []);\n            const count = option.count || 1;\n            const replaceTermCount = getAddTerm(count, model);\n            const addLimit = option.limit;\n            let modelLimit = option.modelLimit;\n            const addTerm = getAddTerm(addLimit, model);\n            let modelAddTerm = getModelAddTerm(modelLimit, model);\n            const isEach = addLimit > 1 || modelLimit > 1 || typeof modelLimit === 'string' || (model.max > 1 && !modelLimit);\n            const addList = weapon.map((addedList) => {\n              let totalCost = 0;\n              const addedWeaponList = castArray(addedList);\n              const addedListString = addedWeaponList.map((added) => {\n                const addedThing = added.id || added;\n                let thing = getRule(addedThing, faction);\n                const newCost = getRuleCostForModel(added, model, faction);\n                totalCost += newCost;\n                const shortDescription = thing.description_short ? ` (${thing.description_short})` : '';\n                const ruleInputs = thing.inputs ? `(${(thing.inputs || []).map((input) => added[input]).join(', ')})` : '';\n                const ruleDescription = shortDescription || ruleInputs || '';\n                const ruleName = `${thing.name}${ruleDescription}`;\n                return `${ruleName}`;\n              }).join(' and ');\n              const name = addedList.name ? `${addedList.name} (${addedListString})` : `${addedListString}`;\n              const cost = Math.trunc(totalCost) * -1;\n              const limitSplit = typeof modelLimit === \"string\" ? modelLimit.split('/') : null;\n              if (limitSplit && limitSplit.length === 2) {\n                modelLimit = Math.floor((toNumber(limitSplit[0]) / toNumber(limitSplit[1])) * numThisModel);\n              }\n              return {\n                text: `${name} for ${cost}pts${isEach ? ' each' : ''}`,\n                points: cost,\n                all: modelLimit === 'all',\n                rules: addedWeaponList,\n                limit: ((modelLimit === \"all\" ? 1 : modelLimit) || numThisModel) * (addLimit || 1) * count,\n                choiceLimit: ((modelLimit === \"all\" ? 1 : modelLimit) || numThisModel) * (addLimit || weapon.length) * count\n              };\n            });\n            upgrades.push({ option: `Remove ${modelAddTerm} ${model.name} ${modelAddTerm === 'all ' || modelAddTerm === 'any ' ? 'models' : 'model'}${count > 1 ? ` ${replaceTermCount}` : ''} ${addTerm}`, list: sortBy(addList, 'points') })\n          }\n        });\n      }\n    });\n    // Handle unit options here with average costs\n    if (unit.options) {\n      (unit.options || []).forEach((option) => {\n        if (option.replaceWeapon) {\n          let totalOldCost = 0;\n          const count = option.count || 1;\n          const replaceTermCount = getAddTerm(count);\n          const replaceLimit = option.limit;\n          const replaceTerm = getAddTermUnit(replaceLimit);\n          let modelReplaceLimit = option.modelLimit;\n          const modelReplaceTerm = getAddLimitTermUnit(modelReplaceLimit);\n          const replaceWeaponList = castArray(option.replaceWeapon);\n          const isEach = replaceLimit > 1 || modelReplaceLimit > 1 || typeof modelReplaceLimit === 'string' || (sum(unit.models.map((model) => model.max)) > 1 && !modelReplaceLimit);\n          const replaceThingList = replaceWeaponList.map((replacedWeapon) => {\n            const avgCost = mean(getModels(unit, faction).filter((model) => model.shoot !== '-' && model.fight !== '-').map((model) => {\n              return getWeaponCostForModel(replacedWeapon, {\n                ...model,\n                rules: [...(unit.rules || []), ...(model.rules || [])]\n              }, faction);\n            }));\n            totalOldCost += avgCost;\n            return formatWeapon(replacedWeapon, faction, { getWeapon });\n          }).join(' and ');\n          const replaceTarget = castArray(option.withWeapon || [])\n            .map((replacedWith) => {\n              let totalCost = 0;\n              const replacedWithList = castArray(replacedWith);\n              const replaceList = replacedWithList.map((replaceWith) => {\n                const avgCost = mean(getModels(unit, faction).filter((model) => model.shoot !== '-' && model.fight !== '-').map((model) => {\n                  return getWeaponCostForModel(replaceWith, {\n                    ...model,\n                    rules: [...(unit.rules || []), ...(model.rules || [])]\n                  }, faction);\n                }));\n                totalCost += avgCost;\n                return formatWeapon(replaceWith, faction, { getWeapon });\n              }).join(' and ');\n              const totalCostDiff = Math.trunc(totalCost - totalOldCost);\n              const limitSplit = typeof modelReplaceLimit === \"string\" ? modelReplaceLimit.split('/') : null;\n              if (limitSplit && limitSplit.length === 2) {\n                modelReplaceLimit = Math.floor((toNumber(limitSplit[0]) / toNumber(limitSplit[1])) * unitTotalModels);\n              }\n              return {\n                text: `${replaceList} for ${totalCostDiff}pts${isEach ? ' each' : ''}`,\n                points: totalCostDiff,\n                weapons: replacedWithList,\n                all: modelReplaceLimit === 'all',\n                limit: (modelReplaceLimit === \"all\" ? 1 : modelReplaceLimit) || unitTotalModels * (replaceLimit || 1) * count,\n                choiceLimit: (modelReplaceLimit === \"all\" ? 1 : modelReplaceLimit) || unitTotalModels * (replaceLimit || 1) * count\n              };\n            });\n            upgrades.push({ option: `Replace ${modelReplaceTerm}${count > 1 ? ` ${replaceTermCount}` : ''} ${replaceThingList} with${replaceTerm}`, list: sortBy(replaceTarget, 'points') });\n        }\n        if (option.replaceRule) {\n          let totalOldCost = 0;\n          const count = option.count || 1;\n          const replaceTermCount = getAddTerm(count);\n          const replaceLimit = option.limit;\n          const replaceTerm = getAddTermUnit(replaceLimit);\n          let modelReplaceLimit = option.modelLimit;\n          // const modelReplaceTerm = getAddLimitTermUnit(modelReplaceLimit);\n          const isEach = replaceLimit > 1 || modelReplaceLimit > 1 || typeof modelReplaceLimit === 'string' || (sum(unit.models.map((model) => model.max)) > 1 && !modelReplaceLimit);\n          const replaceWeaponList = castArray(option.replaceRule);\n          const replaceThingList = replaceWeaponList.map((replacedWeapon) => {\n            const replace = replacedWeapon.id || replacedWeapon;\n            const ruleData = getRule(replace, faction);\n            const avgCost = Math.trunc(mean(getModels(unit, faction).map((model) => {\n              return getRuleCostForModel(replacedWeapon, {\n                ...model,\n                rules: [...(unit.rules || []), ...(model.rules || [])]\n              }, faction);\n            })));\n            totalOldCost += avgCost;\n            return `${ruleData.inputs ? `${ruleData.name}(${ruleData.inputs.map((input) => replacedWeapon[input]).join(', ')})` : ruleData.name}`;\n          }).join(' and ');\n          const replaceTarget = castArray(option.withRule)\n            .map((replacedWith) => {\n              let totalCost = 0;\n              const replacedWithList = castArray(replacedWith);\n              const replaceList = replacedWithList.map((replaceWith) => {\n                const replaceWithId = replaceWith.id || replaceWith;\n                let ruleData = getRule(replaceWithId, faction);\n                const shortDescription = ruleData.description_short ? ` (${ruleData.description_short})` : '';\n                const ruleInputs = ruleData.inputs ? `(${(ruleData.inputs || []).map((input) => replaceWith[input]).join(', ')})` : '';\n                const ruleDescription = shortDescription || ruleInputs || '';\n                const avgCost = Math.trunc(mean(getModels(unit, faction).map((model) => {\n                  return getRuleCostForModel(replacedWith, {\n                    ...model,\n                    rules: [...(unit.rules || []), ...(model.rules || [])]\n                  }, faction);\n                })));\n                totalCost += avgCost;\n                return `${ruleData.name}${ruleDescription}`;\n              }).join(' and ');\n              const totalCostDiff = Math.trunc(totalCost - totalOldCost);\n              const limitSplit = typeof modelReplaceLimit === \"string\" ? modelReplaceLimit.split('/') : null;\n              if (limitSplit && limitSplit.length === 2) {\n                modelReplaceLimit = Math.floor((toNumber(limitSplit[0]) / toNumber(limitSplit[1])) * unitTotalModels);\n              }\n              return {\n                text: `${replaceList} for ${totalCostDiff}pts${isEach ? ' each' : ''}`,\n                points: totalCostDiff,\n                rules: replacedWithList,\n                all: modelReplaceLimit === 'all',\n                limit: (modelReplaceLimit === \"all\" ? 1 : modelReplaceLimit) || unitTotalModels * (replaceLimit || 1) * count,\n                choiceLimit: (modelReplaceLimit === \"all\" ? 1 : modelReplaceLimit) || unitTotalModels * (replaceLimit || 1) * count\n              };\n            });\n            upgrades.push({ option: `Replace ${replaceTerm}${count > 1 ? ` ${replaceTermCount}` : ''} ${replaceThingList} with`, list: sortBy(replaceTarget, 'points') });\n        }\n        if (option.addWeapon) {\n          const count = option.count || 1;\n          const replaceTermCount = getAddTerm(count);\n          const addLimit = option.limit;\n          let modelLimit = option.modelLimit;\n          const addTerm = getAddTermUnit(addLimit);\n          const modelAddTerm = getAddLimitTermUnit(modelLimit);\n          const isEach = addLimit > 1 || modelLimit > 1 || typeof modelLimit === 'string' || (sum(unit.models.map((model) => model.max)) > 1 && !modelLimit);\n          const weapon = castArray(option.addWeapon);\n          const addList = weapon.map((addedList) => {\n            let totalCost = 0;\n            const addedWeaponList = castArray(addedList);\n            const addedListString = addedWeaponList.map((added) => {\n              const avgCost = Math.trunc(mean(getModels(unit, faction).filter((model) => model.shoot !== '-' && model.fight !== '-').map((model) => {\n                return getWeaponCostForModel(added, {\n                  ...model,\n                  rules: [...(unit.rules || []), ...(model.rules || [])]\n                }, faction);\n              })));\n              const newCost = avgCost;\n              totalCost += newCost;\n              return formatWeapon(added, faction, { getWeapon });\n            }).join(' and ');\n            const limitSplit = typeof modelLimit === \"string\" ? modelLimit.split('/') : null;\n            if (limitSplit && limitSplit.length === 2) {\n              modelLimit = Math.floor((toNumber(limitSplit[0]) / toNumber(limitSplit[1])) * unitTotalModels);\n            }\n            return {\n              text: `${addedListString} for ${totalCost}pts${isEach ? ' each' : ''}`,\n              points: totalCost,\n              weapons: addedWeaponList,\n              all: modelLimit === 'all',\n              limit: (modelLimit === \"all\" ? 1 : modelLimit) || unitTotalModels * (addLimit || 1) * count,\n              choiceLimit: (modelLimit === \"all\" ? 1 : modelLimit) || unitTotalModels * (addLimit || 1) * count\n            };\n          });\n          upgrades.push({ option: `Upgrade ${modelAddTerm}${count > 1 ? ` ${replaceTermCount}` : ''} with${addTerm}`, list: sortBy(addList, 'points') });\n        }\n        if (option.addRule) {\n          const weapon = castArray(option.addRule || []);\n          const count = option.count || 1;\n          const replaceTermCount = getAddTerm(count);\n          const addLimit = option.limit;\n          let modelLimit = option.modelLimit;\n          const addTerm = getAddTermUnit(addLimit);\n          const modelAddTerm = getAddLimitTermUnit(modelLimit);\n          const isEach = addLimit > 1 || modelLimit > 1 || typeof modelLimit === 'string' || (sum(unit.models.map((model) => model.max)) > 1 && !modelLimit);\n          const addList = weapon.map((addedList) => {\n            let totalCost = 0;\n            const addedWeaponList = castArray(addedList);\n            const addedListString = addedWeaponList.map((added) => {\n              const addedThing = added.id || added;\n              let thing = getRule(addedThing, faction);\n              const avgCost = Math.trunc(mean(getModels(unit, faction).map((model) => {\n                return getRuleCostForModel(added, {\n                  ...model,\n                  rules: [...(unit.rules || []), ...(model.rules || [])]\n                }, faction);\n              })));\n              totalCost += avgCost;\n              const shortDescription = thing.description_short ? ` (${thing.description_short})` : '';\n              const ruleInputs = thing.inputs ? `(${(thing.inputs || []).map((input) => added[input]).join(', ')})` : '';\n              const ruleDescription = shortDescription || ruleInputs || '';\n              const ruleName = `${thing.name}${ruleDescription}`;\n              return `${ruleName}`;\n            }).join(' and ');\n            const name = addedList.name ? `${addedList.name} (${addedListString})` : `${addedListString}`;\n            const limitSplit = typeof modelLimit === \"string\" ? modelLimit.split('/') : null;\n            if (limitSplit && limitSplit.length === 2) {\n              modelLimit = Math.floor((toNumber(limitSplit[0]) / toNumber(limitSplit[1])) * unitTotalModels);\n            }\n            return {\n              text: `${name} for ${Math.trunc(totalCost)}pts${isEach ? ' each' : ''}`,\n              points: Math.trunc(totalCost),\n              rules: addedWeaponList,\n              all: modelLimit === 'all',\n              limit: (modelLimit === \"all\" ? 1 : modelLimit) || unitTotalModels * (addLimit || 1) * count,\n              choiceLimit: (modelLimit === \"all\" ? 1 : modelLimit) || unitTotalModels * (addLimit || 1) * count\n            };\n          });\n          upgrades.push({ option: `Upgrade ${modelAddTerm}${count > 1 ? ` ${replaceTermCount}` : ''} with${addTerm}`, list: sortBy(addList, 'points') })\n        }\n        if (option.removeRule) {\n          const weapon = castArray(option.removeRule || []);\n          const count = option.count || 1;\n          const replaceTermCount = getAddTerm(count);\n          const addLimit = option.limit;\n          let modelLimit = option.modelLimit;\n          const addTerm = getAddTermUnit(addLimit);\n          const modelAddTerm = getAddLimitTermUnit(modelLimit);\n          const isEach = addLimit > 1 || modelLimit > 1 || typeof modelLimit === 'string' || (sum(unit.models.map((model) => model.max)) > 1 && !modelLimit);\n          const addList = weapon.map((addedList) => {\n            let totalCost = 0;\n            const addedWeaponList = castArray(addedList);\n            const addedListString = addedWeaponList.map((added) => {\n              const addedThing = added.id || added;\n              let thing = getRule(addedThing, faction);\n              const avgCost = Math.trunc(mean(getModels(unit, faction).map((model) => {\n                return getRuleCostForModel(added, {\n                  ...model,\n                  rules: [...(unit.rules || []), ...(model.rules || [])]\n                }, faction);\n              })));\n              totalCost += avgCost;\n              const shortDescription = thing.description_short ? ` (${thing.description_short})` : '';\n              const ruleInputs = thing.inputs ? `(${(thing.inputs || []).map((input) => added[input]).join(', ')})` : '';\n              const ruleDescription = shortDescription || ruleInputs || '';\n              const ruleName = `${thing.name}${ruleDescription}`;\n              return `${ruleName}`;\n            }).join(' and ');\n            const name = addedList.name ? `${addedList.name} (${addedListString})` : `${addedListString}`;\n            const limitSplit = typeof modelLimit === \"string\" ? modelLimit.split('/') : null;\n            if (limitSplit && limitSplit.length === 2) {\n              modelLimit = Math.floor((toNumber(limitSplit[0]) / toNumber(limitSplit[1])) * unitTotalModels);\n            }\n            const cost = Math.trunc(totalCost) * -1;\n            return {\n              text: `${name} for ${cost}pts${isEach ? ' each' : ''}`,\n              points: cost,\n              rules: addedWeaponList,\n              all: modelLimit === 'all',\n              limit: (modelLimit === \"all\" ? 1 : modelLimit) || unitTotalModels * (addLimit || 1) * count,\n              choiceLimit: (modelLimit === \"all\" ? 1 : modelLimit) || unitTotalModels * (addLimit || 1) * count\n            };\n          });\n          upgrades.push({ option: `Remove ${modelAddTerm}${count > 1 ? ` ${replaceTermCount}` : ''} ${addTerm}`, list: sortBy(addList, 'points') })\n        }\n      });\n    }\n    return upgrades;\n  }\n\n  const getPowerCharge = (power, faction) => {\n    let points = 0;\n    const dummyShooter = {\n      shoot: 10\n    }\n    const cachedPoints = getCache(faction.name + power.name);\n    if (cachedPoints) {\n      return cachedPoints;\n    }\n    const psychicCost = getRuleCostForModel({ \"id\": \"psychic\" }, dummyTarget, faction);\n    (power.effects || []).forEach((effect) => {\n      if (effect.weapon) {\n        const weapon = effect.weapon.id || effect.weapon;\n        const pts = getWeaponCostForModel(weapon, dummyShooter, faction);\n        points += pts;\n      }\n      if (effect.rule) {\n        const rule = effect.rule.id || effect.rule;\n        const pts = getRuleCostForModel(rule, dummyShooter, faction);\n        points += pts;\n      }\n    });\n    const charge = psychicCost / points * 10;\n    const finalCharge = clamp(Math.trunc(charge), 1, 9);\n    setCache(faction.name + power.name, finalCharge);\n    return finalCharge;\n  }\n\n  const getUnitPoints = (unit, faction) => {\n    let points = 0;\n    (unit.models || []).forEach((model) => {\n      const min = get(model, 'min', 1);\n      const modelWithUnitRules = {\n        ...model,\n        rules: [...(model.rules || []), ...(unit.rules || [])]\n      };\n      const modelPts = getModelTotalPoints(modelWithUnitRules, faction) * min;\n      points += Math.trunc(modelPts);\n    });\n    // const allModelsMaxed = every(unit.models, (model) => {\n    //  return model.min === model.max;\n    // });\n    const gameType = get(data, 'gameType', 'battle');\n    const isSkirmish = gameType === 'skirmish';\n    if (!isSkirmish) {\n      points = round5(points);\n    }\n    return points;\n  }\n\n  const resolveVariable = (variableName, variables) => {\n    const combinedVars = {...variables, constants: CONSTANTS};\n    const val = typeof variableName === 'string' ? get(combinedVars, variableName) : variableName;\n    if (isNil(val) || !isNumber(val)) {\n      // console.log(`Couldn't resolve ${variableName}`);\n      return 0;\n    }\n    return val;\n  }\n\n  const resolvePointsRecurse = (pointsArray, variables) => {\n    if (isArray(pointsArray)) {\n      let total = 0;\n      pointsArray.forEach((arrItem) => {\n        if (!isNil(arrItem.add)) {\n          total += resolvePointsRecurse(arrItem.add, variables);\n        } else if (!isNil(arrItem.multiply)) {\n          total *= resolvePointsRecurse(arrItem.multiply, variables);\n        } else if (!isNil(arrItem.subtract)) {\n          total -= resolvePointsRecurse(arrItem.subtract, variables);\n        } else if (!isNil(arrItem.divide)) {\n          total /= resolvePointsRecurse(arrItem.divide, variables);\n        } else if (!isNil(arrItem.max)) {\n          total = Math.max(total, resolvePointsRecurse(arrItem.max, variables));\n        } else if (!isNil(arrItem.min)) {\n          total = Math.min(total, resolvePointsRecurse(arrItem.min, variables));\n        } else {\n          total += resolvePointsRecurse(arrItem, variables);\n        }\n      });\n      return total;\n    } else {\n      return resolveVariable(pointsArray, variables);\n    }\n  }\n\n  const resolvePoints = (pointsArray, variables) => {\n    return resolvePointsRecurse(castArray(pointsArray), variables);\n  }\n\n  const getModelTotalPoints = (model, faction, doRound=true) => {\n    let points = 0;\n    const modelPoints = getModelPoints(model, faction);\n    const weaponPoints = getModelWeaponPoints(model, faction);\n    const rulePoints = getModelRulePoints(model, faction);\n    const ptsTotal = modelPoints + weaponPoints + rulePoints;\n    points += Math.trunc(ptsTotal);\n    //console.log(model.name, 'model', modelPoints, 'weps', weaponPoints, 'rules', rulePoints, 'total', points);\n    return points;\n  }\n\n  const getModelPoints = (model, faction) => {\n    if (model.shoot === \"-\" && model.fight === \"-\" && model.courage === \"-\" && model.defense !== \"-\") {\n      const defense = model.defense || CONSTANTS.baseStats.defense;\n      const defenseIncrease = (defense - 5);\n      const defenseCost = model.defense === '-' ? 0 : (defenseIncrease * 2);\n      return defenseCost;\n    }\n    if (model.shoot === \"-\" && model.fight === \"-\" && model.courage === \"-\") {\n      return 0;\n    }\n    if (model.defense === \"-\" && model.courage === \"-\" && model.reflexes === \"-\") {\n      return 0;\n    }\n    let points = 0;\n    // const wounds = model.wounds || CONSTANTS.baseStats.wounds;\n    const defense = model.defense || CONSTANTS.baseStats.defense;\n    const courage = model.courage || CONSTANTS.baseStats.courage;\n    const movement = isNil(model.movement) ? CONSTANTS.baseStats.movement : model.movement;\n    const reflexes = model.reflexes || CONSTANTS.baseStats.reflexes;\n    // const shoot = model.shoot || CONSTANTS.baseStats.shoot;\n    // const fight = model.fight || CONSTANTS.baseStats.fight;\n    // const shootCost = (shoot - 5);\n    // const fightCost = (fight - 5);\n    //const woundsCost = (wounds > 1) ? ((wounds - 1) * 2 * (defenseIncrease || 1)) : 0;\n    const defenseIncrease = (defense - 5);\n    // const woundsCost = (wounds > 1) ? ((wounds - 1) * CONSTANTS.woundsCost * (defenseIncrease || 1)) : 0;\n    const defenseCost = model.defense === '-' ? 0 : (defenseIncrease * 2);\n    const courageCost = model.courage === '-' ? 0 : (courage - 5) * 2;\n    const movementCost = (movement - 6);\n    const reflexCost = model.reflexes === '-' ? 0 : (reflexes - 5);\n    // console.log(model.name, 'w', woundsCost, 'r',defenseCost, 'co',courageCost, 'm',movementCost, 'ref',reflexCost);\n    points += (defenseCost + courageCost + reflexCost + movementCost + CONSTANTS.baseStats.baseCost);\n    return points;\n  }\n\n  const getModelWeaponPoints = (model, faction) => {\n    let points = 0;\n    (model.weapons || []).forEach((weapon) => {\n      points += getWeaponCostForModel(weapon, model, faction);\n    });\n    return points;\n  }\n\n  const getWeaponCostAverage = (weapon, models, faction) => {\n    const weaponId = weapon.id || weapon;\n    const cachedPoints = getCache(models.map((model) => model.name).join('') + weaponId);\n    if (cachedPoints) {\n      return cachedPoints;\n    }\n    const cost = mean((models).map((model) => {\n      return getWeaponCostForModel(weapon, model, faction);\n    }));\n    setCache(models.map((model) => model.name).join('') + weaponId, cost);\n    return cost;\n  }\n\n  const getRuleCostAverage = (rule, models, faction) => {\n    const ruleId = rule.id || rule;\n    const cachedPoints = getCache(models.map((model) => model.name).join('') + ruleId);\n    if (cachedPoints) {\n      return cachedPoints;\n    }\n    const cost = mean((models).map((model) => {\n      return getRuleCostForModel(rule, model, faction);\n    }));\n    setCache(models.map((model) => model.name).join('') + ruleId, cost);\n    return cost;\n  }\n\n  const getWeaponCostForModel = (weapon, model, faction, modifiedWeapon) => {\n    let points = 0;\n    const weaponData = modifiedWeapon || getWeapon(weapon, faction);\n    const weaponCount = weapon.count || 1;\n    let weaponMountMult = 1;\n    if ((weapon.mount && weapon?.mount?.length === 1) || isString(weapon?.mount)) {\n      weaponMountMult = 0.8;\n    }\n    if (weapon.mount && weapon.mount.length === 2) {\n      weaponMountMult = 0.9;\n    }\n    //const weaponModelMult = (weaponData.short === \"Melee\" ? (model.fight - CONSTANTS.baseStats.fight) : (model.shoot * CONSTANTS.baseStats.shoot));\n    const weaponBase = getWeaponPoints(weaponData, model, faction);\n    const weaponPoints = weaponBase * weaponCount * weaponMountMult;\n    points += weaponPoints;\n    // if (points > 0) {\n    //   // Cost weapon rules that do not scale with weapon\n    //   const weaponRules = weaponData.rules || [];\n    //   weaponRules.forEach((rule) => {\n    //     const weaponsWithoutCurr = (model.weapons || []).filter((wep) => (wep.id || wep) !== (weapon.id || weapon));\n    //     const ruleCost = getRuleCostForModel(rule, {\n    //       ...model,\n    //       weapons: weaponsWithoutCurr\n    //     }, faction);\n\n    //     points += ruleCost;\n    //   });\n    // }\n    //console.log(model.name, weaponData.name, points);\n    return points;\n  }\n\n  /*\n * Find cost of a single weapon\n */\n  const getWeaponPoints = (wep, model, faction) => {\n    // Merge weapon profiles into one master list\n    const weps = [wep, ...get(wep, 'profiles', [])];\n    // Keep track of most expensive profile\n    const weaponPoints = sortBy(weps.map((weapon) => {\n      let points = 0;\n      const weaponModelMult = (weapon.short === \"Melee\" ? (model.fight - CONSTANTS.baseStats.fight) : (model.shoot - CONSTANTS.baseStats.shoot));\n      const weaponAP = weapon.ap || 0;\n      const weaponRules = weapon.rules || [];\n      const range = weapon.short;\n      const rangeCost = ((range === \"Melee\") ? (model.movement || 6) / 6 : range / 6);\n      // const weaponDamage = weapon.damage || 1;\n      points += weaponModelMult;\n      // points += (weaponDamage - 1) * CONSTANTS.damageCost;\n      const rangePoints = (weapon.medium || (range === \"Melee\")) ? rangeCost : rangeCost / 2;\n      points += rangePoints;\n      points += weaponAP * CONSTANTS.apCost;\n      let isPistol = false;\n      let isGrenade = false;\n      //Multiply weapon cost by number of attacks\n      const attacks = isNil(weapon.attacks) ? 1 : weapon.attacks;\n      points *= attacks;\n      // Calculate weapon rules that don't scale with damage or attacks\n      weaponRules.forEach((rule) => {\n        const ruleId = rule.id || rule;\n        const ruleData = getRule(ruleId, faction);\n        const resolvedPoints = resolvePoints(ruleData.points || 0, {\n          weapon: {\n            ...weapon,\n            ap: weapon.ap || 0,\n            damage: weapon.damage || 1,\n            range,\n            rangeCost,\n            points\n          },\n          rule,\n          model,\n          faction\n        });\n        if (resolvedPoints) {\n          points += resolvedPoints;\n        }\n        // if (ruleId === 'pistol') {\n        //   isPistol = true;\n        // }\n        if (ruleId === 'grenade') {\n          isGrenade = true;\n        }\n      });\n      // If it's a pistol or grenade and not the cheapest weapon, zero out the cost\n      // Ignore for now. Too many problems.\n      // Logic is expensive. Yikes.\n      if (isPistol) {\n        points *= 0.5;\n      }\n      if (isGrenade) {\n        points *= 0;\n      }\n      return points;\n    }).filter((number) => isFinite(number))).reverse();\n    const mostExpensiveWeapon = weaponPoints[0] || 0;\n    const otherPoints = sum(weaponPoints.slice(1).map((pts) => pts * 0.5));\n    const totalPts = mostExpensiveWeapon + otherPoints;\n    // console.log(model.name, wep.name, 'pts', mostExpensiveWeapon, totalPts);\n    return totalPts;\n  }\n\n  const getModelRulePoints = (model, faction) => {\n    let points = 0;\n    (model.rules || []).forEach((rule) => {\n      points += getRuleCostForModel(rule, model, faction);\n    })\n    return points;\n  }\n\n  // const getAuraCost = (model, effect, func, faction) => {\n  //   const cachedPoints = getCache(faction.name + JSON.stringify(effect));\n  //   if (cachedPoints) {\n  //     return cachedPoints;\n  //   }\n  //   const filter = effect.filter || {};\n  //   const range = effect.range || 3;\n  //   // For every 3\" of range add some to the cost\n  //   const rangeMult = (1 + Math.abs(((range - 3) / 3) * 0.25));\n  //   const models = effect.target === \"enemy\" ? getAllModels(dummyFaction, { filter }) : getAllModels(faction, { filter });\n  //   let meanCost = mean((models).map(func).filter((value) => !!value));\n  //   if (!meanCost) {\n  //     meanCost = 0;\n  //   }\n  //   const cost = meanCost * rangeMult;\n  //   setCache(faction.name + JSON.stringify(effect), cost);\n  //   return cost;\n  // }\n\n  const getRuleCostForModel = (rule, model, faction) => {\n    let points = 0;\n    const ruleId = rule.id || rule;\n    const ruleData = getRule(ruleId, faction);\n    const cachedPoints = getCache(faction.name + model.name + JSON.stringify(rule));\n    if (cachedPoints) {\n      return cachedPoints;\n    }\n    const resolvedPoints = resolvePoints(ruleData.points || 0, {\n      rule,\n      model,\n      faction\n    });\n    if (resolvedPoints) {\n      points += resolvedPoints;\n    }\n    // (ruleData.effects || []).forEach((effect) => {\n    //   // How often the ability will trigger (frequency / 10 is the percentage time it's active)\n    //   let frequency = (typeof effect.frequency === 'string' ? rule[effect.frequency] : effect.frequency) || 10;\n    //   const value = (typeof effect.value === 'string' ? rule[effect.value] : effect.value) || 1;\n    //   // Ignore terrain penalties\n    //   if (effect.type === \"ignoreTerrain\") {\n    //     const modelWounds = model.wounds || 1;\n    //     points += modelWounds * 2 * (frequency / 10);\n    //   }\n    //   // Ignore terrain penalties\n    //   if (effect.type === \"ambush\") {\n    //     const modelWounds = model.wounds || 1;\n    //     points += modelWounds * 2 * (frequency / 10);\n    //   }\n    //   // Ignore terrain penalties\n    //   if (effect.type === \"stealth\") {\n    //     const modelWounds = model.wounds || 1;\n    //     points += modelWounds * 3 * value * (frequency / 10);\n    //   }\n    //   if (effect.type === \"activateUnit\") {\n    //     const modelWounds = model.wounds || 1;\n    //     points += (modelWounds / 2) * value * (frequency / 10);\n    //   }\n    //   if (effect.type === \"regeneration\") {\n    //     const modelWounds = model.wounds || 1;\n    //     points += modelWounds * frequency;\n    //   }\n    //   if (effect.type === \"invulnerable\") {\n    //     const modelDefense = model.defense || 1;\n    //     points += modelDefense * value * (frequency / 10);\n    //   }\n    //   if (effect.type === \"transport\") {\n    //     const size = (typeof effect.size === 'string' ? rule[effect.size] : effect.size) || 1;\n    //     points += size * (frequency / 10);\n    //   }\n    //   if (effect.type === \"open_topped\") {\n    //     points += value * (frequency / 10);\n    //   }\n    //   if (effect.type === \"psychic\") {\n    //     points += (15 * value) * (frequency / 10);\n    //   }\n    //   if (effect.type === \"heal\") {\n    //     points += 5 * value * (frequency / 10);\n    //   }\n    //   if (effect.type === \"spawnModel\") {\n    //     const spawnedModel = effect.model || {};\n    //     const modelData = getModel(spawnedModel, faction);\n    //     const cost = getModelTotalPoints({\n    //       ...modelData,\n    //     }, faction);\n    //     points += cost * 0.8 * (frequency / 10);\n    //   }\n    //   // Give a new rule\n    //   if (effect.type === \"grantRule\") {\n    //     const ruleName = effect.rule;\n    //     if (ruleName === ruleId) {\n    //       console.log('cycle detected wot you doing m8');\n    //       return 0;\n    //     };\n    //     const target = effect.target || \"self\";\n    //     if (target !== \"self\") {\n    //       const auraCost = getAuraCost(model, effect, (modelTarget) => {\n    //         //const modelRulesWithoutCurr = (modelTarget.rules || []).filter((filterRule) => filterRule.id !== ruleId && filterRule !== ruleId);\n    //         const modelRulesWithoutCurr = [];\n    //         const oldCost = getModelTotalPoints({\n    //           ...modelTarget,\n    //           rules: modelRulesWithoutCurr\n    //         }, faction);\n    //         const modelRulesWithNew = uniq([...modelRulesWithoutCurr, ruleName]);\n    //         const newCost = getModelTotalPoints({\n    //           ...modelTarget,\n    //           rules: modelRulesWithNew\n    //         }, faction);\n    //         const cost = (newCost - oldCost) * (effect.targetModels || modelTarget.min || 1);\n    //         return cost;\n    //       }, faction);\n    //       points += auraCost * (frequency / 10);\n    //     } else {\n    //       const modelRulesWithoutCurr = (model.rules || []).filter((filterRule) => filterRule.id !== ruleId && filterRule !== ruleId);\n    //       const oldCost = getModelTotalPoints({\n    //         ...model,\n    //         rules: modelRulesWithoutCurr\n    //       }, faction);\n    //       const modelRulesWithNew = uniq([...modelRulesWithoutCurr, ruleName]);\n    //       const newCost = getModelTotalPoints({\n    //         ...model,\n    //         rules: modelRulesWithNew\n    //       }, faction);\n    //       const cost = (newCost - oldCost) * (frequency / 10);\n    //       points += cost;\n    //     }\n    //   }\n    //   // Modify stat by some amount\n    //   if (effect.type === \"alterStat\") {\n    //     const target = effect.target || \"self\";\n    //     const improvedValue = (typeof effect.value === 'string' ? rule[effect.value] : effect.value) || 1;\n    //     const improvedStat = effect.statName;\n    //     if (target !== \"self\") {\n    //       const auraCost = getAuraCost(model, effect, (modelTarget) => {\n    //         const oldCost = getModelTotalPoints({\n    //           ...modelTarget,\n    //           rules: [],\n    //         }, faction);\n    //         const newCost = getModelTotalPoints({\n    //           ...modelTarget,\n    //           [improvedStat]: (modelTarget[improvedStat] || CONSTANTS[improvedStat] || 0) + improvedValue,\n    //           rules: [],\n    //         }, faction);\n    //         const cost = (newCost - oldCost) * (effect.targetModels || modelTarget.min || 1);\n    //         return cost;\n    //       }, faction);\n    //       // Tweak this cost up for possible upgrade interactions\n    //       points += auraCost * (frequency / 10) * 1.25;\n    //     } else {\n    //       const oldCost = getModelTotalPoints({\n    //         ...model,\n    //         weapons: [],\n    //         rules: []\n    //       }, faction);\n    //       const newCost = getModelTotalPoints({\n    //         ...model,\n    //         [improvedStat]: (model[improvedStat] || CONSTANTS[improvedStat] || 0) + improvedValue,\n    //         rules: [],\n    //         weapons: [],\n    //       }, faction);\n    //       const cost = (newCost - oldCost) * (frequency / 10);\n    //       points += cost;\n    //     }\n    //   }\n    //   // Modify stat by some amount\n    //   if (effect.type === \"changeStat\") {\n    //     const target = effect.target || \"self\";\n    //     const improvedValue = (typeof effect.value === 'string' ? rule[effect.value] : effect.value) || 1;\n    //     const improvedStat = effect.statName;\n    //     if (target !== \"self\") {\n    //       const auraCost = getAuraCost(model, effect, (modelTarget) => {\n    //         const oldCost = getModelTotalPoints({\n    //           ...modelTarget,\n    //           rules: []\n    //         }, faction);\n    //         const newCost = getModelTotalPoints({\n    //           ...modelTarget,\n    //           [improvedStat]: improvedValue,\n    //           rules: []\n    //         }, faction);\n    //         const cost = (newCost - oldCost) * (effect.targetModels || modelTarget.min || 1);\n    //         return cost;\n    //       }, faction);\n    //       // Tweak this cost up for possible upgrade interactions\n    //       points += auraCost * (frequency / 10) * 1.25;\n    //     } else {\n    //       const oldCost = getModelTotalPoints({\n    //         ...model,\n    //         rules: []\n    //       }, faction);\n    //       const newCost = getModelTotalPoints({\n    //         ...model,\n    //         [improvedStat]: improvedValue,\n    //         rules: []\n    //       }, faction);\n    //       const cost = (newCost - oldCost) * (frequency / 10);\n    //       points += cost;\n    //     }\n    //   }\n    //   // Give free attacks\n    //   if (effect.type === \"freeAttacks\") {\n    //     const weaponName = effect.weapon;\n    //     const fight = (typeof effect.fight === 'string' ? rule[effect.fight] : effect.fight) || 5;\n    //     const shoot = (typeof effect.shoot === 'string' ? rule[effect.shoot] : effect.shoot) || 5;\n    //     const numAttacks = (typeof effect.attacks === 'string' ? rule[effect.attacks] : effect.attacks) || 1;\n    //     const newMod = { ...model };\n    //     if (effect.shoot) {\n    //       newMod.shoot = shoot;\n    //     }\n    //     if (effect.fight) {\n    //       newMod.fight = fight;\n    //     }\n    //     const attackCost = getWeaponCostForModel(weaponName, newMod, faction);\n    //     const cost = numAttacks * attackCost * (frequency / 10);\n    //     points += cost;\n    //   }\n    //   // Alter a rule\n    //   if (effect.type === \"alterRule\") {\n    //     const target = effect.target || \"self\";\n    //     const improvedValue = (typeof effect.value === 'string' ? rule[effect.value] : effect.value) || 1;\n    //     const improvedInput = effect.input;\n    //     const ruleName = effect.ruleName;\n    //     if (target !== \"self\") {\n    //       const auraCost = getAuraCost(model, effect, (modelTarget) => {\n    //         const oldCost = getModelTotalPoints({\n    //           ...modelTarget,\n    //           rules: []\n    //         }, faction);\n    //         const modelRule = find(modelTarget.rules, ['id', ruleName]);\n    //         if (modelRule) {\n    //           const newCost = getModelTotalPoints({\n    //             ...modelTarget,\n    //             rules: [{ ...modelRule, [improvedInput]: modelRule[improvedInput] + improvedValue }]\n    //           }, faction);\n    //           return (newCost - oldCost) * (effect.targetModels || modelTarget.min || 1);\n    //         }\n    //         return 0;\n    //       }, faction);\n    //       points += auraCost * (frequency / 10) * 1.25;\n    //     } else {\n    //       const oldCost = getModelTotalPoints({\n    //         ...model,\n    //         rules: []\n    //       }, faction);\n    //       const modelRule = find(model.rules, ['id', ruleName]);\n    //       if (modelRule) {\n    //         const newCost = getModelTotalPoints({\n    //           ...model,\n    //           rules: [{ ...modelRule, [improvedInput]: modelRule[improvedInput] + improvedValue }]\n    //         }, faction);\n    //         const cost = (newCost - oldCost) * (frequency / 10);\n    //         points += cost;\n    //       }\n    //     }\n    //   }\n    //   // Give bonus attacks with any weapon of that type\n    //   if (effect.type === \"bonusAttack\") {\n    //     const weaponType = effect.weaponType || \"shoot\";\n    //     const weaponFilter = weaponType === \"fight\" ? (wep) => getWeapon(wep, faction).short === \"Melee\" : (wep) => getWeapon(wep, faction).short !== \"Melee\";\n    //     let mostExpensiveWeaponDiff = 0;\n    //     const improvedWeaponStat = \"attacks\";\n    //     (model.weapons || []).filter(weaponFilter).forEach((wep) => {\n    //       const weapon = getWeapon(wep, faction);\n    //       const newCost = getWeaponCostForModel(wep.id ? { ...wep, count: 1 } : wep, model, faction, {\n    //         ...weapon,\n    //         [improvedWeaponStat]: (weapon[improvedWeaponStat] || 0) + value,\n    //         profiles: get(weapon, 'profiles', []).map((profile) => ({ ...profile, [improvedWeaponStat]: (profile[improvedWeaponStat] || 0) + value }))\n    //       });\n    //       mostExpensiveWeaponDiff = Math.max(mostExpensiveWeaponDiff, newCost);\n    //     });\n    //     points += mostExpensiveWeaponDiff * (frequency / 10);\n    //   }\n    //   // change all weapons\n    //   if (effect.type === \"alterWeapon\") {\n    //     const improvedInput = effect.statName;\n    //     const target = effect.target || \"self\";\n    //     if (target !== \"self\") {\n    //       const auraCost = getAuraCost(model, effect, (modelTarget) => {\n    //         let weaponCostTotal = 0;\n    //         (modelTarget.weapons || []).forEach((wep) => {\n    //           const weaponData = getWeapon(wep, faction);\n    //           const wepRulesWithoutCurrent = (weaponData.rules || []).filter((rule) => rule.id !== ruleId && rule !== ruleId);\n    //           if (weaponData[improvedInput]) {\n    //             const oldCost = getWeaponCostForModel(wep, modelTarget, faction, {\n    //               ...weaponData,\n    //               rules: wepRulesWithoutCurrent\n    //             });\n    //             const newCost = getWeaponCostForModel(wep, modelTarget, faction, {\n    //               ...weaponData,\n    //               rules: wepRulesWithoutCurrent,\n    //               [improvedInput]: (weaponData[improvedInput] || 0) + value,\n    //               profiles: get(weaponData, 'profiles', []).map((profile) => ({ ...profile, [improvedInput]: (profile[improvedInput] || 0) + value }))\n    //             });\n    //             const cost = (newCost - oldCost) * (frequency / 10);\n    //             weaponCostTotal += cost;\n    //           }\n    //         });\n    //         return weaponCostTotal * (effect.targetModels || modelTarget.min || 1);\n    //       }, faction);\n    //       points += auraCost * (frequency / 10) * 1.25;\n    //     } else {\n    //       const modelTarget = model;\n    //       let weaponCostTotal = 0;\n    //       (modelTarget.weapons || []).forEach((wep) => {\n    //         const weaponData = getWeapon(wep, faction);\n    //         const wepRulesWithoutCurrent = (weaponData.rules || []).filter((rule) => rule.id !== ruleId && rule !== ruleId);\n    //         if (weaponData[improvedInput]) {\n    //           const oldCost = getWeaponCostForModel(wep, modelTarget, faction, {\n    //             ...weaponData,\n    //             rules: wepRulesWithoutCurrent\n    //           });\n    //           const newCost = getWeaponCostForModel(wep, modelTarget, faction, {\n    //             ...weaponData,\n    //             rules: wepRulesWithoutCurrent,\n    //             [improvedInput]: (weaponData[improvedInput] || 0) + value,\n    //             profiles: get(weaponData, 'profiles', []).map((profile) => ({ ...profile, [improvedInput]: (profile[improvedInput] || 0) + value }))\n    //           });\n    //           const cost = (newCost - oldCost);\n    //           weaponCostTotal += cost;\n    //         }\n    //       });\n    //       points += weaponCostTotal * (frequency / 10);\n    //     }\n    //   }\n    // });\n    setCache(faction.name + model.name + JSON.stringify(rule));\n    return points;\n  }\n\n  const getWeaponList = (weaponList, faction) => {\n    const weapons = weaponList.map((weaponName) => getWeapon(weaponName, faction)).filter(weapon => !!weapon);\n    return sortBy(weapons, 'name');\n  }\n\n  const getRulesList = (ruleList, faction) => {\n    const weapons = ruleList.map((ruleName) => getRule(ruleName, faction)).filter(rule => !!rule);\n    return sortBy(weapons, 'name');\n  }\n\n  const getWeapons = (unit, faction) => {\n    const weaponsSet = new Set();\n    const weaponsList = [];\n    (unit.options || []).forEach((option) => {\n      const wepsArray = castArray(option.withWeapon || option.addWeapon || []);\n      wepsArray.forEach((wepList) => {\n        const wepListArr = castArray(wepList);\n        wepListArr.forEach((wep) => {\n          const weaponId = wep.id || wep;\n          if (!weaponsSet.has(weaponId)) {\n            weaponsSet.add(weaponId);\n            weaponsList.push(weaponId);\n          }\n        });\n      });\n    });\n    getModels(unit, faction).forEach((model) => {\n      if (model.options) {\n        model.options.forEach((option) => {\n          const wepsArray = castArray(option.withWeapon || option.addWeapon || []);\n          wepsArray.forEach((wepList) => {\n            const wepListArr = castArray(wepList);\n            wepListArr.forEach((wep) => {\n              const weaponId = wep.id || wep;\n              if (!weaponsSet.has(weaponId)) {\n                weaponsSet.add(weaponId);\n                weaponsList.push(weaponId);\n              }\n            });\n          });\n        });\n      }\n      (model.weapons || []).forEach((weapon) => {\n        const weaponId = weapon.id || weapon;\n        if (!weaponsSet.has(weaponId)) {\n          weaponsSet.add(weaponId);\n          weaponsList.push(weaponId);\n        }\n      });\n    });\n    const weapons = weaponsList.map((weaponName) => getWeapon(weaponName, faction)).filter(weapon => !!weapon);\n    return sortBy(weapons, 'name');\n  }\n\n  const getAllWeapons2 = (faction) => {\n    const allWeapons = {};\n    Object.keys(get(faction, 'weapons', {})).forEach((key) => {\n      allWeapons[key] = {\n        id: key,\n        ...faction.weapons[key]\n      }\n    });\n    Object.keys(globalWeapons).forEach((key) => {\n      allWeapons[key] = {\n        id: key,\n        ...globalWeapons[key]\n      }\n    });\n    return allWeapons;\n  };\n\n  const getAllWeapons = (faction) => {\n    const weaponsSet = new Set();\n    const weaponsList = [];\n    Object.values((faction.units || []) || {}).forEach((unit) => {\n      const weps = getWeapons(unit, faction);\n      weps.forEach((weapon) => {\n        if (!weaponsSet.has(weapon.name)) {\n          weaponsSet.add(weapon.name);\n          weaponsList.push(weapon);\n        }\n      });\n    });\n    return weaponsList;\n  };\n\n  const getAllRules = (faction) => {\n    const allRules = {};\n    Object.keys(get(faction, 'rules', {})).forEach((key) => {\n      allRules[key] = {\n        id: key,\n        ...faction.rules[key]\n      }\n    });\n    Object.keys(globalRules).forEach((key) => {\n      allRules[key] = {\n        id: key,\n        ...globalRules[key]\n      }\n    });\n    return Object.values(allRules);\n  }\n\n  const getAllWeaponRules = (weapons, faction) => {\n    const rulesSet = new Set();\n    const rulesList = [];\n    const wepArray = castArray(weapons);\n    wepArray.forEach((wepy) => {\n      const profiles = get(wepy, 'profiles', []);\n      const weaponAndProfiles = [...profiles, wepy];\n      weaponAndProfiles.forEach((weapon) => {\n        get(weapon, 'rules', []).forEach((rule) => {\n          const ruleId = rule.id || rule;\n          if (!rulesSet.has(ruleId)) {\n            rulesSet.add(ruleId);\n            rulesList.push(ruleId);\n          }\n        });\n      });\n    });\n    const rules = rulesList.map((rule) => getRule(rule, faction)).filter(rule => !rule.hidden);\n    return rules;\n  };\n\n  const getWeaponRules = (units, faction) => {\n    const rulesSet = new Set();\n    const rulesList = [];\n    units.forEach((unit) => {\n      getModels(unit, faction).forEach((model) => {\n        get(model, 'weapons', []).forEach((weaponName) => {\n          const weaponId = weaponName.id || weaponName;\n          const wep = getWeapon(weaponId, faction);\n          const profiles = get(wep, 'profiles', []);\n          const weaponAndProfiles = [...profiles, wep];\n          weaponAndProfiles.forEach((weapon) => {\n            get(weapon, 'rules', []).forEach((rule) => {\n              const ruleId = rule.id || rule;\n              if (!rulesSet.has(ruleId)) {\n                rulesSet.add(ruleId);\n                rulesList.push(ruleId);\n              }\n            });\n          });\n        });\n        if (model.options || unit.options) {\n          [...get(unit, 'options', []), ...get(model, 'options', [])].forEach((option) => {\n            const wepArray = castArray(option.withWeapon || option.addWeapon || []).flat();\n            wepArray.forEach((wepList) => {\n              const wepListArr = castArray(wepList);\n              wepListArr.forEach((wep) => {\n                const weaponId = wep.id || wep;\n                const wepy = getWeapon(weaponId, faction);\n                const profiles = get(wepy, 'profiles', []);\n                const weaponAndProfiles = [...profiles, wepy];\n                weaponAndProfiles.forEach((weapon) => {\n                  get(weapon, 'rules', []).forEach((rule) => {\n                    const ruleId = rule.id || rule;\n                    if (!rulesSet.has(ruleId)) {\n                      rulesSet.add(ruleId);\n                      rulesList.push(ruleId);\n                    }\n                  });\n                });\n              });\n            });\n          });\n        }\n      });\n    });\n    const rules = rulesList.map((rule) => getRule(rule, faction)).filter(rule => !rule.hidden);\n    return rules;\n  };\n\n  const getModelRules = (units, faction) => {\n    const rulesSet = new Set();\n    const rulesList = [];\n    units.forEach((unit) => {\n      const unitRules = unit.rules || [];\n      unitRules.forEach((rule) => {\n        const ruleId = rule.id || rule;\n        if (!rulesSet.has(ruleId)) {\n          rulesSet.add(ruleId);\n          rulesList.push(ruleId);\n        }\n      });\n      getModels(unit, faction).forEach((model) => {\n        (model.rules || []).forEach((rule) => {\n          const ruleId = rule.id || rule;\n          if (!rulesSet.has(ruleId)) {\n            rulesSet.add(ruleId);\n            rulesList.push(ruleId);\n          }\n        });\n        if (model.options || unit.options) {\n          [...get(unit, 'options', []), ...get(model, 'options', [])].forEach((option) => {\n            const addRule = castArray(option.addRule || option.withRule || []).flat();\n            addRule.forEach((rule) => {\n              // const ruleData = getRule(rule, faction);\n              // (ruleData.effects || []).forEach((effect) => {\n              //   const ruleId = get(effect, 'rule.id') || get(effect, 'rule');\n              //   if (ruleId) {\n              //     if (!rulesSet.has(ruleId)) {\n              //       rulesSet.add(ruleId);\n              //       rulesList.push(ruleId);\n              //     }\n              //   }\n              // })\n              const ruleId = rule.id || rule;\n              if (!rulesSet.has(ruleId)) {\n                rulesSet.add(ruleId);\n                rulesList.push(ruleId);\n              }\n            });\n          });\n        }\n      });\n    });\n    const rules = rulesList.map((rule) => getRule(rule, faction)).filter(rule => !rule.hidden);\n    return rules;\n  };\n\n  const getRules = (units, faction) => {\n    let rulesList = [];\n    const modelRules = getModelRules(units, faction);\n    rulesList = rulesList.concat(modelRules);\n    const weaponRules = getWeaponRules(units, faction);\n    rulesList = rulesList.concat(weaponRules);\n    return uniq(rulesList);\n  };\n\n  const getMissions = () => {\n    return rootMissions || {};\n  }\n\n  const getMissionScenarios = () => {\n    return Object.values(getMissions().missions || {});\n  }\n\n  const getMissionWeather = () => {\n    return Object.values(getMissions().weather || {});\n  }\n\n  const getMissionConditions = () => {\n    return Object.values(getMissions().conditions || {});\n  }\n\n  const getMissionSecondaries = () => {\n    return Object.values(getMissions().secondaries || {});\n  }\n\n  return {\n    getNameLists,\n    getNameList,\n    getRandomName,\n    getRandomFemaleName,\n    getRandomMaleName,\n    resolvePoints,\n    getSetbacks,\n    getSetback,\n    getGameType,\n    getPerks,\n    getPerk,\n    getRawFaction,\n    getAllKeywords,\n    getOrganizationCategory,\n    getOrganizationSlotsRaw,\n    getRawOrganizations,\n    getOrganizations,\n    getAllWeaponRules,\n    getModels,\n    getModel,\n    getModelTotalPoints,\n    getModelPoints,\n    getModelWeaponPoints,\n    getModelRulePoints,\n    getWeaponCostForModel,\n    getModelList,\n    getAlliance,\n    getAlliances,\n    getRawAlliances,\n    getRelicCost,\n    getAllRules,\n    getPowerCharge,\n    getPhase,\n    getUnits,\n    getUnit,\n    getAllWeapons,\n    getAllWeapons2,\n    getRules,\n    getRulesList,\n    getWeaponRules,\n    getModelRules,\n    getFactions,\n    getRawPhases,\n    getWeaponCostAverage,\n    getRuleCostAverage,\n    getRule,\n    getUnitPoints,\n    getWeapon,\n    getWeapons,\n    getWeaponList,\n    getOptionsList,\n    getAdditionalModelsList,\n    getRuleCostForModel,\n    getPowers,\n    getFactionWithSubfaction,\n    getPower,\n    getAllModels,\n    getStrategies,\n    getStrategy,\n    getRelics,\n    getRelic,\n    getFaction,\n    getSubfaction,\n    getPowerCategories,\n    getCategories,\n    getRawPowerCategories,\n    getRawCategories,\n    getPowerCategory,\n    getCategory,\n    getMissions,\n    getMissionScenarios,\n    getMissionSecondaries,\n    getMissionWeather,\n    getMissionConditions,\n    getTerrain\n  }\n}\n\nexport const mergeGlobalData = (game, gameData) => {\n  const gameType = get(game, 'gameType', 'battle');\n  return mergeWith(get(gameData, `gameData.globalData.all`, {}), get(gameData, `gameData.globalData[${gameType}]`, {}))\n}","import {\n  Box, Button,\n  Card, CardContent, CardHeader, Typography\n} from \"@mui/material\";\nimport React from \"react\";\nimport { getTextColor, hexToRgb } from \"utils/colors\";\n\nexport const Focus = (props) => {\n  const {\n    faction,\n    subfactions: rawSubfactions,\n    setSubfaction,\n    subfaction,\n  } = props;\n  const subfactions = [\n    {\n      id: \"none\",\n      name: \"No Focus\",\n      description:\n        \"A generalist force which can take on many different enemies.\",\n    },\n    ...rawSubfactions,\n  ];\n  const { color: factionColor } =\n    faction;\n  const textColor = factionColor\n    ? getTextColor(hexToRgb(factionColor))\n    : \"white\";\n  return (\n    <div>\n      <Typography sx={{ my: 2 }} variant=\"h4\" component=\"div\" align=\"center\">\n        Focus\n      </Typography>\n      {!subfactions.length && <p>{\"No subfactions found...\"}</p>}\n      <div className=\"two-columns\">\n        {subfactions.map((subfactionData, index) => {\n          const background = subfactionData.description;\n          return (\n            <div style={{ breakInside: \"avoid\" }} key={index}>\n              <Card\n                className=\"no-break\"\n                sx={{\n                  border: `2px solid ${factionColor}`,\n                  mb: 2,\n                }}\n              >\n                <CardHeader\n                  sx={{\n                    backgroundColor: factionColor,\n                    color: textColor,\n                    py: 1,\n                  }}\n                  title={\n                    <Typography variant=\"h5\" component=\"div\">\n                      {subfactionData.name}\n                    </Typography>\n                  }\n                />\n                <CardContent>\n                  <Box\n                    display=\"flex\"\n                    sx={{ justifyContent: 'space-between', alignItems: 'center' }}\n                  >\n                    <Box\n                      display=\"flex\"\n                      sx={{ justifyContent: 'space-between', alignItems: 'center', mr: 1 }}\n                    >\n                      {!!background && (\n                        <div>\n                          <>{background}</>\n                        </div>\n                      )}\n                      {/* {!!strengths && <div>\n                        <>{strengths}</>\n                      </div>}\n                      {!!weaknesses && <div>\n                        <>{weaknesses}</>\n                      </div>} */}\n                    </Box>\n                    <Button\n                      className=\"focus-select\"\n                      variant=\"contained\"\n                      disabled={subfaction === subfactionData.id}\n                      onClick={() => setSubfaction(subfactionData.id)}\n                    >{`Select`}</Button>\n                  </Box>\n                </CardContent>\n              </Card>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n","\nimport {\n  TableRow\n} from \"@mui/material\";\nimport { styled } from '@mui/material/styles';\n\nexport const StyledTableRow = styled(TableRow)(({ theme }) => ({\n  th: {\n    color: 'inherit'\n  },\n  '& .MuiTableCell-sizeSmall': {\n    padding: \"5px 0px 5px 5px\" // <-- arbitrary value\n  },\n  '&:nth-of-type(odd)': {\n    backgroundColor: theme.palette.action.hover,\n  },\n  // hide last border\n  '&:last-child td, &:last-child th': {\n    border: 0,\n  },\n}));","import {\n  Card, CardContent, CardHeader, Table, TableBody, TableCell, Typography\n} from \"@mui/material\";\nimport { StyledTableRow } from \"components/styled-table\";\nimport React from \"react\";\nimport { getTextColor, hexToRgb } from \"utils/colors\";\n\n\nexport const Organization = (props) => {\n  const { data, faction, nameFilter } = props;\n  const organizations = data\n    .getOrganizations()\n    .filter((strategy) =>\n      nameFilter\n        ? strategy.name.toLowerCase().includes(nameFilter.toLowerCase())\n        : true\n    );\n  const { color: factionColor } =\n    faction;\n  const textColor = factionColor\n    ? getTextColor(hexToRgb(factionColor))\n    : \"white\";\n\n  return (\n    <>\n      <div>\n        <Typography sx={{ my: 2 }} variant=\"h4\" align=\"center\">\n          Forces\n        </Typography>\n        {!organizations.length && <p>{\"No forces found...\"}</p>}\n        <div className=\"two-columns\">\n          {organizations.map((org, index) => {\n            const orgSlots = data.getOrganizationSlotsRaw(org);\n            const cost = org.cost;\n            return (\n              <Card\n                key={index}\n                className=\"no-break\"\n                sx={{\n                  border: `2px solid ${factionColor}`,\n                  mb: 2,\n                }}\n              >\n                <CardHeader\n                  sx={{ backgroundColor: factionColor, color: textColor, p: 1 }}\n                  title={\n                    <Typography variant=\"h5\" component=\"div\" align=\"center\">\n                      {org.name} {!!cost && <small style={{ fontSize: '1rem'}}>{`(${cost})`}</small>}\n                    </Typography>\n                  }\n                />\n                <CardContent style={{ padding: 0 }}>\n                  <Typography component=\"div\" align=\"center\" sx={{ p: 2 }}>\n                    {org.description}\n                  </Typography>\n                  <Table size=\"small\" aria-label=\"simple table\" sx={{ mb: 1 }}>\n                    <TableBody>\n                      {orgSlots.map((category, index) => {\n                        const categoryData = data.getCategory(category);\n                        const organizationData = data.getOrganizationCategory(\n                          org,\n                          category\n                        );\n                        return (\n                          <StyledTableRow key={index}>\n                            <TableCell>{categoryData.name}</TableCell>\n                            <TableCell align=\"right\" style={{ paddingRight: '5px' }}>\n                              {`${organizationData.min || 0}-${\n                                organizationData.max || 0\n                              }`}\n                            </TableCell>\n                          </StyledTableRow>\n                        );\n                      })}\n                    </TableBody>\n                  </Table>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      </div>\n    </>\n  );\n};\n","import ShoppingCartIcon from \"@mui/icons-material/ShoppingCart\";\nimport {\n  CardHeader, IconButton, List,\n  ListItem, ListItemText, Typography\n} from \"@mui/material\";\nimport Card from \"@mui/material/Card\";\nimport CardContent from \"@mui/material/CardContent\";\nimport { get, sortBy } from \"lodash\";\nimport React from \"react\";\nimport { getTextColor, hexToRgb } from \"utils/colors\";\n\nexport const Overview = (props) => {\n  const { faction, nameFilter } = props;\n  const { color: factionColor } = faction;\n  const textColor = factionColor\n    ? getTextColor(hexToRgb(factionColor))\n    : \"white\";\n  const background = faction.background;\n  const description = faction.description;\n  const strengths = faction.strengths;\n  const weaknesses = faction.weaknesses;\n  const powers = get(faction, \"buyLinks\", []).filter((list) =>\n    nameFilter\n      ? list.name.toLowerCase().includes(nameFilter.toLowerCase())\n      : true\n  );\n  const sortedPowers = sortBy(powers, (power) => power.name);\n  return (\n    <div>\n      <Typography sx={{ my: 2 }} variant=\"h4\" align=\"center\">\n        Overview\n      </Typography>\n      {!background &&\n        !description &&\n        !strengths &&\n        !weaknesses &&\n        !sortedPowers && (\n          <div>\n            <p>{`No information available...`}</p>\n          </div>\n        )}\n\n      {!!description && (\n        <Card\n          sx={{\n            border: `2px solid ${factionColor}`,\n            mb: 2,\n          }}\n        >\n          <CardHeader\n            sx={{ backgroundColor: factionColor, color: textColor, py: 1 }}\n            title={\n              <Typography variant=\"h5\" component=\"div\">\n                {\"Description\"}\n              </Typography>\n            }\n          />\n          <CardContent>{description}</CardContent>\n        </Card>\n      )}\n      {/* {!!background && <div className=\"unit-card\" style={{ marginBottom: '15px', borderColor: factionColor }}>\n        <div style={thStyle} className=\"unit-card-title\">\n          <h4>{'Background'}</h4>\n        </div>\n        <div className=\"unit-card-body\">\n          {background}\n        </div>\n      </div>} */}\n      {/* {!!strengths && <div>\n        <h4>{'Strengths'}</h4>\n        <p>{strengths}</p>\n        <hr />\n      </div>}\n      {!!weaknesses && <div>\n        <h4>{'Weaknesses'}</h4>\n        <p>{weaknesses}</p>\n        <hr />\n      </div>} */}\n      {!!sortedPowers && !!sortedPowers.length && (\n        <Card\n          sx={{\n            border: `2px solid ${factionColor}`,\n            mb: 2,\n          }}\n        >\n          <CardHeader\n            sx={{ backgroundColor: factionColor, color: textColor, py: 1 }}\n            title={\n              <Typography variant=\"h5\" component=\"div\">\n                {\"Model Makers\"}\n              </Typography>\n            }\n          />\n          <CardContent style={{ padding: 0 }}>\n            <List\n              sx={{\n                width: \"100%\"\n              }}\n            >\n              {sortedPowers.map((list) => (\n                <ListItem\n                  key={list.name}\n                  secondaryAction={\n                    <IconButton edge=\"end\" aria-label=\"comments\" onClick={() => window.open(list.link, \"_blank\")}>\n                      <ShoppingCartIcon />\n                    </IconButton>\n                  }\n                >\n                  <ListItemText\n                    id={list.name}\n                    primary={list.name}\n                    secondary={list.description}\n                  />\n                </ListItem>\n              ))}\n            </List>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n};\n","import {\n  Card, CardContent, CardHeader, Divider,\n  Typography\n} from \"@mui/material\";\nimport ReactMarkdown from \"react-markdown\";\nimport { getTextColor, hexToRgb } from 'utils/colors';\n\nexport const PowerCard = (props) => {\n  const { faction, power } = props;\n  const { color: factionColor } = faction;\n  const textColor = factionColor\n    ? getTextColor(hexToRgb(factionColor))\n    : \"white\";\n  return (\n    <Card\n      className=\"no-break\"\n      sx={{\n        border: `2px solid ${factionColor}`,\n        mb: 2,\n      }}\n    >\n      <CardHeader\n        sx={{\n          backgroundColor: factionColor,\n          color: textColor,\n          py: 1,\n        }}\n        title={\n          <Typography variant=\"h5\" component=\"div\">\n            {power.name} <small style={{ fontSize: '1rem'}}>{`(${power.charge})`}</small>\n          </Typography>\n        }\n      />\n      <CardContent>\n        {!!power.flavor && (\n          <>\n            <i className=\"power-flavor\">{power.flavor}</i>\n            <Divider />\n          </>\n        )}\n        <div className=\"power-description\">\n          <ReactMarkdown children={power.description} className=\"rule-text\" />\n        </div>\n        {!!power.source && (\n          <>\n            <Divider />\n            <i className=\"power-source\">{power.source}</i>\n          </>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n","import {\n  Box, Typography\n} from \"@mui/material\";\nimport { PowerCard } from 'components/roster/power-card';\nimport { get, groupBy, sortBy } from \"lodash\";\nimport React from \"react\";\n\nexport const Powers = (props) => {\n  const { data, faction, nameFilter } = props;\n  const strategies = data\n    .getPowers(faction)\n    .filter((power) =>\n      nameFilter\n        ? power.name.toLowerCase().includes(nameFilter.toLowerCase())\n        : true\n    );\n  const phases = { ...data.getRawPowerCategories(faction) };\n  const unitPhases = { ...groupBy(strategies, \"category\") };\n  const phaseOrder = [undefined, ...Object.keys(phases)].filter(\n    (cat) => unitPhases[cat] && unitPhases[cat]\n  );\n  return (\n    <>\n      {!strategies.length && <p>{\"No strategies found...\"}</p>}\n      {phaseOrder.map((phaseId, phaseIdx) => {\n        const phaseStrategies = get(unitPhases, `[${phaseId}]`, []).map(\n          (strat) => ({ ...strat, sourceLength: strat.source.length })\n        );\n        const sortedStrategies = sortBy(phaseStrategies, [\n          \"sourceLength\",\n          \"source\",\n          \"charge\",\n        ]);\n        const phaseData = data.getPowerCategory(phaseId, faction);\n        return (\n          <>\n            <div key={phaseIdx}>\n              <Typography\n                sx={{ my: 2 }}\n                variant=\"h4\"\n                component=\"div\"\n                align=\"center\"\n              >\n                {phaseData.name || \"Any Specialty\"}\n              </Typography>\n            </div>\n            <div className=\"two-columns\">\n              {sortedStrategies.map((power, index) => (\n                <div key={index} className=\"no-break\">\n                  <Box sx={{ mb: 2 }}>\n                    <PowerCard faction={faction} power={power} />\n                  </Box>\n                </div>\n              ))}\n            </div>\n          </>\n        );\n      })}\n    </>\n  );\n};\n","import React, { useState } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport { getTextColor, hexToRgb } from \"utils/colors\";\nimport Collapse from \"@mui/material/Collapse\";\nimport Button from \"@mui/material/Button\";\n\nexport const RuleList = (props) => {\n  const { rules, faction, toggler, twoColumn, showName = true } = props;\n  const [showRules, setShowRules] = useState(false);\n  const { color: factionColor } = faction;\n  const textColor = factionColor\n    ? getTextColor(hexToRgb(factionColor))\n    : \"white\";\n  const borderColor = textColor !== \"white\" ? textColor : factionColor;\n  const btnStyle = { borderColor };\n  return (\n    <div>\n      {!!toggler && (\n        <div className=\"text-center\" style={{ marginBottom: \"0.5rem\" }}>\n          <Button\n            sx={{ color: 'inherit', textTransform: 'none' }}\n            size=\"small\"\n            fullWidth\n            variant=\"outlined\"\n            block\n            style={btnStyle}\n            onClick={() => setShowRules(!showRules)}\n          >\n            {showRules ? \"Hide\" : \"Special Rules\"}\n          </Button>\n        </div>\n      )}\n      <Collapse in={!toggler || showRules}>\n        <div>\n          <div className={twoColumn ? \"two-columns\" : \"\"}>\n            {rules.map((rule) => {\n              const ruleName = `${rule.name}${\n                rule.inputs\n                  ? `(${rule.inputs\n                      .map((input) => input.toUpperCase())\n                      .join(\", \")})`\n                  : ``\n              }`;\n              const stuff = `${showName ? `**${ruleName}**: ` : \"\"}${\n                rule.description\n              }`;\n              return (\n                <div className=\"no-break\">\n                  <>\n                    <ReactMarkdown children={stuff} className=\"rule-text\" />\n                  </>\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      </Collapse>\n    </div>\n  );\n};\n","import React, { useState } from \"react\";\nimport { getTextColor, hexToRgb } from \"utils/colors\";\nimport { get } from \"lodash\";\nimport { RuleList } from \"components/roster/rule-list\";\nimport Collapse from \"@mui/material/Collapse\";\nimport Button from \"@mui/material/Button\";\nimport Table from \"@mui/material/Table\";\nimport TableBody from \"@mui/material/TableBody\";\nimport TableCell from \"@mui/material/TableCell\";\nimport TableContainer from \"@mui/material/TableContainer\";\nimport TableHead from \"@mui/material/TableHead\";\nimport { StyledTableRow } from \"components/styled-table\";\n\nexport const WeaponList = (props) => {\n  const { weapons, faction, data, toggler, rules, twoColumns = true } = props;\n  const { color: factionColor, secondary_color: factionSecondaryColor } =\n    faction;\n  const textColor = factionColor\n    ? getTextColor(hexToRgb(factionColor))\n    : \"white\";\n  const textColorSecondary = factionSecondaryColor\n    ? getTextColor(hexToRgb(factionSecondaryColor))\n    : \"white\";\n  const borderColor = textColor !== \"white\" ? textColor : factionColor;\n  const btnStyle = { borderColor };\n  const thStyle = {\n    backgroundColor: factionSecondaryColor || factionColor,\n    color: factionSecondaryColor ? textColorSecondary : textColor,\n  };\n  const [showWeapons, setShowWeapons] = useState(false);\n  const renderRules = (rules) => {\n    if (!rules || !rules.length) {\n      return;\n    }\n    return (\n      <div>\n        <RuleList twoColumn={twoColumns} faction={faction} rules={rules} />\n      </div>\n    );\n  };\n  return (\n    <div>\n      {!!toggler && (\n        <div align=\"center\">\n          <div style={{ marginBottom: \"0.5rem\" }}>\n            <Button\n              sx={{ color: \"inherit\", textTransform: \"none\" }}\n              size=\"small\"\n              fullWidth\n              variant=\"outlined\"\n              style={btnStyle}\n              onClick={() => setShowWeapons(!showWeapons)}\n            >\n              {showWeapons ? \"Hide\" : \"Weapons\"}\n            </Button>\n          </div>\n        </div>\n      )}\n      <Collapse in={!toggler || showWeapons}>\n        <TableContainer sx={{ borderRadius: 1, mb: 1 }}>\n          <Table size=\"small\" style={{ borderColor: borderColor }}>\n            <TableHead>\n              <StyledTableRow style={thStyle}>\n                <TableCell>{\"Weapon\"}</TableCell>\n                <TableCell align=\"center\">{\"Range\"}</TableCell>\n                <TableCell align=\"center\">{\"A\"}</TableCell>\n                <TableCell align=\"center\">{\"AP\"}</TableCell>\n                <TableCell>{\"Special\"}</TableCell>\n              </StyledTableRow>\n            </TableHead>\n            <TableBody>\n              {weapons.map((weapon) => {\n                if (weapon.profiles) {\n                  return weapon.profiles.map((weaponProfile) => {\n                    return (\n                      <StyledTableRow>\n                        <TableCell>{`${weapon.name} (${weaponProfile.name})`}</TableCell>\n                        <TableCell align=\"center\">\n                          {`${\n                            weapon.short !== \"Melee\"\n                              ? `${weaponProfile.short}\"`\n                              : weaponProfile.short || \"-\"\n                          }/${\n                            weaponProfile.medium\n                              ? `${weaponProfile.medium}\"`\n                              : \"-\"\n                          }`}\n                        </TableCell>\n                        <TableCell align=\"center\">\n                          {weaponProfile.attacks ? weaponProfile.attacks : \"-\"}\n                        </TableCell>\n                        <TableCell align=\"center\">\n                          {weaponProfile.ap || \"-\"}\n                        </TableCell>\n                        <TableCell>\n                          {[\n                            ...get(weapon, \"rules\", []),\n                            ...get(weaponProfile, \"rules\", []),\n                          ]\n                            .map((rule) => {\n                              const ruleData = data.getRule(\n                                rule.id || rule,\n                                faction\n                              );\n                              return ruleData.inputs\n                                ? `${ruleData.name}(${ruleData.inputs\n                                    .map((input) => rule[input])\n                                    .join(\", \")})`\n                                : ruleData.name;\n                            })\n                            .join(\", \") || \"-\"}\n                        </TableCell>\n                      </StyledTableRow>\n                    );\n                  });\n                }\n                return (\n                  <StyledTableRow>\n                    <TableCell>{weapon.name}</TableCell>\n                    <TableCell align=\"center\">\n                      {`${\n                        weapon.short !== \"Melee\"\n                          ? `${weapon.short}\"`\n                          : weapon.short || \"-\"\n                      }/${weapon.medium ? `${weapon.medium}\"` : \"-\"}`}\n                    </TableCell>\n                    <TableCell align=\"center\">\n                      {weapon.attacks ? weapon.attacks : \"-\"}\n                    </TableCell>\n                    <TableCell align=\"center\">{weapon.ap || \"-\"}</TableCell>\n                    <TableCell>\n                      {get(weapon, \"rules\", [])\n                        .map((rule) => {\n                          const ruleData = data.getRule(\n                            rule.id || rule,\n                            faction\n                          );\n                          return ruleData.inputs\n                            ? `${ruleData.name}(${ruleData.inputs\n                                .map((input) => rule[input])\n                                .join(\", \")})`\n                            : ruleData.name;\n                        })\n                        .join(\", \") || \"-\"}\n                    </TableCell>\n                  </StyledTableRow>\n                );\n              })}\n            </TableBody>\n          </Table>\n        </TableContainer>\n        {!!(rules && rules.length) && <>{renderRules(rules)}</>}\n      </Collapse>\n    </div>\n  );\n};\n","import {\n  Card, CardContent, CardHeader, Divider,\n  Typography\n} from \"@mui/material\";\nimport { RuleList } from \"components/roster/rule-list\";\nimport { WeaponList } from \"components/roster/weapon-list\";\nimport ReactMarkdown from \"react-markdown\";\nimport { getTextColor, hexToRgb } from \"utils/colors\";\n\nconst dummyModel = {\n  name: \"Battle Brother\",\n  courage: 7,\n  shoot: 6,\n  fight: 6,\n  defense: 7,\n  movement: 5,\n  reflexes: 7,\n  agility: 6,\n  wounds: 3,\n  weapons: [\n    { id: \"marine_rifle\" },\n    \"at_grenade\",\n    { id: \"ccw\", count: 2 },\n    \"marine_pistol\",\n  ],\n  min: 4,\n  max: 9,\n};\n\nexport const RelicCard = (props) => {\n  const { faction, relic, data, printMode = false } = props;\n  const { color: factionColor } = faction;\n  const textColor = factionColor\n    ? getTextColor(hexToRgb(factionColor))\n    : \"white\";\n  const weaponData = relic.weapon\n    ? data.getWeapon(relic.weapon, faction)\n    : undefined;\n  const ruleData = relic.rule ? data.getRule(relic.rule, faction) : undefined;\n  const weaponRules = relic.weapon\n    ? data.getRules(\n        [\n          {\n            models: [\n              {\n                ...dummyModel,\n                rules: [],\n                weapons: [relic.weapon],\n              },\n            ],\n          },\n        ],\n        faction\n      )\n    : [];\n  const relicCost = Math.round(data.getRelicCost(relic, faction));\n  return (\n    <Card\n      className=\"no-break no-page-break force-print\"\n      sx={{\n        border: `2px solid ${factionColor}`,\n      }}\n    >\n      <CardHeader\n        sx={{\n          backgroundColor: factionColor,\n          color: textColor,\n          py: 1,\n        }}\n        title={\n          <Typography variant=\"h5\" component=\"div\">\n            {relic.name} <small style={{ fontSize: '1rem'}}>{`(${relicCost}pts)`}</small>\n          </Typography>\n        }\n      />\n      <CardContent>\n        {(!!relic.flavor && !printMode) && (\n          <>\n            <i className=\"legend-flavor\">{relic.flavor}</i>\n            <Divider />\n          </>\n        )}\n        {!!relic.description && (\n          <div className=\"legend-description\">\n            <ReactMarkdown children={relic.description} className=\"rule-text\" />\n            <Divider />\n          </div>\n        )}\n        <div>\n          {!!ruleData && (\n            <div className=\"legend-rules-text\">\n              <ReactMarkdown\n                children={`${`__${ruleData.name}:__ `} ${ruleData.description}`}\n                className=\"rule-text\"\n              />\n            </div>\n          )}\n          {!!weaponData && (\n            <div className=\"legend-rules-text\">\n              <WeaponList\n                weapons={[weaponData]}\n                faction={faction}\n                data={data}\n              />\n            </div>\n          )}\n          {!!weaponRules.length && (\n            <div className=\"legend-rules-text\">\n              <RuleList\n                twoColumn={false}\n                rules={weaponRules}\n                faction={faction}\n              />\n            </div>\n          )}\n        </div>\n        {!!relic.source && (\n          <div className=\"legend-description\">\n            <Divider />\n            <i>{relic.source}</i>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n","import { Box, Typography } from \"@mui/material\";\nimport { RelicCard } from \"components/roster/relic-card\";\nimport { get, groupBy, sortBy } from \"lodash\";\nimport React from \"react\";\n\nexport const Relics = (props) => {\n  const { data, faction, nameFilter } = props;\n\n  const RELIC_TYPES = {\n    equipment: \"Equipment\",\n    ability: \"Abilities\",\n  };\n\n  const nameFilterer = (relic) => {\n    if (!nameFilter) {\n      return true;\n    }\n    const relicData = relic.weapon\n      ? data.getWeapon(relic.weapon, faction)\n      : data.getRule(relic.rule, faction);\n    return relicData.name.toLowerCase().includes(nameFilter.toLowerCase());\n  };\n\n  const relics = data.getRelics(faction).filter(nameFilterer);\n  const groupedRelics = groupBy(relics, (relic) =>\n    relic.type || relic.rule ? \"ability\" : \"equipment\"\n  );\n\n  return (\n    <div>\n      {!relics.length && <p>{\"No legends found...\"}</p>}\n      <div>\n        {Object.keys(RELIC_TYPES)\n          .filter(\n            (type) => !!groupedRelics[type] && !!groupedRelics[type].length\n          )\n          .map((relicType, relicIdxKey) => {\n            const relicsType = get(groupedRelics, `[${relicType}]`, [])\n              .map((relic) => ({\n                ...relic,\n                cost: data.getRelicCost(relic, faction),\n              }))\n              .map((strat) => ({\n                ...strat,\n                sourceLength: strat.source.length,\n              }));\n            const sortedRelics = sortBy(relicsType, [\n              \"sourceLength\",\n              \"source\",\n              \"cost\",\n            ]);\n            return (\n              <>\n                <div key={relicIdxKey}>\n                  <Typography\n                    sx={{ my: 2 }}\n                    variant=\"h4\"\n                    component=\"div\"\n                    align=\"center\"\n                  >\n                    {RELIC_TYPES[relicType]}\n                  </Typography>\n                </div>\n                <div className=\"two-columns\">\n                  {sortedRelics.map((relic, index) => {\n                    return (\n                      <Box sx={{ mb: 2 }} style={{ breakInside: \"avoid\" }} key={index}>\n                        <RelicCard faction={faction} relic={relic} data={data} />\n                      </Box>\n                    );\n                  })}\n                </div>\n              </>\n            );\n          })}\n      </div>\n    </div>\n  );\n};\n","import { Card, CardContent, CardHeader, Typography } from \"@mui/material\";\nimport { RuleList } from \"components/roster/rule-list\";\nimport { sortBy } from \"lodash\";\nimport React from \"react\";\nimport { getTextColor, hexToRgb } from \"utils/colors\";\n\nexport const Rules = (props) => {\n  const { data, faction, nameFilter } = props;\n  const { color: factionColor } = faction;\n  const textColor = factionColor\n    ? getTextColor(hexToRgb(factionColor))\n    : \"white\";\n  const units = data.getUnits(faction);\n  const weapons = data\n    .getRules(units, faction)\n    .filter((strategy) =>\n      nameFilter\n        ? strategy.name.toLowerCase().includes(nameFilter.toLowerCase())\n        : true\n    );\n  const weaponsSorted = sortBy(weapons, \"name\");\n  return (\n    <div>\n      <Typography sx={{ my: 2 }} variant=\"h4\" component=\"div\" align=\"center\">\n        Rules\n      </Typography>\n      {!weapons.length && <p>{\"No rules found...\"}</p>}\n      {!!weapons.length && (\n        <div className=\"two-columns\">\n          {weaponsSorted.map((rule, index) => (\n            <div style={{ breakInside: \"avoid-column\" }} key={index}>\n              <Card\n                className=\"no-break\"\n                sx={{\n                  border: `2px solid ${factionColor}`,\n                  mb: 2,\n                }}\n              >\n                <CardHeader\n                  sx={{\n                    backgroundColor: factionColor,\n                    color: textColor,\n                    py: 1,\n                  }}\n                  title={\n                    <Typography variant=\"h6\" component=\"div\">\n                      {rule.name}\n                    </Typography>\n                  }\n                />\n                <CardContent>\n                  <RuleList faction={faction} rules={[rule]} showName={false} />\n                </CardContent>\n              </Card>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n","import { Card, CardContent, CardHeader, Divider, Typography } from '@mui/material';\nimport ReactMarkdown from 'react-markdown';\nimport { getTextColor, hexToRgb } from 'utils/colors';\n\nexport const StrategyCard = (props) => {\n  const { strategy, faction } = props;\n  const { color: factionColor } = faction;\n  const textColor = factionColor\n    ? getTextColor(hexToRgb(factionColor))\n    : \"white\";\n  return (\n    <Card\n      className=\"no-break\"\n      sx={{\n        border: `2px solid ${factionColor}`\n      }}\n    >\n      <CardHeader\n        sx={{\n          backgroundColor: factionColor,\n          color: textColor,\n          py: 1,\n        }}\n        title={\n          <Typography variant=\"h5\" component=\"div\">\n            {strategy.name} <small style={{ fontSize: '1rem'}}>{`(${strategy.cost})`}</small>\n          </Typography>\n        }\n      />\n      <CardContent>\n        {!!strategy.flavor && (\n          <>\n            <i className=\"strategy-flavor\">{strategy.flavor}</i>\n            <Divider />\n          </>\n        )}\n        <div className=\"strategy-description\">\n          <ReactMarkdown\n            children={strategy.description}\n            className=\"rule-text\"\n          />\n        </div>\n        {!!strategy.source && (\n          <>\n            <Divider />\n            <i className=\"strategy-source\">{strategy.source}</i>\n          </>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n","import {\n  Box, Typography\n} from \"@mui/material\";\nimport { StrategyCard } from \"components/roster/strategy-card\";\nimport { get, groupBy, sortBy } from \"lodash\";\nimport React from \"react\";\n\nexport const Strategies = (props) => {\n  const { data, faction, nameFilter } = props;\n  const strategies = data\n    .getStrategies(faction)\n    .filter((strategy) =>\n      nameFilter\n        ? strategy.name.toLowerCase().includes(nameFilter.toLowerCase())\n        : true\n    );\n  const phases = { ...data.getRawPhases() };\n  const unitPhases = { ...groupBy(strategies, \"phase\") };\n  const phaseOrder = [...Object.keys(phases), undefined].filter(\n    (cat) => unitPhases[cat] && unitPhases[cat]\n  );\n  return (\n    <div>\n      {!strategies.length && <p>{\"No strategies found...\"}</p>}\n      {phaseOrder.map((phaseId, phaseKey) => {\n        const phaseStrategies = get(unitPhases, `[${phaseId}]`, []).map(\n          (strat) => ({ ...strat, sourceLength: strat.source.length })\n        );\n        const sortedStrategies = sortBy(phaseStrategies, [\n          \"sourceLength\",\n          \"source\",\n          \"cost\",\n        ]);\n        const phaseData = data.getPhase(phaseId);\n        return (\n          <>\n            <div key={phaseKey} className=\"no-break\">\n              <Typography\n                sx={{ my: 2 }}\n                variant=\"h4\"\n                component=\"div\"\n                align=\"center\"\n              >\n                {phaseData.name || \"Any Phase\"}\n              </Typography>\n            </div>\n            <div className=\"two-columns\">\n              {sortedStrategies.map((strategy, index) => (\n                <div key={index} className=\"no-break\">\n                  <Box sx={{ mb: 2 }}>\n                    <StrategyCard faction={faction} strategy={strategy} />\n                  </Box>\n                </div>\n              ))}\n            </div>\n          </>\n        );\n      })}\n    </div>\n  );\n};\n","import {\n  Button, Dialog, DialogActions, DialogContent, DialogTitle, FormControl, FormControlLabel, Radio, RadioGroup, Table, TableBody, TableCell, TableContainer, TableHead\n} from \"@mui/material\";\nimport { StyledTableRow } from \"components/styled-table\";\nimport {\n  get\n} from \"lodash\";\nimport React, {\n  useMemo, useState\n} from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport { getTextColor, hexToRgb } from \"utils/colors\";\nimport { formatRule, formatWeapon } from \"utils/format\";\n\nexport const DescriptionModal = (props) => {\n  const { hideModal, unit } = props;\n  return (\n    <>\n      <Dialog open onClose={hideModal}>\n        <DialogTitle closeButton>{unit.name}</DialogTitle>\n        <DialogContent>\n          <ReactMarkdown children={unit.background} className=\"rule-text\" />\n        </DialogContent>\n        <DialogActions>\n          <Button\n            color=\"primary\"\n            onClick={() => {\n              hideModal();\n            }}\n          >\n            Done\n          </Button>{\" \"}\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport const UnitDebugModal = (props) => {\n  const { hideModal, unit, data, faction } = props;\n  const { color: factionColor, secondary_color: factionSecondaryColor } =\n    faction;\n  const textColor = factionColor\n    ? getTextColor(hexToRgb(factionColor))\n    : \"white\";\n  const textColorSecondary = factionSecondaryColor\n    ? getTextColor(hexToRgb(factionSecondaryColor))\n    : \"white\";\n  const borderColor = textColor !== \"white\" ? textColor : factionColor;\n  const thStyle = {\n    backgroundColor: factionSecondaryColor || factionColor,\n    color: factionSecondaryColor ? textColorSecondary : textColor,\n  };\n  const [modelSelection, setModelSelection] = useState(0);\n  const unitPoints = useMemo(() => {\n    return data.getUnitPoints(unit, faction);\n  }, [data, unit, faction]);\n  const unitModels = useMemo(() => {\n    return data.getModels(unit, faction);\n  }, [data, unit, faction]);\n  const selectedModels =\n    modelSelection === 0 ? unitModels : [unitModels[modelSelection - 1]];\n  return (\n    <>\n      <Dialog fullWidth maxWidth=\"md\" open onClose={hideModal}>\n        <DialogTitle>\n          {unit.name} <small>{`(${unitPoints} pts)`}</small>\n        </DialogTitle>\n        <DialogContent>\n          <FormControl>\n            <RadioGroup\n              row\n              aria-label=\"gender\"\n              name=\"row-radio-buttons-group\"\n              onChange={(event) => setModelSelection(parseInt(event.target.value))}\n              value={modelSelection}\n            >\n              {[{ name: \"All\" }, ...unitModels].map((model, index) => (\n                <FormControlLabel\n                  key={index}\n                  value={index}\n                  control={<Radio />}\n                  label={model.name}\n                />\n              ))}\n            </RadioGroup>\n          </FormControl>\n          <TableContainer sx={{ borderRadius: 1, mb: 2 }}>\n            <Table size=\"small\" style={{ borderColor: borderColor }}>\n              <TableHead>\n                <StyledTableRow style={thStyle}>\n                  <TableCell>{\"Models\"}</TableCell>\n                  <TableCell className=\"text-center\">\n                    {\"Model Points\"}\n                  </TableCell>\n                  <TableCell className=\"text-center\">{\"Rule Points\"}</TableCell>\n                  <TableCell className=\"text-center\">\n                    {\"Weapon Points\"}\n                  </TableCell>\n                  <TableCell className=\"text-center\">\n                    {\"Total Points\"}\n                  </TableCell>\n                </StyledTableRow>\n              </TableHead>\n              <TableBody>\n                {selectedModels.map((model, index) => {\n                  const modelPoints = Math.round(\n                    data.getModelTotalPoints(\n                      {\n                        ...model,\n                        rules: [...(model?.rules || []), ...(unit.rules || [])],\n                      },\n                      faction\n                    )\n                  );\n                  const baseModelPoints = Math.round(\n                    data.getModelPoints(\n                      {\n                        ...model,\n                        rules: [...(model?.rules || []), ...(unit.rules || [])],\n                      },\n                      faction\n                    )\n                  );\n                  const modelWeaponPoints = Math.round(\n                    data.getModelWeaponPoints(\n                      {\n                        ...model,\n                        rules: [...(model?.rules || []), ...(unit.rules || [])],\n                      },\n                      faction\n                    )\n                  );\n                  const modelRulePoints = Math.round(\n                    data.getModelRulePoints(\n                      {\n                        ...model,\n                        rules: [...(model?.rules || []), ...(unit.rules || [])],\n                      },\n                      faction\n                    )\n                  );\n                  return (\n                    <StyledTableRow>\n                      <TableCell>{`${model.name} x${\n                        model.min || 1\n                      }`}</TableCell>\n                      <TableCell className=\"text-center\">\n                        {baseModelPoints} pts (\n                        {Math.round((baseModelPoints / modelPoints) * 100)}\n                        %)\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        {modelRulePoints} pts (\n                        {Math.round((modelRulePoints / modelPoints) * 100)}\n                        %)\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        {modelWeaponPoints} pts (\n                        {Math.round((modelWeaponPoints / modelPoints) * 100)}\n                        %)\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        {modelPoints} pts\n                      </TableCell>\n                    </StyledTableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n          </TableContainer>\n          {selectedModels.map((model, index) => {\n            const modelWeapons = get(model, \"weapons\", []);\n            const modelRules = [\n              ...get(unit, \"rules\", []),\n              ...get(model, \"rules\", []),\n            ];\n            return (\n              <>\n                {!!modelWeapons.length && (\n                  <TableContainer sx={{ borderRadius: 1, mb: 2 }}>\n                    <Table\n                      striped\n                      responsive\n                      size=\"small\"\n                      style={{ borderColor: borderColor }}\n                    >\n                      <TableHead>\n                        <StyledTableRow style={thStyle}>\n                          <TableCell>{`${model.name} Weapons`}</TableCell>\n                          <TableCell className=\"text-center\">{`Weapon Points`}</TableCell>\n                        </StyledTableRow>\n                      </TableHead>\n                      <TableBody>\n                        {modelWeapons.map((weapon) => {\n                          const weaponPointsForModel = Math.trunc(\n                            data.getWeaponCostForModel(weapon, model, faction)\n                          );\n                          const weaponName = formatWeapon(\n                            weapon,\n                            faction,\n                            data\n                          );\n                          return (\n                            <StyledTableRow>\n                              <TableCell>{weaponName}</TableCell>\n                              <TableCell className=\"text-center\">\n                                {weaponPointsForModel} pts\n                              </TableCell>\n                            </StyledTableRow>\n                          );\n                        })}\n                      </TableBody>\n                    </Table>\n                  </TableContainer>\n                )}\n                {!!modelRules.length && (\n                  <TableContainer sx={{ borderRadius: 1 }}>\n                    <Table\n                      striped\n                      responsive\n                      size=\"small\"\n                      style={{ borderColor: borderColor }}\n                    >\n                      <TableHead>\n                        <StyledTableRow style={thStyle}>\n                          <TableCell>{`${model.name} Rules`}</TableCell>\n                          <TableCell className=\"text-center\">\n                            {\"Rule Points\"}\n                          </TableCell>\n                        </StyledTableRow>\n                      </TableHead>\n                      <TableBody>\n                        {modelRules.map((rule) => {\n                          const rulePointsForModel = Math.trunc(\n                            data.getRuleCostForModel(rule, model, faction)\n                          );\n                          const ruleName = formatRule(rule, faction, data);\n                          return (\n                            <StyledTableRow>\n                              <TableCell>{ruleName}</TableCell>\n                              <TableCell className=\"text-center\">\n                                {rulePointsForModel} pts\n                              </TableCell>\n                            </StyledTableRow>\n                          );\n                        })}\n                      </TableBody>\n                    </Table>\n                  </TableContainer>\n                )}\n              </>\n            );\n          })}\n        </DialogContent>\n        <DialogActions>\n          <Button\n            color=\"primary\"\n            onClick={() => {\n              hideModal();\n            }}\n          >\n            Done\n          </Button>{\" \"}\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n","import React, { useState } from \"react\";\nimport { getTextColor, hexToRgb } from \"utils/colors\";\nimport Collapse from \"@mui/material/Collapse\";\nimport Button from \"@mui/material/Button\";\nimport './option-list.css';\n\nexport const OptionList = (props) => {\n  const { options, faction, toggler = true, twoColumn = true } = props;\n  const [showOptions, setShowOptions] = useState(false);\n  const { color: factionColor } = faction;\n  const textColor = factionColor\n    ? getTextColor(hexToRgb(factionColor))\n    : \"white\";\n  const borderColor = textColor !== \"white\" ? textColor : factionColor;\n  const btnStyle = { borderColor };\n\n  const renderOptionList = (option) => {\n    if (!option.list) {\n      return null;\n    }\n    if (option.list.length === 1) {\n      return ` ${option.list[0].text}`;\n    }\n    return (\n      <ul className=\"optionSubUl\">\n        {!!option.list &&\n          option.list.map((opt, index) => <li key={index}>{opt.text}</li>)}\n      </ul>\n    );\n  };\n\n  if (!options || !options.length) {\n    return null;\n  }\n  return (\n    <div>\n      {!!toggler && (\n        <div className=\"text-center\" style={{ marginBottom: \"0.5rem\" }}>\n          <Button\n            sx={{ color: 'inherit', textTransform: 'none' }}\n            size=\"small\"\n            fullWidth\n            variant=\"outlined\"\n            block\n            style={btnStyle}\n            onClick={() => setShowOptions(!showOptions)}\n          >\n            {showOptions ? \"Hide\" : \"Unit Options\"}\n          </Button>\n        </div>\n      )}\n      <Collapse in={!toggler || showOptions}>\n        <div>\n          <div className={twoColumn ? \"two-columns\" : \"\"}>\n            <ul className=\"optionUl\">\n              {options.map((option) => {\n                return (\n                  <div className=\"no-break\">\n                    <li>\n                      <div className=\"no-break\">\n                        {option.option || option}\n                        {renderOptionList(option)}\n                      </div>\n                    </li>\n                  </div>\n                );\n              })}\n            </ul>\n          </div>\n        </div>\n      </Collapse>\n    </div>\n  );\n};\n","import Button from \"@mui/material/Button\";\nimport Collapse from \"@mui/material/Collapse\";\nimport Table from \"@mui/material/Table\";\nimport TableBody from \"@mui/material/TableBody\";\nimport TableCell from \"@mui/material/TableCell\";\nimport TableContainer from \"@mui/material/TableContainer\";\nimport TableHead from \"@mui/material/TableHead\";\nimport { OptionList } from \"components/roster/option-list\";\nimport { StyledTableRow } from \"components/styled-table\";\nimport { isNumber } from \"lodash\";\nimport React, { useState } from \"react\";\nimport { getTextColor, hexToRgb } from \"utils/colors\";\nimport { formatModel } from \"utils/format\";\n\nexport const UnitStats = (props) => {\n  const { data, unit, faction, toggler, models, options, perks, setbacks, powerSpecialty } =\n    props;\n  const [showOptions, setShowOptions] = useState(false);\n  const { color: factionColor, secondary_color: factionSecondaryColor } =\n    faction;\n  const textColor = factionColor\n    ? getTextColor(hexToRgb(factionColor))\n    : \"white\";\n  const textColorSecondary = factionSecondaryColor\n    ? getTextColor(hexToRgb(factionSecondaryColor))\n    : \"white\";\n  const borderColor = textColor !== \"white\" ? textColor : factionColor;\n  const thStyle = {\n    backgroundColor: factionSecondaryColor || factionColor,\n    color: factionSecondaryColor ? textColorSecondary : textColor,\n  };\n  const btnStyle = { borderColor };\n  const unitModels = (models ? models : data.getModels(unit, faction)).filter(\n    (model) =>\n      !(model.shoot === \"-\" && model.fight === \"-\" && model.save === \"-\")\n  );\n  const perkString =\n    perks && perks.length\n      ? `${perks.length > 1 ? \"perks\" : \"the perk\"} (${perks\n        .map((perk) => perk.name)\n        .join(\", \")})`\n      : \"\";\n  const setbackString =\n    setbacks && setbacks.length\n      ? `${setbacks.length > 1 ? \"injuries\" : \"the injury\"} (${setbacks\n        .map((setback) => setback.name)\n        .join(\", \")})`\n      : \"\";\n  const combinedString = [perkString, setbackString]\n    .filter((str) => str.length)\n    .join(\" and \");\n  const unitPowerSpecialty = powerSpecialty;\n  const renderAdditionalModels = (unit, faction) => {\n    return (\n      <ul className=\"ul-indent\" style={{ marginBottom: 0, marginTop: 0 }}>\n        {(unit.models || [])\n          .filter((model) => model.min > 0)\n          .map((model) => formatModel(model, unit, faction, data))\n          .map((modelString) => (\n            <li>{modelString}</li>\n          ))}\n      </ul>\n    );\n  };\n  if (!unit) {\n    return null;\n  }\n  return (\n    <div>\n      {!!toggler && (\n        <div align=\"center\" style={{ padding: \"0.5rem 0px\" }}>\n          <Button\n            variant=\"outline-primary\"\n            size=\"sm\"\n            style={btnStyle}\n            block\n            onClick={() => setShowOptions(!showOptions)}\n          >\n            {showOptions ? \"Hide\" : \"Unit Stats\"}\n          </Button>\n        </div>\n      )}\n      <Collapse in={!toggler || showOptions}>\n        <div>\n          <>{renderAdditionalModels(unit, faction)}</>\n          <div>\n            {!!options && (\n              <OptionList\n                twoColumn={false}\n                faction={faction}\n                options={options}\n                toggler={false}\n              />\n            )}\n          </div>\n          {!!unitPowerSpecialty && <div style={{ marginBottom: '0.5rem' }}><ul className=\"optionUl\">{!!unitPowerSpecialty && <li>The unit has the \"{unitPowerSpecialty}\" Power specialty</li>}</ul></div>}\n          <div style={{ marginBottom: \"0.5rem\" }}>\n            <ul className=\"optionUl\">\n              {!!combinedString && <li>The unit has {combinedString}</li>}\n            </ul>\n          </div>\n          {!!unitModels.length && (\n            <>\n              <TableContainer sx={{ borderRadius: 1 }}>\n                <Table size=\"small\" aria-label=\"simple table\" style={{ padding: 0 }}>\n                  <TableHead>\n                    <StyledTableRow style={thStyle}>\n                      <TableCell>{\"Model\"}</TableCell>\n                      <TableCell align=\"center\">{\"Mov\"}</TableCell>\n                      <TableCell align=\"center\">{\"Acc\"}</TableCell>\n                      <TableCell align=\"center\">{\"Str\"}</TableCell>\n                      <TableCell align=\"center\">{\"Sav\"}</TableCell>\n                      <TableCell align=\"center\">{\"Init\"}</TableCell>\n                      <TableCell align=\"center\">{\"Co\"}</TableCell>\n                    </StyledTableRow>\n                  </TableHead>\n                  <TableBody>\n                    {unitModels.map((model) => (\n                      <StyledTableRow>\n                        <TableCell>{model.name}</TableCell>\n                        <TableCell align=\"center\">\n                          {`${isNumber(model.movement)\n                              ? `${model.movement}\"`\n                              : model.movement\n                            }`}\n                        </TableCell>\n                        <TableCell align=\"center\">\n                          {`${!!model.shoot ? `${model.shoot}` : \"-\"}`}\n                        </TableCell>\n                        <TableCell align=\"center\">\n                          {`${!!model.fight ? `${model.fight}` : \"-\"}`}\n                        </TableCell>\n                        <TableCell align=\"center\">\n                          {`${!!model.defense ? `${model.defense}` : \"-\"}`}\n                        </TableCell>\n                        <TableCell align=\"center\">\n                          {`${!!model.reflexes ? `${model.reflexes}` : \"-\"}`}\n                        </TableCell>\n                        <TableCell align=\"center\">\n                          {`${!!model.courage ? `${model.courage}` : \"-\"}`}\n                        </TableCell>\n                      </StyledTableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </TableContainer>\n            </>\n          )}\n        </div>\n      </Collapse>\n    </div>\n  );\n};\n","import {\n  faBook,\n  faBug\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport MoreVertIcon from \"@mui/icons-material/MoreVert\";\nimport {\n  Card, CardContent, CardHeader, Divider, IconButton, ListItemIcon,\n  ListItemText,\n  Menu, MenuItem, Typography\n} from \"@mui/material\";\nimport { Dropdown } from \"components/dropdown\";\nimport { DescriptionModal, UnitDebugModal } from \"components/roster/modals\";\nimport { OptionList } from \"components/roster/option-list\";\nimport { RuleList } from \"components/roster/rule-list\";\nimport { UnitStats } from \"components/roster/unit-stats\";\nimport { WeaponList } from \"components/roster/weapon-list\";\nimport { useModal } from \"hooks\";\nimport { get, uniq } from \"lodash\";\nimport React, { useMemo } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport { getTextColor, hexToRgb } from \"utils/colors\";\nimport { formatLevel } from \"utils/format\";\n\n\n\nexport const UnitCard = (props) => {\n  const {\n    unit,\n    data,\n    faction,\n    subfactionId = \"none\",\n    showOptions = true,\n    unitOptions,\n    points,\n    weapons,\n    rules,\n    weaponRules,\n    models,\n    embeddedOptions = false,\n    toggler: toggle = true,\n    focusView = true,\n    perks,\n    level,\n    setbacks,\n    showContext = false,\n    userPrefs,\n    powerSpecialty,\n    printMode\n  } = props;\n  const toggler = !printMode && toggle;\n  const { color: factionColor } = faction;\n  const textColor = factionColor\n    ? getTextColor(hexToRgb(factionColor))\n    : \"white\";\n  const borderColor = textColor !== \"white\" ? textColor : factionColor;\n  const thStyle = {\n    backgroundColor: factionColor || \"#376f8c\",\n    color: textColor,\n    borderColor,\n  };\n  const unitPoints = useMemo(() => {\n    return points ? points : data.getUnitPoints(unit, faction);\n  }, [points, data, unit, faction]);\n  const unitWeapons = weapons ? weapons : data.getWeapons(unit, faction) || [];\n  const unitRules = rules ? rules : data.getModelRules([unit], faction);\n  const weaponRuleList = weaponRules\n    ? weaponRules\n    : data.getWeaponRules([unit], faction);\n  const unitSubfactions = focusView\n    ? [\n      subfactionId !== \"none\"\n        ? `${{ ...data.getSubfaction(faction.id, subfactionId) }.name || \"No\"\n        } Focus`\n        : \"\",\n    ].filter((name) => !!name)\n    : uniq(\n      get(unit, \"subfactions\", [])\n        .map((subfactionId) => data.getSubfaction(faction.id, subfactionId))\n        .map((subfac) => `${subfac.name || \"No\"} Focus`)\n    );\n  const unitSetbacksCount = (setbacks || []).length;\n  const [showUnitDescription, hideUnitDescription] = useModal(\n    ({ extraProps }) => (\n      <DescriptionModal\n        {...props}\n        hideModal={hideUnitDescription}\n        unit={unit}\n        {...extraProps}\n      />\n    ),\n    [unit]\n  );\n  const [showUnitDebug, hideUnitDebug] = useModal(\n    ({ extraProps }) => (\n      <UnitDebugModal\n        {...props}\n        hideModal={hideUnitDebug}\n        unit={unit}\n        data={data}\n        faction={faction}\n        {...extraProps}\n      />\n    ),\n    [unit, data, faction]\n  );\n  // const handleSearch = () => {\n  //   const query = unit.searchTerms || `${faction.name} ${unit.name}`;\n  //   const url = \"http://www.google.com/search?q=\" + query + \"&tbm=isch\";\n  //   window.open(url, \"_blank\");\n  // };\n  const renderModelRules = (rules) => {\n    if (!rules.length) {\n      return;\n    }\n    return (\n      <>\n        {(!toggler) && <Divider style={thStyle} />}\n        <div className=\"unit-specialrules\">\n          <RuleList\n            twoColumn\n            toggler={toggler}\n            faction={faction}\n            rules={rules}\n          />\n        </div>\n      </>\n    );\n  };\n  const renderModelExtraRules = (perks) => {\n    if (!perks.length) {\n      return;\n    }\n    return (\n      <>\n        <Divider style={thStyle} />\n        <div className={\"two-columns\"}>\n          {perks.map((perk) => {\n            const ruleName = `${perk.name}`;\n            const stuff = `**${ruleName}**: ${perk.description}`;\n            return (\n              <div className=\"no-break\">\n                <>\n                  <ReactMarkdown\n                    children={stuff}\n                    className=\"rule-text\"\n                  />\n                </>\n              </div>\n            );\n          })}\n        </div>\n      </>\n    );\n  };\n  function renderOptions(data, unit, faction) {\n    let options = unitOptions\n      ? unitOptions\n      : data.getOptionsList(unit, faction);\n    if (!options.length) {\n      return;\n    }\n    return (\n      <div style={{ marginBottom: \"0.5em\" }}>\n        <OptionList faction={faction} options={options} />\n      </div>\n    );\n  }\n\n  const getExtraActions = () => {\n    if (showContext && (unit.background || !!userPrefs.developerMode)) {\n      return (\n        <Dropdown>\n          {({ handleClose, open, handleOpen, anchorElement }) => (\n            <>\n              <IconButton onClick={handleOpen} sx={{ color: 'inherit' }}>\n                <MoreVertIcon />\n              </IconButton>\n              <Menu\n                anchorOrigin={{\n                  vertical: \"bottom\",\n                  horizontal: \"right\",\n                }}\n                transformOrigin={{\n                  vertical: \"top\",\n                  horizontal: \"right\",\n                }}\n                anchorEl={anchorElement}\n                id=\"basic-menu\"\n                open={open}\n                onClose={handleClose}\n                MenuListProps={{\n                  dense: true,\n                  onClick: handleClose,\n                  \"aria-labelledby\": \"basic-button\",\n                }}\n              >\n                {!!unit.background && (\n                  <MenuItem onClick={showUnitDescription}>\n                    <ListItemIcon>\n                      <FontAwesomeIcon icon={faBook} />\n                    </ListItemIcon>\n                    <ListItemText>Read More</ListItemText>\n                  </MenuItem>\n                )}\n                {!!userPrefs.developerMode && (\n                  <MenuItem onClick={showUnitDebug}>\n                    <ListItemIcon>\n                      <FontAwesomeIcon icon={faBug} />\n                    </ListItemIcon>\n                    <ListItemText>Debug Unit</ListItemText>\n                  </MenuItem>\n                )}\n                {/* <Dropdown.Item onClick={handleSearch}><FontAwesomeIcon icon={faSearch} /> Find Models</Dropdown.Item> */}\n              </Menu>\n            </>\n          )}\n        </Dropdown>\n      );\n    } else {\n      return <></>;\n    }\n  };\n  return (\n    <Card\n      className=\"force-print no-page-break\"\n      sx={{\n        border: `2px solid ${factionColor}`,\n      }}\n    >\n      <CardHeader\n        sx={{ backgroundColor: factionColor, color: textColor, py: 1.5 }}\n        title={\n          <>\n            <Typography variant=\"h5\">\n              <span style={{ marginRight: \"5px\" }}>{unit.customName || unit.name}</span>\n              <small style={{ fontSize: '1rem' }}>{`(${unitPoints}pts)`}</small>\n              <span\n                style={{ marginLeft: \"5px\" }}\n                className=\"badge badge-success\"\n              >\n                {level ? `${formatLevel(level)}` : \"\"}\n              </span>\n              <span\n                style={{ marginLeft: \"5px\" }}\n                className=\"badge badge-danger\"\n              >\n                {unitSetbacksCount > 0\n                  ? `${unitSetbacksCount} ${unitSetbacksCount > 1 ? \"Injuries\" : \"Injury\"\n                  }`\n                  : \"\"}\n              </span>\n            </Typography>\n          </>\n        }\n        action={getExtraActions()}\n      />\n      <CardContent>\n        {(!!unit.description && !printMode) && (\n          <>\n            <Typography\n              className=\"unit-description\"\n              style={{ marginBottom: \"0.5em\" }}\n            >\n              <i>{unit.description}</i>\n            </Typography>\n            <Divider style={thStyle} />\n          </>\n        )}\n        <div style={{ marginBottom: \"0.5em\" }} className=\"unit-stats\">\n          <UnitStats\n            powerSpecialty={powerSpecialty}\n            models={models}\n            unit={unit}\n            faction={faction}\n            data={data}\n            perks={perks}\n            setbacks={setbacks}\n            options={embeddedOptions ? unitOptions : undefined}\n          />\n        </div>\n        {!!showOptions && renderOptions(data, unit, faction)}\n        {!!unitWeapons.length && !printMode && (\n          <div style={{ marginBottom: \"0.5em\" }} className=\"unit-weapons\">\n            <WeaponList\n              toggler={toggler}\n              weapons={unitWeapons}\n              faction={faction}\n              data={data}\n              rules={weaponRuleList}\n            />\n          </div>\n        )}\n        {!printMode && <>{renderModelRules(unitRules)}</>}\n        {renderModelExtraRules([...(perks || []), ...(setbacks || [])])}\n        <Divider style={thStyle} />\n        <span className=\"unit-keywords\">\n          <b>Keywords: </b>\n          {[\n            faction.name,\n            ...unitSubfactions,\n            ...(unit.keywords || [\"Infantry\"]),\n          ].join(\", \")}\n        </span>\n      </CardContent>\n    </Card>\n  );\n};\n","import { Box, Pagination, Typography } from '@mui/material';\nimport { UnitCard } from 'components/roster/unit-card';\nimport { findIndex, get, groupBy, intersection, omit, sortBy } from 'lodash';\nimport React, { useEffect, useState } from 'react';\nimport './roster.css';\n\nexport const Units = React.memo((props) => {\n  const { data, faction, nameFilter, unitFilter, filterByFocus=true, subfactionId=\"none\", userPrefs } = props;\n  const [pinnedUnits, setPinnedUnits] = useState({});\n  const [currentPage, setCurrentPage] = useState(0);\n  const PAGE_SIZE = 20;\n  const categories = { pinned_units: {name: \"Pinned Units\"}, ...data.getRawCategories()};\n  const unitsUn = data.getUnits(faction);\n  const unitsFiltered = unitsUn.filter(unit => nameFilter ? get(unit, 'name', '').toLowerCase().includes(nameFilter.toLowerCase()) : true)\n  .filter((unit) => {\n    return unitFilter.keywords && unitFilter.keywords.size ? intersection(Array.from(unitFilter.keywords), (unit.keywords || [])).length === unitFilter.keywords.size : true;\n  })\n  .filter((unit) => {\n    return unitFilter.categories && unitFilter.categories.size ? unitFilter.categories.has(unit.category) : true;\n  });\n  const numPages = Math.ceil(unitsFiltered.length / PAGE_SIZE);\n  const sortOrder = ['pinned_units', ...Object.keys(categories)];\n  const unitsSorted = sortBy(unitsFiltered, (unit) => data.getUnitPoints(unit, faction));\n  const units = unitsSorted.sort((first, second) => {\n    const firstIndex = findIndex(sortOrder, (o) => o === first.category);\n    const secondIndex = findIndex(sortOrder, (o) => o === second.category);\n    return firstIndex - secondIndex;\n  }).slice(currentPage * PAGE_SIZE, (currentPage * PAGE_SIZE) + PAGE_SIZE);\n  useEffect(() => {\n    setCurrentPage(0);\n  }, [unitsFiltered.length]);\n  const unitCategories = { pinned_units: [], ...groupBy(units, \"category\")};\n  const categoryOrder = ['pinned_units', ...Object.keys(categories), undefined].filter((cat) => unitCategories[cat] && unitCategories[cat].filter((unit) => !pinnedUnits[unit.id]).length);\n  const handlePinUnit = (unit) => {\n    const unitId = unit.id;\n    if (pinnedUnits[unitId]) {\n      setPinnedUnits({\n        ...omit(pinnedUnits, unitId),\n      });\n    } else {\n      setPinnedUnits({\n        ...pinnedUnits,\n        [unitId]: unit\n      });\n    }\n  }\n  const scrollWithOffset = () => {\n    const yCoordinate = 0;\n    const yOffset = 0; \n    window.scrollTo({ top: yCoordinate + yOffset });\n  }\n  const changePage = (event, number) => {\n    scrollWithOffset();\n    setCurrentPage(number - 1);\n  }\n  return (\n    <div>\n      {!units.length && <p>{'No units found...'}</p>}\n      {categoryOrder.map((category, catIndex) => {\n        const categoryUnits = get(unitCategories, `[${category}]`, []).filter((unit) => !pinnedUnits[unit.id]);\n        const categoryData = data.getCategory(category);\n        return (\n          <div key={catIndex}>\n            <Typography sx={{ my: 2 }} variant=\"h4\" component=\"div\" align=\"center\">\n              {categoryData.name || \"No Category\"}\n            </Typography>\n            {categoryUnits.map((unit, index) => {\n              return (\n                <div\n                  key={index}\n                >\n                  <Box\n                    className=\"unit-card-wrapper\"\n                    sx={{ mb: 2 }}\n                  >\n                    <UnitCard\n                      showContext\n                      faction={faction}\n                      subfactionId={subfactionId}\n                      focusView={filterByFocus}\n                      data={data}\n                      userPrefs={userPrefs}\n                      unit={unit}\n                      onPinUnit={handlePinUnit}\n                      pinned={!!pinnedUnits[unit.id]}\n                    />\n                  </Box>\n                </div>\n              );\n            })}\n          </div>\n        );\n      })}\n      {numPages > 1 && <Box sx={{ mx: 'auto', display: 'flex', textAlign: 'center', alignItems: 'center', justifyContent: 'center' }}>\n        <Pagination count={numPages} page={currentPage + 1} onChange={changePage} />\n      </Box>}\n    </div>\n  );\n});","import { Card, CardContent, CardHeader, Typography } from \"@mui/material\";\nimport { WeaponList } from \"components/roster/weapon-list\";\nimport { sortBy } from \"lodash\";\nimport React from \"react\";\nimport { getTextColor, hexToRgb } from \"utils/colors\";\n\nexport const Weapons = React.memo((props) => {\n  const { data, faction, nameFilter } = props;\n  const { color: factionColor } = faction;\n  const textColor = factionColor\n    ? getTextColor(hexToRgb(factionColor))\n    : \"white\";\n  const weapons = data\n    .getAllWeapons(faction)\n    .filter((strategy) =>\n      nameFilter\n        ? (strategy.name || \"\").toLowerCase().includes(nameFilter.toLowerCase())\n        : true\n    );\n  const weaponsSorted = sortBy(weapons, \"name\");\n  return (\n    <div>\n      <Typography sx={{ my: 2 }} variant=\"h4\" component=\"div\" align=\"center\">\n        Weapons\n      </Typography>\n      {!weapons.length && <p>{\"No weapons found...\"}</p>}\n      {!!weapons.length && (\n        <div className=\"two-columns\">\n          {weaponsSorted.map((rule, index) => (\n            <div style={{ breakInside: \"avoid-column\" }} key={index}>\n              <Card\n                className=\"no-break\"\n                sx={{\n                  border: `2px solid ${factionColor}`,\n                  mb: 2,\n                }}\n              >\n                <CardHeader\n                  sx={{\n                    backgroundColor: factionColor,\n                    color: textColor,\n                    py: 1,\n                  }}\n                  title={\n                    <Typography variant=\"h6\" component=\"div\">\n                      {rule.name}\n                    </Typography>\n                  }\n                />\n                <CardContent>\n                  {!!rule.description && (\n                    <>\n                      <i>{rule.description}</i>\n                      <hr />\n                    </>\n                  )}\n                  <WeaponList\n                    twoColumns={false}\n                    faction={faction}\n                    data={data}\n                    weapons={[rule]}\n                    rules={data.getAllWeaponRules([rule], faction)}\n                  />\n                </CardContent>\n              </Card>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n});\n","import {\n  faExclamationCircle\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport BugReportIcon from '@mui/icons-material/BugReport';\nimport RefreshIcon from '@mui/icons-material/Refresh';\nimport UploadIcon from '@mui/icons-material/Upload';\nimport { Box, Typography } from \"@mui/material\";\nimport Container from \"@mui/material/Container\";\nimport Popover from \"@mui/material/Popover\";\nimport { useTheme } from \"@mui/material/styles\";\nimport Tab from \"@mui/material/Tab\";\nimport Tabs from \"@mui/material/Tabs\";\nimport useMediaQuery from \"@mui/material/useMediaQuery\";\nimport CustomCircularProgress from \"components/CustomCircularProgress\";\nimport { Dropdown } from \"components/dropdown\";\nimport { DataContext, PointsCacheContext } from \"hooks\";\nimport {\n  get, isNil, set\n} from \"lodash\";\nimport { useSnackbar } from \"notistack\";\nimport React, {\n  useContext, useEffect, useState\n} from \"react\";\nimport Tour from \"reactour\";\nimport { DataAPI, mergeGlobalData } from \"utils/data\";\nimport { readFileContent } from \"utils/files\";\nimport { Focus } from \"./focus\";\nimport { Organization } from \"./organization\";\nimport { Overview } from \"./overview\";\nimport { Powers } from \"./powers\";\nimport { Relics } from \"./relics\";\nimport { Rules } from \"./rules\";\nimport { Strategies } from \"./strategies\";\nimport { Units } from \"./units\";\nimport { Weapons } from \"./weapons\";\n\nconst allSteps = [];\nconst steps = [\n  [\n    {\n      selector: \"#tab-0\",\n      content:\n        \"This is the module overview. This gives you background information and an overview of the game module.\",\n      stepInteraction: false,\n    },\n  ],\n  [\n    {\n      selector: \"#tab-1\",\n      content:\n        \"This is the forces list. It contains information about how to organize your units and what limits exist.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".org-card:first-of-type\",\n      content:\n        \"This is a force. It describes the minimum and maximum of each unit type allowed in it. It may also cost strategy points per round as described with the (number) after the name.\",\n      stepInteraction: false,\n    },\n  ],\n  [\n    {\n      selector: \"#tab-2\",\n      content:\n        \"This is the units list. Units are grouped into categories which have limits to how many are allowed to be taken depending on the force type selected.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \"#unit-filter\",\n      content:\n        \"Pressing this button will open the unit filter allowing you to filter units based on various properties.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".unit-card-wrapper:first-of-type\",\n      content:\n        \"This is a unit. It has several pieces to it which will be described later.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".unit-name:first-of-type\",\n      content:\n        \"This is the unit's name and points cost to include in your force.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".unit-description:first-of-type\",\n      content:\n        \"This is the unit's description. This can describe what a unit is used for or any background flavor on the unit.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".unit-stats:first-of-type\",\n      content:\n        \"This is the unit's stats. This contains a list of any models that start in the unit and their equipment and special rules.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".unit-options:first-of-type\",\n      content:\n        \"This is the unit's options. Clicking this button will show any options the unit has such as adding new rules or exchanging weapons.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".unit-weapons:first-of-type\",\n      content:\n        \"This is the unit's weapons. Clicking this button will show the list of weapons a unit could potentially have and all related stats and special rules on those weapons.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".unit-specialrules:first-of-type\",\n      content:\n        \"This is the unit's special rules. Clicking this button will show all special rules text for any rules that could be on the models in this unit.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".unit-keywords:first-of-type\",\n      content:\n        \"This is the unit's keywords. These are typically used to categorize units for being affected by certain special rules or abilities.\",\n      stepInteraction: false,\n    },\n  ],\n  [\n    {\n      selector: \"#tab-3\",\n      content:\n        \"This is the powers list. It contains information about the powers available to this faction.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".power-card:first-of-type\",\n      content:\n        \"This is a power. Powers are unique abilities that can be used by certain units in the game.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".power-name:first-of-type\",\n      content:\n        \"This is the power's name. It also contains the charge level of the power required to use it.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".power-flavor:first-of-type\",\n      content:\n        \"This is the power's flavor text. It also contains a brief amount of flavor about the power.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".power-description:first-of-type\",\n      content:\n        \"This is the power's description text. It contains information about when the power can be used and any effects when used.\",\n      stepInteraction: false,\n    },\n  ],\n  [\n    {\n      selector: \"#tab-4\",\n      content:\n        \"This is the strategies list. It contains information about the strategies available to this faction. They are grouped into the phase they can be used in.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".strategy-card:first-of-type\",\n      content:\n        \"This is a strategy. Strategies are unique abilities that can be activated throughout the game.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".strategy-name:first-of-type\",\n      content:\n        \"This is the strategy's name. It also contains the cost in strategy points required to use it.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".strategy-flavor:first-of-type\",\n      content:\n        \"This is the strategy's flavor text. It also contains a brief amount of flavor about the strategy.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".strategy-description:first-of-type\",\n      content:\n        \"This is the strategy's description text. It contains information about when the strategy can be used and any effects when used.\",\n      stepInteraction: false,\n    },\n  ],\n  [\n    {\n      selector: \"#tab-5\",\n      content:\n        \"This is the legends list. It contains information about the legends available to this faction. They are grouped into their type.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".legend-card:first-of-type\",\n      content:\n        \"This is a legend. Legends are unique and legendary items or individuals which can be taken in limited quantities.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".legend-name:first-of-type\",\n      content:\n        \"This is the legend's name. It also contains the point cost required to take it.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".legend-flavor:first-of-type\",\n      content:\n        \"This is the legend's flavor text. It also contains a brief amount of flavor about the legend.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".legend-description:first-of-type\",\n      content:\n        \"This is the legend's description text. It contains information about when the strategy can be used and any effects when used.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".legend-rules-text:first-of-type\",\n      content:\n        \"This is the legend's rule text. It contains any rules or weapon profiles related to the legend.\",\n      stepInteraction: false,\n    },\n  ],\n  [\n    {\n      selector: \"#tab-6\",\n      content:\n        \"This is the focus list. It contains information about the focuses available to this faction.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".focus-card:first-of-type\",\n      content:\n        \"This is a focus. Focuses are sub-factions of a particular faction and allow you to focus on a particular style of play.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".focus-select:first-of-type\",\n      content:\n        \"Clicking this button will switch the faction display to this focus.\",\n      stepInteraction: false,\n    },\n  ],\n  [\n    {\n      selector: \"#tab-7\",\n      content:\n        \"This is the weapon list. It contains information about the weapons available to this faction.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".weapon-card:first-of-type\",\n      content:\n        \"This is a weapon. Weapons have several stats such as range and attacks described further in the core rules.\",\n      stepInteraction: false,\n    },\n  ],\n  [\n    {\n      selector: \"#tab-8\",\n      content:\n        \"This is the rule list. It contains information about the rules relevant to this faction.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".rule-card:first-of-type\",\n      content:\n        \"This is a rule. It has rule text which describes when it is active.\",\n      stepInteraction: false,\n    },\n  ],\n];\n\nexport default React.memo((props) => {\n  const { factionName, gameName } = props.match.params;\n  const [\n    {\n      data: someData,\n      coreData,\n      fetchFaction,\n      setData,\n      isLoading,\n      refreshFaction,\n      appState,\n      setAppState,\n      userPrefs\n    },\n  ] = useContext(DataContext);\n  const theme = useTheme();\n  const isMobile = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  const nameFilter = appState?.searchText;\n  const [isTourOpen, setIsTourOpen] = useState(false);\n  const [activeTab, setActiveTab] = useState(get(appState, \"rosterTab\", 2));\n  const [filterByFocus, ] = useState(true);\n  const [subfaction, setSubfaction] = useState(\"none\");\n  const [retryCount, setRetryCount] = useState(0);\n  const cache = useContext(PointsCacheContext);\n  const game = get(someData, `gameData.games[${gameName}]`, {});\n  const globalData = mergeGlobalData(game, someData);\n  const data = DataAPI(game, cache, globalData);\n  const faction = filterByFocus\n    ? data.getFactionWithSubfaction(factionName, subfaction)\n    : data.getFaction(factionName);\n  const buyLinks = get(faction, \"buyLinks\", []);\n  const rawFaction = data.getRawFaction(factionName);\n  const DEFAULT_FILTER = {\n    keywords: new Set(),\n    categories: new Set(),\n  };\n  const [unitFilter, ] = useState(DEFAULT_FILTER);\n  const powers =\n    !isNil(rawFaction.powers) && Object.keys(rawFaction.powers).length;\n  const subfactionData = data.getSubfaction(factionName, subfaction);\n  const { enqueueSnackbar } = useSnackbar();\n  const fileDialog = React.useRef();\n  const subfactions = Object.values(faction.subfactions || []);\n  useEffect(() => {\n    if (\n      !get(\n        someData,\n        `gameData.games[${gameName}].factions[${factionName}].units`\n      ) &&\n      !isLoading &&\n      retryCount < 5\n    ) {\n      setRetryCount(retryCount + 1);\n      fetchFaction(gameName, factionName);\n    }\n  }, [coreData, factionName, fetchFaction, gameName, isLoading, retryCount, someData]);\n  const handleClick = () => {\n    fileDialog.current.click();\n  };\n  const setCustomData = (passedData) => {\n    const newGameData = {\n      ...coreData,\n      customData: {\n        ...get(someData, \"customData\", {}),\n        ...passedData,\n      },\n    };\n    setData(newGameData);\n  };\n  const refreshFactionData = () => {\n    refreshFaction(gameName, factionName)\n      .then(() => {\n        enqueueSnackbar(`Faction data successfully updated.`, {\n          appearance: \"success\",\n        });\n      })\n      .catch((error) => {\n        enqueueSnackbar(`Faction failed to fetch factions. ${error.message}`, {\n          appearance: \"error\",\n        });\n      });\n  };\n  const uploadFaction = (event) => {\n    event.preventDefault();\n    const file = get(event, \"target.files[0]\");\n    if (file) {\n      readFileContent(file)\n        .then((content) => {\n          let armyObject = {};\n          try {\n            armyObject = JSON.parse(content);\n          } catch (e) {\n            return Promise.reject(e);\n          }\n          if (armyObject.games) {\n            const newArmyData = {\n              ...armyObject,\n            };\n            setCustomData(newArmyData);\n            enqueueSnackbar(`Core data successfully imported.`, {\n              appearance: \"success\",\n            });\n          } else if (armyObject.factions) {\n            const newData = set(\n              { ...get(someData, \"customData\", {}) },\n              `games[${gameName}]`,\n              {\n                ...get(someData, `customData.games[${gameName}]`),\n                ...armyObject,\n              }\n            );\n            setCustomData(newData);\n            enqueueSnackbar(`Core data successfully imported.`, {\n              appearance: \"success\",\n            });\n          } else {\n            // const hasArmy = nope.factions[armyObject.id];\n            const factionId = faction.id;\n            const newData = set(\n              { ...get(someData, \"customData\", {}) },\n              `games[${gameName}].factions[${factionId}]`,\n              {\n                ...get(\n                  someData,\n                  `customData.games[${gameName}].factions[${factionId}]`,\n                  {}\n                ),\n                ...armyObject,\n                id: faction.id,\n                color: faction.color,\n              }\n            );\n            setCustomData(newData);\n            enqueueSnackbar(`${armyObject.name} successfully imported.`, {\n              appearance: \"success\",\n            });\n          }\n        })\n        .catch((error) => {\n          enqueueSnackbar(`Faction failed to import. ${error.message}`, {\n            appearance: \"error\",\n          });\n        });\n    }\n    fileDialog.current.value = null;\n  };\n  const toggle = (tab) => {\n    if (activeTab !== tab) setActiveTab(tab);\n    setAppState({ ...appState, rosterTab: tab });\n  };\n  const handleChange = (event, newValue) => {\n    toggle(newValue);\n  };\n  function a11yProps(index) {\n    return {\n      id: `simple-tab-${index}`,\n      \"aria-controls\": `simple-tabpanel-${index}`,\n    };\n  }\n  React.useEffect(() => {\n    setAppState({\n      enableSearch: true,\n      contextActions: [\n        {\n          name: 'Refresh',\n          icon: <RefreshIcon />,\n          onClick: () => refreshFactionData()\n        },\n        ...(!!userPrefs.developerMode ? [\n          {\n            name: 'Import',\n            icon: <UploadIcon />,\n            onClick: () => handleClick()\n          }\n        ] : []),\n        ...(!!game.reportUrl ? [\n          {\n            name: 'Report',\n            icon: <BugReportIcon />,\n            onClick: () => window.open(game.reportUrl, \"_blank\")\n          }\n        ] : [])\n      ]\n    })\n    return () => {\n      setAppState({\n        contextActions: []\n      })\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [ userPrefs.developerMode ]);\n  //const [dialOpen, setDialOpen] = React.useState(false);\n  if (\n    !someData ||\n    !faction ||\n    !faction.name ||\n    !get(someData, `gameData.games[${gameName}].factions[${factionName}].units`)\n  ) {\n    return (\n      <Box sx={{ textAlign: \"center\" }}>\n        <CustomCircularProgress />\n        <input\n          id=\"file-input\"\n          type=\"file\"\n          name=\"name\"\n          multiple\n          ref={fileDialog}\n          onChange={uploadFaction}\n          style={{ height: \"0\", overflow: \"hidden\", display: \"none\" }}\n        />\n      </Box>\n    );\n  }\n  let TABS = {\n    Overview: (\n      <Overview data={data} faction={faction} subfaction={subfactionData} />\n    ),\n    Forces: (\n      <Organization\n        data={data}\n        faction={faction}\n        subfaction={subfactionData}\n        nameFilter={nameFilter}\n      />\n    ),\n    Units: (\n      <Units\n        data={data}\n        faction={faction}\n        subfactionId={subfaction}\n        setData={setData}\n        rawData={someData}\n        userPrefs={userPrefs}\n        nameFilter={nameFilter}\n        unitFilter={unitFilter}\n        filterByFocus={filterByFocus}\n      />\n    ),\n    Powers: <Powers data={data} faction={faction} nameFilter={nameFilter} />,\n    Strategies: (\n      <Strategies data={data} faction={faction} nameFilter={nameFilter} />\n    ),\n    Legends: <Relics data={data} faction={faction} nameFilter={nameFilter} />,\n    Focus: (\n      <Focus\n        data={data}\n        faction={faction}\n        nameFilter={nameFilter}\n        subfactions={subfactions}\n        setSubfaction={setSubfaction}\n        subfaction={subfaction}\n      />\n    ),\n    Weapons: <Weapons data={data} faction={faction} nameFilter={nameFilter} />,\n    Rules: <Rules data={data} faction={faction} nameFilter={nameFilter} />,\n  };\n  const isModified = Object.values(\n    get(someData, `customData.games[${gameName}].factions[${factionName}]`, {})\n  ).length;\n  const hiddenTabs = new Set([]);\n  if (!powers) {\n    hiddenTabs.add(\"Powers\");\n  }\n  if (!subfactions.length) {\n    hiddenTabs.add(\"Focus\");\n  }\n  if (!buyLinks.length) {\n    hiddenTabs.add(\"Buy\");\n  }\n  return (\n    <Container>\n      <Typography variant=\"h3\" align=\"center\" sx={{ mb: 2 }}>\n        {!!isModified && (\n          <Dropdown>\n            {({ handleClose, open, handleOpen, anchorElement }) => (\n              <>\n                <span\n                  aria-haspopup=\"true\"\n                  onMouseEnter={handleOpen}\n                  onMouseLeave={handleClose} style={{ marginRight: '5px' }}>\n                  <FontAwesomeIcon\n                    size=\"sm\"\n                    icon={faExclamationCircle}\n                  />\n                </span>\n                <Popover\n                  variant=\"warning\"\n                  id=\"mouse-over-popover\"\n                  sx={{\n                    pointerEvents: 'none',\n                  }}\n                  open={open}\n                  anchorEl={anchorElement}\n                  anchorOrigin={{\n                    vertical: 'top',\n                    horizontal: 'center',\n                  }}\n                  transformOrigin={{\n                    vertical: 'bottom',\n                    horizontal: 'center',\n                  }}\n                  onClose={handleClose}\n                  disableRestoreFocus\n                >\n                  <Typography sx={{ p: 1 }}>Warning: Data Is Modified Locally</Typography>\n                </Popover>\n              </>\n            )}\n          </Dropdown>\n        )}\n        {/* {!!faction.author && (\n          <Dropdown>\n            {({ handleClose, open, handleOpen, anchorElement }) => (\n              <>\n                <IconButton\n                  aria-haspopup=\"true\"\n                  onMouseEnter={handleOpen}\n                  onMouseLeave={handleClose} style={{ marginLeft: '5px' }}>\n                  <PersonIcon />\n                </IconButton>\n                <Popover\n                  variant=\"warning\"\n                  id=\"mouse-over-popover\"\n                  sx={{\n                    pointerEvents: 'none',\n                  }}\n                  open={open}\n                  anchorEl={anchorElement}\n                  anchorOrigin={{\n                    vertical: 'top',\n                    horizontal: 'center',\n                  }}\n                  transformOrigin={{\n                    vertical: 'bottom',\n                    horizontal: 'center',\n                  }}\n                  onClose={handleClose}\n                  disableRestoreFocus\n                >\n                  <Typography sx={{ p: 1 }}>{`Written by ${faction.author}`}</Typography>\n                </Popover>\n              </>\n            )}\n          </Dropdown>\n        )} */}\n        {`${faction.name}${subfactionData.name ? ` - ${subfactionData.name}` : \"\"\n          }`}\n        <small style={{ fontSize: '1rem' }}> {faction.version ? `(${faction.version})` : \"\"}</small>\n      </Typography>\n      <Box\n        className=\"sticky\"\n        sx={{\n          width: \"100%\",\n          bgcolor: \"background.paper\",\n          top: isMobile ? \"56px\" : \"64px\",\n        }}\n      >\n        <Box sx={{ width: \"100%\", bgcolor: \"background.paper\", pb: 0 }}>\n          <Box sx={{ borderBottom: 1, borderColor: \"divider\" }}>\n            <Tabs\n              variant=\"scrollable\"\n              value={activeTab}\n              onChange={handleChange}\n              aria-label=\"The Tabs\"\n            >\n              {Object.keys(TABS).map((tab, index) => (\n                <Tab\n                  style={{ display: hiddenTabs.has(tab) ? \"none\" : \"\" }}\n                  sx={{ textTransform: \"none\" }}\n                  label={tab}\n                  {...a11yProps(0)}\n                />\n              ))}\n            </Tabs>\n          </Box>\n        </Box>\n        {/* <HideOnScroll>\n          {({ show }) => (\n            <SpeedDial\n              ariaLabel=\"SpeedDial tooltip example\"\n              sx={{ position: \"fixed\", bottom: 16, right: 16 }}\n              icon={<SpeedDialIcon />}\n              onClose={(event) => {\n                if (event.type === 'click' || event.type === 'blur') {\n                  setDialOpen(false);\n                }\n              }}\n              onOpen={(event) => {\n                if (event.type === 'click') {\n                  setDialOpen(true);\n                }\n              }}\n              open={dialOpen && show}\n              hidden={!show}\n            >\n              <SpeedDialAction\n                tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n                tooltipTitle=\"Refresh\"\n                color=\"primary\"\n                onClick={refreshFactionData}\n                icon={<RefreshIcon />}\n              />\n              {userPrefs.developerMode && (\n                <SpeedDialAction\n                  tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n                  tooltipTitle=\"Import\"\n                  color=\"primary\"\n                  onClick={handleClick}\n                  icon={<UploadIcon />}\n                />\n              )}\n              {!!game.reportUrl && (\n                <SpeedDialAction\n                  tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n                  tooltipTitle=\"Issue\"\n                  onClick={() => window.open(game.reportUrl, \"_blank\")}\n                  icon={<BugReportIcon />}\n                />\n              )}\n              <SpeedDialAction\n                tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n                tooltipTitle=\"Top\"\n                color=\"primary\"\n                onClick={scrollToTop}\n                icon={<KeyboardArrowUpIcon />}\n              />\n              {!!steps[activeTab] && (\n                <SpeedDialAction\n                  tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n                  tooltipTitle=\"Help\"\n                  onClick={() => setIsTourOpen(true)}\n                  icon={<FontAwesomeIcon icon={faQuestion} />}\n                />\n              )}\n            </SpeedDial>\n          )}\n        </HideOnScroll> */}\n        {/* <Collapse in={showFilter}>\n          <div style={{ marginTop: \"0.5em\", marginBottom: 0 }}>\n            <Form.Label style={{ marginBottom: 0 }}>\n              <b>{`Focus:`}</b>\n            </Form.Label>\n            <Form inline>\n              <FormGroup controlId=\"focus-filter\">\n                <Form.Check\n                  type=\"checkbox\"\n                  label={\"Filter by currently selected focus\"}\n                  title=\"Filter by focus\"\n                  style={{ marginRight: \"5px\" }}\n                  color=\"primary\"\n                  checked={filterByFocus}\n                  onChange={(event) => setFilterByFocus(!filterByFocus)}\n                />\n              </FormGroup>\n            </Form>\n            <Form.Label style={{ marginBottom: 0 }}>\n              <b>{`Categories (OR):`}</b>\n            </Form.Label>\n            <Form inline>\n              {Object.keys(categories).map((categoryKey) => {\n                const category = categories[categoryKey];\n                return (\n                  <FormGroup controlId={`category-${category.name}`}>\n                    <Form.Check\n                      type=\"checkbox\"\n                      label={category.name}\n                      title=\"Update this faction from file.\"\n                      style={{ marginRight: \"5px\" }}\n                      color=\"primary\"\n                      checked={unitFilter.categories.has(categoryKey)}\n                      onChange={(event) =>\n                        toggleCategoryFilter(event, categoryKey)\n                      }\n                    />\n                  </FormGroup>\n                );\n              })}\n            </Form>\n            <Form.Label style={{ marginBottom: 0 }}>\n              <b>{`Keywords (AND):`}</b>\n            </Form.Label>\n            <Form inline>\n              {keywords.map((keyword) => (\n                <FormGroup check inline controlId={`keyword-${keyword}`}>\n                  <Form.Check\n                    inline\n                    type=\"checkbox\"\n                    label={keyword}\n                    title=\"Update this faction from file.\"\n                    style={{ marginRight: \"5px\" }}\n                    color=\"primary\"\n                    checked={unitFilter.keywords.has(keyword)}\n                    onChange={(event) => toggleKeywordFilter(event, keyword)}\n                  />\n                </FormGroup>\n              ))}\n            </Form>\n          </div>\n        </Collapse> */}\n      </Box>\n      <div>\n        {/* {Object.values(TABS).map((pane, index) => (\n          <div\n            id={`tab-${index}`}\n            tabId={index}\n            style={{ display: activeTab === index ? \"\" : \"none\" }}\n          >\n            {pane}\n          </div>\n        ))} */}\n        {Object.values(TABS)[activeTab]}\n      </div>\n      <Tour\n        accentColor={`rgb(57, 110, 158)`}\n        className=\"tour\"\n        key={activeTab}\n        steps={[...allSteps, ...(steps[activeTab] || [])]}\n        isOpen={isTourOpen}\n        onRequestClose={() => {\n          setIsTourOpen(false);\n        }}\n        rounded={5}\n        onAfterOpen={(target) => (document.body.style.overflowY = \"hidden\")}\n        onBeforeClose={(target) => (document.body.style.overflowY = \"auto\")}\n      />\n      <input\n        id=\"file-input\"\n        type=\"file\"\n        name=\"name\"\n        multiple\n        ref={fileDialog}\n        onChange={uploadFaction}\n        style={{ height: \"0\", overflow: \"hidden\", display: \"none\" }}\n      />\n    </Container>\n  );\n});\n","import { faExclamationCircle } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  Button, CardActionArea,\n  CardActions, CardHeader, Grid, Typography\n} from \"@mui/material\";\nimport Card from \"@mui/material/Card\";\nimport CardContent from \"@mui/material/CardContent\";\nimport CardMedia from \"@mui/material/CardMedia\";\nimport Popover from '@mui/material/Popover';\nimport { Dropdown } from 'components/dropdown';\nimport { get, groupBy, sortBy } from 'lodash';\nimport React from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { getTextColor, hexToRgb } from 'utils/colors';\nimport { DataAPI } from 'utils/data';\nimport './factions.css';\n\nexport const Factions = (props) => {\n  const { game, gameName, nameFilter, deleteFaction, rawData, userPrefs } = props;\n\n  const history = useHistory();\n  const data = DataAPI(game);\n  const alliances = data.getRawAlliances();\n  const showBeta = userPrefs.showBeta;\n  const factions = sortBy(data.getFactions(gameName).filter(unit => nameFilter ? unit.name.toLowerCase().includes(nameFilter.toLowerCase()) : true), 'name').filter((game) => showBeta ? true : game.version && Number(game.version) >= 1);\n  const unitCategories = groupBy(factions, \"alliance\");\n  const categoryOrder = [...Object.keys(alliances), undefined].filter((cat) => unitCategories[cat] && unitCategories[cat].length);\n  const goToFaction = (faction) => history.push(`/games/${gameName}/${faction.id}`);\n  if (!data) {\n    return <p>{\"Ohai\"}</p>\n  }\n  return (\n    <>\n      {categoryOrder.map((allianceKey) => {\n        const factions = get(unitCategories, `[${allianceKey}]`, []);\n        const allianceData = data.getAlliance(allianceKey);\n        return (\n          <>\n            <Typography variant=\"h4\" gutterBottom align=\"center\" sx={{ my: 2 }}>\n              {allianceData.name || \"Unaligned\"}\n            </Typography>\n            <Grid\n              container\n              spacing={{ xs: 2, md: 3 }}\n              columns={{ xs: 4, sm: 8, md: 12 }}\n            >\n              {factions.map((faction, index) => {\n                const factionColor = faction.color;\n                const textColor = factionColor\n                  ? getTextColor(hexToRgb(factionColor))\n                  : \"white\";\n                const isModified = Object.values(\n                  get(\n                    rawData,\n                    `customData.games[${gameName}].factions[${faction.id}]`,\n                    {}\n                  )\n                ).length;\n                return (\n                  <Grid item sx={{ pb: 2 }} md={4} key={index}>\n                    <Card\n                      sx={{\n                        border: `2px solid ${factionColor}`,\n                      }}\n                    >\n                      <CardActionArea onClick={() => goToFaction(faction)}>\n                        <CardHeader\n                          sx={{ backgroundColor: factionColor, color: textColor, p: 1.5 }}\n                          title={\n                            <Typography\n                              variant=\"h5\"\n                              component=\"div\"\n                              align=\"center\"\n                            >\n                              {!!isModified && (\n                                <Dropdown>\n                                  {({ handleClose, open, handleOpen, anchorElement }) => (\n                                    <>\n                                      <span\n                                        aria-haspopup=\"true\"\n                                        onMouseEnter={handleOpen}\n                                        onMouseLeave={handleClose} style={{ marginRight: '5px' }}>\n                                        <FontAwesomeIcon\n                                          icon={faExclamationCircle}\n                                        />\n                                      </span>\n                                      <Popover\n                                        variant=\"warning\"\n                                        id=\"mouse-over-popover\"\n                                        sx={{\n                                          pointerEvents: 'none',\n                                        }}\n                                        open={open}\n                                        anchorEl={anchorElement}\n                                        anchorOrigin={{\n                                          vertical: 'top',\n                                          horizontal: 'center',\n                                        }}\n                                        transformOrigin={{\n                                          vertical: 'bottom',\n                                          horizontal: 'center',\n                                        }}\n                                        onClose={handleClose}\n                                        disableRestoreFocus\n                                      >\n                                        <Typography sx={{ p: 1 }}>Warning: Data Is Modified Locally</Typography>\n                                      </Popover>\n                                    </>\n                                  )}\n                                </Dropdown>\n                              )}\n                              {faction.name}\n                              <small style={{ marginLeft: '5px', fontSize: '1rem'}}>\n                                {game.version ? `(${game.version})` : \"\"}\n                              </small>\n                            </Typography>\n                          }\n                        />\n                        {!!faction.image && (\n                          <CardMedia\n                            component=\"img\"\n                            height=\"250\"\n                            image={game.image}\n                            alt=\"green iguana\"\n                          />\n                        )}\n                        <CardContent>\n                          <Typography>\n                            {faction.description || \" \"}\n                          </Typography>\n                        </CardContent>\n                      </CardActionArea>\n                      {!faction.url && (\n                        <CardActions>\n                          <Button\n                            size=\"small\"\n                            color=\"primary\"\n                            onClick={(event) => {\n                              event.stopPropagation();\n                              deleteFaction(game.id);\n                            }}\n                          >\n                            Delete\n                          </Button>\n                        </CardActions>\n                      )}\n                    </Card>\n                  </Grid>\n                );\n              })}\n            </Grid>\n          </>\n        );\n      })}\n    </>\n  );\n}","import { Sync } from \"@mui/icons-material\";\nimport {\n  Button, CardHeader, Checkbox, Divider, FormControlLabel, FormGroup, Grid, Typography\n} from \"@mui/material\";\nimport Card from \"@mui/material/Card\";\nimport CardContent from \"@mui/material/CardContent\";\nimport CardMedia from \"@mui/material/CardMedia\";\nimport React, { useState } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport { getRandomItem, getRandomItems } from \"utils/math\";\n\nexport function MissionGenerator(props) {\n  const { nameFilter, data } = props;\n  const missions = data\n    .getMissionScenarios()\n    .filter((mission) =>\n      nameFilter\n        ? mission.name.toLowerCase().includes(nameFilter.toLowerCase())\n        : true\n    );\n  const weathers = data.getMissionWeather();\n  const secondaries = data.getMissionSecondaries();\n  const [randomMission, setRandomMission] = useState(getRandomItem(missions));\n  const [randomWeather, setRandomWeather] = useState(getRandomItem(weathers));\n  const [randomSecondary, setRandomSecondary] = useState(\n    getRandomItems(secondaries, 3)\n  );\n  const [enableWeather, setEnableWeather] = useState(false);\n  const generateNewMission = () => {\n    setRandomMission(getRandomItem(missions));\n    setRandomWeather(getRandomItem(weathers));\n    setRandomSecondary(getRandomItems(secondaries, 3));\n  };\n  return (\n    <>\n      <Typography sx={{ my: 2 }} variant=\"h4\" align=\"center\">\n        Scenarios\n      </Typography>\n      <Card\n        sx={{\n          border: `2px solid rgb(57, 110, 158)`,\n          mb: 2,\n        }}\n      >\n        <CardHeader\n          sx={{ backgroundColor: \"rgb(57, 110, 158)\", color: \"white\", p: 1 }}\n          title={\n            <Typography variant=\"h5\" component=\"div\" align=\"center\">\n              Options\n            </Typography>\n          }\n        />\n        <CardContent>\n          <FormGroup>\n            <FormControlLabel\n              control={\n                <Checkbox\n                  checked={enableWeather}\n                  onChange={() => setEnableWeather(!enableWeather)}\n                />\n              }\n              label=\"Twist\"\n            />\n          </FormGroup>\n          {/* <FormGroup check inline>\n          <Label style={{ display: 'inline' }}>\n            <Input type=\"checkbox\" title=\"\" style={{ marginLeft: '5px' }} color=\"primary\" checked={enableCondition} onChange={() => setEnableCondition(!enableCondition)} />\n            {'Fighting Condition'}\n          </Label>\n        </FormGroup> */}\n          <Button\n            variant=\"contained\"\n            onClick={generateNewMission}\n            startIcon={<Sync />}\n          >\n            New Scenario\n          </Button>\n        </CardContent>\n      </Card>\n      {!randomMission && (\n        <>\n          <div\n            className=\"rule-card unit-card\"\n            style={{ marginBottom: \"15px\", borderColor: \"rgb(57, 110, 158)\" }}\n          >\n            <div\n              className=\"unit-card-title\"\n              style={{ backgroundColor: \"rgb(57, 110, 158)\", color: \"white\" }}\n            >\n              <h5>None Found</h5>\n            </div>\n            <div className=\"unit-card-body\">\n              No missions found. Try rengerating...\n            </div>\n          </div>\n        </>\n      )}\n      {!!randomMission && (\n        <>\n          <Grid\n            container\n            spacing={{ xs: 2, md: 3 }}\n            columns={{ xs: 4, sm: 8, md: 12 }}\n          >\n            <Grid item sx={{ mb: 2 }} md={6}>\n              <Card\n                sx={{\n                  border: `2px solid rgb(57, 110, 158)`,\n                }}\n              >\n                <CardHeader\n                  sx={{\n                    backgroundColor: \"rgb(57, 110, 158)\",\n                    color: \"white\",\n                    p: 1,\n                  }}\n                  title={\n                    <Typography variant=\"h5\" component=\"div\" align=\"center\">\n                      {randomMission.name}\n                    </Typography>\n                  }\n                />\n                <CardMedia\n                  component=\"img\"\n                  image={randomMission.map}\n                  alt={randomMission.name}\n                />\n                <CardContent>\n                  <Typography variant=\"body\" color=\"text.primary\">\n                    <ReactMarkdown\n                      className=\"rule-text\"\n                      style={{ breakInside: \"avoid-column\" }}\n                      children={randomMission.victory_conditions}\n                    />\n                  </Typography>\n                </CardContent>\n              </Card>\n            </Grid>\n            <Grid item sx={{ mb: 2 }} md={6}>\n              <Card\n                sx={{\n                  border: `2px solid rgb(57, 110, 158)`,\n                }}\n              >\n                <CardHeader\n                  sx={{\n                    backgroundColor: \"rgb(57, 110, 158)\",\n                    color: \"white\",\n                    p: 1,\n                  }}\n                  title={\n                    <Typography variant=\"h5\" component=\"div\" align=\"center\">\n                      Secondary Objectives\n                    </Typography>\n                  }\n                />\n                <CardContent>\n                  {randomSecondary.map((secondary) => (\n                    <div className=\"width-100\">\n                      <Typography variant=\"h5\" component=\"div\" gutterBottom>\n                        {secondary.name}\n                      </Typography>\n                      <div style={{ marginBottom: \"0.5em\" }}>\n                        <ReactMarkdown\n                          className=\"rule-text font-italic\"\n                          style={{ breakInside: \"avoid-column\" }}\n                          children={secondary.description}\n                        />\n                      </div>\n                      <ReactMarkdown\n                        className=\"rule-text\"\n                        style={{ breakInside: \"avoid-column\" }}\n                        children={secondary.rules}\n                      />\n                      <Divider />\n                    </div>\n                  ))}\n                </CardContent>\n              </Card>\n            </Grid>\n            {!!enableWeather && (\n              <Grid item sx={{ mb: 2 }} md={12}>\n                <Card\n                  sx={{\n                    border: `2px solid rgb(57, 110, 158)`,\n                  }}\n                >\n                  <CardHeader\n                    sx={{\n                      backgroundColor: \"rgb(57, 110, 158)\",\n                      color: \"white\",\n                    }}\n                    title={\n                      <Typography variant=\"h5\" component=\"div\" align=\"center\">\n                        Twist\n                      </Typography>\n                    }\n                  />\n                  <CardContent>\n                    <h4>{randomWeather.name}</h4>\n                    <div style={{ marginBottom: \"0.5em\" }}>\n                      <ReactMarkdown\n                        className=\"rule-text font-italic\"\n                        style={{ breakInside: \"avoid-column\" }}\n                        children={randomWeather.description}\n                      />\n                    </div>\n                    <ReactMarkdown\n                      className=\"rule-text\"\n                      style={{ breakInside: \"avoid-column\" }}\n                      children={randomWeather.rules}\n                    />\n                  </CardContent>\n                </Card>\n              </Grid>\n            )}\n          </Grid>\n        </>\n      )}\n    </>\n  );\n}\n","import {\n  CardHeader,\n  Typography\n} from \"@mui/material\";\nimport Card from \"@mui/material/Card\";\nimport CardContent from \"@mui/material/CardContent\";\nimport React from 'react';\n\nexport const Overview = (props) => {\n  const { game } = props;\n  const background = game.description;\n  return (\n    <div>\n      <Typography sx={{ my: 2 }} variant=\"h4\" align=\"center\">Overview</Typography>\n      {!background && (\n        <div>\n          <p>{`No information available...`}</p>\n        </div>\n      )}\n      {!!background && (\n        <>\n          <Card\n            sx={{\n              border: `2px solid rgb(57, 110, 158)`,\n              mb: 2,\n            }}\n          >\n            <CardHeader\n              sx={{ backgroundColor: \"rgb(57, 110, 158)\", color: \"white\", py: 1 }}\n              title={\n                <Typography variant=\"h5\" component=\"div\">\n                  Background\n                </Typography>\n              }\n            />\n            <CardContent>\n              <Typography>{background}</Typography>\n            </CardContent>\n          </Card>\n        </>\n      )}\n    </div>\n  );\n}","import { Box, Button, Card, CardActionArea, CardContent, CardMedia, Link, Typography } from '@mui/material';\nimport React from 'react';\n\nconst sanitizeId = (id) => {\n  return id.replace(/\\s+/g, '');\n}\n\nexport const MarkdownRenderer = (options = {}) => {\n  return {\n    p: ({ children }) => <Typography paragraph>{children}</Typography>,\n    h1: (props) => {\n      const { children } = props;\n      const id = sanitizeId(children[0] ?? '').toLowerCase() ?? undefined;\n    return (\n      <Typography id={id} variant=\"h1\" gutterBottom>\n        {children}\n      </Typography>\n    )},\n    h2: (props) => {\n      const { children } = props;\n      const id = sanitizeId(children[0] ?? '').toLowerCase() ?? undefined;\n      return (\n      <Typography id={id} variant=\"h2\" gutterBottom>\n        {children}\n      </Typography>\n    )},\n    h3: (props) => {\n      const { children } = props;\n      const id = sanitizeId(children[0] ?? '').toLowerCase() ?? undefined;\n      return (\n      <Typography id={id} variant=\"h3\" gutterBottom>\n        {children}\n      </Typography>\n    )},\n    h4: (props) => {\n      const { children } = props;\n      const id = sanitizeId(children[0] ?? '').toLowerCase() ?? undefined;\n      return (\n      <Typography id={id} variant=\"h4\" gutterBottom>\n        {children}\n      </Typography>\n    )},\n    h5: (props) => {\n      const { children } = props;\n      const id = sanitizeId(children[0] ?? '').toLowerCase() ?? undefined;\n      return (\n      <Typography id={id} variant=\"h5\" gutterBottom>\n        {children}\n      </Typography>\n    )},\n    h6: (props) => {\n      const { children } = props;\n      const id = sanitizeId(children[0] ?? '').toLowerCase() ?? undefined;\n      return (\n      <Typography id={id} variant=\"h6\" gutterBottom>\n        {children}\n      </Typography>\n    )},\n    a: (props) => {\n      const { children, href } = props;\n      const id = sanitizeId(children[0] ?? '').toLowerCase() ?? undefined;\n      if (href === \"#\") {\n        return (\n        <Button\n          style={{ textTransform: 'none' }}\n          onClick={(el) => {\n            const offset = -150;\n            const element = document.getElementById(id);\n            const y = element?.getBoundingClientRect()?.top + window.pageYOffset + offset;\n            window.scrollTo({ behavior: 'smooth', top: y })\n          }}\n        >{children}</Button>\n      );\n      } else {\n        return <Link {...props}>{children}</Link>;\n      }\n    },\n    img: ({ alt, src, title }) => (\n      <Box\n        sx={{\n          backgroundColor: \"background.paper\",\n          my: 2,\n          display: \"flex\",\n          justifyContent: \"center\",\n          alignItems: \"center\",\n        }}\n      >\n        <Card fullWidth>\n          <CardContent style={{ padding: 0 }}>\n            <CardActionArea onClick={() => window.open(src, \"_blank\")}>\n              <CardMedia component=\"img\" alt={alt} image={src} title={title}\n                style={{ maxHeight: '600px' }} />\n            </CardActionArea>\n          </CardContent>\n        </Card>\n      </Box>\n    ),\n  };\n};\n\nexport const MaterialRenderer = (options = {}) => {\n  return {\n    p: ({ children }) => (<Typography paragraph>{children}</Typography>),\n    h1: ({ children }) => (<Typography variant=\"h1\" gutterBottom>{children}</Typography>),\n    h2: ({ children }) => (<Typography variant=\"h2\" gutterBottom>{children}</Typography>),\n    h3: ({ children }) => (<Typography variant=\"h3\" gutterBottom>{children}</Typography>),\n    h4: ({ children }) => (<Typography variant=\"h4\" gutterBottom>{children}</Typography>),\n    h5: ({ children }) => (<Typography variant=\"h5\" gutterBottom>{children}</Typography>),\n    h6: ({ children }) => (<Typography variant=\"h6\" gutterBottom>{children}</Typography>),\n    a: (props) => (<Link {...props}>{props.children}</Link>),\n    img: ({\n      alt,\n      src,\n      title,\n    }) => (\n      <div style={{ backgroundColor: 'rgba(0, 0, 0, 0.3)', borderRadius: '5px' }}>\n        <a href={src} rel=\"noreferrer\" target={\"_blank\"}>\n          <CardMedia\n            alt={alt}\n            image={src}\n            title={title}\n            style={{ margin: '5px auto', maxWidth: '700px' }}\n            className={\"d-block width-100 rules-image\"}\n          />\n        </a>\n      </div>\n    ),\n  }\n};","import RehypeToc from '@jsdevtools/rehype-toc';\nimport { Grid } from \"@mui/material\";\nimport Typography from \"@mui/material/Typography\";\nimport { get, isEqual, sortBy } from \"lodash\";\nimport React from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport styled from \"styled-components\";\nimport { MarkdownRenderer } from \"utils/markdown\";\n\nconst StyledRules = styled.div`\n  h1 {\n    font-size: 22pt;\n    font-weight: bold;\n    border-bottom: 4px solid rgb(57, 110, 158);\n    padding-bottom: 0.25rem;\n  }\n  h2 {\n    font-size: 20pt;\n    border-bottom: 2px solid rgb(57, 110, 158);\n    padding-bottom: 0.25rem;\n  }\n  h3 {\n    font-size: 16pt;\n  }\n  h4 {\n    font-weight: bold;\n    font-size: 12pt;\n  }\n  h5 {\n    font-weight: bold;\n    font-size: 12pt;\n  }\n  p {\n    break-inside: \"avoid-column\";\n    page-break-inside: avoid; /* For Firefox. */\n    -webkit-column-break-inside: avoid; /* For Chrome & friends. */\n    break-inside: avoid; /* For standard browsers like IE. :-) */\n  }\n`;\n\nexport function Rules(props) {\n  const { rawData, game, data, nameFilter } = props;\n  const { gameRules, skirmishRules } = rawData;\n  const gameType = get(game, \"gameType\", \"battle\");\n  const gameTypeData = get(rawData, `gameData.gameTypes[${gameType}]`, {});\n  const gameTypeName = get(gameTypeData, \"name\", \"Unknown Game\");\n  const isSkirmish = isEqual(gameType, \"battle\");\n  const rules = isSkirmish ? gameRules : skirmishRules;\n  const mdRenderer = React.useMemo(() => MarkdownRenderer(), []);\n  const missions = data\n    .getMissionScenarios()\n    .filter((mission) =>\n      nameFilter\n        ? mission.name.toLowerCase().includes(nameFilter.toLowerCase())\n        : true\n    );\n  const weathers = data\n    .getMissionWeather()\n    .filter((mission) =>\n      nameFilter\n        ? mission.name.toLowerCase().includes(nameFilter.toLowerCase())\n        : true\n    );\n  const secondaries = data\n    .getMissionSecondaries()\n    .filter((mission) =>\n      nameFilter\n        ? mission.name.toLowerCase().includes(nameFilter.toLowerCase())\n        : true\n    );\n  const terrains = sortBy(\n    data\n      .getTerrain()\n      .filter((mission) =>\n        nameFilter\n          ? mission.name.toLowerCase().includes(nameFilter.toLowerCase())\n          : true\n      ),\n    \"name\"\n  );\n  return (\n    <>\n      <Typography\n        sx={{ my: 2 }}\n        variant=\"h4\"\n        align=\"center\"\n      >{`${gameTypeName} Rules`}</Typography>\n      <div\n        className=\"unit-card\"\n        style={{ marginBottom: \"15px\", borderColor: \"rgb(57, 110, 158)\" }}\n      >\n        <div className=\"unit-card-body\">\n          <StyledRules>\n            <ReactMarkdown components={mdRenderer} children={rules}\n              rehypePlugins={[[RehypeToc, { headings: [\"h1\", \"h2\", \"h3\"] }]]} />\n          </StyledRules>\n        </div>\n      </div>\n      <Typography variant=\"h4\" align=\"center\">Terrain Examples</Typography>\n      <hr className=\"hr-blue\" />\n      <div className=\"two-columns\">\n        {terrains.map((terrain) => (\n          <div\n            className=\"unit-card terrain-card\"\n            style={{ marginBottom: \"15px\", borderColor: \"rgb(57, 110, 158)\" }}\n          >\n            <div\n              className=\"unit-card-title\"\n              style={{ backgroundColor: \"rgb(57, 110, 158)\", color: \"white\" }}\n            >\n              <Typography variant=\"h5\" align=\"center\">{terrain.name}</Typography>\n            </div>\n            <div className=\"unit-card-body\">\n              <div>\n                <p style={{ breakInside: \"avoid-column\", marginBottom: \"0.5em\" }}>\n                  <i>{terrain.description}</i>\n                </p>\n                <ul className=\"ul-indent\">\n                  {get(terrain, \"rules\", []).map((rule) => (\n                    <li>{rule}</li>\n                  ))}\n                </ul>\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n      <span id=\"scenario-h1\">\n        <Typography variant=\"h4\" align=\"center\">Scenarios</Typography>\n        <hr className=\"hr-blue\" />\n        <Grid\n          container\n          rowSpacing={1}\n          sx={{ mt: 2 }}\n          columnSpacing={{ xs: 1, sm: 2, md: 3 }}\n        >\n          {missions.map((mission, index) => (\n\n            <Grid item md={6} key={index}>\n              <div\n                className=\"unit-card mission-card\"\n                style={{ marginBottom: \"15px\", borderColor: \"rgb(57, 110, 158)\" }}\n              >\n                <div\n                  className=\"unit-card-title\"\n                  style={{ backgroundColor: \"rgb(57, 110, 158)\", color: \"white\" }}\n                >\n                  <Typography variant=\"h5\" align=\"center\">{mission.name}</Typography>\n                </div>\n                <div className=\"unit-card-body\">\n                  <a href={mission.map} rel=\"noreferrer\" target={\"_blank\"}>\n                    <img\n                      className={\"d-block width-100 rules-image\"}\n                      style={{ marginBottom: \"1rem\" }}\n                      src={mission.map}\n                      alt={mission.name}\n                    />\n                  </a>\n                  <div className=\"width-100\">\n                    {/* <h5>{'Setup'}</h5>\n                  <p style={{ breakInside: \"avoid-column\" }}>{mission.setup}</p>\n                  <h5>{'Deployment'}</h5>\n                  <p style={{ breakInside: \"avoid-column\" }}>{mission.deployment}</p> */}\n                    <ReactMarkdown\n                      className=\"rule-text\"\n                      style={{ breakInside: \"avoid-column\" }}\n                      children={mission.victory_conditions}\n                    />\n                  </div>\n                </div>\n              </div>\n            </Grid>\n          ))}\n\n        </Grid>\n      </span>\n      <Typography variant=\"h4\" align=\"center\">Secondary Objectives</Typography>\n      <hr className=\"hr-blue\" />\n      <div className=\"two-columns\">\n        {secondaries.map((condition, index) => (\n          <div key={index} style={{ breakInside: \"avoid\" }}>\n            <div\n              className=\"unit-card secondary-card\"\n              style={{\n                marginBottom: \"15px\",\n                borderColor: \"rgb(57, 110, 158)\",\n              }}\n            >\n              <div\n                className=\"unit-card-title\"\n                style={{\n                  backgroundColor: \"rgb(57, 110, 158)\",\n                  color: \"white\",\n                }}\n              >\n                <h3 className=\"text-center\">{condition.name}</h3>\n              </div>\n              <div className=\"unit-card-body\">\n                <div className=\"width-100\">\n                  <div style={{ marginBottom: \"0.5em\" }}>\n                    <ReactMarkdown\n                      className=\"rule-text  font-italic\"\n                      style={{ breakInside: \"avoid-column\" }}\n                      children={condition.description}\n                    />\n                  </div>\n                  <ReactMarkdown\n                    className=\"rule-text\"\n                    style={{ breakInside: \"avoid-column\" }}\n                    children={condition.rules}\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      <Typography variant=\"h4\" align=\"center\">Twists</Typography>\n      <hr className=\"hr-blue\" />\n      <div className=\"two-columns\">\n        {weathers.map((weather, index) => (\n          <div key={index} style={{ breakInside: \"avoid\" }}>\n            <div\n              className=\"unit-card twist-card\"\n              style={{\n                marginBottom: \"15px\",\n                borderColor: \"rgb(57, 110, 158)\",\n              }}\n            >\n              <div\n                className=\"unit-card-title\"\n                style={{\n                  backgroundColor: \"rgb(57, 110, 158)\",\n                  color: \"white\",\n                }}\n              >\n                <h3 className=\"text-center\">{weather.name}</h3>\n              </div>\n              <div className=\"unit-card-body\">\n                <div className=\"width-100\">\n                  <div style={{ marginBottom: \"0.5em\" }}>\n                    <ReactMarkdown\n                      className=\"rule-text  font-italic\"\n                      style={{ breakInside: \"avoid-column\" }}\n                      children={weather.description}\n                    />\n                  </div>\n                  <ReactMarkdown\n                    className=\"rule-text\"\n                    style={{ breakInside: \"avoid-column\" }}\n                    children={weather.rules}\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n    </>\n  );\n}\n","import {\n  faExclamationCircle\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport BugReportIcon from '@mui/icons-material/BugReport';\nimport RefreshIcon from '@mui/icons-material/Refresh';\nimport UploadIcon from '@mui/icons-material/Upload';\nimport {\n  Container\n} from \"@mui/material\";\nimport Box from \"@mui/material/Box\";\nimport Popover from \"@mui/material/Popover\";\nimport { useTheme } from \"@mui/material/styles\";\nimport Tab from \"@mui/material/Tab\";\nimport Tabs from \"@mui/material/Tabs\";\nimport Typography from \"@mui/material/Typography\";\nimport useMediaQuery from \"@mui/material/useMediaQuery\";\nimport CustomCircularProgress from \"components/CustomCircularProgress\";\nimport { Dropdown } from \"components/dropdown\";\nimport { DataContext, PointsCacheContext } from \"hooks\";\nimport { get, omitBy } from \"lodash\";\nimport { set } from \"lodash/fp\";\nimport { useSnackbar } from \"notistack\";\nimport React, { useContext, useState } from \"react\";\nimport Tour from \"reactour\";\nimport { DataAPI, mergeGlobalData } from \"utils/data\";\nimport { readFileContent } from \"utils/files\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { Factions } from \"./factions\";\nimport { MissionGenerator } from \"./mission_generator\";\nimport { Overview } from \"./overview\";\nimport { Rules } from \"./rules\";\n\n\nconst allSteps = [];\nconst steps = [\n  [\n    {\n      selector: \"#tab-0\",\n      content:\n        \"This is the module overview. This gives you background information and an overview of the game module.\",\n      stepInteraction: false,\n    },\n  ],\n  [\n    {\n      selector: \"#tab-1\",\n      content:\n        \"These are the game rules. This gives you the core rules of the game module.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".terrain-card:first-of-type\",\n      content:\n        \"This is a piece of terrain. It contains a brief description of what it might look like and any assocaited rules.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".mission-card:first-of-type\",\n      content:\n        \"This is a scenario. Each scenario has its own way to score victory points and deployment conditions.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".secondary-card:first-of-type\",\n      content:\n        \"This is a secondary objective. Player can select one of these to be the secondary objective for the mission.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".twist-card:first-of-type\",\n      content:\n        \"This is a twist. Player can select one of these to add an interesting twist to the mission.\",\n      stepInteraction: false,\n    },\n  ],\n  [\n    {\n      selector: \"#tab-4\",\n      content:\n        \"This is the factions list. This gives you a list of all factions in the module. Factions can sometimes be grouped into alliances.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".faction-card:first-of-type\",\n      content:\n        \"This is a faction. It contains a brief description of the faction and clicking on it will bring you to the roster for that faction.\",\n      stepInteraction: false,\n    },\n  ],\n  [\n    {\n      selector: \"#tab-3\",\n      content:\n        \"This is the scenarios tab. It can give you a random scenario to play with optional parameters.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \"#generateScenario\",\n      content:\n        \"Pressing this button will generate a new scenario for you to play with a random mission, secondary and optional twist.\",\n      stepInteraction: false,\n    },\n  ],\n  [\n    {\n      selector: \"#tab-4\",\n      content:\n        \"This is the rosters tab. It allows you to create rosters to play this game module.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \"#createList\",\n      content:\n        \"Pressing this button will open the force creator and allow you to give the force a name and choose a type.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \"#importList\",\n      content:\n        \"Pressing this button will allow you to import a force from a file into the force manager.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \"#list-manager\",\n      content:\n        \"This is the force manager. It contains all your previously created lists. You can click on the name of a list to go to it or click the ellipses to edit or delete the list properties.\",\n      stepInteraction: false,\n    },\n  ],\n];\n\nexport default React.memo((props) => {\n  const { gameName } = props.match.params;\n  const [\n    {\n      data: nope,\n      coreData,\n      fetchGame,\n      setData,\n      refreshData,\n      isLoading,\n      appState,\n      setAppState,\n      userPrefs,\n    },\n  ] = useContext(DataContext);\n  const nameFilter = appState?.searchText;\n  const [isTourOpen, setIsTourOpen] = useState(false);\n  const fileDialog = React.useRef();\n  // const history = useHistory();\n  const theme = useTheme();\n  const isMobile = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  // const addList = (listName, data) => {\n  //   const listId = uuidv4();\n  //   setLists({\n  //     ...lists,\n  //     [listId]: {\n  //       name: listName,\n  //       ...data,\n  //     },\n  //   });\n  //   goToList(listId);\n  // };\n  // const goToList = (listId) =>\n  //   history.push(`/games/${gameName}/lists/${listId}`);\n  const handleClick = () => {\n    fileDialog.current.click();\n  };\n  const game = get(nope, `gameData.games[${gameName}]`, {});\n  const coreGame = get(coreData, `gameData.games[${gameName}]`, {});\n  React.useEffect(() => {\n    if (!game.factions || (!coreGame.factions && !isLoading)) {\n      fetchGame(gameName);\n    }\n  }, [coreData, coreGame.factions, fetchGame, game.factions, gameName, isLoading]);\n  // Default active tab!!!\n  const [activeTab, setActiveTab] = useState(get(appState, \"factionTab\", 2));\n  const cache = useContext(PointsCacheContext);\n  const globalData = mergeGlobalData(game, nope);\n  const data = DataAPI(game, cache, globalData);\n  const { enqueueSnackbar } = useSnackbar();\n  const lists = get(nope, `lists[${gameName}]`, []);\n  const toggle = (tab) => {\n    if (activeTab !== tab) setActiveTab(tab);\n    setAppState({ ...appState, factionTab: tab });\n  };\n  const uploadFile = (event) => {\n    if (activeTab === 4) {\n      uploadList(event);\n    } else {\n      uploadFaction(event);\n    }\n  };\n  const uploadList = (event) => {\n    event.preventDefault();\n    const file = get(event, \"target.files[0]\");\n    if (file) {\n      readFileContent(file)\n        .then((content) => {\n          let listObject = {};\n          try {\n            listObject = JSON.parse(content);\n          } catch (e) {\n            return Promise.reject(e);\n          }\n          if (listObject.forces) {\n            const newArmyData = {\n              ...listObject,\n            };\n            const listName = listObject.name;\n            const listId = uuidv4();\n            setLists({\n              ...lists,\n              [listId]: {\n                name: listName,\n                ...newArmyData,\n              },\n            });\n            enqueueSnackbar(`List successfully imported.`, {\n              appearance: \"success\",\n            });\n          }\n        })\n        .catch((error) => {\n          enqueueSnackbar(`List failed to import. ${error.message}`, {\n            appearance: \"error\",\n          });\n        });\n    }\n    fileDialog.current.value = null;\n  };\n  const uploadFaction = (event) => {\n    const file = get(event, \"target.files[0]\");\n    if (file) {\n      readFileContent(file)\n        .then((content) => {\n          let armyObject = {};\n          try {\n            armyObject = JSON.parse(content);\n          } catch (e) {\n            return Promise.reject(e);\n          }\n          if (armyObject.games) {\n            const newArmyData = {\n              ...armyObject,\n            };\n            setCustomData(newArmyData);\n            enqueueSnackbar(`Core data successfully imported.`, {\n              appearance: \"success\",\n            });\n          } else if (armyObject.factions) {\n            const newData = set(\n              `games[${gameName}]`,\n              { ...get(nope, `customData.games[${gameName}]`), ...armyObject },\n              get(nope, \"customData\", {})\n            );\n            setCustomData(newData);\n            enqueueSnackbar(`Core data successfully imported.`, {\n              appearance: \"success\",\n            });\n          } else if (armyObject.id) {\n            const newData = set(\n              `games[${gameName}].factions[${armyObject.id}]`,\n              {\n                ...get(`games[${gameName}].factions[${armyObject.id}]`, {}),\n                ...armyObject,\n              },\n              get(nope, \"customData\", {})\n            );\n            setCustomData(newData);\n            cache.resetCache();\n            enqueueSnackbar(`${armyObject.name} successfully imported.`, {\n              appearance: \"success\",\n            });\n          } else {\n            enqueueSnackbar(`Faction failed to find data to import.`, {\n              appearance: \"error\",\n            });\n          }\n        })\n        .catch((error) => {\n          enqueueSnackbar(`Faction failed to import. ${error.message}`, {\n            appearance: \"error\",\n          });\n        });\n    }\n    fileDialog.current.value = null;\n  };\n  const deleteFaction = (factionId) => {\n    const newFactionList = omitBy(\n      get(nope, `customData.games[${gameName}].factions`, {}),\n      (faction) => faction.id === factionId\n    );\n    const armyData = {\n      ...get(nope, \"customData\", {}),\n      games: {\n        ...get(nope, \"customData.games\", {}),\n        [gameName]: {\n          ...get(nope, `customData.games[${gameName}]`, {}),\n          factions: newFactionList,\n        },\n      },\n    };\n    enqueueSnackbar(\n      `${data.getFaction(factionId).name} successfully deleted.`,\n      {\n        appearance: \"success\",\n      }\n    );\n    setCustomData(armyData);\n  };\n  const refreshFactions = () => {\n    refreshData(gameName)\n      .then(() => {\n        cache.resetCache();\n        enqueueSnackbar(`Game data successfully updated.`, {\n          appearance: \"success\",\n        });\n      })\n      .catch((error) => {\n        enqueueSnackbar(`Game failed to fetch factions. ${error.message}`, {\n          appearance: \"error\",\n        });\n      });\n  };\n  const setLists = (listData) => {\n    const newGameData = {\n      ...coreData,\n      lists: {\n        ...get(nope, \"lists\", {}),\n        [gameName]: {\n          ...listData,\n        },\n      },\n    };\n    setData(newGameData);\n  };\n  const setCustomData = (passedData) => {\n    const newGameData = {\n      ...coreData,\n      customData: {\n        ...get(nope, \"customData\", {}),\n        ...passedData,\n      },\n    };\n    setData(newGameData);\n  };\n  // const [showAddList, hideAddList] = useModal(\n  //   ({ extraProps }) => (\n  //     <AddList\n  //       {...props}\n  //       hideModal={hideAddList}\n  //       lists={lists}\n  //       data={data}\n  //       addList={addList}\n  //       {...extraProps}\n  //     />\n  //   ),\n  //   [lists]\n  // );\n//   <SpeedDial\n//   ariaLabel=\"SpeedDial tooltip example\"\n//   sx={{ position: \"fixed\", bottom: 16, right: 16 }}\n//   icon={<SpeedDialIcon />}\n//   onClose={(event) => {\n//     if (event.type === 'click' || event.type === 'blur') {\n//       setDialOpen(false);\n//     }\n//   }}\n//   onOpen={(event) => {\n//     if (event.type === 'click') {\n//       setDialOpen(true);\n//     }\n//   }}\n//   open={dialOpen && show}\n//   hidden={!show}\n// >\n//   {/* {activeTab === 4 && <> <Button id=\"addFaction\" title=\"Add new faction.\" style={{ marginRight: '5px', width: '42px' }} color=\"primary\" onClick={() => { showAddList() }}><FontAwesomeIcon icon={faPlus} /></Button></>} */}\n//   {activeTab === 4 && (\n//     <SpeedDialAction\n//       tooltipOpen\n//       FabProps={{\n//         sx: {\n//           backgroundColor: theme.palette.primary.main,\n//           color: theme.palette.getContrastText(theme.palette.primary.main)\n//         }\n//       }}\n//       id=\"createList\"\n//       tooltipTitle=\"Create\"\n//       onClick={() => {\n//         showAddList();\n//       }}\n//       icon={<AddIcon />}\n//     />\n//   )}\n//   {activeTab === 4 && (\n//     <SpeedDialAction\n//       tooltipOpen\n//       FabProps={{\n//         sx: {\n//           backgroundColor: theme.palette.primary.main,\n//           color: theme.palette.getContrastText(theme.palette.primary.main)\n//         }\n//       }}\n//       tooltipTitle=\"Import\"\n//       id=\"importList\"\n//       onClick={handleClick}\n//       icon={<UploadIcon />}\n//     />\n//   )}\n//   {activeTab !== 4 && (\n//     <SpeedDialAction\n//       tooltipOpen\n//       FabProps={{\n//         sx: {\n//           backgroundColor: theme.palette.primary.main,\n//           color: theme.palette.getContrastText(theme.palette.primary.main)\n//         }\n//       }}\n//       id=\"refreshFactions\"\n//       tooltipTitle=\"Refresh\"\n//       onClick={refreshFactions}\n//       icon={<RefreshIcon />}\n//     />\n//   )}\n//   {userPrefs.developerMode && activeTab !== 4 && (\n//     <SpeedDialAction\n//       tooltipOpen\n//       FabProps={{\n//         sx: {\n//           backgroundColor: theme.palette.primary.main,\n//           color: theme.palette.getContrastText(theme.palette.primary.main)\n//         }\n//       }}\n//       id=\"importFaction\"\n//       tooltipTitle=\"Import\"\n//       onClick={handleClick}\n//       icon={<UploadIcon />}\n//     />\n//   )}\n//   {!!game.reportUrl && (\n//     <SpeedDialAction\n//       tooltipOpen\n//       FabProps={{\n//         sx: {\n//           backgroundColor: theme.palette.primary.main,\n//           color: theme.palette.getContrastText(theme.palette.primary.main)\n//         }\n//       }}\n//       id=\"reportModuleIssue\"\n//       tooltipTitle=\"Issue\"\n//       onClick={() => window.open(game.reportUrl, \"_blank\")}\n//       icon={<BugReportIcon />}\n//     />\n//   )}\n//   <SpeedDialAction\n//     tooltipOpen\n//     FabProps={{\n//       sx: {\n//         backgroundColor: theme.palette.primary.main,\n//         color: theme.palette.getContrastText(theme.palette.primary.main)\n//       }\n//     }}\n//     tooltipTitle=\"Top\"\n//     color=\"primary\"\n//     onClick={scrollToTop}\n//     icon={<KeyboardArrowUpIcon />}\n//   />\n// </SpeedDial>\n  React.useEffect(() => {\n    setAppState({\n      enableSearch: true,\n      contextActions: [\n        {\n          name: 'Refresh',\n          icon: <RefreshIcon />,\n          onClick: () => refreshFactions()\n        },\n        ...(!!userPrefs.developerMode ? [\n          {\n            name: 'Import',\n            icon: <UploadIcon />,\n            onClick: () => handleClick()\n          }\n        ] : []),\n        ...(!!game.reportUrl ? [\n          {\n            name: 'Report',\n            icon: <BugReportIcon />,\n            onClick: () => window.open(game.reportUrl, \"_blank\")\n          }\n        ] : [])\n      ]\n    })\n    return () => {\n      setAppState({\n        contextActions: []\n      })\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [ userPrefs.developerMode ]);\n  // const [dialOpen, setDialOpen] = React.useState(false);\n  if (!data) {\n    return (\n      <Box sx={{ textAlign: \"center\" }}>\n        <CustomCircularProgress />\n        <input\n          id=\"file-Form.Control\"\n          type=\"file\"\n          name=\"name\"\n          multiple\n          ref={fileDialog}\n          onChange={uploadFile}\n          style={{ height: \"0px\", overflow: \"hidden\" }}\n        />\n      </Box>\n    );\n  }\n  let TABS = {\n    Overview: <Overview data={data} game={game} />,\n    Rules: (\n      <Rules\n        data={data}\n        game={game}\n        rawData={nope}\n        gameName={gameName}\n        nameFilter={nameFilter}\n      />\n    ),\n    Factions: (\n      <Factions\n        data={data}\n        game={game}\n        gameName={gameName}\n        setData={setData}\n        rawData={nope}\n        userPrefs={userPrefs}\n        deleteFaction={deleteFaction}\n        nameFilter={nameFilter}\n      />\n    ),\n    Scenarios: (\n      <MissionGenerator\n        data={data}\n        game={game}\n        gameName={gameName}\n        setData={setData}\n        rawData={nope}\n        nameFilter={nameFilter}\n      />\n    ),\n    // Rosters: (\n    //   <ForceBuilder\n    //     data={data}\n    //     game={game}\n    //     gameName={gameName}\n    //     lists={lists}\n    //     setLists={setLists}\n    //     goToList={goToList}\n    //     showModal={showEditList}\n    //     nameFilter={nameFilter}\n    //   />\n    // ),\n  };\n  function a11yProps(index) {\n    return {\n      id: `simple-tab-${index}`,\n      \"aria-controls\": `simple-tabpanel-${index}`,\n    };\n  }\n  const handleChange = (event, newValue) => {\n    toggle(newValue);\n  };\n  const isModified = Object.values(\n    get(nope, `customData.games[${gameName}]`, {})\n  ).length;\n  return (\n    <Container>\n      {/* {!bannerHidden && (\n        <Alert sx={{ mb: 2 }} severity=\"info\" variant=\"filled\" onClose={hideBanner}> <Link onClick={() => {\n          setActiveTab(4);\n          hideBanner();\n        }} color=\"inherit\">Click here to try the new Roster creator to create a list.</Link>\n        </Alert>\n      )} */}\n      <Typography variant=\"h3\" align=\"center\" sx={{ mb: 2 }}>\n        {!!isModified && (\n          <Dropdown>\n            {({ handleClose, open, handleOpen, anchorElement }) => (\n              <>\n                <span\n                  aria-haspopup=\"true\"\n                  onMouseEnter={handleOpen}\n                  onMouseLeave={handleClose} style={{ marginRight: '5px' }}>\n                  <FontAwesomeIcon\n                    size=\"sm\"\n                    icon={faExclamationCircle}\n                  />\n                </span>\n                <Popover\n                  variant=\"warning\"\n                  id=\"mouse-over-popover\"\n                  sx={{\n                    pointerEvents: 'none',\n                  }}\n                  open={open}\n                  anchorEl={anchorElement}\n                  anchorOrigin={{\n                    vertical: 'top',\n                    horizontal: 'center',\n                  }}\n                  transformOrigin={{\n                    vertical: 'bottom',\n                    horizontal: 'center',\n                  }}\n                  onClose={handleClose}\n                  disableRestoreFocus\n                >\n                  <Typography sx={{ p: 1 }}>Warning: Data Is Modified Locally</Typography>\n                </Popover>\n              </>\n            )}\n          </Dropdown>\n        )}\n        {/* {!!game.author && (\n          <Dropdown>\n            {({ handleClose, open, handleOpen, anchorElement }) => (\n              <>\n                <IconButton\n                  aria-haspopup=\"true\"\n                  onClick={handleOpen}\n                  onMouseEnter={handleOpen}\n                  onMouseLeave={handleClose} style={{ marginRight: '5px' }}>\n                  <PersonIcon />\n                </IconButton>\n                <Popover\n                  variant=\"warning\"\n                  id=\"mouse-over-popover\"\n                  sx={{\n                    pointerEvents: 'none',\n                  }}\n                  open={open}\n                  anchorEl={anchorElement}\n                  anchorOrigin={{\n                    vertical: 'top',\n                    horizontal: 'center',\n                  }}\n                  transformOrigin={{\n                    vertical: 'bottom',\n                    horizontal: 'center',\n                  }}\n                  onClose={handleClose}\n                  disableRestoreFocus\n                >\n                  <Typography sx={{ p: 1 }}>{`Written by ${game.author}`}</Typography>\n                </Popover>\n              </>\n            )}\n          </Dropdown>\n        )} */}\n        {game.name}\n        <small style={{ marginLeft: '5px', fontSize: '1rem' }}> {game.version ? `(${game.version})` : \"\"}</small>\n      </Typography>\n      <Box\n        className=\"sticky\"\n        sx={{\n          width: \"100%\",\n          bgcolor: \"background.paper\",\n          top: isMobile ? \"56px\" : \"64px\",\n        }}\n      >\n        <Box sx={{ width: \"100%\", bgcolor: \"background.paper\", pb: 0 }}>\n          <Box sx={{ borderBottom: 1, borderColor: \"divider\" }}>\n            <Tabs\n              variant=\"scrollable\"\n              value={activeTab}\n              onChange={handleChange}\n            >\n              {Object.keys(TABS).map((tab, index) => (\n                <Tab\n                  sx={{ textTransform: \"none\" }}\n                  label={tab}\n                  {...a11yProps(0)}\n                />\n              ))}\n            </Tabs>\n          </Box>\n        </Box>\n      </Box>\n      {/* <HideOnScroll>\n        {({ show }) => (\n          <SpeedDial\n            ariaLabel=\"SpeedDial tooltip example\"\n            sx={{ position: \"fixed\", bottom: 16, right: 16 }}\n            icon={<SpeedDialIcon />}\n            onClose={(event) => {\n              if (event.type === 'click' || event.type === 'blur') {\n                setDialOpen(false);\n              }\n            }}\n            onOpen={(event) => {\n              if (event.type === 'click') {\n                setDialOpen(true);\n              }\n            }}\n            open={dialOpen && show}\n            hidden={!show}\n          >\n            {activeTab === 4 && <> <Button id=\"addFaction\" title=\"Add new faction.\" style={{ marginRight: '5px', width: '42px' }} color=\"primary\" onClick={() => { showAddList() }}><FontAwesomeIcon icon={faPlus} /></Button></>}\n            {activeTab === 4 && (\n              <SpeedDialAction\n                tooltipOpen\n                FabProps={{\n                  sx: {\n                    backgroundColor: theme.palette.primary.main,\n                    color: theme.palette.getContrastText(theme.palette.primary.main)\n                  }\n                }}\n                id=\"createList\"\n                tooltipTitle=\"Create\"\n                onClick={() => {\n                  showAddList();\n                }}\n                icon={<AddIcon />}\n              />\n            )}\n            {activeTab === 4 && (\n              <SpeedDialAction\n                tooltipOpen\n                FabProps={{\n                  sx: {\n                    backgroundColor: theme.palette.primary.main,\n                    color: theme.palette.getContrastText(theme.palette.primary.main)\n                  }\n                }}\n                tooltipTitle=\"Import\"\n                id=\"importList\"\n                onClick={handleClick}\n                icon={<UploadIcon />}\n              />\n            )}\n            {activeTab !== 4 && (\n              <SpeedDialAction\n                tooltipOpen\n                FabProps={{\n                  sx: {\n                    backgroundColor: theme.palette.primary.main,\n                    color: theme.palette.getContrastText(theme.palette.primary.main)\n                  }\n                }}\n                id=\"refreshFactions\"\n                tooltipTitle=\"Refresh\"\n                onClick={refreshFactions}\n                icon={<RefreshIcon />}\n              />\n            )}\n            {userPrefs.developerMode && activeTab !== 4 && (\n              <SpeedDialAction\n                tooltipOpen\n                FabProps={{\n                  sx: {\n                    backgroundColor: theme.palette.primary.main,\n                    color: theme.palette.getContrastText(theme.palette.primary.main)\n                  }\n                }}\n                id=\"importFaction\"\n                tooltipTitle=\"Import\"\n                onClick={handleClick}\n                icon={<UploadIcon />}\n              />\n            )}\n            {!!game.reportUrl && (\n              <SpeedDialAction\n                tooltipOpen\n                FabProps={{\n                  sx: {\n                    backgroundColor: theme.palette.primary.main,\n                    color: theme.palette.getContrastText(theme.palette.primary.main)\n                  }\n                }}\n                id=\"reportModuleIssue\"\n                tooltipTitle=\"Issue\"\n                onClick={() => window.open(game.reportUrl, \"_blank\")}\n                icon={<BugReportIcon />}\n              />\n            )}\n            <SpeedDialAction\n              tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n              tooltipTitle=\"Top\"\n              color=\"primary\"\n              onClick={scrollToTop}\n              icon={<KeyboardArrowUpIcon />}\n            />\n          </SpeedDial>\n        )}\n      </HideOnScroll> */}\n      <div>\n        {/* {Object.values(TABS).map((pane, index) => (\n          <div\n            id={`tab-${index}`}\n            tabId={index}\n            style={{ display: activeTab === index ? \"\" : \"none\" }}\n          >\n            {pane}\n          </div>\n        ))} */}\n        {Object.values(TABS)[activeTab]}\n      </div>\n      <Tour\n        accentColor={`rgb(57, 110, 158)`}\n        className=\"tour\"\n        key={activeTab}\n        steps={[...allSteps, ...(steps[activeTab] || [])]}\n        isOpen={isTourOpen}\n        onRequestClose={() => {\n          setIsTourOpen(false);\n        }}\n        rounded={5}\n        onAfterOpen={(target) => (document.body.style.overflowY = \"hidden\")}\n        onBeforeClose={(target) => (document.body.style.overflowY = \"auto\")}\n      />\n      <input\n        id=\"file-Form.Control\"\n        type=\"file\"\n        name=\"name\"\n        multiple\n        ref={fileDialog}\n        onChange={uploadFile}\n        style={{ height: \"0px\", overflow: \"hidden\" }}\n      />\n    </Container>\n  );\n});\n","import {\n  faCheckCircle, faExclamationCircle\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport BugReportIcon from '@mui/icons-material/BugReport';\nimport RefreshIcon from '@mui/icons-material/Refresh';\nimport UploadIcon from '@mui/icons-material/Upload';\nimport {\n  Button, CardActionArea,\n  CardActions, CardHeader, Grid\n} from \"@mui/material\";\nimport Box from \"@mui/material/Box\";\nimport Card from \"@mui/material/Card\";\nimport CardContent from \"@mui/material/CardContent\";\nimport CardMedia from \"@mui/material/CardMedia\";\nimport Container from \"@mui/material/Container\";\nimport Popover from \"@mui/material/Popover\";\nimport { useTheme } from \"@mui/material/styles\";\nimport Tab from \"@mui/material/Tab\";\nimport Tabs from \"@mui/material/Tabs\";\nimport Typography from \"@mui/material/Typography\";\nimport useMediaQuery from \"@mui/material/useMediaQuery\";\nimport { Dropdown } from \"components/dropdown\";\nimport { DataContext, PointsCacheContext } from \"hooks\";\nimport { get, groupBy, omit, sortBy } from \"lodash\";\nimport { useSnackbar } from \"notistack\";\nimport React, { useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport Tour from \"reactour\";\nimport { readFileContent } from \"utils/files\";\nimport \"./games.css\";\n\nconst steps = [\n  {\n    selector: \"#gameTypeTabs\",\n    content:\n      \"This is the list of game types. Each game type has its own core rules set and all modules share the same core rules.\",\n    stepInteraction: false,\n  },\n  {\n    selector: \"#gameList\",\n    content:\n      \"This is the list of game modules. Modules are split into different settings. They are all cross-compatible.\",\n    stepInteraction: false,\n  },\n  {\n    selector: \".game-card:first-of-type\",\n    content:\n      \"Clicking on a game module will bring you to that module where you can explore all the game data.\",\n    stepInteraction: false,\n  },\n];\n\nconst Games = (props) => {\n  const [\n    {\n      data: nope,\n      setData,\n      coreData,\n      refreshAllData,\n      appState,\n      setAppState,\n      userPrefs\n    },\n  ] = React.useContext(DataContext);\n  const cache = React.useContext(PointsCacheContext);\n  const [activeTab, setActiveTab] = useState(get(appState, \"gamesTab\", 0));\n  const theme = useTheme();\n  const isMobile = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  const { enqueueSnackbar } = useSnackbar();\n  const history = useHistory();\n  const nameFilter = appState?.searchText;\n  const [isTourOpen, setIsTourOpen] = useState(false);\n  const showBeta = userPrefs.showBeta;\n  // <SpeedDialAction\n  //   FabProps={{\n  //     sx: { backgroundColor: 'primary.main', color: theme.palette.getContrastText(theme.palette.primary.main) }\n  //   }}\n  //   tooltipOpen\n  //   id=\"refreshGame\"\n  //   tooltipTitle=\"Refresh\"\n  //   onClick={refreshFactions}\n  //   icon={}\n  // />\n  // {!!userPrefs.developerMode && (\n  //   <SpeedDialAction\n  //     FabProps={{\n  //       sx: {\n  //         backgroundColor: 'primary.main',\n  //         color: theme.palette.getContrastText(theme.palette.primary.main)\n  //       }\n  //     }}\n  //     tooltipOpen\n  //     id=\"importGameData\"\n  //     tooltipTitle=\"Import\"\n  //     onClick={handleClick}\n  //     icon={<UploadIcon />}\n  //   />\n  // )}\n  // {!!reportUrl && (\n  //   <SpeedDialAction\n  //     FabProps={{\n  //       sx: {\n  //         backgroundColor: 'primary.main',\n  //         color: theme.palette.getContrastText(theme.palette.primary.main)\n  //       }\n  //     }}\n  //     tooltipOpen\n  //     id=\"reportGameIssue\"\n  //     tooltipTitle=\"Issue\"\n  //     onClick={}\n  //     icon={<BugReportIcon />}\n  //   />\n  // )}\n  // <SpeedDialAction\n  //   tooltipOpen\n  //   FabProps={{\n  //     sx: {\n  //       backgroundColor: theme.palette.primary.main,\n  //       color: theme.palette.getContrastText(theme.palette.primary.main)\n  //     }\n  //   }}\n  //   tooltipTitle=\"Top\"\n  //   color=\"primary\"\n  //   onClick={scrollToTop}\n  //   icon={<KeyboardArrowUpIcon />}\n  // />\n  const gameTypesRaw = {\n    all: { name: \"All\" },\n    ...get(nope, \"gameData.gameTypes\", {}),\n  };\n  const gamesUnsorted = Object.values(get(nope, `gameData.games`, {})).filter(\n    (game) => (showBeta ? true : game.version && Number(game.version) >= 1)\n  );\n  const gameTypes = [\n    ...Object.keys(gameTypesRaw).filter(\n      (gameType) =>\n        gamesUnsorted.filter((game) => game.gameType === gameType).length\n    ),\n  ];\n  const games = sortBy(\n    Object.values(get(nope, `gameData.games`, {}))\n      .filter((game) =>\n        showBeta ? true : game.version && Number(game.version) >= 1\n      )\n      .filter((unit) =>\n        nameFilter\n          ? unit.name.toLowerCase().includes(nameFilter.toLowerCase())\n          : true\n      ),\n    \"name\"\n  ).filter((game) =>\n    gameTypes[activeTab] === \"all\"\n      ? true\n      : game.gameType === gameTypes[activeTab]\n  );\n  const gameCategories = get(nope, \"gameData.categories\", {});\n  const unitCategories = groupBy(games, \"category\");\n  const categoryOrder = [...Object.keys(gameCategories), undefined].filter(\n    (cat) => unitCategories[cat] && unitCategories[cat].length\n  );\n  const reportUrl = get(nope, \"gameData.reportUrl\");\n  const fileDialog = React.useRef();\n\n  const toggle = (tab) => {\n    if (activeTab !== tab) setActiveTab(tab);\n    setAppState({ ...appState, gamesTab: tab });\n  };\n  const setCustomData = (passedData) => {\n    const newGameData = {\n      ...coreData,\n      customData: {\n        ...get(nope, \"customData\", {}),\n        ...passedData,\n      },\n    };\n    setData(newGameData);\n  };\n  const uploadFaction = (event) => {\n    const file = get(event, \"target.files[0]\");\n    if (file) {\n      readFileContent(file)\n        .then((content) => {\n          let armyObject = {};\n          try {\n            armyObject = JSON.parse(content);\n          } catch (e) {\n            return Promise.reject(e);\n          }\n          if (armyObject.games) {\n            const newArmyData = {\n              ...armyObject,\n            };\n            setCustomData(newArmyData);\n            enqueueSnackbar(`Core data successfully imported.`, {\n              appearance: \"success\",\n            });\n          } else if (armyObject.id && armyObject.factions) {\n            const newArmyData = {\n              games: {\n                ...get(nope, \"customData.games\", {}),\n                [armyObject.id]: {\n                  ...armyObject,\n                },\n              },\n            };\n            setCustomData(newArmyData);\n            cache.resetCache();\n            enqueueSnackbar(`${armyObject.name} successfully imported.`, {\n              appearance: \"success\",\n            });\n          } else {\n            enqueueSnackbar(`Game failed to find data to import.`, {\n              appearance: \"error\",\n            });\n          }\n        })\n        .catch((error) => {\n          enqueueSnackbar(`Core game data failed to import. ${error.message}`, {\n            appearance: \"error\",\n          });\n        });\n    }\n    fileDialog.current.value = null;\n  };\n  const deleteGame = (gameId) => {\n    const newArmyData = {\n      ...get(nope, \"customData\", {}),\n      games: {\n        ...omit(get(nope, \"customData.games\", {}), gameId),\n      },\n    };\n    enqueueSnackbar(\n      `${get(\n        nope,\n        `customData.games[${gameId}].name`,\n        {}\n      )} successfully deleted.`,\n      { appearance: \"success\" }\n    );\n    setCustomData(newArmyData);\n  };\n  const goToFaction = (faction) => history.push(`/games/${faction.id}`);\n  const refreshFactions = React.useCallback(() => {\n    refreshAllData(true)\n      .then(() => {\n        enqueueSnackbar(`All games data successfully updated.`, {\n          appearance: \"success\",\n        });\n      })\n      .catch((error) => {\n        enqueueSnackbar(`All games data failed to fetch. ${error.message}`, {\n          appearance: \"error\",\n        });\n      });\n  }, [ enqueueSnackbar, refreshAllData ]);\n  const handleClick = () => {\n    fileDialog.current.click();\n  };\n\n  const handleChange = (event, newValue) => {\n    toggle(newValue);\n  };\n  function a11yProps(index) {\n    return {\n      id: `simple-tab-${index}`,\n      \"aria-controls\": `simple-tabpanel-${index}`,\n    };\n  }\n  React.useEffect(() => {\n    setAppState({\n      enableSearch: true,\n      contextActions: [\n        {\n          name: 'Refresh',\n          icon: <RefreshIcon />,\n          onClick: () => {\n            refreshFactions()\n          }\n        },\n        ...(!!userPrefs.developerMode ? [\n          {\n            name: 'Import',\n            icon: <UploadIcon />,\n            onClick: () => {\n              handleClick();\n            }\n          }\n        ] : []),\n        ...(!!reportUrl ? [\n          {\n            name: 'Report',\n            icon: <BugReportIcon />,\n            onClick: () => window.open(reportUrl, \"_blank\")\n          }\n        ] : [])\n      ]\n    })\n    return () => {\n      setAppState({\n        contextActions: []\n      })\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [ userPrefs.developerMode ]);\n  // const [dialOpen, setDialOpen] = React.useState(false);\n  if (!games) {\n    return (\n      <p><input\n        id=\"file-input\"\n        type=\"file\"\n        name=\"name\"\n        multiple\n        ref={fileDialog}\n        onChange={uploadFaction}\n        style={{ height: \"0px\", overflow: \"hidden\" }}\n      /></p>\n    );\n  }\n  return (\n    <Container>\n      <Typography variant=\"h3\" align=\"center\" sx={{ mb: 2 }}>\n        Games Modules\n      </Typography>\n      <Box\n        className=\"sticky\"\n        sx={{\n          width: \"100%\",\n          bgcolor: \"background.paper\",\n          top: isMobile ? \"56px\" : \"64px\",\n        }}\n      >\n        {!!gameTypes && !!gameTypes.length && (\n          <Box sx={{ width: \"100%\", bgcolor: \"background.paper\", pb: 0 }}>\n            <Box sx={{ borderBottom: 1, borderColor: \"divider\" }}>\n              <Tabs\n                variant=\"scrollable\"\n                value={activeTab}\n                onChange={handleChange}\n                aria-label=\"basic tabs example\"\n              >\n                {gameTypes.map((tab, index) => {\n                  const gameTypeData = gameTypesRaw[tab];\n                  return (\n                    <Tab\n                      key={index}\n                      sx={{ textTransform: \"none\" }}\n                      label={gameTypeData.name}\n                      {...a11yProps(0)}\n                    />\n                  );\n                })}\n              </Tabs>\n            </Box>\n          </Box>\n        )}\n      </Box>\n      {/* <HideOnScroll>\n        {({ show }) => (\n          <SpeedDial\n            ariaLabel=\"SpeedDial tooltip example\"\n            sx={{ position: \"fixed\", bottom: 16, right: 16 }}\n            icon={<SpeedDialIcon />}\n            onClose={(event) => {\n              if (event.type === 'click' || event.type === 'blur') {\n                setDialOpen(false);\n              }\n            }}\n            onOpen={(event) => {\n              if (event.type === 'click') {\n                setDialOpen(true);\n              }\n            }}\n            open={dialOpen && show}\n            hidden={!show}\n          >\n            <SpeedDialAction\n              FabProps={{\n                sx: { backgroundColor: 'primary.main', color: theme.palette.getContrastText(theme.palette.primary.main) }\n              }}\n              tooltipOpen\n              id=\"refreshGame\"\n              tooltipTitle=\"Refresh\"\n              onClick={refreshFactions}\n              icon={<RefreshIcon />}\n            />\n            {!!userPrefs.developerMode && (\n              <SpeedDialAction\n                FabProps={{\n                  sx: {\n                    backgroundColor: 'primary.main',\n                    color: theme.palette.getContrastText(theme.palette.primary.main)\n                  }\n                }}\n                tooltipOpen\n                id=\"importGameData\"\n                tooltipTitle=\"Import\"\n                onClick={handleClick}\n                icon={<UploadIcon />}\n              />\n            )}\n            {!!reportUrl && (\n              <SpeedDialAction\n                FabProps={{\n                  sx: {\n                    backgroundColor: 'primary.main',\n                    color: theme.palette.getContrastText(theme.palette.primary.main)\n                  }\n                }}\n                tooltipOpen\n                id=\"reportGameIssue\"\n                tooltipTitle=\"Issue\"\n                onClick={() => window.open(reportUrl, \"_blank\")}\n                icon={<BugReportIcon />}\n              />\n            )}\n            <SpeedDialAction\n              tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n              tooltipTitle=\"Top\"\n              color=\"primary\"\n              onClick={scrollToTop}\n              icon={<KeyboardArrowUpIcon />}\n            />\n            <SpeedDialAction\n              tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n              tooltipTitle=\"Help\"\n              icon={<FontAwesomeIcon icon={faQuestion} />}\n              onClick={() => setIsTourOpen(true)}\n            />\n          </SpeedDial>\n        )}\n      </HideOnScroll> */}\n      <div id=\"gameList\">\n        {categoryOrder.map((gameKey, idx) => {\n          const games = get(unitCategories, `[${gameKey}]`, []);\n          const categoryData = get(nope, `gameData.categories[${gameKey}]`, {});\n          return (\n            <>\n              <Typography variant=\"h4\" gutterBottom align=\"center\" sx={{ my: 2 }}>\n                {categoryData.name || \"No Category\"}\n              </Typography>\n              <Grid\n                container\n                spacing={{ xs: 2, md: 3 }}\n                key={idx}\n              >\n                {games.map((game, index) => {\n                  const factionColor = game.color;\n                  const isModified = Object.values(\n                    get(nope, `customData.games[${game.id}]`, {})\n                  ).length;\n                  return (\n                    <Grid\n                      item\n                      sx={{ pb: 2 }}\n                      md={games.length > 1 ? \"6\" : \"12\"}\n                      key={index}\n                    >\n                      <Card\n                        sx={{\n                          border: `2px solid ${factionColor}`,\n                        }}\n                      >\n                        <CardActionArea onClick={() => goToFaction(game)}>\n                          <CardHeader\n                            sx={{\n                              backgroundColor: factionColor,\n                              color: \"white\",\n                            }}\n                            title={\n                              <Typography\n                                variant=\"h5\"\n                                component=\"div\"\n                                align=\"center\"\n                              >\n                                {!!isModified && (\n                                  <Dropdown>\n                                    {({ handleClose, open, handleOpen, anchorElement }) => (\n                                      <>\n                                        <span\n                                          aria-haspopup=\"true\"\n                                          onMouseEnter={handleOpen}\n                                          onMouseLeave={handleClose} style={{ marginRight: '5px' }}>\n                                          <FontAwesomeIcon\n                                            size=\"sm\"\n                                            icon={faExclamationCircle}\n                                          />\n                                        </span>\n                                        <Popover\n                                          variant=\"warning\"\n                                          id=\"mouse-over-popover\"\n                                          sx={{\n                                            pointerEvents: 'none',\n                                          }}\n                                          open={open}\n                                          anchorEl={anchorElement}\n                                          anchorOrigin={{\n                                            vertical: 'top',\n                                            horizontal: 'center',\n                                          }}\n                                          transformOrigin={{\n                                            vertical: 'bottom',\n                                            horizontal: 'center',\n                                          }}\n                                          onClose={handleClose}\n                                          disableRestoreFocus\n                                        >\n                                          <Typography sx={{ p: 1 }}>Warning: Data Is Modified Locally</Typography>\n                                        </Popover>\n                                      </>\n                                    )}\n                                  </Dropdown>\n                                )}\n                                {!isModified && (\n                                  <Dropdown>\n                                    {({ handleClose, open, handleOpen, anchorElement }) => (\n                                      <>\n                                        <span\n                                          aria-haspopup=\"true\"\n                                          onMouseEnter={handleOpen}\n                                          onMouseLeave={handleClose} style={{ marginRight: '5px' }}>\n                                          <FontAwesomeIcon size=\"sm\" icon={faCheckCircle} />\n                                        </span>\n                                        <Popover\n                                          variant=\"warning\"\n                                          id=\"mouse-over-popover\"\n                                          sx={{\n                                            pointerEvents: 'none',\n                                          }}\n                                          open={open}\n                                          anchorEl={anchorElement}\n                                          anchorOrigin={{\n                                            vertical: 'top',\n                                            horizontal: 'center',\n                                          }}\n                                          transformOrigin={{\n                                            vertical: 'bottom',\n                                            horizontal: 'center',\n                                          }}\n                                          onClose={handleClose}\n                                          disableRestoreFocus\n                                        >\n                                          <Typography sx={{ p: 1 }}>Official Game Module</Typography>\n                                        </Popover>\n                                      </>\n                                    )}\n                                  </Dropdown>\n                                )}\n                                {game.name}\n                                <small style={{ marginLeft: '5px', fontSize: '1rem' }}>\n                                  {game.version ? `(${game.version})` : \"\"}\n                                </small>\n                              </Typography>\n                            }\n                          />\n                          {!!game.image && (\n                            <CardMedia\n                              component=\"img\"\n                              height=\"250\"\n                              image={game.image}\n                              alt=\"green iguana\"\n                            />\n                          )}\n                          <CardContent>\n                            <Typography>{game.description || \" \"}</Typography>\n                          </CardContent>\n                        </CardActionArea>\n                        {!game.url && (\n                          <CardActions>\n                            <Button\n                              size=\"small\"\n                              color=\"primary\"\n                              onClick={(event) => {\n                                event.stopPropagation();\n                                deleteGame(game.id);\n                              }}\n                            >\n                              Delete\n                            </Button>\n                          </CardActions>\n                        )}\n                      </Card>\n                    </Grid>\n                  );\n                })}\n              </Grid>\n            </>\n          );\n        })}\n      </div>\n      <Tour\n        accentColor={`rgb(57, 110, 158)`}\n        className=\"tour\"\n        steps={steps}\n        isOpen={isTourOpen}\n        onRequestClose={() => {\n          setIsTourOpen(false);\n        }}\n        rounded={5}\n        onAfterOpen={(target) => (document.body.style.overflowY = \"hidden\")}\n        onBeforeClose={(target) => (document.body.style.overflowY = \"auto\")}\n      />\n      <input\n        id=\"file-input\"\n        type=\"file\"\n        name=\"name\"\n        multiple\n        ref={fileDialog}\n        onChange={uploadFaction}\n        style={{ height: \"0px\", overflow: \"hidden\" }}\n      />\n    </Container>\n  );\n};\n\nexport default Games;\n","import KeyboardArrowDownIcon from '@mui/icons-material/KeyboardArrowDown';\nimport KeyboardArrowUpIcon from '@mui/icons-material/KeyboardArrowUp';\nimport RefreshIcon from '@mui/icons-material/Refresh';\nimport { IconButton, Stack, TextField } from \"@mui/material\";\nimport { isNil, toNumber } from \"lodash\";\nimport React from \"react\";\n\n\nexport const CustomToggle = React.forwardRef(({ children, onClick }, ref) => (\n  <span\n    ref={ref}\n    onClick={(e) => {\n      e.preventDefault();\n      onClick(e);\n    }}\n  >\n    {children}\n  </span>\n));\n\nexport const InputNumber = (props) => {\n  const {\n    onChange = () => {},\n    value,\n    max,\n    min,\n    style = {},\n    defaultValue = 0,\n    allowReset,\n    disabled = false,\n    label,\n    fullWidth = false\n  } = props;\n  const changeValue = (newValue) => {\n    if (!isNil(max) && newValue > max) {\n      onChange(max);\n      return;\n    } else if (!isNil(min) && newValue < min) {\n      onChange(min);\n      return;\n    }\n    onChange(newValue);\n  };\n  return (\n    <span style={style}>\n      <Stack direction=\"row\">\n        {!!allowReset && (\n          <IconButton\n            variant=\"contained\"\n            disabled={disabled}\n            size=\"small\"\n            sx={{ mr: 1, color: 'primary.main' }}\n            onClick={() => changeValue(defaultValue)}\n          >\n            <RefreshIcon />\n          </IconButton>\n        )}\n        <TextField\n          fullWidth={fullWidth}\n          label={label}\n          inputProps={{ inputMode: \"numeric\", pattern: \"[0-9]*\" }}\n          size=\"small\"\n          type=\"number\"\n          sx={{ mr: 1 }}\n          {...props}\n          onChange={(event) => {\n            changeValue(toNumber(event.target.value));\n          }}\n        />\n        <IconButton\n          variant=\"contained\"\n          sx={{ mr: 1, color: 'primary.main' }}\n          disabled={disabled || value === min}\n          size=\"small\"\n          onClick={() => changeValue(value - 1)}\n        >\n          <KeyboardArrowDownIcon />\n        </IconButton>\n        <IconButton\n          sx={{ color: 'primary.main' }}\n          variant=\"contained\"\n          disabled={disabled || value === max}\n          size=\"small\"\n          onClick={() => changeValue(value + 1)}\n        >\n          <KeyboardArrowUpIcon />\n        </IconButton>\n      </Stack>\n    </span>\n  );\n};\n","import React, { useState } from 'react';\nimport { getTextColor, hexToRgb } from 'utils/colors';\nimport { get } from 'lodash';\nimport { RuleList } from 'components/roster/rule-list';\nimport Button from '@mui/material/Button';\nimport Collapse from '@mui/material/Collapse';\nimport Table from \"@mui/material/Table\";\nimport TableBody from \"@mui/material/TableBody\";\nimport TableCell from \"@mui/material/TableCell\";\nimport TableContainer from \"@mui/material/TableContainer\";\nimport TableHead from \"@mui/material/TableHead\";\nimport { StyledTableRow } from \"components/styled-table\";\n\nexport const WeaponList = (props) => {\n  const { weapons, faction, data, toggler, rules, twoColumns = true } = props;\n  const { color: factionColor, secondary_color: factionSecondaryColor } = faction;\n  const textColor = factionColor ? getTextColor(hexToRgb(factionColor)) : 'white';\n  const textColorSecondary = factionSecondaryColor ? getTextColor(hexToRgb(factionSecondaryColor)) : 'white';\n  const borderColor = (textColor !== 'white') ? textColor : factionColor;\n  const btnStyle = { borderColor };\n  const thStyle = { backgroundColor: factionSecondaryColor || factionColor, color: factionSecondaryColor ? textColorSecondary : textColor };\n  const [showWeapons, setShowWeapons] = useState(false);\n  const renderRules = (rules) => {\n    if (!rules || !rules.length) {\n      return;\n    }\n    return (\n      <div>\n        <RuleList twoColumn={twoColumns} faction={faction} rules={rules} />\n      </div>\n    )\n  }\n  return (\n    <div>\n      {!!toggler && <div className=\"text-center\">\n        <div style={{ marginBottom: '0.5rem' }}>\n          <Button variant=\"outline-primary\" size=\"sm\" block style={btnStyle} onClick={() => setShowWeapons(!showWeapons)}>{showWeapons ? 'Hide' : 'Weapons'}</Button>\n        </div>\n      </div>}\n      <Collapse in={!toggler || showWeapons}>\n        <div>\n          <TableContainer>\n            <Table size=\"small\" aria-label=\"simple table\" style={{ padding: 0 }}>\n              <TableHead>\n                <StyledTableRow style={thStyle}>\n                  <TableCell>{\"Weapon\"}</TableCell>\n                  <TableCell className=\"text-center\">{\"Range\"}</TableCell>\n                  <TableCell className=\"text-center\">{\"A\"}</TableCell>\n                  <TableCell className=\"text-center\">{\"AP\"}</TableCell>\n                  <TableCell>{\"Special\"}</TableCell>\n                </StyledTableRow>\n              </TableHead>\n              <TableBody>\n                {weapons.map((weapon) => {\n                  if (weapon.profiles) {\n                    return weapon.profiles.map((weaponProfile) => {\n                      return (\n                        <StyledTableRow>\n                          <TableCell>\n                            {`${weapon.name} (${weaponProfile.name})`}\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            {`${weapon.short !== \"Melee\" ? `${weaponProfile.short}\"` : weaponProfile.short || '-'}/${weaponProfile.medium ? `${weaponProfile.medium}\"` : '-'}`}\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            {weaponProfile.attacks ? weaponProfile.attacks : '-'}\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            {weaponProfile.ap || '-'}\n                          </TableCell>\n                          <TableCell>\n                            {[...get(weapon, 'rules', []), ...get(weaponProfile, 'rules', [])].map((rule) => {\n                              const ruleData = data.getRule(rule.id || rule, faction);\n                              return (ruleData.inputs ? `${ruleData.name}(${ruleData.inputs.map((input) => rule[input]).join(', ')})` : ruleData.name);\n                            }).join(', ') || \"-\"}\n                          </TableCell>\n                        </StyledTableRow>\n                      )\n                    })\n                  }\n                  return (\n                    <StyledTableRow>\n                      <TableCell>\n                        {weapon.name}\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        {`${weapon.short !== \"Melee\" ? `${weapon.short}\"` : weapon.short || '-'}/${weapon.medium ? `${weapon.medium}\"` : '-'}`}\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        {weapon.attacks ? weapon.attacks : '-'}\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        {weapon.ap || '-'}\n                      </TableCell>\n                      <TableCell>\n                        {get(weapon, 'rules', []).map((rule) => {\n                          const ruleData = data.getRule(rule.id || rule, faction);\n                          return (ruleData.inputs ? `${ruleData.name}(${ruleData.inputs.map((input) => rule[input]).join(', ')})` : ruleData.name);\n                        }).join(', ') || \"-\"}\n                      </TableCell>\n                    </StyledTableRow>\n                  )\n                })}\n              </TableBody>\n            </Table>\n          </TableContainer>\n          {!!(rules && rules.length) && <>\n            {renderRules(rules)}\n          </>\n          }\n        </div>\n      </Collapse>\n    </div>\n  );\n}","import { Box, Table, TableBody, TableCell, TableContainer, TableHead, Typography } from '@mui/material';\nimport { WeaponList } from 'components/print/weapon-list';\nimport { RelicCard } from 'components/roster/relic-card';\nimport { RuleList } from 'components/roster/rule-list';\nimport { UnitCard } from 'components/roster/unit-card';\nimport { StyledTableRow } from 'components/styled-table';\nimport { find, get, orderBy, sortBy, sum, uniqBy } from 'lodash';\nimport React from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport { getTextColor, hexToRgb } from 'utils/colors';\n\nexport const PrintView = (props) => {\n  const { list, forces, data } = props;\n  const LIST_TYPES = [\n    { label: 'Competitive', value: 'competitive' },\n    { label: 'Narrative', value: 'narrative' },\n    { label: 'Campaign', value: 'campaign' }\n  ];\n  const listType = list.type || 'competitive';\n  const listTypeName = (find(LIST_TYPES, myType => myType.value === list.type) || {}).label || 'Competitive';\n  const totalForcePoints = sum(forces.map((force) => {\n    const unitPoints = sum(get(force, 'units', []).map((unit) => unit.points));\n    const legendPoints = sum(get(force, 'legends', []).map((legend) => legend.points));\n    return unitPoints + legendPoints;\n  }));\n  const totalSP = (1 + Math.ceil(totalForcePoints / 500)) - sum(forces.map((force) => force.cost));\n  const totalForceReservePoints = sum(forces.map((force) => {\n    const unitPoints = sum(get(force, 'reserves', []).map((unit) => unit.points));\n    return unitPoints;\n  }));\n  const legendLimit = Math.ceil(totalForcePoints / 500);\n  return (\n    <div>\n      <div>\n        <div>\n          <Typography\n            variant=\"h3\"\n            align=\"center\"\n            sx={{ mb: 2 }}\n          >{`${list.name}`}</Typography>\n          <Typography align=\"center\" sx={{ mb: 4 }}>\n            {`${listTypeName}, ${totalForcePoints} pts`},\n            {listType === \"campaign\"\n              ? ` ${totalForceReservePoints} pts of reserves,`\n              : \"\"}\n            {` ${totalSP} SP`},{\" \"}\n            {`${legendLimit} Legend${legendLimit > 1 ? \"s\" : \"\"}`}\n          </Typography>\n        </div>\n      </div>\n      <div>\n        {forces.map((force, index) => {\n          const forceFactionId = get(force, 'faction.id');\n          const forceSubFactionId = get(force, 'subFactionId');\n          const forceFaction = data.getFactionWithSubfaction(forceFactionId, forceSubFactionId || 'none');\n          // const forceSubfaction = data.getSubfaction(forceFactionId, forceSubFactionId || 'none');\n          const { color: factionColor, secondary_color: factionSecondaryColor } = forceFaction;\n          const textColor = factionColor ? getTextColor(hexToRgb(factionColor)) : 'white';\n          const textColorSecondary = factionSecondaryColor ? getTextColor(hexToRgb(factionSecondaryColor)) : 'white';\n          const borderColor = (textColor !== 'white') ? textColor : factionColor;\n          const btnStyle = { borderColor };\n          const thStyle = { backgroundColor: factionColor, color: textColor };\n          const thStyle2 = {\n            backgroundColor: factionSecondaryColor || factionColor,\n            color: factionSecondaryColor ? textColorSecondary : textColor,\n          };\n          const forceCategories = Object.keys(get(force, 'categories', {}));\n          const forceUnits = get(force, 'units', []);\n          const factionRelics = data.getRelics(forceFaction);\n          // const factionPowers = data.getPowers(forceFaction);\n          // const hasPowers = !isNil(forceFaction.powers) && !isEqual(forceFaction.powers, {})\n          // const factionStrategies = data.getStrategies(forceFaction);\n          const units = forceUnits || [];\n          const forceLegends = get(force, 'legends', []);\n          const filteredCategories = forceCategories.filter((catKey) => forceUnits.filter((myUnit) => myUnit.category === catKey).length);\n          const faction = forceFaction;\n          const flatWeps = units.map((unit) => {\n            return data.getWeaponList(get(unit, 'selectedWeapons', []), faction);\n          }).flat();\n          const allWeapons = uniqBy(flatWeps, (rule) => rule.id || rule);\n          const rules = uniqBy(units.map((unit) => {\n            return data.getRulesList(get(unit, 'selectedRules', []), faction)\n          }).flat(), (rule) => rule.id || rule);\n          const allWeaponRules = data.getAllWeaponRules(allWeapons, faction);\n          const weaponsRules = uniqBy(allWeaponRules, (rule) => rule.id || rule);\n          const allRules = uniqBy([...weaponsRules, ...rules], (rule) => rule.id || rule);\n          const allSortedRules = sortBy(allRules, (rule) => rule.name || rule);\n          const allSortedWeapons = sortBy(allWeapons, (weapon) => weapon.name || weapon);\n          const powerCategories = { ...data.getRawPowerCategories(faction) };\n          const allPowerSpecialties = [];\n          forces.forEach((force) => {\n            force?.units.forEach((unit) => {\n              const powerSp = unit?.powerSpecialty;\n              if (powerSp) {\n                allPowerSpecialties.push(powerSp);\n              }\n            })\n          });\n          const powerSpecialtySet = new Set(allPowerSpecialties);\n          const powers = data.getPowers(faction).filter((power) => powerSpecialtySet.has(power?.category) || !power?.category);\n          const sortedPowers = sortBy(powers, ['category', 'charge']).reverse();\n          const strategies = orderBy(data.getStrategies(faction), ['phase', 'cost'], ['desc', 'asc']);\n          const phases = { ...data.getRawPhases() };\n          return (\n            <div>\n              <div>\n                {/* <div className=\"d-flex justify-content-between align-items-center\">\n                  <h4 className=\"text-left\">{`${forceFaction.name} ${(!forceSubFactionId || forceSubFactionId === \"none\") ? '' : `(${forceSubfaction.name})`} - ${force.name}`}<small>{` (${force.cost} SP)`}</small></h4>\n                </div> */}\n                <div>\n                  {((factionRelics.length) && (!!forceLegends.length)) && <>\n                    {forceLegends.map((relic, unitIdx) => {\n\n                      return (\n                        <Box sx={{ mb: 2 }}>\n                          <RelicCard printMode faction={faction} relic={relic} data={data} />\n                        </Box>\n                      )\n                    })}\n                  </>}\n                  {filteredCategories.map((catKey, catIndex) => {\n                    // const category = data.getCategory(catKey);\n                    // const categoryData = data.getOrganizationCategory(force, catKey);\n                    // const unitCatCount = forceUnits.filter((myUnit) => myUnit.category === catKey).length;\n                    return (\n                      <>\n                        {/* <div className=\"d-flex justify-content-between  align-items-center\">\n                          <h4 style={{ margin: '0', padding: '8px 0' }} className=\"text-left\">{category.name} {listType !== 'narrative' ? `${`(${categoryData.min || 0}-${categoryData.max})`}` : ''}</h4>\n                        </div> */}\n                        {forceUnits.filter((unit) => unit.category === catKey).map((unit, unitIdx) => {\n                          // const unitOptions = get(unit, 'optionList', []);\n                          // const unitCopy = get(list, `forces[${index}].units[${unit.id}]`);\n                          const models = [...get(unit, 'models', []), ...data.getModelList(unit.selectedModels, faction)];\n                          const weapons = data.getWeaponList(unit.selectedWeapons, faction);\n                          const rules = data.getRulesList(unit.selectedRules, faction);\n                          const allWeaponRules = data.getAllWeaponRules(weapons, faction);\n                          const weaponsRules = uniqBy(allWeaponRules, (rule) => rule.id || rule);\n                          const unitSetbacks = get(unit, 'selectedSetbacks', []).map((setback) => data.getSetback(faction, setback));\n                          const unitPerks = get(unit, 'selectedPerks', []).map((perk) => data.getPerk(faction, perk));\n                          const unitLevel = Math.floor((unit.experience || 0) / 5);\n                          return (\n                            <div style={{ marginBottom: '0.5em' }}>\n                              <UnitCard\n                                printMode\n                                perks={unitPerks}\n                                level={unitLevel}\n                                setbacks={unitSetbacks}\n                                points={unit.points}\n                                models={models}\n                                weapons={weapons}\n                                faction={faction}\n                                data={data}\n                                unit={unit}\n                                rules={rules}\n                                weaponRules={weaponsRules}\n                                showOptions={false}\n                                embeddedOptions={true}\n                                unitOptions={unit.selectedOptionsList}\n                              />\n                            </div>\n                          )\n                        })}\n                      </>\n                    );\n                  })}\n                  {!!allSortedWeapons.length && <div style={{ breakInside: 'avoid', marginBottom: '15px' }}>\n                    <div className=\"unit-card\" style={btnStyle}>\n                      <div style={thStyle} className=\"unit-card-title\">\n                        <h4>Weapons</h4>\n                      </div>\n                      <div>\n                        <WeaponList faction={faction} data={data} weapons={allSortedWeapons} />\n                      </div>\n                    </div>\n                  </div>}\n                  {!!allSortedRules.length && <div style={{ breakInside: 'avoid', marginBottom: '15px' }}>\n                    <div className=\"unit-card\" style={btnStyle}>\n                      <div style={thStyle} className=\"unit-card-title\">\n                        <h4>Rules</h4>\n                      </div>\n                      <div className=\"unit-card-body\">\n                        {allSortedRules.map((rule) => (\n                          <div>\n                            <RuleList faction={faction} twoColumn={false} rules={[rule]} />\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  </div>}\n                  {!!powers.length && <div style={{ breakInside: 'avoid', marginBottom: '15px' }}>\n                    <div className=\"unit-card\" style={btnStyle}>\n                      <div style={thStyle} className=\"unit-card-title\">\n                        <h4>Powers</h4>\n                      </div>\n                      <div>\n                        <TableContainer>\n                          <Table size=\"small\" aria-label=\"simple table\" style={{ padding: 0 }}>\n                            <TableHead>\n                              <StyledTableRow style={thStyle2}>\n                                <TableCell>{\"Power\"}</TableCell>\n                                <TableCell>{\"Specialty\"}</TableCell>\n                                <TableCell align=\"center\">{\"Charge\"}</TableCell>\n                                <TableCell>{\"Description\"}</TableCell>\n                              </StyledTableRow>\n                            </TableHead>\n                            <TableBody>\n                              {sortedPowers.map((power) => {\n                                return (\n                                  <StyledTableRow>\n                                    <TableCell>\n                                      {power.name}\n                                    </TableCell>\n                                    <TableCell align=\"center\">\n                                      {get(powerCategories, `[${power.category}].name`, 'Any')}\n                                    </TableCell>\n                                    <TableCell align=\"center\">\n                                      {power.charge}\n                                    </TableCell>\n                                    <TableCell>\n                                      <ReactMarkdown children={power.description} className=\"rule-text\" />\n                                    </TableCell>\n                                  </StyledTableRow>\n                                )\n                              })}\n                            </TableBody>\n                          </Table>\n                        </TableContainer>\n                      </div>\n                    </div>\n                  </div>}\n                  {!!strategies.length && <div style={{ breakInside: 'avoid', marginBottom: '15px' }}>\n                    <div className=\"unit-card\" style={btnStyle}>\n                      <div style={thStyle} className=\"unit-card-title\">\n                        <h4>Strategies</h4>\n                      </div>\n                      <div>\n                      <TableContainer>\n                        <Table size=\"small\" aria-label=\"simple table\" style={{ padding: 0 }}>\n                          <TableHead>\n                            <StyledTableRow style={thStyle2}>\n                              <TableCell>{\"Strategy\"}</TableCell>\n                              <TableCell align=\"center\">{\"SP\"}</TableCell>\n                              <TableCell>{\"Phase\"}</TableCell>\n                              <TableCell>{\"Description\"}</TableCell>\n                            </StyledTableRow>\n                          </TableHead>\n                          <TableBody>\n                            {strategies.map((strategy) => {\n                              return (\n                                <StyledTableRow>\n                                  <TableCell>\n                                    {strategy.name}\n                                  </TableCell>\n                                  <TableCell align=\"center\">\n                                    {strategy.cost}\n                                  </TableCell>\n                                  <TableCell>\n                                    {get(phases, `[${strategy.phase}].name`, 'Activation')}\n                                  </TableCell>\n                                  <TableCell>\n                                    <ReactMarkdown children={strategy.description} className=\"rule-text\" />\n                                  </TableCell>\n                                </StyledTableRow>\n                              )\n                            })}\n                          </TableBody>\n                        </Table>\n                        </TableContainer>\n                      </div>\n                    </div>\n                  </div>}\n                  {!filteredCategories.length && <>\n                    <p>Force is empty...</p>\n                  </>}\n                </div>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  )\n}","import {\n  Button, Dialog, DialogActions, DialogContent, DialogTitle, FormControl, FormControlLabel, FormLabel, Radio, RadioGroup, Stack, TextField\n} from \"@mui/material\";\nimport {\n  get\n} from \"lodash\";\nimport React, {\n  useState\n} from \"react\";\n\nconst LIST_TYPES = [\n  { label: \"Competitive\", value: \"competitive\" },\n  { label: \"Narrative\", value: \"narrative\" },\n  // { label: \"Campaign\", value: \"campaign\" },\n];\nexport const AddList = (props) => {\n  const { hideModal, addList } = props;\n  const [listName, setListName] = useState(\"\");\n  const [listType, setListType] = useState(\"competitive\");\n  return (\n    <>\n      <Dialog open maxWidth=\"md\" fullWidth onClose={hideModal}>\n        <DialogTitle closeButton>Create Roster</DialogTitle>\n        <DialogContent>\n          <Stack spacing={2} sx={{ mt: 1 }}>\n            <FormControl>\n              <TextField\n                id=\"standard-basic\"\n                label=\"Force Name\"\n                variant=\"outlined\"\n                onChange={(value) => setListName(value.target.value)}\n                value={listName}\n              />\n            </FormControl>\n            <FormControl>\n              <FormLabel component=\"legend\">List Type</FormLabel>\n              <RadioGroup\n                row\n                aria-label=\"gender\"\n                name=\"row-radio-buttons-group\"\n                onChange={(event) => setListType(event.target.value)}\n                value={listType}\n              >\n                {LIST_TYPES.map((type, index) => (\n                  <FormControlLabel\n                    key={index}\n                    value={type.value}\n                    control={<Radio />}\n                    label={type.label}\n                  />\n                ))}\n              </RadioGroup>\n            </FormControl>\n          </Stack>\n        </DialogContent>\n        <DialogActions>\n          <Button color=\"secondary\" onClick={hideModal}>\n            Cancel\n          </Button>\n          <Button\n            color=\"primary\"\n            onClick={() => {\n              if (listName) {\n                addList(listName, { type: listType });\n                hideModal();\n              }\n            }}\n          >\n            Create\n          </Button>{\" \"}\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport const UpdateList = (props) => {\n  const { hideModal, updateList, listId, lists } = props;\n  const oldListName = get(lists, `[${listId}].name`, \"\");\n  const oldListType = get(lists, `[${listId}].type`, \"\");\n  const [listName, setListName] = useState(oldListName);\n  const [listType, setListType] = useState(oldListType || \"competitive\");\n  return (\n    <>\n      <Dialog open maxWidth=\"md\" fullWidth onClose={hideModal}>\n        <DialogTitle>\n          Roster Settings\n        </DialogTitle>\n        <DialogContent>\n          <Stack spacing={2} sx={{ mt: 1 }}>\n            <FormControl>\n              <TextField\n                id=\"standard-basic\"\n                label=\"Force Name\"\n                variant=\"outlined\"\n                onChange={(value) => setListName(value.target.value)}\n                value={listName}\n              />\n            </FormControl>\n            <FormControl>\n              <FormLabel component=\"legend\">List Type</FormLabel>\n              <RadioGroup\n                row\n                aria-label=\"gender\"\n                name=\"row-radio-buttons-group\"\n                onChange={(event) => setListType(event.target.value)}\n                value={listType}\n              >\n                {LIST_TYPES.map((type, index) => (\n                  <FormControlLabel\n                    key={index}\n                    value={type.value}\n                    control={<Radio />}\n                    label={type.label}\n                  />\n                ))}\n              </RadioGroup>\n            </FormControl>\n          </Stack>\n        </DialogContent>\n        <DialogActions>\n          <Button color=\"secondary\" onClick={hideModal}>\n            Cancel\n          </Button>\n          <Button\n            color=\"primary\"\n            onClick={() => {\n              if (listName) {\n                updateList(listId, {\n                  name: listName,\n                  type: listType,\n                });\n                hideModal();\n              }\n            }}\n          >\n            Save\n          </Button>{\" \"}\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n","export const BASE_THEME = {\n  components: {\n    MuiCardContent: {\n      styleOverrides: {\n        // Name of the slot\n        root: {\n          ':last-child': {\n            paddingBottom: '16px'\n          }\n        }\n      }\n    },\n    MuiTabScrollButton: {\n      styleOverrides: {\n        root: {\n          width: 25,\n        }\n      }\n    }\n  },\n  typography: {\n    fontFamily: [\n      'Noto Sans JP'\n    ],\n    h1: {\n      fontSize: '4rem',\n      fontWeight: 'bold'\n    },\n    h2: {\n      fontSize: '3rem',\n      fontWeight: 'bold'\n    },\n    h3: {\n      fontSize: '2.5rem',\n      fontWeight: 'bold'\n    },\n    h4: {\n      fontSize: '2rem',\n      fontWeight: 'bold'\n    },\n    h5: {\n      fontSize: '1.5rem',\n      fontWeight: 'bold'\n    },\n    h6: {\n      fontSize: '1rem',\n    }\n  },\n};","import {\n  faCheck, faChevronDown,\n  faChevronUp, faDice, faTimes\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport AddIcon from '@mui/icons-material/Add';\nimport {\n  Button, Checkbox, Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle, Divider, FormControl,\n  FormControlLabel, FormGroup, IconButton, InputLabel, List,\n  ListItem,\n  ListItemButton,\n  ListItemText,\n  ListSubheader, MenuItem, Select, TextField, Typography\n} from \"@mui/material\";\nimport Collapse from \"@mui/material/Collapse\";\nimport ProgressBar from '@mui/material/LinearProgress';\nimport useTheme from \"@mui/material/styles/useTheme\";\nimport useMediaQuery from \"@mui/material/useMediaQuery\";\nimport { Box } from \"@mui/system\";\nimport { InputNumber } from \"components/bootstrap\";\nimport { PowerCard } from \"components/roster/power-card\";\nimport { RelicCard } from \"components/roster/relic-card\";\nimport { StrategyCard } from 'components/roster/strategy-card';\nimport { UnitCard } from \"components/roster/unit-card\";\nimport {\n  find, get, groupBy, isEqual, sortBy, sum,\n  toNumber, uniqBy\n} from \"lodash\";\nimport React, { useState } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport styled from \"styled-components\";\nimport { formatLevel } from \"utils/format\";\nimport { MarkdownRenderer } from \"utils/markdown\";\nimport { getRandomItem } from \"utils/math\";\n\nconst PowerSpecialtySelector = (props) => {\n  const { data: nope, faction, onChange=() => {}, value='none' } = props;\n  const powerCats = { 'none': { name: 'None'}, ...nope.getRawPowerCategories(faction) };\n  const specialtyOptions = Object.keys(powerCats).map((cat, index) => {\n    return <MenuItem key={index} value={cat}>{powerCats[cat]?.name}</MenuItem>;\n  });\n  return (\n    <FormGroup sx={{ my: 1 }}>\n      <FormControl>\n        <InputLabel id=\"specialty-label\">Power Specialty</InputLabel>\n        <Select\n          size=\"small\"\n          labelId=\"specialty-label\"\n          id=\"specialty\"\n          value={value}\n          label=\"Power Specialty\"\n          onChange={onChange}\n        >\n          {specialtyOptions}\n        </Select>\n      </FormControl>\n    </FormGroup>\n  );\n};\n\nexport const ChooseSubFaction = (props) => {\n  const { hideModal, setSubFaction, forceId, faction } = props;\n  const rawSubfactions = Object.values(faction.subfactions || []);\n  const subfactions = [\n    {\n      id: \"none\",\n      name: \"No Focus\",\n      description:\n        \"A generalist force which can take on many different enemies.\",\n    },\n    ...rawSubfactions,\n  ];\n  const theme = useTheme();\n  const fullScreen = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  return (\n    <>\n      <Dialog open onClose={hideModal} fullScreen={fullScreen} maxWidth=\"lg\" fullWidth>\n        <DialogTitle closeButton>Change Focus</DialogTitle>\n        <DialogContent style={{ padding: 0 }} sx={{ backgroundColor: \"background.paper\" }}>\n            <List style={{ height: '100%' }}>\n              {subfactions.map((subfaction) => {\n                return (\n                  <ListItem\n                    disablePadding\n                    secondaryAction={\n                      <IconButton\n                        sx={{ color: \"primary.main\" }}\n                        onClick={() => {\n                          setSubFaction(forceId, subfaction.id);\n                          hideModal();\n                        }}\n                      >\n                        <AddIcon />\n                      </IconButton>\n                    }\n                  >\n                    <ListItemButton\n                      onClick={() => {\n                        setSubFaction(forceId, subfaction.id);\n                        hideModal();\n                      }}\n                    >\n                      <ListItemText\n                        primary={`${subfaction.name}`}\n                        secondary={`${subfaction.description}`}\n                      />\n                    </ListItemButton>\n                  </ListItem>\n                );\n              })}\n            </List>\n        </DialogContent>\n        <DialogActions>\n          <Button color=\"primary\" onClick={hideModal}>\n            Cancel\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport const AddLegend = (props) => {\n  const { hideModal, data, forceId, faction, addLegend, list } = props;\n  const legends = data.getRelics(faction);\n  const RELIC_TYPES = {\n    equipment: \"Equipment\",\n    ability: \"Abilities\",\n  };\n  const sortedLegends = sortBy(\n    legends.map((legend) => ({\n      ...legend,\n      points: data.getRelicCost(legend, faction),\n    })),\n    [\"points\", \"name\"]\n  );\n  const listType = list.type || \"competitive\";\n  const listLegendSet = new Set(\n    get(list, \"forces\", [])\n      .map((force) => get(force, \"legends\", []).map((legend) => legend.id))\n      .flat()\n  );\n  const filteredLegends =\n    listType === \"narrative\"\n      ? sortedLegends\n      : sortedLegends.filter((legend) => !listLegendSet.has(legend.id));\n  const groupedRelics = groupBy(filteredLegends, (relic) =>\n    relic.type || relic.rule ? \"ability\" : \"equipment\"\n  );\n  const theme = useTheme();\n  const fullScreen = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  return (\n    <>\n      <Dialog open onClose={hideModal} fullScreen={fullScreen} maxWidth=\"lg\" fullWidth>\n        <DialogTitle>Add Legend</DialogTitle>\n        <DialogContent style={{ padding: 0 }} sx={{ backgroundColor: \"background.paper\" }}>\n          <List style={{ height: '100%' }}>\n            {Object.keys(RELIC_TYPES)\n              .filter(\n                (type) => !!groupedRelics[type] && !!groupedRelics[type].length\n              )\n              .map((relicType) => {\n                const relicsType = get(groupedRelics, `[${relicType}]`, []);\n                const sortedRelics = sortBy(relicsType, (relic) =>\n                  data.getRelicCost(relic, faction)\n                );\n                return (\n                  <>\n                    <ListSubheader>\n                      <Typography\n                        sx={{ py: 0.5 }}\n                        fontWeight=\"bold\"\n                        variant=\"h5\"\n                      >\n                        {RELIC_TYPES[relicType]}\n                      </Typography>\n                    </ListSubheader>\n                    {sortedRelics.map((relic) => {\n                      return (\n                        <div key={relic.id}>\n                          <ListItem\n                            disablePadding\n                            secondaryAction={\n                              <IconButton\n                                sx={{ color: \"primary.main\" }}\n                                onClick={() => {\n                                  addLegend(forceId, { id: relic.id });\n                                  hideModal();\n                                }}\n                              >\n                                <AddIcon />\n                              </IconButton>\n                            }\n                          >\n                            <ListItemButton\n                              onClick={() => {\n                                addLegend(forceId, { id: relic.id });\n                                hideModal();\n                              }}\n                            >\n                              <ListItemText\n                                primary={`${relic.name} (${relic.points} pts)`}\n                                secondary={<ReactMarkdown\n                                  children={relic.description}\n                                  className=\"rule-text\"\n                                />}\n                              />\n                            </ListItemButton>\n                          </ListItem>\n                        </div>\n                      );\n                    })}\n                  </>\n                );\n              })}\n          </List>\n        </DialogContent>\n        <DialogActions>\n          <Button color=\"primary\" onClick={hideModal}>\n            Cancel\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport const AddForce = (props) => {\n  const { data, addForce, list, hideModal, userPrefs } = props;\n  const showBeta = userPrefs.showBeta;\n  const [faction, setFaction] = useState(\"\");\n  const [subFaction, setSubFaction] = useState(\"\");\n  const forces = get(list, \"forces\", []);\n  const factions = data\n    .getFactions()\n    .filter((game) =>\n      showBeta ? true : game.version && Number(game.version) >= 1\n    );\n  const organizations = data.getRawOrganizations();\n  const alliances = data.getRawAlliances();\n  const firstFaction = get(list, \"forces[0].factionId\", \"\");\n  const listAlliance = data.getFaction(firstFaction).alliance;\n  const unitCategories = groupBy(factions, \"alliance\");\n  let filteredAlliances = [...Object.keys(alliances), \"mercenaries\", undefined];\n  if (!listAlliance && forces.length > 0 && list.type !== \"narrative\") {\n    filteredAlliances = [\"mercenaries\", undefined];\n  } else if (listAlliance && forces.length > 0 && list.type !== \"narrative\") {\n    filteredAlliances = [\n      ...Object.keys(alliances).filter((alliance) => alliance === listAlliance),\n      \"mercenaries\",\n    ];\n  }\n  const categoryOrder = filteredAlliances.filter(\n    (cat) => unitCategories[cat] && unitCategories[cat].length\n  );\n  // Subfactions\n  const rawSubfactions = Object.values(\n    data.getFaction(faction).subfactions || []\n  );\n  const hasSubfactions = !!rawSubfactions.length;\n  const subfactions = [\n    {\n      id: \"none\",\n      name: \"No Focus\",\n      description:\n        \"A generalist force which can take on many different enemies.\",\n    },\n    ...rawSubfactions,\n  ];\n  const theme = useTheme();\n  const fullScreen = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  return (\n    <>\n      <Dialog\n        open\n        fullScreen={fullScreen}\n        fullWidth\n        onClose={hideModal}\n        maxWidth=\"lg\"\n      >\n        {!faction && (\n          <>\n            <DialogTitle closeButton>Choose Faction</DialogTitle>\n            <DialogContent sx={{ backgroundColor: \"background.paper\" }} style={{ padding: 0 }}>\n              <List>\n                {categoryOrder.map((allianceKey) => {\n                  const theFactions = sortBy(\n                    get(unitCategories, `[${allianceKey}]`, []),\n                    \"name\"\n                  );\n                  const filteredFactions =\n                    forces.length > 0 &&\n                      !listAlliance &&\n                      list.type !== \"narrative\"\n                      ? theFactions.filter(\n                        (faction) => faction.id === firstFaction\n                      )\n                      : theFactions;\n                  const allianceData = data.getAlliance(allianceKey);\n                  return (\n                    <>\n                      <ListSubheader>\n                        <Typography\n                          sx={{ py: 0.5 }}\n                          fontWeight=\"bold\"\n                          variant=\"h5\"\n                        >\n                          {allianceData.name || \"Unaligned\"}\n                        </Typography>\n                      </ListSubheader>\n                      {Object.keys(filteredFactions).map((orgKey) => {\n                        const org = filteredFactions[orgKey];\n                        return (\n                          <ListItem\n                            disablePadding\n                            secondaryAction={\n                              <IconButton\n                                sx={{ color: \"primary.main\" }}\n                                onClick={() => {\n                                  setFaction(org.id);\n                                }}\n                              >\n                                <AddIcon />\n                              </IconButton>\n                            }\n                          >\n                            <ListItemButton\n                              onClick={() => {\n                                setFaction(org.id);\n                              }}\n                            >\n                              <ListItemText\n                                primary={\n                                  <>\n                                    {`${org.name}`}\n                                    <small>\n                                      {org.version ? ` (${org.version})` : \"\"}\n                                    </small>\n                                  </>\n                                }\n                                secondary={<>{`${org.description || \"\"}`}</>}\n                              />\n                            </ListItemButton>\n                          </ListItem>\n                        );\n                      })}\n                    </>\n                  );\n                })}\n              </List>\n            </DialogContent>\n            <DialogActions>\n              <Button color=\"primary\" onClick={hideModal}>\n                Cancel\n              </Button>\n            </DialogActions>\n          </>\n        )}\n        {!!faction && (subFaction || !hasSubfactions) && (\n          <>\n            <DialogTitle closeButton>Add Force Organization</DialogTitle>\n            <DialogContent style={{ padding: 0 }} sx={{ backgroundColor: \"background.paper\" }}>\n              <List style={{ height: '100%' }}>\n                {Object.keys(organizations).map((orgKey) => {\n                  const org = organizations[orgKey];\n                  return (\n                    <ListItem\n                      disablePadding\n                      secondaryAction={\n                        <IconButton\n                          sx={{ color: \"primary.main\" }}\n                          onClick={() => {\n                            addForce({\n                              id: orgKey,\n                              factionId: faction,\n                              subFactionId: subFaction || \"none\",\n                            });\n                            hideModal();\n                          }}\n                        >\n                          <AddIcon />\n                        </IconButton>\n                      }\n                    >\n                      <ListItemButton\n                        onClick={() => {\n                          addForce({\n                            id: orgKey,\n                            factionId: faction,\n                            subFactionId: subFaction || \"none\",\n                          });\n                          hideModal();\n                        }}\n                      >\n                        <ListItemText\n                          primary={`${org.name} (Cost ${org.cost})`}\n                          secondary={`${org.description}`}\n                        />\n                      </ListItemButton>\n                    </ListItem>\n                  );\n                })}\n              </List>\n            </DialogContent>\n            <DialogActions>\n              <Button\n                color=\"secondary\"\n                onClick={() => {\n                  hasSubfactions ? setSubFaction(\"\") : setFaction(\"\");\n                }}\n              >\n                Back\n              </Button>\n              <Button color=\"primary\" onClick={hideModal}>\n                Cancel\n              </Button>\n            </DialogActions>\n          </>\n        )}\n        {hasSubfactions && !subFaction && !!faction && (\n          <>\n            <DialogTitle closeButton>Choose Focus</DialogTitle>\n            <DialogContent style={{ padding: 0 }} sx={{ backgroundColor: \"background.paper\" }}>\n              <List style={{ height: '100%' }}>\n                {subfactions.map((subfaction) => {\n                  return (\n                    <ListItem\n                      disablePadding\n                      secondaryAction={\n                        <IconButton\n                          sx={{ color: \"primary.main\" }}\n                          onClick={() => {\n                            setSubFaction(subfaction.id);\n                          }}\n                        >\n                          <AddIcon />\n                        </IconButton>\n                      }\n                    >\n                      <ListItemButton\n                        onClick={() => {\n                          setSubFaction(subfaction.id);\n                        }}\n                      >\n                        <ListItemText\n                          primary={`${subfaction.name}`}\n                          secondary={`${subfaction.description}`}\n                        />\n                      </ListItemButton>\n                    </ListItem>\n                  );\n                })}\n              </List>\n            </DialogContent>\n            <DialogActions>\n              <Button\n                color=\"secondary\"\n                onClick={() => {\n                  setFaction(\"\");\n                }}\n              >\n                Back\n              </Button>\n              <Button color=\"primary\" onClick={hideModal}>\n                Cancel\n              </Button>\n            </DialogActions>\n          </>\n        )}\n      </Dialog>\n    </>\n  );\n};\n\nexport const AddUnit = (props) => {\n  const { hideModal, data, units, faction, addUnit, forceId } = props;\n  const theme = useTheme();\n  const fullScreen = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  const sortedUnits = sortBy(\n    units.map((unit) => ({\n      ...unit,\n      points: data.getUnitPoints(unit, faction),\n    })),\n    [\"points\", \"name\"]\n  );\n  return (\n    <>\n      <Dialog open onClose={hideModal} fullScreen={fullScreen} maxWidth=\"lg\" fullWidth>\n        <DialogTitle closeButton>\n          Add Unit\n        </DialogTitle>\n        <DialogContent style={{ padding: 0 }} sx={{ backgroundColor: \"background.paper\" }}>\n          <List>\n            {sortedUnits.map((unit, index) => {\n              return (\n                <ListItem\n                  key={index}\n                  disablePadding\n                  secondaryAction={\n                    <IconButton\n                      sx={{ color: \"primary.main\" }}\n                      onClick={() => {\n                        addUnit(forceId, { id: unit.id });\n                        hideModal();\n                      }}\n                    >\n                      <AddIcon />\n                    </IconButton>\n                  }\n                >\n                  <ListItemButton\n                    onClick={() => {\n                      addUnit(forceId, { id: unit.id });\n                      hideModal();\n                    }}\n                  >\n                    <ListItemText\n                      primary={`${unit.name} (${unit.points} pts)`}\n                      secondary={`${unit.description}`}\n                    />\n                  </ListItemButton>\n                </ListItem>\n              );\n            })}\n          </List>\n        </DialogContent>\n        <DialogActions>\n          <Button color=\"primary\" onClick={hideModal}>\n            Cancel\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport const ViewStrategies = (props) => {\n  const { hideModal, data, faction } = props;\n  const strategies = data.getStrategies(faction);\n  const phases = { ...data.getRawPhases() };\n  const unitPhases = { ...groupBy(strategies, \"phase\") };\n  const phaseOrder = [...Object.keys(phases), undefined].filter(\n    (cat) => unitPhases[cat] && unitPhases[cat]\n  );\n  const theme = useTheme();\n  const fullScreen = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  return (\n    <>\n      <Dialog open onClose={hideModal} maxWidth=\"lg\" fullWidth fullScreen={fullScreen}>\n        <DialogTitle closeButton>\n          Strategies\n        </DialogTitle>\n        <DialogContent sx={{ backgroundColor: \"background.paper\" }}>\n          {phaseOrder.map((phaseId, phaseIndex) => {\n            const phaseStrategies = get(unitPhases, `[${phaseId}]`, []).map(\n              (strat) => ({ ...strat, sourceLength: strat.source.length })\n            );\n            const sortedStrategies = sortBy(phaseStrategies, [\n              \"sourceLength\",\n              \"source\",\n              \"cost\",\n            ]);\n            const phaseData = data.getPhase(phaseId);\n            return (\n              <div key={phaseIndex}>\n                <Typography\n                  sx={{ my: 2 }}\n                  variant=\"h5\"\n                  component=\"div\"\n                  align=\"center\"\n                >\n                  {phaseData.name || \"Any Phase\"}\n                </Typography>\n                <div className=\"two-columns\">\n                  {sortedStrategies.map((strategy, index) => (\n                    <div key={index} className=\"no-break\">\n                      <Box sx={{ mb: 2 }}>\n                        <StrategyCard strategy={strategy} faction={faction} />\n                      </Box>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            );\n          })}\n        </DialogContent>\n        <DialogActions>\n          <Button color=\"primary\" onClick={hideModal}>\n            Done\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport const ViewPowers = (props) => {\n  const { hideModal, data, faction, powerSpecialties } = props;\n  const powerCatSet = new Set(powerSpecialties);\n  const strategies = data.getPowers(faction);\n  const phases = { ...data.getRawPowerCategories(faction) };\n  const unitPhases = { ...groupBy(strategies, \"category\") };\n  const phaseOrder = [undefined, ...Object.keys(phases)].filter(\n    (cat) => unitPhases[cat] && unitPhases[cat]\n  ).filter((cat) => powerCatSet.has(cat) || !cat);\n  const theme = useTheme();\n  const fullScreen = useMediaQuery(theme.breakpoints.down(\"md\"));\n  return (\n    <Dialog open onClose={hideModal} maxWidth=\"lg\" fullWidth fullScreen={fullScreen}>\n      <DialogTitle closeButton>\n        Powers\n      </DialogTitle>\n      <DialogContent sx={{ backgroundColor: 'background.paper' }}>\n        <>\n          {!strategies.length && <p>{\"No strategies found...\"}</p>}\n          {phaseOrder.map((phaseId, phaseIdx) => {\n            const phaseStrategies = get(unitPhases, `[${phaseId}]`, []).map(\n              (strat) => ({ ...strat, sourceLength: strat.source.length })\n            );\n            const sortedStrategies = sortBy(phaseStrategies, [\n              \"sourceLength\",\n              \"source\",\n              \"charge\",\n            ]);\n            const phaseData = data.getPowerCategory(phaseId, faction);\n            return (\n              <>\n                <div key={phaseIdx}>\n                  <Typography\n                    sx={{ my: 2 }}\n                    variant=\"h4\"\n                    component=\"div\"\n                    align=\"center\"\n                  >\n                    {phaseData.name || \"Any Specialty\"}\n                  </Typography>\n                </div>\n                <div className=\"two-columns\">\n                  {sortedStrategies.map((power, index) => (\n                    <div key={index} className=\"no-break\">\n                      <Box sx={{ mb: 2 }}>\n                        <PowerCard faction={faction} power={power} />\n                      </Box>\n                    </div>\n                  ))}\n                </div>\n              </>\n            );\n          })}\n        </>\n      </DialogContent>\n      <DialogActions>\n        <Button color=\"primary\" onClick={hideModal}>\n          Done\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport const ViewUnit = (props) => {\n  const { hideModal, data, unit, faction } = props;\n  const models = [\n    ...get(unit, \"models\", []),\n    ...data.getModelList(unit.selectedModels, faction),\n  ];\n  const weapons = data.getWeaponList(unit.selectedWeapons, faction);\n  const rules = data.getRulesList(unit.selectedRules, faction);\n  const allWeaponRules = data.getAllWeaponRules(weapons, faction);\n  const weaponsRules = uniqBy(allWeaponRules, (rule) => rule.id || rule);\n  const unitSetbacks = get(unit, \"selectedSetbacks\", []).map((setback) =>\n    data.getSetback(faction, setback)\n  );\n  const unitPerks = get(unit, \"selectedPerks\", []).map((perk) =>\n    data.getPerk(faction, perk)\n  );\n  const unitLevel = Math.floor((unit.experience || 0) / 5);\n  const theme = useTheme();\n  const fullScreen = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  const unitPowerSpecialty = unit?.powerSpecialty ? data.getPowerCategory(unit?.powerSpecialty, faction)?.name : undefined;\n  return (\n    <>\n      <Dialog open maxWidth=\"lg\" fullScreen={fullScreen} onClose={hideModal}>\n        <DialogTitle>\n          View Unit\n        </DialogTitle>\n        <DialogContent sx={{ p: 1, backgroundColor: 'background.paper' }}>\n          <Box sx={{ mt: 1 }}>\n          <UnitCard\n            toggler={false}\n            points={unit.points}\n            models={models}\n            weapons={weapons}\n            faction={faction}\n            data={data}\n            unit={unit}\n            rules={rules}\n            setbacks={unitSetbacks}\n            powerSpecialty={unitPowerSpecialty}\n            perks={unitPerks}\n            level={unitLevel}\n            weaponRules={weaponsRules}\n            showOptions={false}\n            embeddedOptions={true}\n            unitOptions={unit.selectedOptionsList}\n          />\n          </Box>\n        </DialogContent>\n        <DialogActions>\n          <Button color=\"primary\" onClick={hideModal}>\n            Close\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nconst injuryText = `\n# Injuries\nWhen this model would be killed, roll a D10 adding the amount it failed the save by plus the number of critical damage tokens it has and refer to the following:\n\n* Shaken(5+): Take one additional shock.\n* Panic(8+): Take 2 additional shock and immediately take a Courage test. If failed the unit is destroyed.\n* Destroyed(10+): It is instantly destroyed.\n\nMark each time the unit rolls on the chart with a critical damage token. While a unit has one or more damage tokens, it may not remove that amount of Shock.\n`;\n\nexport const ViewInjuryTable = (props) => {\n  const { hideModal } = props;\n  const theme = useTheme();\n  const fullScreen = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  return (\n    <>\n      <Dialog open maxWidth=\"lg\" fullScreen={fullScreen} onClose={hideModal}>\n        <DialogTitle closeButton>\n          <DialogTitle>Injury Chart</DialogTitle>\n        </DialogTitle>\n        <DialogContent>\n          <ReactMarkdown className=\"rule-text\" children={injuryText} />\n        </DialogContent>\n        <DialogActions>\n          <Button color=\"primary\" onClick={hideModal}>\n            Done\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nconst actionReference = `\n# Actions\nThe following actions are available to all units.\n\n### Focus\nThe unit focuses and gains +1 Accuracy and Strength with its next attack.\n### Shoot\nThe unit attacks with all equipped Ranged weapons. Units may only shoot once per round.\n### Fight\nThe unit fights will all equipped melee weapons in close combat. A unit may only fight once per round. If a unit has no Melee weapons, it may not perform Fight actions.\n### Move\nAll models in the unit move up to their movement characteristic.\n#### Rushing\nWhen performing a move action, a unit may attempt to rush. The unit takes an Initiative skill check. If passed, the unit may move an additional number of inches equal to half its movement characteristic rounded down with that Move action. If failed, the unit takes a Shock at the end of the Move and does not gain any benefit. Units may never rush across obstacles or through difficult terrain.\n### Charge\nThe unit declares a target and makes a move action into base contact with it and may make a free fight action. A unit may not charge if already in close combat. A unit may only use a Charge action if it is in range of an enemy unit it can reach with its move action.\n### Hold\nThe unit prepares itself and may perform a reaction later in the round. It may automatically perform an Overwatch or Counter Attack reaction without having to test. All other reactions will require the unit to test.\n### Evade\nThe unit attemps to evade incoming attacks. Mark that the unit has Evaded with a token. When the unit is targeted by a Shooting or Fighting attack, that unit may spend the token to gain +1 Save against that attack.\n### Rally\nThe unit attempts to regroup and prepare to fight on. Roll a Courage check for each Shock on the unit and any successes remove one Shock.\n\n# Reactions\nUnits may make any of the following reactions.\n\n### Dodge\nWhen a unit is targeted by an attack it may attempt a Dodge reaction. With a Dodge reaction, a unit attempts to dodge out of the way of the attack and avoid being hit. If successful, immediately make an Evade action.\n\n### Overwatch\nUnits may react when a Charge action is declared against them or a Move action is performed in their line of sight by attempting an Overwatch reaction. If successful, the unit may make a full shooting attack against the Charging or Moving unit measured from any point in the unit's Move. A unit that is on Hold may automatically perform an Overwatch reaction. No test is required for this reaction as a Hold action has already been performed.\n\n### Counter Attack\nWhen a Fight or Shoot action is declared against a unit, it may attempt a Counter Attack reaction. If successful, the unit may simultaneously make a Fight or Shoot action against the attacking unit. A unit that is on Hold may automatically perform a Counter Attack reaction against an enemy unit that Fights or Shoots it. No test is required for this reaction as a Hold action has already been performed.\n\n### Escape\nWhen a Fight, Shoot, or Charge action is declared against a unit, it may attempt an Escape reaction. If successful, the target unit may make a full move action before the Shoot, Fight or Charge action is performed.\n`;\nconst ReferenceRules = styled.div`\n  h1 {\n    font-size: 18pt;\n    font-weight: bold;\n    padding-bottom: 0.25rem;\n  }\n  h2 {\n    font-size: 16pt;\n    margin-top: 0.5em;\n    padding-bottom: 0.25rem;\n  }\n  h3 {\n    font-size: 14pt;\n  }\n  h4 {\n    font-weight: bold;\n    font-size: 12pt;\n  }\n  h5 {\n    font-weight: bold;\n    font-size: 12pt;\n  }\n  p {\n    break-inside: \"avoid-column\";\n    page-break-inside: avoid; /* For Firefox. */\n    -webkit-column-break-inside: avoid; /* For Chrome & friends. */\n    break-inside: avoid; /* For standard browsers like IE. :-) */\n  }\n`;\n\nexport const ViewActionReference = (props) => {\n  const { hideModal, isSkirmish } = props;\n  const theme = useTheme();\n  const fullScreen = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  const rules = isSkirmish ? injuryText + actionReference : actionReference;\n  return (\n    <>\n      <Dialog open maxWidth=\"lg\" fullScreen={fullScreen} onClose={hideModal}>\n        <DialogTitle>Rules Reference</DialogTitle>\n        <DialogContent>\n          <ReferenceRules>\n            <ReactMarkdown\n              className=\"reference-text\"\n              children={rules}\n            />\n          </ReferenceRules>\n        </DialogContent>\n        <DialogActions>\n          <Button color=\"primary\" onClick={hideModal}>\n            Done\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\nconst StyledRules = styled.div`\n  h1 {\n    font-size: 20pt;\n    font-weight: bold;\n    border-bottom: 4px solid rgb(57, 110, 158);\n    padding-bottom: 0.25rem;\n  }\n  h2 {\n    font-size: 18pt;\n    border-bottom: 2px solid rgb(57, 110, 158);\n    padding-bottom: 0.25rem;\n  }\n  h3 {\n    font-size: 16pt;\n  }\n  h4 {\n    font-weight: bold;\n    font-size: 12pt;\n  }\n  h5 {\n    font-weight: bold;\n    font-size: 12pt;\n  }\n  p {\n    break-inside: \"avoid-column\";\n    page-break-inside: avoid; /* For Firefox. */\n    -webkit-column-break-inside: avoid; /* For Chrome & friends. */\n    break-inside: avoid; /* For standard browsers like IE. :-) */\n  }\n`;\n\nexport const ViewFullRules = (props) => {\n  const { rawData, game, hideModal } = props;\n  const { gameRules, skirmishRules } = rawData;\n  const gameType = get(game, \"gameType\", \"battle\");\n  const gameTypeData = get(rawData, `gameData.gameTypes[${gameType}]`, {});\n  const gameTypeName = get(gameTypeData, \"name\", \"Unknown Game\");\n  const isSkirmish = isEqual(gameType, \"battle\");\n  const rules = isSkirmish ? gameRules : skirmishRules;\n  const mdRenderer = React.useMemo(() => MarkdownRenderer(), []);\n  return (\n    <>\n      <Dialog open onClose={hideModal}>\n        <DialogTitle closeButton>\n          <DialogTitle>{`${gameTypeName} Rules`}</DialogTitle>\n        </DialogTitle>\n        <DialogContent>\n          <StyledRules>\n            <ReactMarkdown renderers={mdRenderer} children={rules} />\n          </StyledRules>\n        </DialogContent>\n        <DialogActions>\n          <Button color=\"primary\" onClick={hideModal}>\n            Done\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport const ViewLegend = (props) => {\n  const { hideModal, data, faction, legend: relic } = props;\n  const theme = useTheme();\n  const fullScreen = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  return (\n    <Dialog open maxWidth=\"lg\" onClose={hideModal} fullScreen={fullScreen}>\n      <DialogTitle>\n        View Legend\n      </DialogTitle>\n      <DialogContent sx={{ p: 1, backgroundColor: \"background.paper\" }}>\n        <Box sx={{ mt: 1 }} height=\"100%\" display=\"flex\" justifyContent=\"center\" alignItems=\"center\">\n          <RelicCard faction={faction} relic={relic} data={data} />\n        </Box>\n      </DialogContent>\n      <DialogActions>\n        <Button color=\"primary\" onClick={hideModal}>\n          Done\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport const EditUnit = (props) => {\n  const {\n    hideModal,\n    data,\n    getUnit,\n    faction,\n    setUnitOptions,\n    setUnitPowerSpecialty,\n    setUnitName,\n    forceId,\n    unitId\n  } = props;\n  const unit = getUnit(forceId, unitId);\n  const options = get(unit, \"optionList\", []);\n  const selectedOptions = get(unit, \"selectedOptions\", []);\n  const unitModels = sum(Object.values(get(unit, \"modelCounts\", {})));\n  const theme = useTheme();\n  const fullScreen = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  const hasPowerRule = find(get(unit, 'selectedRules', []), (rule) => rule.id === 'power' || rule === 'power');\n  if (!unit) {\n    return <div></div>;\n  }\n  const renderOption = (option, index) => {\n    if (option.list) {\n      return (\n        <>\n          {option.list.length !== 1 && <div>{`${option.option}: `}</div>}\n          {option.list.map((opt, optIndex) => {\n            const limit = opt.limit;\n            const choiceLimit = opt.choiceLimit;\n            // Get total selected choices minus the current context\n            const selectedChoices = sum(\n              selectedOptions[index].filter((option, idx) => idx !== optIndex)\n            );\n            const changeFuncCheck = () => {\n              const val = selectedOptions[index][optIndex];\n              const newVal = val === 0 ? 1 : 0;\n              if (selectedChoices + newVal > choiceLimit) {\n                return;\n              }\n              selectedOptions[index][optIndex] = newVal;\n              setUnitOptions(forceId, unitId, selectedOptions);\n            };\n            const changeFunc = (newValue) => {\n              const value = toNumber(newValue);\n              if (selectedChoices + value > choiceLimit) {\n                return;\n              }\n              selectedOptions[index][optIndex] = value;\n              setUnitOptions(forceId, unitId, selectedOptions);\n            };\n            const value = selectedOptions[index][optIndex];\n            const shouldDisable = selectedChoices >= choiceLimit && value === 0;\n            return (\n              <>\n                {!choiceLimit && limit === 0 && (\n                  <FormGroup\n                    controlId={`${index}${optIndex}`}\n                  >\n                    <FormControlLabel control={\n                      <Checkbox\n                        type=\"checkbox\"\n                        color=\"primary\"\n                        checked={value}\n                        disabled={shouldDisable}\n                        onChange={changeFuncCheck}\n                      />\n                    } label={`${option.list.length === 1 ? option.option : \"\"\n                      } ${opt.text}`} />\n                  </FormGroup>\n                )}\n                {limit > 1 && choiceLimit > 1 && (\n                  <FormGroup\n                    controlId={`${index}${optIndex}`}\n                    sx={{ mb: 1 }}\n                  >\n                    <label style={{ marginBottom: 0 }}>\n                      {option.list.length === 1 && <>{option.option}</>}{\" \"}\n                      {opt.text}\n                    </label>\n                    <InputNumber\n                      fullWidth\n                      min={0}\n                      max={limit}\n                      type=\"number\"\n                      color=\"primary\"\n                      disabled={shouldDisable}\n                      value={value}\n                      onChange={changeFunc}\n                    />\n                  </FormGroup>\n                )}\n                {(choiceLimit === 1 || limit === 1) && (\n                  <FormGroup\n                    controlId={`${index}${optIndex}`}\n                  >\n                    <FormControlLabel control={\n                      <Checkbox\n                        type=\"checkbox\"\n                        color=\"primary\"\n\n                        checked={value}\n                        disabled={shouldDisable}\n                        onChange={changeFuncCheck}\n                      />}\n                      label={`${option.list.length === 1 ? option.option : \"\"\n                        } ${opt.text}`} />\n                  </FormGroup>\n                )}\n              </>\n            );\n          })}\n        </>\n      );\n    }\n    return <></>;\n  };\n  return (\n    <>\n      <Dialog open onClose={hideModal} fullScreen={fullScreen} maxWidth=\"lg\" fullWidth>\n        <DialogTitle>\n          {`${unit.customName || unit.name} `}{\" \"}\n          <small>\n            {`(${unitModels} ${unitModels > 1 ? \"models\" : \"model\"})`}{\" \"}\n            {`(${unit.points} pts)`}\n          </small>\n        </DialogTitle>\n        <DialogContent>\n          <FormControl fullWidth sx={{ mt: 2 }}>\n            <TextField\n              fullWidth\n              size=\"small\"\n              label=\"Custom Name\"\n              value={unit.customName}\n              onChange={(event) =>\n                setUnitName(forceId, unitId, event.target.value)\n              }\n            />\n            {/* <InputGroup.Append addonType=\"append\">\n                <Button size=\"sm\" color=\"primary\" onClick={() => { setShowNameLists(!showNameLists) }}>\n                {!showNameLists && <FontAwesomeIcon icon={faArrowDown} />}\n                {!!showNameLists && <FontAwesomeIcon icon={faArrowUp} />}\n                <FontAwesomeIcon style={{ marginLeft: '5px' }} icon={faDice} />\n              </Button>\n            </InputGroup.Append> */}\n            <Divider />\n          </FormControl>\n          {/* <FormGroup>\n            <Collapse in={showNameLists}>\n              <div style={{ maxHeight: '300px', overflowY: 'auto'}}>\n                <div className=\"d-flex align-items-center flex-wrap\">\n                  {nameLists.map((nameList) => {\n                    const maleNames = get(nameList, 'male.first', []);\n                    const femaleNames = get(nameList, 'female.first', []);\n                    return (\n                      <div>\n                        <Button size=\"sm\" className=\"grid-button\" color=\"primary\" onClick={() => {setUnitName(forceId, unitId, data.getRandomName(nameList.id))}}>\n                        {`${nameList.name}`} Any <FontAwesomeIcon icon={faDice} />\n                        </Button>\n                        {!!maleNames.length && <Button size=\"sm\" className=\"grid-button\" color=\"primary\" onClick={() => {setUnitName(forceId, unitId, data.getRandomMaleName(nameList.id))}}>\n                        {`${nameList.name}`} Male <FontAwesomeIcon icon={faDice} />\n                        </Button>}\n                        {!!femaleNames.length && <Button size=\"sm\" className=\"grid-button\" color=\"primary\" onClick={() => {setUnitName(forceId, unitId, data.getRandomFemaleName(nameList.id))}}>\n                        {`${nameList.name}`} Female <FontAwesomeIcon icon={faDice} />\n                        </Button>}\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            </Collapse>\n          </FormGroup> */}\n          <FormGroup>\n            <div>\n              {!!hasPowerRule && <div>\n                <div className=\"d-flex justify-content-center flex-column\">\n                  <PowerSpecialtySelector value={unit?.powerSpecialty} onChange={(event) => setUnitPowerSpecialty(forceId, unitId, event.target.value)} data={data} faction={faction} />\n                </div>\n                <Divider />\n              </div>}\n              {options.map((option, index) => {\n                return (\n                  <div>\n                    <div className=\"d-flex justify-content-center flex-column\">\n                      {renderOption(option, index)}\n                    </div>\n                    <Divider />\n                  </div>\n                );\n              })}\n            </div>\n          </FormGroup>\n        </DialogContent>\n        <DialogActions>\n          <Button\n            color=\"primary\"\n            onClick={() => {\n              hideModal();\n            }}\n          >\n            Done\n          </Button>{\" \"}\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport const EditUnitCampaign = (props) => {\n  const {\n    hideModal,\n    data,\n    getUnit,\n    faction,\n    setUnitPerks,\n    setUnitSetbacks,\n    forceId,\n    unitId,\n    updateUnit,\n  } = props;\n  const [showPerkLevel, setShowPerkLevel] = useState({});\n  const unit = getUnit(forceId, unitId);\n  const unitPerks = get(unit, \"selectedPerks\", []);\n  const unitSetbacks = get(unit, \"selectedSetbacks\", []);\n  const unitPerksData = unitPerks.map((perk) => {\n    return { id: perk, ...data.getPerk(faction, perk) };\n  });\n  const unitSetbacksData = unitSetbacks.map((setback) => {\n    return { id: setback, ...data.getSetback(faction, setback) };\n  });\n  const selectedSetbacks = new Set(unitSetbacks);\n  const selectedPerks = new Set(unitPerks);\n  const setbacks = data.getSetbacks(faction);\n  const filteredSetbacks = setbacks.filter(\n    (setback) => !selectedSetbacks.has(setback.id)\n  );\n  const getRandomSetback = () => {\n    return get(getRandomItem(filteredSetbacks), \"id\");\n  };\n  const perks = data.getPerks(faction);\n  const perksByLevel = groupBy(perks, \"level\");\n  const perkOrder = Object.keys(perksByLevel);\n  const unitExperience = unit.experience || 0;\n  const levelProgress = unitExperience % 5;\n  const unitLevel = Math.floor((unit.experience || 0) / 5);\n  const formattedLevel = formatLevel(unitLevel);\n  const perksLeft =\n    unitLevel - (sum(unitPerksData.map((perk) => perk.level)) || 0);\n  const canGetPerk = (level) => {\n    return perksLeft - level >= 0;\n  };\n  if (!unit) {\n    return <div></div>;\n  }\n  return (\n    <>\n      <Dialog open onClose={hideModal}>\n        <DialogTitle closeButton>\n          <DialogTitle>\n            {`${unit.customName || unit.name}`}{\" \"}\n            <small>\n              {`(${unit.points} pts)`}\n              {unitLevel > 0 ? ` (${formattedLevel})` : \"\"}\n            </small>\n          </DialogTitle>\n        </DialogTitle>\n        <DialogContent>\n          <div>\n            <h4 className=\"text-left\">\n              <b>{\"Level Progress\"}</b>\n            </h4>\n            <ProgressBar\n              style={{ height: \"2em\" }}\n              now={levelProgress}\n              min={0}\n              max={5}\n              label={`${levelProgress} xp`}\n            />\n            <Divider />\n            <div>\n              <Button\n                size=\"sm\"\n                style={{ marginRight: \"5px\" }}\n                color=\"primary\"\n                onClick={() =>\n                  updateUnit(forceId, unitId, {\n                    experience: Math.max((unit.experience || 0) - 5, 0),\n                  })\n                }\n              >\n                {\"-5 xp\"}\n              </Button>\n              <Button\n                size=\"sm\"\n                style={{ marginRight: \"5px\" }}\n                color=\"primary\"\n                onClick={() =>\n                  updateUnit(forceId, unitId, {\n                    experience: Math.max((unit.experience || 0) - 1, 0),\n                  })\n                }\n              >\n                {\"-1 xp\"}\n              </Button>\n              <Button\n                size=\"sm\"\n                style={{ marginRight: \"5px\" }}\n                color=\"primary\"\n                onClick={() =>\n                  updateUnit(forceId, unitId, {\n                    experience: Math.max((unit.experience || 0) + 1, 0),\n                  })\n                }\n              >\n                {\"+1 xp\"}\n              </Button>\n              <Button\n                size=\"sm\"\n                style={{ marginRight: \"5px\" }}\n                color=\"primary\"\n                onClick={() =>\n                  updateUnit(forceId, unitId, {\n                    experience: Math.max((unit.experience || 0) + 5, 0),\n                  })\n                }\n              >\n                {\"+5 xp\"}\n              </Button>\n              <hr />\n            </div>\n          </div>\n          <div>\n            <h4 className=\"text-left\">\n              <b>{\"Injuries\"}</b>\n            </h4>\n            {unitSetbacksData.map((setback) => {\n              const setbackCost = data.resolvePoints(setback.points, { unit });\n              return (\n                <div>\n                  <div className=\"d-flex justify-content-between align-items-center\">\n                    <span className=\"text-left\">\n                      <b>{`${setback.name} (${setbackCost} pts)`}</b>\n                      <p\n                        style={{ marginBottom: 0, marginRight: \"5px\" }}\n                        className=\"text-left\"\n                      >{`${setback.description}`}</p>\n                    </span>\n                    <div className=\"d-flex justify-content-end\">\n                      <Button\n                        style={{}}\n                        color=\"primary\"\n                        onClick={() => {\n                          selectedSetbacks.delete(setback.id);\n                          updateUnit(forceId, unitId, {\n                            experience: Math.max((unit.experience || 0) - 5, 0),\n                            selectedSetbacks: Array.from(selectedSetbacks),\n                          });\n                        }}\n                      >\n                        {\"-5 xp\"}\n                      </Button>\n                    </div>\n                  </div>\n                  <hr />\n                </div>\n              );\n            })}\n            {!!filteredSetbacks.length && (\n              <Button\n                color=\"primary\"\n                onClick={() => {\n                  selectedSetbacks.add(getRandomSetback());\n                  setUnitSetbacks(\n                    forceId,\n                    unitId,\n                    Array.from(selectedSetbacks)\n                  );\n                }}\n              >\n                Generate <FontAwesomeIcon icon={faDice} />\n              </Button>\n            )}\n          </div>\n          <hr />\n          <div>\n            {perkOrder.map((level) => {\n              const thePerks = sortBy(\n                get(perksByLevel, `[${level}]`, []),\n                \"name\"\n              );\n              const availablePerks = Math.floor(perksLeft / level);\n              return (\n                <>\n                  <div>\n                    <div className=\"d-flex justify-content-between align-items-center\">\n                      <span className=\"text-left\">\n                        <h4 className=\"text-left\" style={{ marginBottom: 0 }}>\n                          <b>{`${formatLevel(level)} Perks`}</b>{\" \"}\n                          <small className=\"badge badge-secondary\">\n                            {\" \"}\n                            {`${availablePerks} Available`}\n                          </small>\n                        </h4>\n                      </span>\n                      <div className=\"d-flex justify-content-end\">\n                        {!showPerkLevel[level] && (\n                          <Button\n                            style={{ width: \"40px\" }}\n                            variant=\"outline-secondary\"\n                            color=\"primary\"\n                            onClick={() => {\n                              setShowPerkLevel({\n                                ...showPerkLevel,\n                                [level]: true,\n                              });\n                            }}\n                          >\n                            <FontAwesomeIcon icon={faChevronDown} />\n                          </Button>\n                        )}\n                        {!!showPerkLevel[level] && (\n                          <Button\n                            style={{ width: \"40px\" }}\n                            variant=\"outline-secondary\"\n                            color=\"primary\"\n                            onClick={() => {\n                              setShowPerkLevel({\n                                ...showPerkLevel,\n                                [level]: false,\n                              });\n                            }}\n                          >\n                            <FontAwesomeIcon icon={faChevronUp} />\n                          </Button>\n                        )}\n                      </div>\n                    </div>\n                    <hr />\n                  </div>\n                  <Collapse in={showPerkLevel[level]}>\n                    <div>\n                      {thePerks.map((perk) => {\n                        const perkCost = data.resolvePoints(perk.points, {\n                          unit,\n                        });\n                        return (\n                          <div>\n                            <div className=\"d-flex justify-content-between align-items-center\">\n                              <span className=\"text-left\">\n                                <b>{`${perk.name} (${perkCost} pts)`}</b>\n                                <p\n                                  style={{\n                                    marginBottom: 0,\n                                    marginRight: \"5px\",\n                                  }}\n                                  className=\"text-left\"\n                                >{`${perk.description}`}</p>\n                              </span>\n                              <div className=\"d-flex justify-content-end\">\n                                {!selectedPerks.has(perk.id) && (\n                                  <Button\n                                    style={{ width: \"40px\" }}\n                                    disabled={!canGetPerk(level)}\n                                    color=\"primary\"\n                                    onClick={() => {\n                                      selectedPerks.add(perk.id);\n                                      setUnitPerks(\n                                        forceId,\n                                        unitId,\n                                        Array.from(selectedPerks)\n                                      );\n                                    }}\n                                  >\n                                    <FontAwesomeIcon icon={faCheck} />\n                                  </Button>\n                                )}\n                                {!!selectedPerks.has(perk.id) && (\n                                  <Button\n                                    style={{ width: \"40px\" }}\n                                    color=\"primary\"\n                                    onClick={() => {\n                                      selectedPerks.delete(perk.id);\n                                      setUnitPerks(\n                                        forceId,\n                                        unitId,\n                                        Array.from(selectedPerks)\n                                      );\n                                    }}\n                                  >\n                                    <FontAwesomeIcon icon={faTimes} />\n                                  </Button>\n                                )}\n                              </div>\n                            </div>\n                            <hr />\n                          </div>\n                        );\n                      })}\n                    </div>\n                  </Collapse>\n                </>\n              );\n            })}\n          </div>\n        </DialogContent>\n        <DialogActions>\n          <Button\n            color=\"primary\"\n            onClick={() => {\n              hideModal();\n            }}\n          >\n            Done\n          </Button>{\" \"}\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n","import {\n  faArrowLeft, faArrowRight, faBook, faUser\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { Add as AddIcon, MoreVert as MoreVertIcon } from \"@mui/icons-material\";\nimport ContentCopyIcon from '@mui/icons-material/ContentCopy';\nimport DeleteIcon from '@mui/icons-material/Delete';\nimport DownloadIcon from '@mui/icons-material/Download';\nimport EditIcon from '@mui/icons-material/Edit';\nimport FlashOnIcon from '@mui/icons-material/FlashOn';\nimport MenuBookIcon from '@mui/icons-material/MenuBook';\nimport PrintIcon from '@mui/icons-material/Print';\nimport SettingsIcon from '@mui/icons-material/Settings';\nimport VisibilityIcon from '@mui/icons-material/Visibility';\nimport {\n  Alert, Box, Card,\n  CardContent,\n  CardHeader, FormGroup, IconButton, List,\n  ListItem, ListItemButton, ListItemIcon, ListItemText, ListSubheader, Menu,\n  MenuItem, ScopedCssBaseline, Stack, Typography\n} from \"@mui/material\";\nimport Container from \"@mui/material/Container\";\nimport Link from '@mui/material/Link';\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\nimport { InputNumber } from \"components/bootstrap\";\nimport CustomCircularProgress from \"components/CustomCircularProgress\";\nimport { Dropdown } from 'components/dropdown';\nimport { PrintView } from \"components/print\";\nimport { DataContext, useModal } from \"hooks\";\nimport {\n  every, find, get, isEqual, isNil, sum, toNumber, uniqBy\n} from \"lodash\";\nimport ChessPawnIcon from \"mdi-material-ui/ChessPawn\";\nimport { useSnackbar } from \"notistack\";\nimport React, {\n  useContext, useEffect, useRef, useState\n} from \"react\";\nimport { Link as RouterLink } from 'react-router-dom';\nimport { useReactToPrint } from \"react-to-print\";\nimport { UpdateList } from 'routes/factions/modals';\nimport styled from \"styled-components\";\nimport { getTextColor, hexToRgb } from \"utils/colors\";\nimport { BASE_THEME } from 'utils/constants';\nimport { DataAPI, mergeGlobalData } from \"utils/data\";\nimport { downloadFile, readFileContent } from \"utils/files\";\nimport { formatLevel } from \"utils/format\";\nimport { insert } from \"utils/misc\";\nimport {\n  AddForce, AddLegend, AddUnit,\n  ChooseSubFaction,\n  EditUnit, EditUnitCampaign, ViewActionReference, ViewLegend, ViewPowers, ViewStrategies, ViewUnit\n} from \"./modals\";\n\n\nconst PrintStyles = styled.div`\n\n`;\n\nconst pageStyle = `\n`;\n\nexport default React.memo((props) => {\n  const { listId } = props.match.params;\n  const [\n    {\n      data: someData,\n      coreData,\n      fetchFaction,\n      setData,\n      isLoading,\n      fetchGame,\n      userPrefs,\n      setAppState\n    },\n  ] = useContext(DataContext);\n  const list = get(someData, `lists[${listId}]`, {});\n  const gameName = get(list, 'gameId');\n  const game = get(someData, `gameData.games[${gameName}]`, {});\n  const gameType = get(game, \"gameType\", \"battle\");\n  const isSkirmish = gameType === \"skirmish\";\n  const globalData = mergeGlobalData(game, someData);\n  const data = DataAPI(game, {}, globalData);\n  const lists = get(someData, `lists[${gameName}]`, {});\n  const fileDialog = React.useRef();\n  const orgs = data.getRawOrganizations();\n  const { enqueueSnackbar } = useSnackbar();\n  const shouldStartEditMode = gameName && !get(list, \"forces\", []).length;\n  const [editMode, setEditMode] = useState(shouldStartEditMode);\n  const [showReserves, setShowReserves] = useState({});\n  // const theme = useTheme();\n  const componentRef = useRef();\n  const doPrint = useReactToPrint({\n    pageStyle: pageStyle,\n    content: () => componentRef.current,\n  });\n  const handlePrint = () => {\n    doPrint();\n  };\n  const LIST_TYPES = [\n    { label: \"Competitive\", value: \"competitive\" },\n    { label: \"Narrative\", value: \"narrative\" },\n    { label: \"Campaign\", value: \"campaign\" },\n  ];\n  const calculateUnitPoints = (\n    unit,\n    faction,\n    options,\n    selectedOptions,\n    selectedPerks,\n    selectedSetbacks\n  ) => {\n    let cost = data.getUnitPoints(unit, faction);\n    let unitModels = sum(\n      get(unit, \"models\", []).map((model) => toNumber(get(model, \"min\", 0)))\n    );\n    // First scan for any new models in the unit\n    options.forEach((option, idx) => {\n      option.list.forEach((item, itemIdx) => {\n        const selected = toNumber(\n          get(selectedOptions, `[${idx}][${itemIdx}]`, 0)\n        );\n        if (item.models && selected) {\n          unitModels += selected;\n        }\n      });\n    });\n    options.forEach((option, idx) => {\n      option.list.forEach((item, itemIdx) => {\n        const selected = get(selectedOptions, `[${idx}][${itemIdx}]`);\n        if (item.all && selected) {\n          cost += item.points * unitModels;\n        } else if (selected) {\n          cost += item.points * selected;\n        }\n      });\n    });\n    selectedPerks.forEach((perk) => {\n      cost += data.resolvePoints(\n        get(data.getPerk(faction, perk), \"points\", 0),\n        { unit }\n      );\n    });\n    selectedSetbacks.forEach((setback) => {\n      cost += data.resolvePoints(\n        get(data.getSetback(faction, setback), \"points\", 0),\n        { unit }\n      );\n    });\n    return cost;\n  };\n  const forces = get(list, \"forces\", [])\n    .filter(\n      (force) =>\n        !!data.getFactionWithSubfaction(\n          force.factionId,\n          force.subFactionId || \"none\"\n        )\n    )\n    .map((force, forceId) => {\n      const forceFaction = data.getFactionWithSubfaction(\n        force.factionId,\n        force.subFactionId || \"none\"\n      );\n      if (!get(forceFaction, \"units\")) {\n        return force;\n      }\n      const forceReserves = get(list, `reserves[${force.factionId}]`, []);\n      const availablePerks = new Set(\n        data.getPerks(forceFaction).map((perk) => perk.id)\n      );\n      const availableSetbacks = new Set(\n        data.getSetbacks(forceFaction).map((setback) => setback.id)\n      );\n      const forceUnits = get(force, \"units\", []);\n      const processUnits = (daUnits) => {\n        return daUnits\n          .filter((theUnit) => !!data.getUnit(forceFaction, theUnit.id))\n          .map((theUnit, unitId) => {\n            const unitKey = theUnit.id;\n            const unit = data.getUnit(forceFaction, unitKey);\n            const selectedOptions = get(theUnit, `selectedOptions`, []);\n            // Get raw option list\n            let optionList = data.getOptionsList(unit, forceFaction);\n            const modelCounts = {};\n            get(unit, \"models\", []).forEach((model, index) => {\n              const count = model.min || 0;\n              if (!isNil(modelCounts[index])) {\n                modelCounts[index] += count;\n              } else {\n                modelCounts[index] = count;\n              }\n            });\n            optionList.forEach((option, idx) => {\n              option.list.forEach((optItem, optIdx) => {\n                const selections = get(\n                  selectedOptions,\n                  `[${idx}][${optIdx}]`,\n                  0\n                );\n                const optModels = get(optItem, \"modelIds\", [])\n                  .flat()\n                  .map((model) => model.id || model);\n                optModels.forEach((model) => {\n                  if (!isNil(modelCounts[model])) {\n                    modelCounts[model] += selections;\n                  } else {\n                    modelCounts[model] = selections;\n                  }\n                });\n              });\n            });\n            const oldModelCounts = { ...modelCounts };\n            optionList.forEach((option, idx) => {\n              option.list.forEach((optItem, optIdx) => {\n                const selections = get(\n                  selectedOptions,\n                  `[${idx}][${optIdx}]`,\n                  0\n                );\n                const optReplacedModels = get(optItem, \"replacedModel\", [])\n                  .flat()\n                  .map((model) => model.id || model);\n                optReplacedModels.forEach((model) => {\n                  if (!isNil(modelCounts[model])) {\n                    modelCounts[model] -= selections;\n                  } else {\n                    modelCounts[model] = -selections;\n                  }\n                });\n              });\n            });\n            // Adjust for model counts\n            optionList = data.getOptionsList(unit, forceFaction, {\n              selectedModels: modelCounts,\n              selectedModelsRaw: oldModelCounts,\n            });\n            const selectedModels = uniqBy(\n              [\n                ...optionList.map((option, idx) => {\n                  return [\n                    ...option.list\n                      .filter((optItem, optIdx) => {\n                        const selections = get(\n                          selectedOptions,\n                          `[${idx}][${optIdx}]`,\n                          0\n                        );\n                        return selections > 0;\n                      })\n                      .map((opt) => get(opt, \"model\", []).flat())\n                      .flat(),\n                  ];\n                }, []),\n              ].flat(),\n              (item) => item.id || item\n            );\n            const unitModels = [\n              ...get(unit, \"models\", []),\n              ...data.getModelList(selectedModels, forceFaction),\n            ];\n            const selectedPerks = get(theUnit, \"selectedPerks\", []).filter(\n              (perk) => availablePerks.has(perk)\n            );\n            const selectedSetbacks = get(\n              theUnit,\n              \"selectedSetbacks\",\n              []\n            ).filter((setback) => availableSetbacks.has(setback));\n            const thing = {\n              ...unit,\n              customName: theUnit.customName,\n              experience: theUnit.experience,\n              modelCounts,\n              selectedOptionsList: optionList\n                .map((option, idx) => {\n                  return {\n                    ...option,\n                    list: option.list\n                      .map((optItem, optIdx) => {\n                        const selections = get(\n                          selectedOptions,\n                          `[${idx}][${optIdx}]`,\n                          0\n                        );\n                        return {\n                          ...optItem,\n                          text:\n                            optItem.text +\n                            ` (${selections} ${selections > 1 ? \"selections\" : \"selection\"\n                            })`,\n                        };\n                      })\n                      .filter((optItem, optIdx) => {\n                        const selections = get(\n                          selectedOptions,\n                          `[${idx}][${optIdx}]`,\n                          0\n                        );\n                        return selections > 0;\n                      }),\n                  };\n                })\n                .filter((option) => option.list.length),\n              selectedModels,\n              selectedWeapons: uniqBy(\n                [\n                  ...unitModels\n                    .map((model) => get(model, \"weapons\", []))\n                    .flat(),\n                  ...optionList.map((option, idx) => {\n                    return [\n                      ...option.list\n                        .filter((optItem, optIdx) => {\n                          const selections = get(\n                            selectedOptions,\n                            `[${idx}][${optIdx}]`,\n                            0\n                          );\n                          return selections > 0;\n                        })\n                        .map((opt) => get(opt, \"weapons\", []).flat())\n                        .flat(),\n                    ];\n                  }, []),\n                ].flat(),\n                (item) => item.id || item\n              ),\n              selectedRules: uniqBy(\n                [\n                  ...get(unit, \"rules\", []),\n                  ...unitModels.map((model) => get(model, \"rules\", [])).flat(),\n                  ...optionList.map((option, idx) => {\n                    return [\n                      ...option.list\n                        .filter((optItem, optIdx) => {\n                          const selections = get(\n                            selectedOptions,\n                            `[${idx}][${optIdx}]`,\n                            0\n                          );\n                          return selections > 0;\n                        })\n                        .map((opt) => get(opt, \"rules\", []).flat())\n                        .flat(),\n                    ];\n                  }, []),\n                ].flat(),\n                (item) => item.id || item\n              ),\n              id: unitId,\n              optionList,\n              selectedPerks,\n              selectedSetbacks,\n              totalModels: sum(Object.values(modelCounts)),\n              selectedOptions: optionList.map((option, idx) => {\n                if (option.list) {\n                  const indValue = get(selectedOptions, `[${idx}]`, []);\n                  return option.list.map((opt, optIdx) =>\n                    !isNil(indValue[optIdx]) ? indValue[optIdx] : 0\n                  );\n                }\n                return !isNil(selectedOptions[idx]) ? selectedOptions[idx] : [];\n              }),\n              powerSpecialty: theUnit?.powerSpecialty\n            };\n            thing.points = calculateUnitPoints(\n              thing,\n              forceFaction,\n              optionList,\n              selectedOptions,\n              selectedPerks,\n              selectedSetbacks\n            );\n            return thing;\n          });\n      };\n      return {\n        ...force,\n        ...get(orgs, `[${force.id}]`, {}),\n        faction: forceFaction,\n        legends: get(force, \"legends\", []).map((theLegend, relicId) => {\n          const legendKey = theLegend.id;\n          const relic = data.getRelic(forceFaction, legendKey);\n          return {\n            ...relic,\n            id: relicId,\n            points: data.getRelicCost(relic, forceFaction),\n          };\n        }),\n        units: processUnits(forceUnits),\n        reserves: processUnits(forceReserves),\n      };\n    });\n  const forceFactionIds = get(list, \"forces\", [])\n    .map((force) => force.factionId)\n    .join(\",\");\n  useEffect(() => {\n    if (!get(someData, `gameData.games[${gameName}].factions`)) {\n      fetchGame(gameName);\n    }\n    // Use a trick to only fetch the first missing faction at a time\n    forces\n      .filter((force) => {\n        const factionName = force.factionId;\n        const faction = get(\n          someData,\n          `gameData.games[${gameName}].factions[${factionName}]`\n        );\n        return !get(faction, \"units\");\n      })\n      .slice(0, 1)\n      .forEach((force) => {\n        const factionName = force.factionId;\n        const faction = get(\n          someData,\n          `gameData.games[${gameName}].factions[${factionName}]`\n        );\n        if (!get(faction, \"units\") && !isLoading) {\n          fetchFaction(gameName, factionName);\n        }\n      });\n  }, [coreData, forces.length, forceFactionIds, someData, gameName, forces, fetchGame, isLoading, fetchFaction]);\n  const [showAddForce, hideAddForce] = useModal(\n    ({ extraProps }) => (\n      <AddForce\n        list={list}\n        hideModal={hideAddForce}\n        data={data}\n        userPrefs={userPrefs}\n        addForce={addForce}\n        forces={forces}\n      />\n    ),\n    [forces, list]\n  );\n  useEffect(() => {\n    setShowReserves({});\n  }, [forces.length]);\n  useEffect(() => {\n    if (shouldStartEditMode) {\n      showAddForce();\n    }\n  }, [shouldStartEditMode, showAddForce]);\n  const allFactionsLoaded = every(forces, (force) => {\n    const factionName = force.factionId;\n    const faction = get(\n      someData,\n      `gameData.games[${gameName}].factions[${factionName}]`\n    );\n    const factionUnits = get(faction, \"units\");\n    const factionUrl = get(faction, \"url\");\n    return !!factionUnits || !factionUrl;\n  });\n  const downloadList = () => {\n    downloadFile(\n      JSON.stringify(\n        {\n          ...list,\n        },\n        null,\n        2\n      ),\n      \"data:text/json\",\n      `${list.name}.json`\n    );\n  };\n  const uploadList = (event) => {\n    event.preventDefault();\n    const file = get(event, \"target.files[0]\");\n    if (file) {\n      readFileContent(file)\n        .then((content) => {\n          let listObject = {};\n          try {\n            listObject = JSON.parse(content);\n          } catch (e) {\n            return Promise.reject(e);\n          }\n          if (listObject.forces) {\n            const newArmyData = {\n              ...listObject,\n            };\n            updateList(newArmyData);\n            enqueueSnackbar(`List successfully imported.`, {\n              appearance: \"success\",\n            });\n          }\n        })\n        .catch((error) => {\n          enqueueSnackbar(`List failed to import. ${error.message}`, {\n            appearance: \"error\",\n          });\n        });\n    }\n    fileDialog.current.value = null;\n  };\n  const setLists = (listData) => {\n    const newGameData = {\n      ...someData,\n      lists: {\n        ...get(someData, \"lists\", {}),\n        ...listData\n      },\n    };\n    setData(newGameData);\n  };\n  const updateList = (newData) => {\n    setLists({\n      ...lists,\n      [listId]: {\n        ...list,\n        ...newData,\n      },\n    });\n  };\n  const renderPrintMode = () => {\n    const theme = createTheme(BASE_THEME);\n    return (\n      <ThemeProvider theme={theme}>\n        <ScopedCssBaseline>\n          <PrintView list={list} data={data} forces={forces} />\n        </ScopedCssBaseline>\n      </ThemeProvider>\n    )\n  };\n  const updateForce = (forceId, newData) => {\n    const mappedForces = get(list, \"forces\", []).map((force, index) =>\n      index === forceId ? { ...force, ...newData } : force\n    );\n    updateList({\n      forces: mappedForces,\n    });\n  };\n  // const setFaction = (forceId, factionId) => {\n  //   updateForce(forceId, {\n  //     factionId,\n  //   });\n  // };\n  const setSubFaction = (forceId, subFactionId) => {\n    const factionId = get(list, `forces[${forceId}].factionId`, []);\n    const forceFaction = data.getFactionWithSubfaction(\n      factionId,\n      subFactionId || \"none\"\n    );\n    const forceUnits = get(list, `forces[${forceId}].units`, []);\n    const forceLegends = get(list, `forces[${forceId}].legends`, []);\n    updateForce(forceId, {\n      subFactionId,\n      legends: forceLegends.filter(\n        (relic) => !!data.getRelic(forceFaction, relic.id)\n      ),\n      units: forceUnits.filter((unit) => !!data.getUnit(forceFaction, unit.id)),\n    });\n  };\n  const addLegend = (forceId, legend) => {\n    let newArr = [];\n    newArr = [...get(list, `forces[${forceId}].legends`, []), legend];\n    updateForce(forceId, {\n      legends: newArr,\n    });\n  };\n  const addUnitToForce = (forceId, unit, index) => {\n    const showingReserves = !!showReserves[forceId];\n    const theForce = get(list, `forces[${forceId}]`, []);\n    const factionId = get(theForce, \"factionId\");\n    if (showingReserves) {\n      let newArr = [];\n      if (index) {\n        newArr = insert(get(list, `reserves[${factionId}]`, []), index, unit);\n      } else {\n        newArr = [...get(list, `reserves[${factionId}]`, []), unit];\n      }\n      updateList({\n        reserves: {\n          ...get(list, `reserves`, []),\n          [factionId]: newArr,\n        },\n      });\n    } else {\n      let newArr = [];\n      if (index) {\n        newArr = insert(get(list, `forces[${forceId}].units`, []), index, unit);\n      } else {\n        newArr = [...get(list, `forces[${forceId}].units`, []), unit];\n      }\n      updateForce(forceId, {\n        units: newArr,\n      });\n    }\n  };\n  const updateUnit = (forceId, unitId, newData) => {\n    const showingReserves = !!showReserves[forceId];\n    const theForce = get(list, `forces[${forceId}]`, []);\n    const factionId = get(theForce, \"factionId\");\n    const forceReserves = get(list, `reserves[${factionId}]`, []);\n    if (showingReserves) {\n      updateList({\n        reserves: {\n          ...get(list, `reserves`, []),\n          [factionId]: forceReserves.map((unit, index) =>\n            index === unitId ? { ...unit, ...newData } : unit\n          ),\n        },\n      });\n    } else {\n      updateForce(forceId, {\n        units: get(list, `forces[${forceId}].units`, []).map((unit, index) =>\n          index === unitId ? { ...unit, ...newData } : unit\n        ),\n      });\n    }\n  };\n  const getUnit = (forceId, unitId) => {\n    const showingReserves = !!showReserves[forceId];\n    if (showingReserves) {\n      return get(forces, `[${forceId}].reserves[${unitId}]`, {});\n    } else {\n      return get(forces, `[${forceId}].units[${unitId}]`, {});\n    }\n  };\n  const deleteUnit = (forceId, unitId) => {\n    const showingReserves = !!showReserves[forceId];\n    const theForce = get(list, `forces[${forceId}]`, []);\n    const factionId = get(theForce, \"factionId\");\n    const forceReserves = get(list, `reserves[${factionId}]`, []);\n    if (showingReserves) {\n      updateList({\n        reserves: {\n          ...get(list, `reserves`, []),\n          [factionId]: forceReserves.filter((unit, idx) => idx !== unitId),\n        },\n      });\n    } else {\n      updateForce(forceId, {\n        units: get(list, `forces[${forceId}].units`, []).filter(\n          (unit, idx) => idx !== unitId\n        ),\n      });\n    }\n  };\n  const moveUnitReserves = (forceId, unitId) => {\n    const theForce = get(list, `forces[${forceId}]`, []);\n    const theUnit = get(list, `forces[${forceId}].units[${unitId}]`, []);\n    const factionId = get(theForce, \"factionId\");\n    const forceReserves = get(list, `reserves[${factionId}]`, []);\n    updateList({\n      reserves: {\n        ...get(list, `reserves`, []),\n        [factionId]: [...forceReserves, theUnit],\n      },\n      forces: get(list, \"forces\", []).map((force, index) =>\n        index === forceId\n          ? {\n            ...force,\n            units: get(list, `forces[${forceId}].units`, []).filter(\n              (unit, idx) => idx !== unitId\n            ),\n          }\n          : force\n      ),\n    });\n  };\n  const moveUnitForce = (forceId, unitId) => {\n    const theForce = get(list, `forces[${forceId}]`, []);\n    const factionId = get(theForce, \"factionId\");\n    const theUnit = get(list, `reserves[${factionId}][${unitId}]`, []);\n    const forceReserves = get(list, `reserves[${factionId}]`, []);\n    updateList({\n      forces: get(list, \"forces\", []).map((force, index) =>\n        index === forceId\n          ? {\n            ...force,\n            units: [...get(list, `forces[${forceId}].units`, []), theUnit],\n          }\n          : force\n      ),\n      reserves: {\n        ...get(list, `reserves`, []),\n        [factionId]: forceReserves.filter((unit, idx) => idx !== unitId),\n      },\n    });\n  };\n  const deleteLegend = (forceId, legendId) => {\n    updateForce(forceId, {\n      legends: get(list, `forces[${forceId}].legends`, []).filter(\n        (unit, idx) => idx !== legendId\n      ),\n    });\n  };\n  const setUnitOptions = (forceId, unitId, data) => {\n    updateUnit(forceId, unitId, {\n      selectedOptions: data,\n    });\n  };\n  const setUnitPowerSpecialty = (forceId, unitId, data) => {\n    updateUnit(forceId, unitId, {\n      powerSpecialty: data,\n    });\n  };\n  const setUnitPerks = (forceId, unitId, data) => {\n    updateUnit(forceId, unitId, {\n      selectedPerks: data,\n    });\n  };\n  const setUnitSetbacks = (forceId, unitId, data) => {\n    updateUnit(forceId, unitId, {\n      selectedSetbacks: data,\n    });\n  };\n  const setUnitName = (forceId, unitId, data) => {\n    updateUnit(forceId, unitId, {\n      customName: data,\n    });\n  };\n  const addForce = (force) => {\n    updateList({\n      forces: [...get(list, \"forces\", []), force],\n    });\n  };\n  const deleteForce = (id) => {\n    updateList({\n      forces: get(list, \"forces\", []).filter((force, index) => index !== id),\n    });\n  };\n  const [showChooseSubfaction, hideChooseSubfaction] = useModal(\n    ({ extraProps }) => (\n      <ChooseSubFaction\n        hideModal={hideChooseSubfaction}\n        data={data}\n        setSubFaction={setSubFaction}\n        {...extraProps}\n      />\n    ),\n    [forces, list]\n  );\n  const [showAddUnit, hideAddUnit] = useModal(\n    ({ extraProps }) => (\n      <AddUnit\n        hideModal={hideAddUnit}\n        data={data}\n        addUnit={addUnitToForce}\n        {...extraProps}\n      />\n    ),\n    [forces, list]\n  );\n  const [showAddLegend, hideAddLegend] = useModal(\n    ({ extraProps }) => (\n      <AddLegend\n        hideModal={hideAddLegend}\n        list={list}\n        data={data}\n        addLegend={addLegend}\n        {...extraProps}\n      />\n    ),\n    [forces, list]\n  );\n  const [showEditUnit, hideEditUnit] = useModal(\n    ({ extraProps }) => (\n      <EditUnit\n        hideModal={hideEditUnit}\n        data={data}\n        list={list}\n        forces={forces}\n        setUnitName={setUnitName}\n        setUnitPowerSpecialty={setUnitPowerSpecialty}\n        setUnitOptions={setUnitOptions}\n        getUnit={getUnit}\n        {...extraProps}\n      />\n    ),\n    [list, forces]\n  );\n  const [showEditUnitCampaign, hideEditUnitCampaign] = useModal(\n    ({ extraProps }) => (\n      <EditUnitCampaign\n        editMode={editMode}\n        hideModal={hideEditUnitCampaign}\n        data={data}\n        list={list}\n        forces={forces}\n        getUnit={getUnit}\n        updateUnit={updateUnit}\n        setUnitPerks={setUnitPerks}\n        setUnitSetbacks={setUnitSetbacks}\n        {...extraProps}\n      />\n    ),\n    [list, forces]\n  );\n  const [showViewUnit, hideViewUnit] = useModal(\n    ({ extraProps }) => (\n      <ViewUnit\n        hideModal={hideViewUnit}\n        data={data}\n        getUnit={getUnit}\n        {...extraProps}\n      />\n    ),\n    [forces, list]\n  );\n  const [showViewLegend, hideViewLegend] = useModal(\n    ({ extraProps }) => (\n      <ViewLegend hideModal={hideViewLegend} data={data} {...extraProps} />\n    ),\n    [forces, list]\n  );\n  const [showViewStrategies, hideViewStrategies] = useModal(\n    ({ extraProps }) => (\n      <ViewStrategies\n        hideModal={hideViewStrategies}\n        data={data}\n        {...extraProps}\n      />\n    ),\n    [forces, list]\n  );\n  const [showViewPowers, hideViewPowers] = useModal(\n    ({ extraProps }) => (\n      <ViewPowers hideModal={hideViewPowers} data={data} {...extraProps} />\n    ),\n    [forces, list]\n  );\n  const [showViewActionReference, hideViewActionReference] = useModal(\n    ({ extraProps }) => (\n      <ViewActionReference\n        hideModal={hideViewActionReference}\n        data={data}\n        isSkirmish={isSkirmish}\n        {...extraProps}\n      />\n    ),\n    [forces, list, isSkirmish]\n  );\n  const [showUpdateList, hideUpdateList] = useModal(\n    ({ extraProps }) => (\n      <UpdateList\n        hideModal={hideUpdateList}\n        lists={lists}\n        listId={listId}\n        data={data}\n        updateList={(listId, data) => {\n          updateList(data);\n        }}\n        {...extraProps}\n      />\n    ),\n    [forces, lists]\n  );\n  // {!editMode && (\n  //   <SpeedDialAction\n  //     tooltipOpen\n  // FabProps={{\n  //   sx: {\n  //     backgroundColor: theme.palette.primary.main,\n  //     color: theme.palette.getContrastText(theme.palette.primary.main)\n  //   }\n  // }}\n  //     tooltipTitle=\"Edit\"\n  //     color=\"primary\"\n  //     onClick={() => setEditMode(true)}\n  //     icon={<EditIcon />}\n  //   />\n  // )}\n  // {!!editMode && (\n  //   <SpeedDialAction\n  //     tooltipOpen\n  // FabProps={{\n  //   sx: {\n  //     backgroundColor: theme.palette.primary.main,\n  //     color: theme.palette.getContrastText(theme.palette.primary.main)\n  //   }\n  // }}\n  //     tooltipTitle=\"View\"\n  //     color=\"primary\"\n  //     onClick={() => setEditMode(false)}\n  //     icon={<VisibilityIcon />}\n  //   />\n  // )}\n  // {!!editMode && (\n  //   <SpeedDialAction\n  //     tooltipOpen\n  // FabProps={{\n  //   sx: {\n  //     backgroundColor: theme.palette.primary.main,\n  //     color: theme.palette.getContrastText(theme.palette.primary.main)\n  //   }\n  // }}\n  //     tooltipTitle=\"Add\"\n  //     color=\"primary\"\n  //     onClick={showAddForce}\n  //     icon={<AddIcon />}\n  //   />\n  // )}\n  // {!editMode && (\n  //   <SpeedDialAction\n  //     tooltipOpen\n  // FabProps={{\n  //   sx: {\n  //     backgroundColor: theme.palette.primary.main,\n  //     color: theme.palette.getContrastText(theme.palette.primary.main)\n  //   }\n  // }}\n  //     tooltipTitle=\"Reference\"\n  //     color=\"primary\"\n  //     onClick={showViewActionReference}\n  //     icon={<MenuBookIcon />}\n  //   />\n  // )}\n  // {!!editMode && (\n  //   <SpeedDialAction\n  //     tooltipOpen\n  // FabProps={{\n  //   sx: {\n  //     backgroundColor: theme.palette.primary.main,\n  //     color: theme.palette.getContrastText(theme.palette.primary.main)\n  //   }\n  // }}\n  //     tooltipTitle=\"Update\"\n  //     style={{ marginRight: \"5px\" }}\n  //     color=\"primary\"\n  //     onClick={handleClick}\n  //     icon={<FontAwesomeIcon icon={faFileUpload} />}\n  //   />\n  // )}\n  // <SpeedDialAction\n  //   tooltipOpen\n  // FabProps={{\n  //   sx: {\n  //     backgroundColor: theme.palette.primary.main,\n  //     color: theme.palette.getContrastText(theme.palette.primary.main)\n  //   }\n  // }}\n  //   tooltipTitle=\"Download\"\n  //   color=\"primary\"\n  //   onClick={downloadList}\n  //   icon={<DownloadIcon />}\n  // />\n  // <SpeedDialAction\n  //   tooltipOpen\n  // FabProps={{\n  //   sx: {\n  //     backgroundColor: theme.palette.primary.main,\n  //     color: theme.palette.getContrastText(theme.palette.primary.main)\n  //   }\n  // }}\n  //   tooltipTitle=\"Print\"\n  //   color=\"primary\"\n  //   onClick={() => handlePrint()}\n  //   icon={<PrintIcon />}\n  // />\n  // {!!editMode && (\n  //   <SpeedDialAction\n  //     tooltipOpen\n  // FabProps={{\n  //   sx: {\n  //     backgroundColor: theme.palette.primary.main,\n  //     color: theme.palette.getContrastText(theme.palette.primary.main)\n  //   }\n  // }}\n  //     tooltipTitle=\"Settings\"\n  //     color=\"primary\"\n  //     onClick={() => showUpdateList()}\n  //     icon={<SettingsIcon />}\n  //   />\n  // )}\n  // {!editMode && (\n  //   <Dropdown drop={\"bottom\"} style={{ display: \"inline-block\" }}>\n  //     <span style={{}}>\n  //       <Dropdown.Toggle as={CustomToggle}>\n  //         <SpeedDialAction\n  //           tooltipOpen\n  // FabProps={{\n  //   sx: {\n  //     backgroundColor: theme.palette.primary.main,\n  //     color: theme.palette.getContrastText(theme.palette.primary.main)\n  //   }\n  // }}\n  //           title=\"Rules\"\n  //           style={{ width: \"40px\" }}\n  //           icon={<FontAwesomeIcon icon={faBook} />}\n  //         />\n  //       </Dropdown.Toggle>\n  //     </span>\n  //     <Dropdown.Menu>\n  //       <Dropdown.Item onClick={() => showViewActionReference()}>\n  //         Actions and Reactions\n  //       </Dropdown.Item>\n  //       {gameType === \"skirmish\" && (\n  //         <Dropdown.Item onClick={() => showViewInjuryTable()}>\n  //           Model Injury Chart\n  //         </Dropdown.Item>\n  //       )}\n  //     </Dropdown.Menu>\n  //   </Dropdown>\n  // )}\n  React.useEffect(() => {\n    setAppState({\n      contextActions: [\n        ...(!editMode ? [\n          {\n            name: 'Edit',\n            icon: <EditIcon />,\n            onClick: () => setEditMode(true)\n          }\n        ] : []),\n        ...(!!editMode ? [\n          {\n            name: 'View',\n            icon: <VisibilityIcon />,\n            onClick: () => setEditMode(false)\n          }\n        ] : []),\n        ...(!!editMode ? [\n          {\n            name: 'Add',\n            icon: <AddIcon />,\n            onClick: () => showAddForce()\n          }\n        ] : []),\n        ...(!editMode ? [\n          {\n            name: 'Reference',\n            icon: <MenuBookIcon />,\n            onClick: () => showViewActionReference()\n          }\n        ] : []),\n        {\n          name: 'Download',\n          icon: <DownloadIcon />,\n          onClick: () => downloadList()\n        },\n        {\n          name: 'Print',\n          icon: <PrintIcon />,\n          onClick: () => handlePrint()\n        },\n        {\n          name: 'Settings',\n          icon: <SettingsIcon />,\n          onClick: () => showUpdateList()\n        }\n      ]\n    })\n    return () => {\n      setAppState({\n        contextActions: []\n      })\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [ editMode ]);\n  // const [dialOpen, setDialOpen] = React.useState(false);\n  if (!someData || !allFactionsLoaded) {\n    return (\n      <Box sx={{ textAlign: \"center\" }}>\n        <CustomCircularProgress />\n      </Box>\n    );\n  }\n  const listType = list.type || \"competitive\";\n  const listTypeName =\n    (find(LIST_TYPES, (myType) => myType.value === list.type) || {}).label ||\n    \"Competitive\";\n  const totalForcePoints = sum(\n    forces.map((force) => {\n      const unitPoints = sum(\n        get(force, \"units\", []).map((unit) => unit.points)\n      );\n      const legendPoints = sum(\n        get(force, \"legends\", []).map((legend) => legend.points)\n      );\n      return unitPoints + legendPoints;\n    })\n  );\n  const totalForceReservePoints = sum(\n    forces.map((force) => {\n      const unitPoints = sum(\n        get(force, \"reserves\", []).map((unit) => unit.points)\n      );\n      return unitPoints;\n    })\n  );\n  const SPMult = isSkirmish ? 50 : 500;\n  const LegendMult = isSkirmish ? 150 : 500;\n  const totalSP =\n    2 +\n    Math.round(totalForcePoints / SPMult) -\n    sum(forces.map((force) => force.cost));\n  const legendLimit = Math.round(totalForcePoints / LegendMult);\n  const validationErrors = [];\n  if (listType !== \"narrative\") {\n    const totalLegends = sum(\n      forces.map((force) => {\n        return get(force, \"legends\", []).length;\n      })\n    );\n    if (totalLegends > legendLimit) {\n      const exceededLegends = totalLegends - legendLimit;\n      validationErrors.push({\n        type: \"error\",\n        text: `List has ${exceededLegends} too many legends`,\n      });\n    }\n    forces.forEach((force) => {\n      const forceFaction = get(force, \"faction\", {});\n      const forceFactionId = get(force, \"faction.id\");\n      const forceSubFactionId = get(force, \"subFactionId\");\n      const forceSubfaction = data.getSubfaction(\n        forceFactionId,\n        forceSubFactionId\n      );\n      const name = `${forceFaction.name} ${!forceSubFactionId || forceSubFactionId === \"none\"\n        ? \"\"\n        : `(${forceSubfaction.name})`\n        } - ${force.name}`;\n      const forceCategories = Object.keys(get(force, \"categories\", {}));\n      forceCategories.forEach((catKey) => {\n        const forceUnits = get(force, \"units\", []);\n        const category = data.getCategory(catKey);\n        const categoryData = data.getOrganizationCategory(force, catKey);\n        const unitCatCount =\n          forceUnits.filter((myUnit) => myUnit.category === catKey).length || 0;\n        if (unitCatCount < categoryData.min) {\n          const unitDiff = categoryData.min - unitCatCount;\n          validationErrors.push({\n            type: \"error\",\n            text: `${name} requires ${unitDiff} more ${category.name} unit${unitDiff > 1 ? \"s\" : \"\"\n              }`,\n          });\n        }\n        if (unitCatCount > categoryData.max) {\n          const unitDiff = unitCatCount - categoryData.max;\n          validationErrors.push({\n            type: \"error\",\n            text: `${name} has ${unitDiff} too many ${category.name} units`,\n          });\n        }\n      });\n    });\n  }\n  const allPowerSpecialties = [];\n  forces.forEach((force) => {\n    force?.units.forEach((unit) => {\n      const powerSp = unit?.powerSpecialty;\n      if (powerSp) {\n        allPowerSpecialties.push(powerSp);\n      }\n    })\n  });\n  if (!gameName) {\n    return (\n      <Container>\n        <Typography align=\"center\">\n          This list does not exist. Click <Link component={RouterLink}\n            to={'/lists'}\n          >here</Link> to return to the rosters screen.\n        </Typography>\n      </Container>\n    );\n  }\n  return (\n    <>\n      <div style={{ display: \"none\" }}>\n        <PrintStyles ref={componentRef}>{renderPrintMode()}</PrintStyles>\n      </div>\n      <Container>\n        <Typography\n          style={{ wordBreak: 'break-all' }}\n          variant=\"h4\"\n          align=\"center\"\n          sx={{ mb: 2 }}\n        >{`${list.name}`}</Typography>\n        <Typography align=\"center\" sx={{ mb: 4 }}>\n          {`${listTypeName}, ${totalForcePoints} pts`},\n          {listType === \"campaign\"\n            ? ` ${totalForceReservePoints} pts of reserves,`\n            : \"\"}\n          {` ${totalSP} SP`},{\" \"}\n          {`${legendLimit} Legend${legendLimit > 1 ? \"s\" : \"\"}`}\n        </Typography>\n        {/* <HideOnScroll>\n          {({ show }) => (\n            <SpeedDial\n              ariaLabel=\"SpeedDial tooltip example\"\n              sx={{ position: \"fixed\", bottom: 16, right: 16 }}\n              icon={<SpeedDialIcon />}\n              onClose={(event) => {\n                if (event.type === 'click' || event.type === 'blur') {\n                  setDialOpen(false);\n                }\n              }}\n              onOpen={(event) => {\n                if (event.type === 'click') {\n                  setDialOpen(true);\n                }\n              }}\n              open={dialOpen && show}\n              hidden={!show}\n              hidden={!show}\n            >\n              {!editMode && (\n                <SpeedDialAction\n                  tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n                  tooltipTitle=\"Edit\"\n                  color=\"primary\"\n                  onClick={() => setEditMode(true)}\n                  icon={<EditIcon />}\n                />\n              )}\n              {!!editMode && (\n                <SpeedDialAction\n                  tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n                  tooltipTitle=\"View\"\n                  color=\"primary\"\n                  onClick={() => setEditMode(false)}\n                  icon={<VisibilityIcon />}\n                />\n              )}\n              {!!editMode && (\n                <SpeedDialAction\n                  tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n                  tooltipTitle=\"Add\"\n                  color=\"primary\"\n                  onClick={showAddForce}\n                  icon={<AddIcon />}\n                />\n              )}\n              {!editMode && (\n                <SpeedDialAction\n                  tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n                  tooltipTitle=\"Reference\"\n                  color=\"primary\"\n                  onClick={showViewActionReference}\n                  icon={<MenuBookIcon />}\n                />\n              )}\n              {!!editMode && (\n                <SpeedDialAction\n                  tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n                  tooltipTitle=\"Update\"\n                  style={{ marginRight: \"5px\" }}\n                  color=\"primary\"\n                  onClick={handleClick}\n                  icon={<FontAwesomeIcon icon={faFileUpload} />}\n                />\n              )}\n              <SpeedDialAction\n                tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n                tooltipTitle=\"Download\"\n                color=\"primary\"\n                onClick={downloadList}\n                icon={<DownloadIcon />}\n              />\n              <SpeedDialAction\n                tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n                tooltipTitle=\"Print\"\n                color=\"primary\"\n                onClick={() => handlePrint()}\n                icon={<PrintIcon />}\n              />\n              {!!editMode && (\n                <SpeedDialAction\n                  tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n                  tooltipTitle=\"Settings\"\n                  color=\"primary\"\n                  onClick={() => showUpdateList()}\n                  icon={<SettingsIcon />}\n                />\n              )}\n              {!editMode && (\n                <Dropdown drop={\"bottom\"} style={{ display: \"inline-block\" }}>\n                  <span style={{}}>\n                    <Dropdown.Toggle as={CustomToggle}>\n                      <SpeedDialAction\n                        tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n                        title=\"Rules\"\n                        style={{ width: \"40px\" }}\n                        icon={<FontAwesomeIcon icon={faBook} />}\n                      />\n                    </Dropdown.Toggle>\n                  </span>\n                  <Dropdown.Menu>\n                    <Dropdown.Item onClick={() => showViewActionReference()}>\n                      Actions and Reactions\n                    </Dropdown.Item>\n                    {gameType === \"skirmish\" && (\n                      <Dropdown.Item onClick={() => showViewInjuryTable()}>\n                        Model Injury Chart\n                      </Dropdown.Item>\n                    )}\n                  </Dropdown.Menu>\n                </Dropdown>\n              )}\n            </SpeedDial>\n          )}\n        </HideOnScroll> */}\n        {validationErrors.map((error, idx) => (\n          <Alert\n            key={idx}\n            severity={error.type || \"info\"}\n            variant=\"filled\"\n            sx={{ mb: 2 }}\n          >\n            {error.text}\n          </Alert>\n        ))}\n        <Card\n          className=\"no-break\"\n          sx={{\n            border: `2px solid rgb(57, 110, 158)`,\n            mb: 2,\n          }}\n        >\n          <CardHeader\n            sx={{ backgroundColor: \"rgb(57, 110, 158)\", color: \"white\", py: 1 }}\n            title={\n              <Typography variant=\"h5\" component=\"div\">\n                Game Trackers\n              </Typography>\n            }\n          />\n          <CardContent>\n            <Stack direction=\"column\" spacing={2}>\n              <FormGroup>\n                <InputNumber\n                  fullWidth\n                  label={\"Strategy Points\"}\n                  min={0}\n                  type=\"number\"\n                  color=\"primary\"\n                  value={list.strategyPoints || 0}\n                  onChange={(value) => updateList({ strategyPoints: value })}\n                  allowReset\n                />\n              </FormGroup>\n              <FormGroup>\n                <InputNumber\n                  fullWidth\n                  label={\"Victory Points\"}\n                  min={0}\n                  type=\"number\"\n                  color=\"primary\"\n                  value={list.victoryPoints || 0}\n                  onChange={(value) => updateList({ victoryPoints: value })}\n                  allowReset\n                />\n              </FormGroup>\n            </Stack>\n          </CardContent>\n        </Card>\n\n        {forces.map((force, index) => {\n          const forceFactionId = get(force, \"faction.id\");\n          const forceSubFactionId = get(force, \"subFactionId\");\n          const forceFaction = data.getFactionWithSubfaction(\n            forceFactionId,\n            forceSubFactionId || \"none\"\n          );\n          const rawForceFaction = data.getRawFaction(forceFactionId);\n          const forceSubfaction = data.getSubfaction(\n            forceFactionId,\n            forceSubFactionId || \"none\"\n          );\n          const {\n            color: factionColor,\n          } = forceFaction;\n          const textColor = factionColor\n            ? getTextColor(hexToRgb(factionColor))\n            : \"white\";\n          const forceCategories = Object.keys(get(force, \"categories\", {}));\n          const showingReserves = !!showReserves[index];\n          const forceUnits = showingReserves\n            ? get(force, \"reserves\", [])\n            : get(force, \"units\", []);\n          const factionRelics = data.getRelics(forceFaction);\n          const factionPowers = data.getPowers(forceFaction);\n          const hasPowers =\n            !isNil(rawForceFaction.powers) &&\n            !isEqual(rawForceFaction.powers, {});\n          const rawSubfactions = Object.values(forceFaction.subfactions || []);\n          const hasSubfactions = !!rawSubfactions.length;\n          const factionStrategies = data.getStrategies(forceFaction);\n          const units = data.getUnits(forceFaction);\n          const forceLegends = get(force, \"legends\", []);\n          const listLegendSet = new Set(\n            get(list, \"forces\", [])\n              .map((force) => get(force, \"legends\", []).map((legend) => legend.id))\n              .flat()\n          );\n          const filteredLegends =\n            listType === \"narrative\"\n              ? factionRelics\n              : factionRelics.filter((legend) => !listLegendSet.has(legend.id));\n          const filteredCategories = forceCategories\n            .filter(\n              (catKey) =>\n                editMode ||\n                forceUnits.filter((myUnit) => myUnit.category === catKey).length\n            )\n            .filter((catKey) => {\n              const categoryData = data.getOrganizationCategory(force, catKey);\n              return categoryData.max > 0 || listType === \"narrative\";\n            });\n          return (\n            <Card\n              className=\"no-break\"\n              sx={{\n                border: `2px solid ${factionColor}`,\n                mb: 2,\n              }}\n            >\n              <CardHeader\n                sx={{ backgroundColor: factionColor, color: textColor, py: 1 }}\n                title={\n                  <>\n                    <Typography variant=\"h5\" component=\"div\">\n                      {`${forceFaction.name} ${!forceSubFactionId || forceSubFactionId === \"none\"\n                        ? \"\"\n                        : `(${forceSubfaction.name})`\n                        } - ${showingReserves ? \"Reserves\" : force.name}`}\n                    </Typography>\n                  </>\n                }\n                action={\n                  <Dropdown>\n                    {({ handleClose, open, handleOpen, anchorElement }) => (\n                      <>\n                        <IconButton sx={{ color: 'inherit', mr: 1 }} onClick={handleOpen}>\n                          <MoreVertIcon />\n                        </IconButton>\n                        <Menu\n                          anchorOrigin={{\n                            vertical: \"bottom\",\n                            horizontal: \"right\",\n                          }}\n                          transformOrigin={{\n                            vertical: \"top\",\n                            horizontal: \"right\",\n                          }}\n                          anchorEl={anchorElement}\n                          id=\"basic-menu\"\n                          open={open}\n                          onClose={handleClose}\n                          MenuListProps={{\n                            dense: true,\n                            onClick: handleClose,\n                            \"aria-labelledby\": \"basic-button\",\n                          }}\n                        >\n\n                          {!!factionStrategies.length && (\n                            <MenuItem onClick={() =>\n                              showViewStrategies({\n                                forceId: index,\n                                faction: forceFaction,\n                              })}>\n                              <ListItemIcon>\n                                <ChessPawnIcon />\n                              </ListItemIcon>\n                              <ListItemText>View Strategies</ListItemText>\n                            </MenuItem>\n                          )}\n                          {!!factionPowers.length && hasPowers && (\n                            <MenuItem onClick={() =>\n                              showViewPowers({\n                                forceId: index,\n                                faction: forceFaction,\n                                powerSpecialties: allPowerSpecialties\n                              })\n                            }>\n                              <ListItemIcon>\n                                <FlashOnIcon />\n                              </ListItemIcon>\n                              <ListItemText>View Powers</ListItemText>\n                            </MenuItem>\n                          )}\n\n                          {listType === \"campaign\" && (\n                            <>\n                              <MenuItem onClick={() =>\n                                setShowReserves({\n                                  ...showReserves,\n                                  [index]: !showReserves[index],\n                                })\n                              }>\n                                <ListItemIcon>\n                                  <FontAwesomeIcon icon={faUser} />\n                                </ListItemIcon>\n                                <ListItemText>{showingReserves ? \"Force\" : \"Reserves\"}</ListItemText>\n                              </MenuItem>\n                            </>\n                          )}\n                          {!!editMode && hasSubfactions && (\n                            <MenuItem onClick={() =>\n                              showChooseSubfaction({\n                                forceId: index,\n                                faction: forceFaction,\n                              })\n                            }>\n                              <ListItemIcon>\n                                <EditIcon />\n                              </ListItemIcon>\n                              <ListItemText>Change Focus</ListItemText>\n                            </MenuItem>\n                          )}\n\n                          {!!editMode && (\n                            <MenuItem onClick={() => deleteForce(index)\n                            }>\n                              <ListItemIcon>\n                                <DeleteIcon />\n                              </ListItemIcon>\n                              <ListItemText>Delete</ListItemText>\n                            </MenuItem>\n                          )}\n                        </Menu>\n                      </>\n                    )}\n                  </Dropdown>\n\n                }\n              />\n              <CardContent\n                style={{ padding: (filteredCategories.length || forceLegends.length) ? 0 : undefined }}\n              >\n                <List>\n                  {!!factionRelics.length &&\n                    !showingReserves &&\n                    (!!editMode || !!forceLegends.length) && (\n                      <>\n                        <ListItem\n                          key={index}\n                          secondaryAction={\n                            <>\n                              {!!editMode && (\n                                <IconButton\n                                  disabled={filteredLegends?.length === 0}\n                                  sx={{ color: \"primary.main\" }}\n                                  onClick={() =>\n                                    showAddLegend({\n                                      forceId: index,\n                                      faction: forceFaction,\n                                    })\n                                  }\n                                >\n                                  <AddIcon />\n                                </IconButton>\n                              )}\n                            </>\n                          }\n                          disablePadding\n                        >\n                          <ListSubheader sx={{ flex: 1, zIndex: 0 }}>\n                            <Typography\n                              sx={{ py: 1 }}\n                              fontWeight=\"bold\"\n                              variant=\"h6\"\n                            >\n                              Legends\n                            </Typography>\n                          </ListSubheader>\n                        </ListItem>\n                        {forceLegends.map((legend, unitIdx) => {\n                          return (\n                            <>\n                              <ListItem\n                                key={index}\n                                secondaryAction={\n                                  <Dropdown>\n                                    {({ handleClose, open, handleOpen, anchorElement }) => (\n                                      <>\n                                        <IconButton sx={{ color: 'primary.main' }} onClick={handleOpen}>\n                                          <MoreVertIcon />\n                                        </IconButton>\n                                        <Menu\n                                          anchorOrigin={{\n                                            vertical: \"bottom\",\n                                            horizontal: \"right\",\n                                          }}\n                                          transformOrigin={{\n                                            vertical: \"top\",\n                                            horizontal: \"right\",\n                                          }}\n                                          anchorEl={anchorElement}\n                                          id=\"basic-menu\"\n                                          open={open}\n                                          onClose={handleClose}\n                                          MenuListProps={{\n                                            dense: true,\n                                            onClick: handleClose,\n                                            \"aria-labelledby\": \"basic-button\",\n                                          }}\n                                        >\n                                          <MenuItem onClick={() =>\n                                            showViewLegend({\n                                              faction: forceFaction,\n                                              legend,\n                                            })}>\n                                            <ListItemIcon>\n                                              <VisibilityIcon />\n                                            </ListItemIcon>\n                                            <ListItemText>View</ListItemText>\n                                          </MenuItem>\n                                          {!!editMode && (\n                                            <MenuItem onClick={() =>\n                                              deleteLegend(index, legend.id)\n                                            }>\n                                              <ListItemIcon>\n                                                <DeleteIcon />\n                                              </ListItemIcon>\n                                              <ListItemText>Delete</ListItemText>\n                                            </MenuItem>\n                                          )}\n                                        </Menu>\n                                      </>\n                                    )}\n                                  </Dropdown>\n                                }\n                                disablePadding\n                              >\n                                <ListItemButton\n                                  onClick={(event) => {\n                                    event.preventDefault();\n                                    showViewLegend({\n                                      faction: forceFaction,\n                                      legend,\n                                    });\n                                  }}\n                                >\n                                  <ListItemText\n                                    primary={\n                                      <>\n                                        {legend.name} {`(${legend.points} pts)`}\n                                      </>\n                                    }\n                                  />\n                                </ListItemButton>\n                              </ListItem>\n                            </>\n                          );\n                        })}\n                      </>\n                    )}\n                  {filteredCategories.map((catKey, catIndex) => {\n                    const category = data.getCategory(catKey);\n                    const categoryData = data.getOrganizationCategory(\n                      force,\n                      catKey\n                    );\n                    const unitCatCount = units.filter(\n                      (unit) => unit.category === catKey\n                    ).length;\n                    return (\n                      <>\n                        <ListItem\n                          key={index}\n                          secondaryAction={\n                            <>\n                              {!!editMode && (\n                                <IconButton\n                                  sx={{ color: \"primary.main\" }}\n                                  disabled={unitCatCount === 0}\n                                  onClick={() =>\n                                    showAddUnit({\n                                      forceId: index,\n                                      faction: forceFaction,\n                                      units: units.filter(\n                                        (unit) => unit.category === catKey\n                                      ),\n                                    })\n                                  }\n                                >\n                                  <AddIcon />\n                                </IconButton>\n                              )}\n                            </>\n                          }\n                          disablePadding\n                        >\n                          <ListSubheader sx={{ flex: 1, zIndex: 0, backgroundColor: 'background.paper' }}>\n                            <Typography\n                              sx={{ py: 1 }}\n                              fontWeight=\"bold\"\n                              variant=\"h6\"\n                            >\n                              {category.name}{\" \"}\n                              {listType !== \"narrative\"\n                                ? `${`(${categoryData.min || 0}-${categoryData.max\n                                })`}`\n                                : \"\"}\n                            </Typography>\n                          </ListSubheader>\n                        </ListItem>\n                        {forceUnits\n                          .filter((unit) => unit.category === catKey)\n                          .map((unit, unitIdx) => {\n                            const unitCopy = showingReserves\n                              ? get(\n                                list,\n                                `reserves[${forceFactionId}][${unit.id}]`\n                              )\n                              : get(list, `forces[${index}].units[${unit.id}]`);\n                            const unitSetbacksCount = get(\n                              unit,\n                              \"selectedSetbacks\",\n                              []\n                            ).length;\n                            const unitLevel = Math.floor(\n                              get(unit, \"experience\", 0) / 5\n                            );\n                            return (\n                              <>\n                                <ListItem\n                                  key={index}\n                                  secondaryAction={\n                                    <Dropdown>\n                                      {({ handleClose, open, handleOpen, anchorElement }) => (\n                                        <>\n                                          <IconButton sx={{ color: 'primary.main' }} onClick={handleOpen}>\n                                            <MoreVertIcon />\n                                          </IconButton>\n                                          <Menu\n                                            anchorOrigin={{\n                                              vertical: \"bottom\",\n                                              horizontal: \"right\",\n                                            }}\n                                            transformOrigin={{\n                                              vertical: \"top\",\n                                              horizontal: \"right\",\n                                            }}\n                                            anchorEl={anchorElement}\n                                            id=\"basic-menu\"\n                                            open={open}\n                                            onClose={handleClose}\n                                            MenuListProps={{\n                                              dense: true,\n                                              onClick: handleClose,\n                                              \"aria-labelledby\": \"basic-button\",\n                                            }}\n                                          >\n                                            <MenuItem onClick={() =>\n                                              showViewUnit({\n                                                unit,\n                                                faction: forceFaction,\n                                              })}>\n                                              <ListItemIcon>\n                                                <VisibilityIcon />\n                                              </ListItemIcon>\n                                              <ListItemText>View</ListItemText>\n                                            </MenuItem>\n                                            {!!editMode && (\n                                              <MenuItem\n                                                onClick={() =>\n                                                  addUnitToForce(\n                                                    index,\n                                                    unitCopy,\n                                                    unit.id + 1\n                                                  )}\n                                              >\n                                                <ListItemIcon>\n                                                  <ContentCopyIcon />\n                                                </ListItemIcon>\n                                                <ListItemText>Copy</ListItemText>\n                                              </MenuItem>\n                                            )}\n                                            {!!editMode && (\n                                              <MenuItem onClick={() => {\n                                                showEditUnit({\n                                                  faction: forceFaction,\n                                                  unitId: unit.id,\n                                                  forceId: index,\n                                                });\n                                              }}>\n                                                <ListItemIcon>\n                                                  <EditIcon />\n                                                </ListItemIcon>\n                                                <ListItemText>Edit</ListItemText>\n                                              </MenuItem>\n                                            )}\n                                            {listType === \"campaign\" && (\n                                              <MenuItem onClick={() => {\n                                                showEditUnitCampaign({\n                                                  faction: forceFaction,\n                                                  unitId: unit.id,\n                                                  forceId: index,\n                                                });\n                                              }}>\n                                                <ListItemIcon>\n                                                  <FontAwesomeIcon icon={faBook} />\n                                                </ListItemIcon>\n                                                <ListItemText>Campaign</ListItemText>\n                                              </MenuItem>\n                                            )}\n                                            {!!editMode &&\n                                              listType === \"campaign\" &&\n                                              !showingReserves && (\n                                                <MenuItem onClick={() =>\n                                                  moveUnitReserves(index, unit.id)\n                                                }>\n                                                  <ListItemIcon>\n                                                    <FontAwesomeIcon\n                                                      icon={faArrowRight}\n                                                    />\n                                                  </ListItemIcon>\n                                                  <ListItemText>To Reserves</ListItemText>\n                                                </MenuItem>\n                                              )}\n                                            {!!editMode &&\n                                              listType === \"campaign\" &&\n                                              showingReserves && (\n                                                <MenuItem onClick={() =>\n                                                  moveUnitForce(index, unit.id)\n                                                }>\n                                                  <ListItemIcon>\n                                                    <FontAwesomeIcon\n                                                      icon={faArrowLeft}\n                                                    />\n                                                  </ListItemIcon>\n                                                  <ListItemText>To Force</ListItemText>\n                                                </MenuItem>\n                                              )}\n                                            {!!editMode && (\n                                              <MenuItem onClick={() =>\n                                                deleteUnit(index, unit.id)\n                                              }>\n                                                <ListItemIcon>\n                                                  <DeleteIcon />\n                                                </ListItemIcon>\n                                                <ListItemText>Delete</ListItemText>\n                                              </MenuItem>\n                                            )}\n                                          </Menu>\n                                        </>\n                                      )}\n                                    </Dropdown>\n                                  }\n                                  disablePadding\n                                >\n                                  <ListItemButton\n                                    onClick={(event) => {\n                                      event.preventDefault();\n                                      showViewUnit({\n                                        unit,\n                                        faction: forceFaction,\n                                      });\n                                    }}\n                                  >\n                                    <ListItemText\n                                      primary={\n                                        <>\n                                          <span style={{ marginRight: '5px' }}>{unit.customName || unit.name}\n                                          </span>{`(${unit.points} pts)`}\n                                          <span className=\"badge badge-success\">\n                                            {listType === \"campaign\" &&\n                                              unitLevel > 0\n                                              ? ` ${formatLevel(unitLevel)}`\n                                              : \"\"}\n                                          </span>\n                                          <span className=\"badge badge-danger\">\n                                            {listType === \"campaign\" &&\n                                              unitSetbacksCount > 0\n                                              ? `${unitSetbacksCount} ${unitSetbacksCount > 1\n                                                ? \"Injuries\"\n                                                : \"Injury\"\n                                              }`\n                                              : \"\"}\n                                          </span>\n                                        </>\n                                      }\n                                    />\n                                  </ListItemButton>\n                                </ListItem>\n                              </>\n                            );\n                          })}\n                      </>\n                    );\n                  })}\n                  {(!filteredCategories.length && !forceLegends.length) && (\n                    <>\n                      Force is empty...\n                    </>\n                  )}\n                </List>\n              </CardContent>\n            </Card>\n          );\n        })}\n        <input\n          id=\"file-input\"\n          type=\"file\"\n          name=\"name\"\n          multiple\n          ref={fileDialog}\n          onChange={uploadList}\n          style={{ height: \"0\", overflow: \"hidden\", display: \"none\" }}\n        />\n      </Container>\n    </>\n  );\n});\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nconst link = {\n  normal: {\n    borderBottom: '1px dotted rgb(0, 168, 0)',\n  },\n  hover: {\n    borderBottom: '1px solid rgb(0, 168, 0)',\n    color: 'black',\n  },\n  active: 'hover'\n};\n\nconst childLink = {};\nObject.keys(link).forEach((key) => {\n  if (key !== 'touchActiveTapOnly') {\n    childLink[`onParent${key.slice(0, 1).toUpperCase()}${key.slice(1)}`] = link[key];\n  }\n});\n\nexport const Code = ({ children }) => (\n  <code\n    style={{\n      fontFamily: 'monospace',\n      fontSize: '15px',\n      paddingLeft: '2px',\n    }}\n  >{children}</code>\n);\n\nCode.propTypes = {\n  children: PropTypes.string.isRequired,\n};\n\nexport const Li = ({ children, ...rest }) => (\n  <li\n    style={{\n      paddingLeft: '18px',\n      textIndent: '-15px',\n      margin: '0.5vh 0',\n      listStyle: 'none',\n    }}\n    {...rest}\n  >\n    <span style={{ paddingRight: '7px' }}>&ndash;</span>\n    {children}\n  </li>\n);\n\nLi.propTypes = {\n  children: PropTypes.string.isRequired,\n};\n\nconst thingy = {\n  link,\n  childLink,\n  p: {\n    margin: '3vh 0',\n    lineHeight: '1.4',\n  },\n};\n\nexport default thingy;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Code } from '../styles/style';\nimport Container from '@mui/material/Container';\n\nconst propTypes = {\n  location: PropTypes.object.isRequired,\n};\n\nexport default function PageNotFound({ location }) {\n  return (\n    <Container>\n      <p className=\"text-center\">\n        Page not found - the path, <Code>{location.pathname}</Code>,\n        did not match any React Router routes.\n      </p>\n    </Container>\n  );\n}\n\nPageNotFound.propTypes = propTypes;\n","import Container from '@mui/material/Container';\nimport React from \"react\";\n\n\nconst renderPolicy = (props) => (\n  <>\n    <h1>Privacy Policy</h1>\n    <p>Last updated: September 06, 2021</p>\n    <p>\n      This Privacy Policy describes Our policies and procedures on the\n      collection, use and disclosure of Your information when You use the\n      Service and tells You about Your privacy rights and how the law protects\n      You.\n    </p>\n    <p>\n      We use Your Personal data to provide and improve the Service. By using the\n      Service, You agree to the collection and use of information in accordance\n      with this Privacy Policy.\n      .\n    </p>\n    <h1>Interpretation and Definitions</h1>\n    <h2>Interpretation</h2>\n    <p>\n      The words of which the initial letter is capitalized have meanings defined\n      under the following conditions. The following definitions shall have the\n      same meaning regardless of whether they appear in singular or in plural.\n    </p>\n    <h2>Definitions</h2>\n    <p>For the purposes of this Privacy Policy:</p>\n    <ul>\n      <li>\n        <p>\n          <strong>Account</strong> means a unique account created for You to\n          access our Service or parts of our Service.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>Company</strong> (referred to as either &quot;the\n          Company&quot;, &quot;We&quot;, &quot;Us&quot; or &quot;Our&quot; in\n          this Agreement) refers to Battle Forge.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>Cookies</strong> are small files that are placed on Your\n          computer, mobile device or any other device by a website, containing\n          the details of Your browsing history on that website among its many\n          uses.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>Country</strong> refers to: New Jersey, United States\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>Device</strong> means any device that can access the Service\n          such as a computer, a cellphone or a digital tablet.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>Personal Data</strong> is any information that relates to an\n          identified or identifiable individual.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>Service</strong> refers to the Website.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>Service Provider</strong> means any natural or legal person\n          who processes the data on behalf of the Company. It refers to\n          third-party companies or individuals employed by the Company to\n          facilitate the Service, to provide the Service on behalf of the\n          Company, to perform services related to the Service or to assist the\n          Company in analyzing how the Service is used.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>Third-party Social Media Service</strong> refers to any\n          website or any social network website through which a User can log in\n          or create an account to use the Service.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>Usage Data</strong> refers to data collected automatically,\n          either generated by the use of the Service or from the Service\n          infrastructure itself (for example, the duration of a page visit).\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>Website</strong> refers to Battle Forge, accessible from{\" \"}\n          <a\n            href=\"https://www.battleforgedgame.com\"\n            rel=\"noreferrer external nofollow noopener\"\n            target=\"_blank\"\n          >\n            https://www.battleforgedgame.com\n          </a>\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>You</strong> means the individual accessing or using the\n          Service, or the company, or other legal entity on behalf of which such\n          individual is accessing or using the Service, as applicable.\n        </p>\n      </li>\n    </ul>\n    <h1>Collecting and Using Your Personal Data</h1>\n    <h2>Types of Data Collected</h2>\n    <h3>Personal Data</h3>\n    <p>\n      While using Our Service, We may ask You to provide Us with certain\n      personally identifiable information that can be used to contact or\n      identify You. Personally identifiable information may include, but is not\n      limited to:\n    </p>\n    <ul>\n      <li>\n        <p>Email address</p>\n      </li>\n      <li>\n        <p>First name and last name</p>\n      </li>\n      <li>\n        <p>Usage Data</p>\n      </li>\n    </ul>\n    <h3>Usage Data</h3>\n    <p>Usage Data is collected automatically when using the Service.</p>\n    <p>\n      Usage Data may include information such as Your Device's Internet Protocol\n      address (e.g. IP address), browser type, browser version, the pages of our\n      Service that You visit, the time and date of Your visit, the time spent on\n      those pages, unique device identifiers and other diagnostic data.\n    </p>\n    <p>\n      When You access the Service by or through a mobile device, We may collect\n      certain information automatically, including, but not limited to, the type\n      of mobile device You use, Your mobile device unique ID, the IP address of\n      Your mobile device, Your mobile operating system, the type of mobile\n      Internet browser You use, unique device identifiers and other diagnostic\n      data.\n    </p>\n    <p>\n      We may also collect information that Your browser sends whenever You visit\n      our Service or when You access the Service by or through a mobile device.\n    </p>\n    <h3>Information from Third-Party Social Media Services</h3>\n    <p>\n      The Company allows You to create an account and log in to use the Service\n      through the following Third-party Social Media Services:\n    </p>\n    <ul>\n      <li>Google</li>\n      <li>Facebook</li>\n      <li>Twitter</li>\n    </ul>\n    <p>\n      If You decide to register through or otherwise grant us access to a\n      Third-Party Social Media Service, We may collect Personal data that is\n      already associated with Your Third-Party Social Media Service's account,\n      such as Your name, Your email address, Your activities or Your contact\n      list associated with that account.\n    </p>\n    <p>\n      You may also have the option of sharing additional information with the\n      Company through Your Third-Party Social Media Service's account. If You\n      choose to provide such information and Personal Data, during registration\n      or otherwise, You are giving the Company permission to use, share, and\n      store it in a manner consistent with this Privacy Policy.\n    </p>\n    <h3>Tracking Technologies and Cookies</h3>\n    <p>\n      We use Cookies and similar tracking technologies to track the activity on\n      Our Service and store certain information. Tracking technologies used are\n      beacons, tags, and scripts to collect and track information and to improve\n      and analyze Our Service. The technologies We use may include:\n    </p>\n    <ul>\n      <li>\n        <strong>Cookies or Browser Cookies.</strong> A cookie is a small file\n        placed on Your Device. You can instruct Your browser to refuse all\n        Cookies or to indicate when a Cookie is being sent. However, if You do\n        not accept Cookies, You may not be able to use some parts of our\n        Service. Unless you have adjusted Your browser setting so that it will\n        refuse Cookies, our Service may use Cookies.\n      </li>\n      <li>\n        <strong>Flash Cookies.</strong> Certain features of our Service may use\n        local stored objects (or Flash Cookies) to collect and store information\n        about Your preferences or Your activity on our Service. Flash Cookies\n        are not managed by the same browser settings as those used for Browser\n        Cookies. For more information on how You can delete Flash Cookies,\n        please read &quot;Where can I change the settings for disabling, or\n        deleting local shared objects?&quot; available at{\" \"}\n        <a\n          href=\"https://helpx.adobe.com/flash-player/kb/disable-local-shared-objects-flash.html#main_Where_can_I_change_the_settings_for_disabling__or_deleting_local_shared_objects_\"\n          rel=\"noreferrer external nofollow noopener\"\n          target=\"_blank\"\n        >\n          https://helpx.adobe.com/flash-player/kb/disable-local-shared-objects-flash.html#main_Where_can_I_change_the_settings_for_disabling__or_deleting_local_shared_objects_\n        </a>\n      </li>\n      <li>\n        <strong>Web Beacons.</strong> Certain sections of our Service and our\n        emails may contain small electronic files known as web beacons (also\n        referred to as clear gifs, pixel tags, and single-pixel gifs) that\n        permit the Company, for example, to count users who have visited those\n        pages or opened an email and for other related website statistics (for\n        example, recording the popularity of a certain section and verifying\n        system and server integrity).\n      </li>\n    </ul>\n    <p>\n      Cookies can be &quot;Persistent&quot; or &quot;Session&quot; Cookies.\n      Persistent Cookies remain on Your personal computer or mobile device when\n      You go offline, while Session Cookies are deleted as soon as You close\n      Your web browser. You can learn more about cookies here:{\" \"}\n      <a href=\"https://www.termsfeed.com/blog/cookies/\" target=\"_blank\" rel=\"noreferrer\">\n        All About Cookies by TermsFeed\n      </a>\n      .\n    </p>\n    <p>\n      We use both Session and Persistent Cookies for the purposes set out below:\n    </p>\n    <ul>\n      <li>\n        <p>\n          <strong>Necessary / Essential Cookies</strong>\n        </p>\n        <p>Type: Session Cookies</p>\n        <p>Administered by: Us</p>\n        <p>\n          Purpose: These Cookies are essential to provide You with services\n          available through the Website and to enable You to use some of its\n          features. They help to authenticate users and prevent fraudulent use\n          of user accounts. Without these Cookies, the services that You have\n          asked for cannot be provided, and We only use these Cookies to provide\n          You with those services.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>Cookies Policy / Notice Acceptance Cookies</strong>\n        </p>\n        <p>Type: Persistent Cookies</p>\n        <p>Administered by: Us</p>\n        <p>\n          Purpose: These Cookies identify if users have accepted the use of\n          cookies on the Website.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>Functionality Cookies</strong>\n        </p>\n        <p>Type: Persistent Cookies</p>\n        <p>Administered by: Us</p>\n        <p>\n          Purpose: These Cookies allow us to remember choices You make when You\n          use the Website, such as remembering your login details or language\n          preference. The purpose of these Cookies is to provide You with a more\n          personal experience and to avoid You having to re-enter your\n          preferences every time You use the Website.\n        </p>\n      </li>\n    </ul>\n    <p>\n      For more information about the cookies we use and your choices regarding\n      cookies, please visit our Cookies Policy or the Cookies section of our\n      Privacy Policy.\n    </p>\n    <h2>Use of Your Personal Data</h2>\n    <p>The Company may use Personal Data for the following purposes:</p>\n    <ul>\n      <li>\n        <p>\n          <strong>To provide and maintain our Service</strong>, including to\n          monitor the usage of our Service.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>To manage Your Account:</strong> to manage Your registration\n          as a user of the Service. The Personal Data You provide can give You\n          access to different functionalities of the Service that are available\n          to You as a registered user.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>For the performance of a contract:</strong> the development,\n          compliance and undertaking of the purchase contract for the products,\n          items or services You have purchased or of any other contract with Us\n          through the Service.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>To contact You:</strong> To contact You by email, telephone\n          calls, SMS, or other equivalent forms of electronic communication,\n          such as a mobile application's push notifications regarding updates or\n          informative communications related to the functionalities, products or\n          contracted services, including the security updates, when necessary or\n          reasonable for their implementation.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>To provide You</strong> with news, special offers and general\n          information about other goods, services and events which we offer that\n          are similar to those that you have already purchased or enquired about\n          unless You have opted not to receive such information.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>To manage Your requests:</strong> To attend and manage Your\n          requests to Us.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>For business transfers:</strong> We may use Your information\n          to evaluate or conduct a merger, divestiture, restructuring,\n          reorganization, dissolution, or other sale or transfer of some or all\n          of Our assets, whether as a going concern or as part of bankruptcy,\n          liquidation, or similar proceeding, in which Personal Data held by Us\n          about our Service users is among the assets transferred.\n        </p>\n      </li>\n      <li>\n        <p>\n          <strong>For other purposes</strong>: We may use Your information for\n          other purposes, such as data analysis, identifying usage trends,\n          determining the effectiveness of our promotional campaigns and to\n          evaluate and improve our Service, products, services, marketing and\n          your experience.\n        </p>\n      </li>\n    </ul>\n    <p>We may share Your personal information in the following situations:</p>\n    <ul>\n      <li>\n        <strong>With Service Providers:</strong> We may share Your personal\n        information with Service Providers to monitor and analyze the use of our\n        Service, to contact You.\n      </li>\n      <li>\n        <strong>For business transfers:</strong> We may share or transfer Your\n        personal information in connection with, or during negotiations of, any\n        merger, sale of Company assets, financing, or acquisition of all or a\n        portion of Our business to another company.\n      </li>\n      <li>\n        <strong>With Affiliates:</strong> We may share Your information with Our\n        affiliates, in which case we will require those affiliates to honor this\n        Privacy Policy. Affiliates include Our parent company and any other\n        subsidiaries, joint venture partners or other companies that We control\n        or that are under common control with Us.\n      </li>\n      <li>\n        <strong>With business partners:</strong> We may share Your information\n        with Our business partners to offer You certain products, services or\n        promotions.\n      </li>\n      <li>\n        <strong>With other users:</strong> when You share personal information\n        or otherwise interact in the public areas with other users, such\n        information may be viewed by all users and may be publicly distributed\n        outside. If You interact with other users or register through a\n        Third-Party Social Media Service, Your contacts on the Third-Party\n        Social Media Service may see Your name, profile, pictures and\n        description of Your activity. Similarly, other users will be able to\n        view descriptions of Your activity, communicate with You and view Your\n        profile.\n      </li>\n      <li>\n        <strong>With Your consent</strong>: We may disclose Your personal\n        information for any other purpose with Your consent.\n      </li>\n    </ul>\n    <h2>Retention of Your Personal Data</h2>\n    <p>\n      The Company will retain Your Personal Data only for as long as is\n      necessary for the purposes set out in this Privacy Policy. We will retain\n      and use Your Personal Data to the extent necessary to comply with our\n      legal obligations (for example, if we are required to retain your data to\n      comply with applicable laws), resolve disputes, and enforce our legal\n      agreements and policies.\n    </p>\n    <p>\n      The Company will also retain Usage Data for internal analysis purposes.\n      Usage Data is generally retained for a shorter period of time, except when\n      this data is used to strengthen the security or to improve the\n      functionality of Our Service, or We are legally obligated to retain this\n      data for longer time periods.\n    </p>\n    <h2>Transfer of Your Personal Data</h2>\n    <p>\n      Your information, including Personal Data, is processed at the Company's\n      operating offices and in any other places where the parties involved in\n      the processing are located. It means that this information may be\n      transferred to — and maintained on — computers located outside of Your\n      state, province, country or other governmental jurisdiction where the data\n      protection laws may differ than those from Your jurisdiction.\n    </p>\n    <p>\n      Your consent to this Privacy Policy followed by Your submission of such\n      information represents Your agreement to that transfer.\n    </p>\n    <p>\n      The Company will take all steps reasonably necessary to ensure that Your\n      data is treated securely and in accordance with this Privacy Policy and no\n      transfer of Your Personal Data will take place to an organization or a\n      country unless there are adequate controls in place including the security\n      of Your data and other personal information.\n    </p>\n    <h2>Disclosure of Your Personal Data</h2>\n    <h3>Business Transactions</h3>\n    <p>\n      If the Company is involved in a merger, acquisition or asset sale, Your\n      Personal Data may be transferred. We will provide notice before Your\n      Personal Data is transferred and becomes subject to a different Privacy\n      Policy.\n    </p>\n    <h3>Law enforcement</h3>\n    <p>\n      Under certain circumstances, the Company may be required to disclose Your\n      Personal Data if required to do so by law or in response to valid requests\n      by public authorities (e.g. a court or a government agency).\n    </p>\n    <h3>Other legal requirements</h3>\n    <p>\n      The Company may disclose Your Personal Data in the good faith belief that\n      such action is necessary to:\n    </p>\n    <ul>\n      <li>Comply with a legal obligation</li>\n      <li>Protect and defend the rights or property of the Company</li>\n      <li>\n        Prevent or investigate possible wrongdoing in connection with the\n        Service\n      </li>\n      <li>Protect the personal safety of Users of the Service or the public</li>\n      <li>Protect against legal liability</li>\n    </ul>\n    <h2>Security of Your Personal Data</h2>\n    <p>\n      The security of Your Personal Data is important to Us, but remember that\n      no method of transmission over the Internet, or method of electronic\n      storage is 100% secure. While We strive to use commercially acceptable\n      means to protect Your Personal Data, We cannot guarantee its absolute\n      security.\n    </p>\n    <h1>Children's Privacy</h1>\n    <p>\n      Our Service does not address anyone under the age of 13. We do not\n      knowingly collect personally identifiable information from anyone under\n      the age of 13. If You are a parent or guardian and You are aware that Your\n      child has provided Us with Personal Data, please contact Us. If We become\n      aware that We have collected Personal Data from anyone under the age of 13\n      without verification of parental consent, We take steps to remove that\n      information from Our servers.\n    </p>\n    <p>\n      If We need to rely on consent as a legal basis for processing Your\n      information and Your country requires consent from a parent, We may\n      require Your parent's consent before We collect and use that information.\n    </p>\n    <h1>Links to Other Websites</h1>\n    <p>\n      Our Service may contain links to other websites that are not operated by\n      Us. If You click on a third party link, You will be directed to that third\n      party's site. We strongly advise You to review the Privacy Policy of every\n      site You visit.\n    </p>\n    <p>\n      We have no control over and assume no responsibility for the content,\n      privacy policies or practices of any third party sites or services.\n    </p>\n    <h1>Changes to this Privacy Policy</h1>\n    <p>\n      We may update Our Privacy Policy from time to time. We will notify You of\n      any changes by posting the new Privacy Policy on this page.\n    </p>\n    <p>\n      We will let You know via email and/or a prominent notice on Our Service,\n      prior to the change becoming effective and update the &quot;Last\n      updated&quot; date at the top of this Privacy Policy.\n    </p>\n    <p>\n      You are advised to review this Privacy Policy periodically for any\n      changes. Changes to this Privacy Policy are effective when they are posted\n      on this page.\n    </p>\n    <h1>Contact Us</h1>\n    <p>\n      If you have any questions about this Privacy Policy, You can contact us:\n    </p>\n    <ul>\n      <li>By email: indiegamerules@gmail.com</li>\n    </ul>\n  </>\n);\n\nconst Privacy = (props) => {\n  return (\n    <>\n      <Container>\n        {renderPolicy()}\n      </Container>\n    </>\n  );\n};\n\nexport default Privacy;\n","import AddIcon from '@mui/icons-material/Add';\nimport {\n  Button, Dialog, DialogActions, DialogContent, DialogTitle, FormControl, FormControlLabel, FormLabel, IconButton, List, ListItem, ListItemButton, ListItemText, ListSubheader, Radio, RadioGroup, Stack, TextField, Typography\n} from \"@mui/material\";\nimport useTheme from \"@mui/material/styles/useTheme\";\nimport useMediaQuery from \"@mui/material/useMediaQuery\";\nimport {\n  get, groupBy, sortBy\n} from \"lodash\";\nimport React, {\n  useState\n} from \"react\";\n\nconst LIST_TYPES = [\n  { label: \"Competitive\", value: \"competitive\" },\n  { label: \"Narrative\", value: \"narrative\" },\n  // { label: \"Campaign\", value: \"campaign\" },\n];\nexport const AddListOld = (props) => {\n  const { hideModal, addList } = props;\n  const [listName, setListName] = useState(\"\");\n  const [listType, setListType] = useState(\"competitive\");\n  return (\n    <>\n      <Dialog open maxWidth=\"md\" fullWidth onClose={hideModal}>\n        <DialogTitle closeButton>Create Roster</DialogTitle>\n        <DialogContent>\n          <Stack spacing={2} sx={{ mt: 1 }}>\n            <FormControl>\n              <TextField\n                id=\"standard-basic\"\n                label=\"Force Name\"\n                variant=\"outlined\"\n                onChange={(value) => setListName(value.target.value)}\n                value={listName}\n              />\n            </FormControl>\n            <FormControl>\n              <FormLabel component=\"legend\">List Type</FormLabel>\n              <RadioGroup\n                row\n                aria-label=\"gender\"\n                name=\"row-radio-buttons-group\"\n                onChange={(event) => setListType(event.target.value)}\n                value={listType}\n              >\n                {LIST_TYPES.map((type, index) => (\n                  <FormControlLabel\n                    key={index}\n                    value={type.value}\n                    control={<Radio />}\n                    label={type.label}\n                  />\n                ))}\n              </RadioGroup>\n            </FormControl>\n          </Stack>\n        </DialogContent>\n        <DialogActions>\n          <Button color=\"secondary\" onClick={hideModal}>\n            Cancel\n          </Button>\n          <Button\n            color=\"primary\"\n            onClick={() => {\n              if (listName) {\n                addList(listName, { type: listType });\n                hideModal();\n              }\n            }}\n          >\n            Create\n          </Button>{\" \"}\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport const UpdateList = (props) => {\n  const { hideModal, updateList, listId, lists } = props;\n  const oldListName = get(lists, `[${listId}].name`, \"\");\n  const oldListType = get(lists, `[${listId}].type`, \"\");\n  const [listName, setListName] = useState(oldListName);\n  const [listType, setListType] = useState(oldListType || \"competitive\");\n  return (\n    <>\n      <Dialog open maxWidth=\"md\" fullWidth onClose={hideModal}>\n        <DialogTitle>\n          Roster Settings\n        </DialogTitle>\n        <DialogContent>\n          <Stack spacing={2} sx={{ mt: 1 }}>\n            <FormControl>\n              <TextField\n                id=\"standard-basic\"\n                label=\"Force Name\"\n                variant=\"outlined\"\n                onChange={(value) => setListName(value.target.value)}\n                value={listName}\n              />\n            </FormControl>\n            <FormControl>\n              <FormLabel component=\"legend\">List Type</FormLabel>\n              <RadioGroup\n                row\n                aria-label=\"gender\"\n                name=\"row-radio-buttons-group\"\n                onChange={(event) => setListType(event.target.value)}\n                value={listType}\n              >\n                {LIST_TYPES.map((type, index) => (\n                  <FormControlLabel\n                    key={index}\n                    value={type.value}\n                    control={<Radio />}\n                    label={type.label}\n                  />\n                ))}\n              </RadioGroup>\n            </FormControl>\n          </Stack>\n        </DialogContent>\n        <DialogActions>\n          <Button color=\"secondary\" onClick={hideModal}>\n            Cancel\n          </Button>\n          <Button\n            color=\"primary\"\n            onClick={() => {\n              if (listName) {\n                updateList(listId, {\n                  name: listName,\n                  type: listType,\n                });\n                hideModal();\n              }\n            }}\n          >\n            Save\n          </Button>{\" \"}\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport const ShareList = (props) => {\n  const { hideModal, listData, copyToClipboard } = props;\n  const url = `${window?.location?.origin?.toString()}/lists?listShare=${listData}`;\n  return (\n    <>\n      <Dialog open maxWidth=\"md\" fullWidth onClose={hideModal}>\n        <DialogTitle>\n          Share Roster\n        </DialogTitle>\n        <DialogContent>\n          <Stack direction=\"row\" spacing={2} sx={{ mt: 1 }}>\n            <FormControl style={{ flexGrow: 1 }}>\n              <TextField\n                fullWidth\n                id=\"standard-basic\"\n                label=\"Share Url\"\n                variant=\"outlined\"\n                value={url}\n                \n              />\n            </FormControl>\n            <Button onClick={() => copyToClipboard('Successfully copied url to clipboard.', url)}>Copy</Button>\n            {/* <FormControl>\n              <FormLabel component=\"legend\">List Type</FormLabel>\n              <RadioGroup\n                row\n                aria-label=\"gender\"\n                name=\"row-radio-buttons-group\"\n                onChange={(event) => setListType(event.target.value)}\n                value={listType}\n              >\n                {LIST_TYPES.map((type, index) => (\n                  <FormControlLabel\n                    key={index}\n                    value={type.value}\n                    control={<Radio />}\n                    label={type.label}\n                  />\n                ))}\n              </RadioGroup>\n            </FormControl> */}\n          </Stack>\n        </DialogContent>\n        <DialogActions>\n          <Button color=\"primary\" onClick={hideModal}>\n            Done\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport const AddList = (props) => {\n  const { hideModal, userPrefs, addList, rawData } = props;\n  const [listName, setListName] = useState(\"\");\n  const [listType, setListType] = useState(\"competitive\");\n  const [gameId, setGameId] = useState();\n  const showBeta = userPrefs.showBeta;\n  const gameTypesRaw = {\n    ...get(rawData, \"gameData.gameTypes\", {}),\n  };\n  const gamesUnsorted = Object.values(get(rawData, `gameData.games`, {})).filter(\n    (game) => (showBeta ? true : game.version && Number(game.version) >= 1)\n  );\n  const gameTypes = [\n    ...Object.keys(gameTypesRaw).filter(\n      (gameType) =>\n        gamesUnsorted.filter((game) => game.gameType === gameType).length\n    ),\n  ];\n  const unitCategories = groupBy(gamesUnsorted, \"gameType\");\n  const categoryOrder = [...gameTypes, undefined].filter(\n    (cat) => unitCategories[cat] && unitCategories[cat].length\n  );\n  const theme = useTheme();\n  const fullScreen = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  return (\n    <>\n      <Dialog\n        open\n        fullScreen={fullScreen}\n        fullWidth\n        onClose={hideModal}\n        maxWidth=\"lg\"\n      >\n        {!gameId && (\n          <>\n            <DialogTitle closeButton>Choose Game</DialogTitle>\n            <DialogContent style={{ padding: 0 }} sx={{ backgroundColor: 'background.paper' }}>\n              <List style={{ height: '100%' }}>\n                {categoryOrder.map((allianceKey) => {\n                  const theFactions = sortBy(\n                    get(unitCategories, `[${allianceKey}]`, []),\n                    \"name\"\n                  );\n                  const allianceData = gameTypesRaw[allianceKey];\n                  return (\n                    <>\n                      <ListSubheader>\n                        <Typography\n                          sx={{ py: 0.5 }}\n                          fontWeight=\"bold\"\n                          variant=\"h5\"\n                        >\n                          {allianceData.name || \"Unaligned\"}\n                        </Typography>\n                      </ListSubheader>\n                      {Object.keys(theFactions).map((orgKey) => {\n                        const org = theFactions[orgKey];\n                        return (\n                          <ListItem\n                            disablePadding\n                            secondaryAction={\n                              <IconButton\n                                sx={{ color: \"primary.main\" }}\n                                onClick={() => {\n                                  setGameId(org.id);\n                                }}\n                              >\n                                <AddIcon />\n                              </IconButton>\n                            }\n                          >\n                            <ListItemButton\n                              onClick={() => {\n                                setGameId(org.id);\n                              }}\n                            >\n                              <ListItemText\n                                primary={\n                                  <>\n                                    {`${org.name}`}\n                                    <small>\n                                      {org.version ? ` (${org.version})` : \"\"}\n                                    </small>\n                                  </>\n                                }\n                                secondary={<>{`${org.description || \"\"}`}</>}\n                              />\n                            </ListItemButton>\n                          </ListItem>\n                        );\n                      })}\n                    </>\n                  );\n                })}\n              </List>\n            </DialogContent>\n            <DialogActions>\n              <Button color=\"primary\" onClick={hideModal}>\n                Cancel\n              </Button>\n            </DialogActions>\n          </>\n        )}\n        {!!gameId && <><DialogTitle closeButton>Create Roster</DialogTitle>\n          <DialogContent>\n            <Stack spacing={2} sx={{ mt: 1 }}>\n              <FormControl>\n                <TextField\n                  id=\"standard-basic\"\n                  label=\"Force Name\"\n                  variant=\"outlined\"\n                  onChange={(value) => setListName(value.target.value)}\n                  value={listName}\n                />\n              </FormControl>\n              <FormControl>\n                <FormLabel component=\"legend\">List Type</FormLabel>\n                <RadioGroup\n                  row\n                  aria-label=\"gender\"\n                  name=\"row-radio-buttons-group\"\n                  onChange={(event) => setListType(event.target.value)}\n                  value={listType}\n                >\n                  {LIST_TYPES.map((type, index) => (\n                    <FormControlLabel\n                      key={index}\n                      value={type.value}\n                      control={<Radio />}\n                      label={type.label}\n                    />\n                  ))}\n                </RadioGroup>\n              </FormControl>\n            </Stack>\n          </DialogContent>\n          <DialogActions>\n            <Button color=\"secondary\" onClick={hideModal}>\n              Cancel\n            </Button>\n            <Button\n              color=\"primary\"\n              onClick={() => {\n                if (listName) {\n                  addList(listName, { type: listType, gameId });\n                  hideModal();\n                }\n              }}\n            >\n              Create\n            </Button>{\" \"}\n          </DialogActions>\n        </>}\n      </Dialog>\n    </>\n  );\n};\n","import AddIcon from '@mui/icons-material/Add';\nimport DeleteIcon from '@mui/icons-material/Delete';\nimport DownloadIcon from '@mui/icons-material/Download';\nimport EditIcon from '@mui/icons-material/Edit';\nimport MoreVertIcon from '@mui/icons-material/MoreVert';\nimport RefreshIcon from '@mui/icons-material/Refresh';\nimport SettingsIcon from '@mui/icons-material/Settings';\nimport ShareIcon from '@mui/icons-material/Share';\nimport UploadIcon from '@mui/icons-material/Upload';\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  Container, IconButton, List, ListItem, ListItemButton, ListItemIcon, ListItemText, ListSubheader, Menu,\n  MenuItem\n} from \"@mui/material\";\nimport Box from \"@mui/material/Box\";\nimport Typography from \"@mui/material/Typography\";\nimport CustomCircularProgress from \"components/CustomCircularProgress\";\nimport { Dropdown } from \"components/dropdown\";\nimport { DataContext, PointsCacheContext, useModal } from \"hooks\";\nimport { get, groupBy, omit, sortBy } from \"lodash\";\nimport { useSnackbar } from \"notistack\";\nimport React from 'react';\nimport { useHistory, useLocation } from \"react-router-dom\";\nimport Tour from \"reactour\";\nimport { AddList, ShareList, UpdateList } from 'routes/rosters/modals';\nimport { DataAPI, mergeGlobalData } from \"utils/data\";\nimport { downloadFile, readFileContent } from \"utils/files\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nconst allSteps = [];\nconst steps = [\n  [\n    {\n      selector: \"#tab-0\",\n      content:\n        \"This is the module overview. This gives you background information and an overview of the game module.\",\n      stepInteraction: false,\n    },\n  ],\n  [\n    {\n      selector: \"#tab-1\",\n      content:\n        \"These are the game rules. This gives you the core rules of the game module.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".terrain-card:first-of-type\",\n      content:\n        \"This is a piece of terrain. It contains a brief description of what it might look like and any assocaited rules.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".mission-card:first-of-type\",\n      content:\n        \"This is a scenario. Each scenario has its own way to score victory points and deployment conditions.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".secondary-card:first-of-type\",\n      content:\n        \"This is a secondary objective. Player can select one of these to be the secondary objective for the mission.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".twist-card:first-of-type\",\n      content:\n        \"This is a twist. Player can select one of these to add an interesting twist to the mission.\",\n      stepInteraction: false,\n    },\n  ],\n  [\n    {\n      selector: \"#tab-4\",\n      content:\n        \"This is the factions list. This gives you a list of all factions in the module. Factions can sometimes be grouped into alliances.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \".faction-card:first-of-type\",\n      content:\n        \"This is a faction. It contains a brief description of the faction and clicking on it will bring you to the roster for that faction.\",\n      stepInteraction: false,\n    },\n  ],\n  [\n    {\n      selector: \"#tab-3\",\n      content:\n        \"This is the scenarios tab. It can give you a random scenario to play with optional parameters.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \"#generateScenario\",\n      content:\n        \"Pressing this button will generate a new scenario for you to play with a random mission, secondary and optional twist.\",\n      stepInteraction: false,\n    },\n  ],\n  [\n    {\n      selector: \"#tab-4\",\n      content:\n        \"This is the rosters tab. It allows you to create rosters to play this game module.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \"#createList\",\n      content:\n        \"Pressing this button will open the force creator and allow you to give the force a name and choose a type.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \"#importList\",\n      content:\n        \"Pressing this button will allow you to import a force from a file into the force manager.\",\n      stepInteraction: false,\n    },\n    {\n      selector: \"#list-manager\",\n      content:\n        \"This is the force manager. It contains all your previously created lists. You can click on the name of a list to go to it or click the ellipses to edit or delete the list properties.\",\n      stepInteraction: false,\n    },\n  ],\n];\n\nexport default React.memo((props) => {\n  const { gameName } = props.match.params;\n  const [\n    {\n      data: nope,\n      coreData,\n      fetchGame,\n      setData,\n      refreshData,\n      isLoading,\n      appState,\n      userPrefs,\n      setAppState\n    },\n  ] = React.useContext(DataContext);\n  const nameFilter = appState?.searchText;\n  const [isTourOpen, setIsTourOpen] = React.useState(false);\n  const fileDialog = React.useRef();\n  const history = useHistory();\n  // const theme = useTheme();\n  const location = useLocation();\n  const queryParams = React.useMemo(() => new URLSearchParams(location.search), [location.search]);\n  const shareData = queryParams?.get(\"listShare\");\n    // Default active tab!!!\n    const [activeTab] = React.useState(get(appState, \"factionTab\", 2));\n    const cache = React.useContext(PointsCacheContext);\n    const game = get(nope, `gameData.games[${gameName}]`, {});\n    const coreGame = get(coreData, `gameData.games[${gameName}]`, {});\n    React.useEffect(() => {\n      if (!game.factions || (!coreGame.factions && !isLoading)) {\n        fetchGame(gameName);\n      }\n    }, [coreData, coreGame.factions, fetchGame, game.factions, gameName, isLoading]);\n    const globalData = mergeGlobalData(game, nope);\n    const data = DataAPI(game, cache, globalData);\n    const gamesRaw = get(nope, `gameData.games`, {});\n    const rawLists = get(nope, `lists`, []);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    const lists = {};\n    Object.keys(rawLists).forEach((listId) => {\n      const list = rawLists[listId];\n      const gameId = list?.gameId;\n      if (gameId && gamesRaw[gameId]) {\n        lists[listId] = { ...list, id: listId };\n      }\n    });\n    const listsByGame = groupBy(Object.values(lists), 'gameId');\n  const { enqueueSnackbar } = useSnackbar();\n  const setLists = React.useCallback((listData) => {\n    const newGameData = {\n      ...coreData,\n      lists: {\n        ...listData\n      }\n    };\n    setData(newGameData);\n  }, [coreData, setData]);\n  const importList = React.useCallback((listObject) => {\n    if (listObject.forces) {\n      const newArmyData = {\n        ...listObject,\n      };\n      const listName = listObject.name;\n      const listId = uuidv4();\n      setLists({\n        ...lists,\n        [listId]: {\n          name: listName,\n          ...newArmyData,\n        },\n      });\n      enqueueSnackbar(`List '${listName}' successfully imported.`, {\n        appearance: \"success\",\n      });\n    }\n  }, [enqueueSnackbar, lists, setLists])\n  React.useEffect(() => {\n    if (!shareData) {\n      return;\n    }\n    let listObject = {};\n    try {\n      listObject = JSON.parse(atob(shareData));\n    } catch (e) {\n      return Promise.reject(e);\n    }\n    importList(listObject);\n    queryParams.set('share', '');\n    history.replace({\n      search: queryParams?.toString(),\n    });\n  }, [history, importList, queryParams, shareData]);\n  const addList = (listName, data) => {\n    const listId = uuidv4();\n    setLists({\n      ...lists,\n      [listId]: {\n        name: listName,\n        ...data,\n      },\n    });\n    goToList(listId);\n  };\n  const updateList = (listId, newData) => {\n    setLists({\n      ...lists,\n      [listId]: {\n        ...get(lists, `[${listId}]`, {}),\n        ...newData,\n      },\n    });\n  };\n  const goToList = (listId) =>\n    history.push(`/lists/${listId}`);\n  const handleClick = () => {\n    fileDialog.current.click();\n  };\n\n  const copyToClipboard = (message, text) => {\n    navigator.clipboard.writeText(text).then(function() {\n      enqueueSnackbar(message, {\n        appearance: \"success\",\n      });\n    }, function(err) {\n      enqueueSnackbar(`Failed to write to clipboard.`, {\n        appearance: \"error\",\n      });\n    });\n  }\n  const uploadFile = (event) => {\n    uploadList(event);\n  };\n  const uploadList = (event) => {\n    event.preventDefault();\n    const file = get(event, \"target.files[0]\");\n    if (file) {\n      readFileContent(file)\n        .then((content) => {\n          let listObject = {};\n          try {\n            listObject = JSON.parse(content);\n          } catch (e) {\n            return Promise.reject(e);\n          }\n          importList(listObject);\n        })\n        .catch((error) => {\n          enqueueSnackbar(`List failed to import. ${error.message}`, {\n            appearance: \"error\",\n          });\n        });\n    }\n    fileDialog.current.value = null;\n  };\n  const refreshFactions = () => {\n    refreshData(gameName)\n      .then(() => {\n        cache.resetCache();\n        enqueueSnackbar(`Game data successfully updated.`, {\n          appearance: \"success\",\n        });\n      })\n      .catch((error) => {\n        enqueueSnackbar(`Game failed to fetch factions. ${error.message}`, {\n          appearance: \"error\",\n        });\n      });\n  };\n  const [showAddList, hideAddList] = useModal(\n    ({ extraProps }) => (\n      <AddList\n        {...props}\n        rawData={nope}\n        userPrefs={userPrefs}\n        hideModal={hideAddList}\n        lists={lists}\n        data={data}\n        addList={addList}\n        {...extraProps}\n      />\n    ),\n    [lists]\n  );\n  const [showShareList, hideShareList] = useModal(\n    ({ extraProps }) => (\n      <ShareList\n        {...props}\n        hideModal={hideShareList}\n        copyToClipboard={copyToClipboard}\n        {...extraProps}\n      />\n    ),\n    [lists]\n  );\n  const [showEditList, hideEditList] = useModal(\n    ({ extraProps }) => (\n      <UpdateList\n        {...props}\n        hideModal={hideEditList}\n        lists={lists}\n        data={data}\n        updateList={updateList}\n        {...extraProps}\n      />\n    ),\n    [lists]\n  );\n\n  const deleteList = (id) => {\n    setLists(omit(lists, [id]));\n  };\n  const downloadList = (id) => {\n    downloadFile(\n      JSON.stringify(\n        {\n          ...get(lists, `[${id}]`),\n        },\n        null,\n        2\n      ),\n      \"data:text/json\",\n      `${get(lists, `[${id}].name`, id)}.json`\n    );\n  };\n  const shareList = (id) => {\n    const list = get(lists, `[${id}]`);\n    const listData = btoa(JSON.stringify(list));\n    showShareList({ listData, listName: list?.name });\n  };\n  React.useEffect(() => {\n    setAppState({\n      enableSearch: true,\n      contextActions: [\n        {\n          name: 'Create',\n          icon: <AddIcon />,\n          onClick: () => {\n            showAddList()\n          }\n        },\n        {\n          name: 'Import',\n          icon: <UploadIcon />,\n          onClick: () => {\n            handleClick()\n          }\n        },\n        {\n          name: 'Refresh',\n          icon: <RefreshIcon />,\n          onClick: () => {\n            refreshFactions()\n          }\n        }\n      ]\n    })\n    return () => {\n      setAppState({\n        contextActions: []\n      })\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  // const [dialOpen, setDialOpen] = React.useState(false);\n  if (!data) {\n    return (\n      <Box sx={{ textAlign: \"center\" }}>\n        <CustomCircularProgress />\n      </Box>\n    );\n  }\n  const factionColor = ' rgb(57, 110, 158)';\n  const textColor = 'white';\n  const filteredCategories = Object.keys(listsByGame);\n\n  return (\n    <Container>\n      <>\n        <Typography variant=\"h3\" align=\"center\" sx={{ mb: 2 }}>\n          Rosters\n        </Typography>\n        <Card\n          className=\"no-break\"\n          sx={{\n            border: `2px solid ${factionColor}`,\n            mb: 2,\n          }}\n        >\n          <CardHeader\n            sx={{ backgroundColor: factionColor, color: textColor, py: 1 }}\n            title={\n              <>\n                <Typography variant=\"h5\" component=\"div\">\n                  Manage Rosters\n                </Typography>\n              </>\n            }\n          // action={\n          //   <Dropdown>\n          //     {({ handleClose, open, handleOpen, anchorElement }) => (\n          //       <>\n          //         <IconButton sx={{ color: 'inherit', mr: 1 }} onClick={handleOpen}>\n          //           <MoreVertIcon />\n          //         </IconButton>\n          //         <Menu\n          //           anchorOrigin={{\n          //             vertical: \"bottom\",\n          //             horizontal: \"right\",\n          //           }}\n          //           transformOrigin={{\n          //             vertical: \"top\",\n          //             horizontal: \"right\",\n          //           }}\n          //           anchorEl={anchorElement}\n          //           id=\"basic-menu\"\n          //           open={open}\n          //           onClose={handleClose}\n          //           MenuListProps={{\n          //             dense: true,\n          //             onClick: handleClose,\n          //             \"aria-labelledby\": \"basic-button\",\n          //           }}\n          //         >\n\n\n          //         </Menu>\n          //       </>\n          //     )}\n          //   </Dropdown>\n\n          // }\n          />\n          <CardContent\n            style={{ padding: (filteredCategories.length) ? 0 : undefined }}\n          >\n            {!! filteredCategories.length && <List>\n              {filteredCategories.map((catKey, catIndex) => {\n                const category = gamesRaw[catKey];\n                const categoryLists = listsByGame[catKey];\n                const filteredLists = sortBy(\n                  categoryLists.filter((list) =>\n                    nameFilter\n                      ? list.name.toLowerCase().includes(nameFilter.toLowerCase())\n                      : true\n                  ),\n                  \"name\"\n                );\n                if (!category) {\n                  return <></>;\n                }\n                return (\n                  <>\n                    <ListItem\n                      key={catIndex}\n                      // secondaryAction={\n                      //   <>\n                      //     {!!editMode && (\n                      //       <IconButton\n                      //         sx={{ color: \"primary.main\" }}\n                      //         onClick={() => {}}\n                      //       >\n                      //         <AddIcon />\n                      //       </IconButton>\n                      //     )}\n                      //   </>\n                      // }\n                      disablePadding\n                    >\n                      <ListSubheader sx={{ flex: 1, zIndex: 0, backgroundColor: 'background.paper' }}>\n                        <Typography\n                          sx={{ py: 1 }}\n                          fontWeight=\"bold\"\n                          variant=\"h6\"\n                        >\n                          {category.name}\n                        </Typography>\n                      </ListSubheader>\n                    </ListItem>\n                    {filteredLists\n                      .map((list, unitIdx) => {\n                        return (\n                          <>\n                            <ListItem\n                              key={unitIdx}\n                              secondaryAction={\n                                <Dropdown>\n                                  {({ handleClose, open, handleOpen, anchorElement }) => (\n                                    <>\n                                      <IconButton sx={{ color: 'primary.main' }} onClick={handleOpen}>\n                                        <MoreVertIcon />\n                                      </IconButton>\n                                      <Menu\n                                        anchorOrigin={{\n                                          vertical: \"bottom\",\n                                          horizontal: \"right\",\n                                        }}\n                                        transformOrigin={{\n                                          vertical: \"top\",\n                                          horizontal: \"right\",\n                                        }}\n                                        anchorEl={anchorElement}\n                                        id=\"basic-menu\"\n                                        open={open}\n                                        onClose={handleClose}\n                                        MenuListProps={{\n                                          dense: true,\n                                          onClick: handleClose,\n                                          \"aria-labelledby\": \"basic-button\",\n                                        }}\n                                      >\n                                        <MenuItem onClick={() => goToList(list.id)}>\n                                          <ListItemIcon>\n                                            <EditIcon />\n                                          </ListItemIcon>\n                                          <ListItemText>Edit</ListItemText>\n                                        </MenuItem>\n                                        <MenuItem\n                                          onClick={() => showEditList({ listId: list.id })}\n                                        >\n                                          <ListItemIcon>\n                                            <SettingsIcon />\n                                          </ListItemIcon>\n                                          <ListItemText>Settings</ListItemText>\n                                        </MenuItem>\n                                        <MenuItem onClick={() => downloadList(list.id)}>\n                                          <ListItemIcon>\n                                            <DownloadIcon />\n                                          </ListItemIcon>\n                                          <ListItemText>Download</ListItemText>\n                                        </MenuItem>\n                                        <MenuItem onClick={() => shareList(list.id)}>\n                                          <ListItemIcon>\n                                            <ShareIcon />\n                                          </ListItemIcon>\n                                          <ListItemText>Share</ListItemText>\n                                        </MenuItem>\n                                        <MenuItem onClick={() => deleteList(list.id)}>\n                                          <ListItemIcon>\n                                            <DeleteIcon />\n                                          </ListItemIcon>\n                                          <ListItemText>Delete</ListItemText>\n                                        </MenuItem>\n                                      </Menu>\n                                    </>\n                                  )}\n                                </Dropdown>\n                              }\n                              disablePadding\n                            >\n                              <ListItemButton\n                                onClick={() => goToList(list.id)}\n                              >\n                                <ListItemText\n                                  primary={list.name}\n                                />\n                              </ListItemButton>\n                            </ListItem>\n                          </>\n                        );\n                      })}\n                  </>\n                );\n              })}\n            </List>}\n            {!filteredCategories.length && <>\n              <Typography>No created lists. Click the <AddIcon /> Button in the top right to get started.</Typography>\n            </>}\n          </CardContent>\n        </Card>\n      </>\n      {/* <HideOnScroll>\n        {({ show }) => (\n          <SpeedDial\n            ariaLabel=\"SpeedDial tooltip example\"\n            sx={{ position: \"fixed\", bottom: 16, right: 16 }}\n            icon={<SpeedDialIcon />}\n            onClose={(event) => {\n              if (event.type === 'click' || event.type === 'blur') {\n                setDialOpen(false);\n              }\n            }}\n            onOpen={(event) => {\n              if (event.type === 'click') {\n                setDialOpen(true);\n              }\n            }}\n            open={dialOpen && show}\n            hidden={!show}\n          >\n            <SpeedDialAction\n              tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n              id=\"createList\"\n              tooltipTitle=\"Create\"\n              onClick={() => {\n                showAddList();\n              }}\n              icon={<AddIcon />}\n            />\n            <SpeedDialAction\n              tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n              tooltipTitle=\"Import\"\n              id=\"importList\"\n              onClick={handleClick}\n              icon={<UploadIcon />}\n            />\n            <SpeedDialAction\n              tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n              id=\"refreshFactions\"\n              tooltipTitle=\"Refresh\"\n              onClick={refreshFactions}\n              icon={<RefreshIcon />}\n            />\n            <SpeedDialAction\n              tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n              tooltipTitle=\"Top\"\n              color=\"primary\"\n              onClick={scrollToTop}\n              icon={<KeyboardArrowUpIcon />}\n            />\n          </SpeedDial>\n        )}\n      </HideOnScroll> */}\n      <Tour\n        accentColor={`rgb(57, 110, 158)`}\n        className=\"tour\"\n        key={activeTab}\n        steps={[...allSteps, ...(steps[activeTab] || [])]}\n        isOpen={isTourOpen}\n        onRequestClose={() => {\n          setIsTourOpen(false);\n        }}\n        rounded={5}\n        onAfterOpen={(target) => (document.body.style.overflowY = \"hidden\")}\n        onBeforeClose={(target) => (document.body.style.overflowY = \"auto\")}\n      />\n      <input\n        id=\"file-Form.Control\"\n        type=\"file\"\n        name=\"name\"\n        multiple\n        ref={fileDialog}\n        onChange={uploadFile}\n        style={{ height: \"0px\", overflow: \"hidden\" }}\n      />\n    </Container>\n  );\n});\n","import RehypeToc from '@jsdevtools/rehype-toc';\nimport Box from \"@mui/material/Box\";\nimport Container from '@mui/material/Container';\nimport Tab from \"@mui/material/Tab\";\nimport Tabs from \"@mui/material/Tabs\";\nimport Typography from \"@mui/material/Typography\";\nimport { DataContext } from 'hooks';\nimport { get } from 'lodash';\nimport React, { useContext, useState } from 'react';\nimport ReactMarkdown from \"react-markdown\";\nimport styled from 'styled-components';\nimport { MarkdownRenderer } from 'utils/markdown';\n\nconst StyledRules = styled.div`\nh1 {\n  font-size: 20pt;\n  font-weight: bold;\n  border-bottom: 4px solid rgb(57, 110, 158);\n  padding-bottom: 0.25rem;\n}\nh2 {\n  font-size: 18pt;\n  border-bottom: 2px solid rgb(57, 110, 158);\n  padding-bottom: 0.25rem;\n}\nh3 {\n  font-size: 16pt;\n}\nh4 {\n  font-weight: bold;\n  font-size: 12pt;\n}\nh5 {\n  font-weight: bold;\n  font-size: 12pt;\n}\np {\n  break-inside: \"avoid-column\";\n  page-break-inside: avoid; /* For Firefox. */\n  -webkit-column-break-inside: avoid; /* For Chrome & friends. */\n  break-inside: avoid; /* For standard browsers like IE. :-) */\n}\n`;\n\nexport default function QuickRules(props) {\n  const [{ data: nope, appState, setAppState, userPrefs }] = useContext(DataContext);\n  const { gameRules, skirmishRules } = nope;\n  const [activeTab, setActiveTab] = useState(get(appState, 'rulesTab', 0));\n  const mdRenderer = React.useMemo(() => MarkdownRenderer(), []);\n  const showBeta = userPrefs.showBeta;\n  // const theme = useTheme();\n  const toggle = tab => {\n    if (activeTab !== tab) setActiveTab(tab);\n    setAppState({ ...appState, rulesTab: tab });\n  }\n  const handleChange = (event, newValue) => {\n    toggle(newValue);\n  };\n  function a11yProps(index) {\n    return {\n      id: `simple-tab-${index}`,\n      \"aria-controls\": `simple-tabpanel-${index}`,\n    };\n  }\n  const gameTypesRaw = { all: {name: \"All\"}, ...get(nope, 'gameData.gameTypes', {}) };\n  const gamesUnsorted = Object.values(get(nope, `gameData.games`, {})).filter((game) => game.version && Number(game.version)).filter((game) => showBeta ? true : game.version && Number(game.version) >= 1);\n  const gameTypes = [...Object.keys(gameTypesRaw).filter((gameType) => gamesUnsorted.filter((game) => game.gameType === gameType).length)];\n  const activeGameTypeData = gameTypesRaw[gameTypes[activeTab]];\n  const activeGameName = get(activeGameTypeData, 'name', 'Battle');\n  const activeRules = activeGameName === 'Battle' ? gameRules : skirmishRules;\n  return (\n    <Container>\n      <>\n        {/* <HideOnScroll>\n          {({ show }) => (\n            <SpeedDial\n              ariaLabel=\"SpeedDial tooltip example\"\n              sx={{ position: \"fixed\", bottom: 16, right: 16 }}\n              icon={<SpeedDialIcon />}\n              hidden={!show}\n            >\n              <SpeedDialAction\n                tooltipOpen\n              FabProps={{\n                sx: {\n                  backgroundColor: theme.palette.primary.main,\n                  color: theme.palette.getContrastText(theme.palette.primary.main)\n                }\n              }}\n                tooltipTitle=\"Top\"\n                color=\"primary\"\n                onClick={scrollToTop}\n                icon={<KeyboardArrowUpIcon />}\n              />\n            </SpeedDial>\n          )}\n        </HideOnScroll> */}\n        <Typography variant=\"h3\" align=\"center\">{`Core Rules`}</Typography>\n        <Box sx={{ width: \"100%\", bgcolor: \"background.paper\" }} className=\"sticky\">\n          {!!gameTypes && !!gameTypes.length && (\n            <>\n              <Box sx={{ width: \"100%\", bgcolor: \"background.paper\", pb: 1 }}>\n                <Box sx={{ borderBottom: 1, borderColor: \"divider\" }}>\n                  <Tabs\n                    value={activeTab}\n                    onChange={handleChange}\n                    aria-label=\"basic tabs example\"\n                  >\n                    {gameTypes.map((tab, index) => {\n                      const gameTypeData = gameTypesRaw[tab];\n                      return (\n                        <Tab\n                          key={index}\n                          sx={{ textTransform: \"none\" }}\n                          label={gameTypeData.name}\n                          {...a11yProps(0)}\n                        />\n                      );\n                    })}\n                  </Tabs>\n                </Box>\n              </Box>\n            </>\n          )}\n        </Box>\n        <Typography variant=\"h4\" align=\"center\" sx={{ mb: 2 }}>{`${activeGameTypeData.name}`}</Typography>\n        <div\n          className=\"unit-card\"\n          style={{ marginBottom: \"15px\", borderColor: \"rgb(57, 110, 158)\" }}\n        >\n          <div className=\"unit-card-body\">\n            <StyledRules>\n              <ReactMarkdown components={mdRenderer} children={activeRules} rehypePlugins={[[ RehypeToc, { headings: [\"h1\", \"h2\", \"h3\"] } ]]} />\n            </StyledRules>\n          </div>\n        </div>\n      </>\n    </Container>\n  );\n}\n","export default __webpack_public_path__ + \"static/media/battle_forged_wide.b1be5222.png\";","import * as React from 'react';\nimport { useTheme } from '@mui/material/styles';\nimport Box from '@mui/material/Box';\nimport MobileStepper from '@mui/material/MobileStepper';\nimport Paper from '@mui/material/Paper';\nimport Typography from '@mui/material/Typography';\nimport Button from '@mui/material/Button';\nimport KeyboardArrowLeft from '@mui/icons-material/KeyboardArrowLeft';\nimport KeyboardArrowRight from '@mui/icons-material/KeyboardArrowRight';\nimport SwipeableViews from 'react-swipeable-views';\nimport { autoPlay } from 'react-swipeable-views-utils';\nimport { CardMedia } from '@mui/material';\n\nconst AutoPlaySwipeableViews = autoPlay(SwipeableViews);\n\nconst imgs = [\n  {\n    label: 'San Francisco – Oakland Bay Bridge, United States',\n    imgPath:\n      'https://images.unsplash.com/photo-1537944434965-cf4679d1a598?auto=format&fit=crop&w=400&h=250&q=60',\n  },\n  {\n    label: 'Bird',\n    imgPath:\n      'https://images.unsplash.com/photo-1538032746644-0212e812a9e7?auto=format&fit=crop&w=400&h=250&q=60',\n  },\n  {\n    label: 'Bali, Indonesia',\n    imgPath:\n      'https://images.unsplash.com/photo-1537996194471-e657df975ab4?auto=format&fit=crop&w=400&h=250&q=80',\n  },\n  {\n    label: 'Goč, Serbia',\n    imgPath:\n      'https://images.unsplash.com/photo-1512341689857-198e7e2f3ca8?auto=format&fit=crop&w=400&h=250&q=60',\n  },\n];\n\nfunction SwipeableTextMobileStepper(props) {\n  const { images = imgs, maxHeight } = props;\n  const theme = useTheme();\n  const [activeStep, setActiveStep] = React.useState(0);\n\n  const maxSteps = images.length;\n\n  const handleNext = () => {\n    setActiveStep((prevActiveStep) => (prevActiveStep + 1) % maxSteps);\n  };\n\n  const handleBack = () => {\n    setActiveStep((prevActiveStep) => (prevActiveStep - 1) % maxSteps);\n  };\n\n  const handleStepChange = (step) => {\n    setActiveStep(step);\n  };\n\n  if (!images) {\n    return <></>\n  }\n\n  return (\n    <Box sx={{ flexGrow: 1 }}>\n      <Paper\n        square\n        elevation={0}\n        sx={{\n          display: 'flex',\n          alignItems: 'center',\n          height: 50,\n          pl: 2,\n          bgcolor: 'background.default',\n        }}\n      >\n        <Typography>{images[activeStep].label}</Typography>\n      </Paper>\n      <AutoPlaySwipeableViews\n        axis={theme.direction === 'rtl' ? 'x-reverse' : 'x'}\n        index={activeStep}\n        onChangeIndex={handleStepChange}\n        enableMouseEvents\n      >\n        {images.map((step, index) => (\n          <div key={index}>\n            {Math.abs(activeStep - index) <= 2 ? (\n              <CardMedia component=\"img\" alt={step.label} image={step.imgPath}\n                style={{ maxHeight }} />\n            ) : null}\n          </div>\n        ))}\n      </AutoPlaySwipeableViews>\n      <MobileStepper\n        steps={maxSteps}\n        position=\"static\"\n        activeStep={activeStep}\n        nextButton={\n          <Button\n            size=\"small\"\n            onClick={handleNext}\n            // disabled={activeStep === maxSteps - 1}\n          >\n            Next\n            {theme.direction === 'rtl' ? (\n              <KeyboardArrowLeft />\n            ) : (\n              <KeyboardArrowRight />\n            )}\n          </Button>\n        }\n        backButton={\n          <Button\n            size=\"small\"\n            onClick={handleBack}\n            // disabled={activeStep === 0}\n          >\n            {theme.direction === 'rtl' ? (\n              <KeyboardArrowRight />\n            ) : (\n              <KeyboardArrowLeft />\n            )}\n            Back\n          </Button>\n        }\n      />\n    </Box>\n  );\n}\n\nexport default SwipeableTextMobileStepper;","import BuildIcon from '@mui/icons-material/Build';\nimport FeaturedPlayListIcon from '@mui/icons-material/FeaturedPlayList';\nimport MenuBookIcon from '@mui/icons-material/MenuBook';\nimport PhoneAndroidIcon from '@mui/icons-material/PhoneAndroid';\nimport {\n  Box, Card, CardActionArea, CardContent, Grid, Stack, Typography\n} from \"@mui/material\";\nimport Container from \"@mui/material/Container\";\nimport logo from \"assets/battle_forged_wide.png\";\nimport Gallery from 'components/gallery';\nimport { shuffle } from \"lodash\";\nimport ChessPawn from 'mdi-material-ui/ChessPawn';\nimport Dice6 from 'mdi-material-ui/Dice6';\nimport Discord from 'mdi-material-ui/Discord';\nimport Github from 'mdi-material-ui/Github';\nimport Newspaper from 'mdi-material-ui/Newspaper';\nimport React from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport { useHistory } from \"react-router-dom\";\nimport { colors } from 'utils/colors';\nimport { getHeaders, getRandomHeader } from \"utils/images\";\nimport { MaterialRenderer } from \"utils/markdown\";\n\nexport default function Home() {\n  const history = useHistory();\n  const images = React.useMemo(() => shuffle(getHeaders()), []);\n  const iconSize = '70px';\n  const mrender = MaterialRenderer();\n  const randomImage = React.useMemo(() => getRandomHeader(), []);\n  const CARDS = [\n    {\n      name: \"Rules\",\n      icon: <MenuBookIcon style={{ fontSize: iconSize }} />,\n      text: \"Read any of the core rules in their digital format here.\",\n      to: \"/rules\",\n      color: colors.red.import[800],\n    },\n    {\n      name: \"Games\",\n      icon: <Dice6 style={{ fontSize: iconSize }} />,\n      text: \"Browse all of the available game modules to experience.\",\n      to: \"/games\",\n      color: colors.green.import[900],\n    },\n    {\n      name: \"Rosters\",\n      icon: <FeaturedPlayListIcon style={{ fontSize: iconSize }} />,\n      text: \"Create and browse game rosters here to use during your games.\",\n      to: \"/lists\",\n      color: colors.brown.import[500],\n    },\n    {\n      name: \"Updates\",\n      icon: <Newspaper style={{ fontSize: iconSize }} />,\n      text: \"View any recent game updates and important announcements.\",\n      to: \"/updates\",\n      color: colors.purple.import[600],\n    },\n    {\n      name: \"Discuss\",\n      icon: <Discord style={{ fontSize: iconSize }} />,\n      text: \"Discuss the game and provide feedback here on our Discord.\",\n      toAbs: \"https://discord.gg/M9sets4\",\n      color: colors.blue.import[800],\n    },\n    {\n      name: \"Contribute\",\n      icon: <Github style={{ fontSize: iconSize }} />,\n      text: \"Contribute to the game modules on Github.\",\n      toAbs: \"https://github.com/wargame-engine\",\n      color: colors.blueGray.import[600],\n    },\n  ];\n\n  return (\n    <>\n      <div\n        style={{\n          backgroundImage: `url(${`/images/headers/${randomImage.img}`})`,\n          backgroundPosition: \"center\",\n          backgroundSize: \"cover\",\n        }}\n      >\n        <Box sx={{ display: \"flex\", flexDirection: 'column' }} style={{ width: \"100%\", background: \"rgba(0,0,0,0.7)\" }}>\n          <img\n            flex={1}\n            // className={\"d-block text-center logo clickable\"}\n            className={\"d-block text-center logo\"}\n            src={logo}\n            // onClick={() => history.push(`/games`)}\n            alt=\"logo\"\n          />\n          <Box style={{ color: \"white\", textAlign: 'right' }}>\n            <Container>\n              <ReactMarkdown\n                className=\"banner-text\"\n                components={mrender}\n                style={{ breakInside: \"avoid-column\" }}\n                children={randomImage.credit}\n              />\n            </Container>\n          </Box>\n        </Box>\n      </div>\n      <Container>\n\n        <Grid\n          container\n          rowSpacing={2}\n          sx={{ mt: 2 }}\n          columnSpacing={2}\n        >\n          {CARDS.map((card) => (\n            <Grid item sm={6} md={4}>\n              <Card\n                sx={{\n                  backgroundColor: card.color,\n                  color: \"white\",\n                }}\n              >\n                <CardActionArea\n                  onClick={() =>\n                    card.toAbs\n                      ? window.open(card.toAbs, \"_blank\")\n                      : history.push(card.to)\n                  }\n                >\n                  <CardContent>\n                    <Box\n                      display=\"flex\"\n                      flexDirection=\"row\"\n                      alignItems=\"center\"\n                      justifyContent=\"center\"\n                    >\n                      <Box sx={{ mr: 2 }}>{card.icon}</Box>\n                      <Stack>\n                        <Typography variant=\"h4\" component=\"div\">\n                          {card.name}\n                        </Typography>\n                        <Typography align=\"left\">{card.text}</Typography>\n                      </Stack>\n                    </Box>\n                  </CardContent>\n                </CardActionArea>\n              </Card>\n            </Grid>\n          ))}\n        </Grid>\n        <Box sx={{ mt: 4 }}>\n          <Typography variant=\"body1\" paragraph>\n            Battle Forge is a modular miniature wargame designed for either\n            small skirmish engagements or large all out battles. It allows you\n            to experience your favorite settings and miniatures in a common and\n            balanced set of rules with awesome tools to help you create your own\n            modules and share them easily.\n          </Typography>\n          <Typography variant=\"body1\" paragraph>\n            We aim to bring you a ruleset that works well in both a tournament\n            setting and casual fun environments. With regular balance updates\n            and direct player-driven feedback we can respond to issues with the\n            system in a timely manner and continue to improve to benefit all\n            types of players. We invite you to come give the rules a try for\n            free and see what you think. Any feedback can be directed to our\n            Discord server linked above. We hope you enjoy it. From all of us at\n            Indie Game Rules, thanks for stopping by!\n          </Typography>\n        </Box>\n      </Container>\n      <Container>\n        <Gallery\n          images={images.map((img) => ({ imgPath: `/images/headers/${img.img}`, label: <ReactMarkdown components={mrender} className=\"rule-text\" children={img.credit} /> }))}\n          maxHeight={400}\n        />\n      </Container>\n      <Container>\n        <Grid\n          container\n          rowSpacing={1}\n          sx={{ mt: 2 }}\n          columnSpacing={{ xs: 1, sm: 2, md: 3 }}\n        >\n          <Grid item md={4}>\n            <Box\n              display=\"flex\"\n              alignItems=\"center\"\n              justifyContent=\"center\"\n              flexDirection=\"column\"\n            >\n              <div style={{ padding: \"5px\" }}>\n                <ChessPawn style={{ fontSize: '100px', color: colors.blue.import[800] }} />\n              </div>\n              <Typography variant=\"h5\" gutterBottom>Strategic Gameplay</Typography>\n              <Typography paragraph>\n                The rules employ alternating activation with a twist, in that\n                both players risk a certain amount of \"Shock\", pushing their\n                units to their limit each round to attempt to seize the\n                initiative. Additionally, units may be deployed in hidden\n                positions to attempt to outsmart or outbluff your opponent.\n              </Typography>\n              <Typography paragraph>\n                The Shock system introduces a Command and Control element to\n                ensure that you will have to adapt to the changing battlefield\n                and use your Leaders to their full effect to keep your units\n                fighting at full efficiency. Crucially, these mechanics will\n                rarely cause you to lose a unit's entire activation, only weaken\n                them to avoid frustration.\n              </Typography>\n            </Box>\n          </Grid>\n          <Grid item md={4}>\n            <Box\n              display=\"flex\"\n              alignItems=\"center\"\n              justifyContent=\"center\"\n              flexDirection=\"column\"\n            >\n              <div style={{ padding: \"5px\" }}>\n                <PhoneAndroidIcon\n                  style={{ fontSize: '100px', color: colors.green.import[800] }}\n                />\n              </div>\n              <Typography variant=\"h5\" gutterBottom>Living Rules</Typography>\n              <Typography paragraph>\n                The project lives here on its digital hub and is quickly and\n                easily updated to ensure the latest rules and updates are\n                available in one place without having to download additional FAQ\n                and Errata documents.\n              </Typography>\n              <Typography paragraph>\n                The digital hub is also designed to be used as a reference while\n                playing and is mobile-friendly with all features available on\n                both desktop and mobile devices.\n              </Typography>\n            </Box>\n          </Grid>\n          <Grid item md={4}>\n            <Box\n              display=\"flex\"\n              alignItems=\"center\"\n              justifyContent=\"center\"\n              flexDirection=\"column\"\n            >\n              <div style={{ padding: \"10px\" }}>\n                <BuildIcon\n                  style={{ fontSize: '100px', color: colors.gray.import[800] }}\n                />\n              </div>\n              <Typography variant=\"h5\" gutterBottom>Fully Mod-able</Typography>\n              <Typography paragraph>\n                All of our released game settings configuration files are fully\n                downloadable and editable with our developed tools to allow you\n                to create your own units, factions or even entirely new game\n                settings.\n              </Typography>\n              <Typography paragraph>\n                The games are all about community-driven content and regular\n                balance feedback. The tools we've created allow us to very\n                rapidly make balance changes that will apply to all settings and\n                datasheets as well as your custom ones so you get the latest\n                adjustments quickly.\n              </Typography>\n            </Box>\n          </Grid>\n        </Grid>\n        {/* <Stack\n          display=\"flex\"\n          alignItems=\"center\"\n          justifyContent=\"center\"\n          flexDirection=\"row\"\n          direction=\"row\"\n          spacing={2}\n        >\n          <Button\n            variant=\"contained\"\n            startIcon={<FontAwesomeIcon icon={faPencilAlt} />}\n            onClick={() => {\n              window.open(\"https://github.com/wargame-engine\");\n            }}\n          >\n            {\"Contribute\"}\n          </Button>\n          <Button\n            variant=\"contained\"\n            startIcon={<FontAwesomeIcon icon={faMoneyBillWave} />}\n            onClick={() => {\n              window.open(\"https://www.patreon.com/bePatron?u=36845786\");\n            }}\n          >\n            {\"Support\"}\n          </Button>\n        </Stack> */}\n      </Container>\n    </>\n  );\n}\n","import { getRandomItem } from 'utils/math';\nimport banners from 'assets/data/banners.json';\nexport function getRandomHeader() {\n    return getRandomItem(banners);\n}\nexport function getHeaders() {\n    return banners;\n}\n\n","import { Container } from '@mui/material';\nimport { DataContext } from 'hooks';\nimport React, { useContext } from 'react';\nimport ReactMarkdown from \"react-markdown\";\nimport styled from 'styled-components';\nimport { MarkdownRenderer } from 'utils/markdown';\nimport Typography from '@mui/material/Typography';\n\nconst StyledRules = styled.div`\n  h1:not(:first-child) {\n    margin-top: 1.5em;\n  }\n  h1 {\n    font-size: 20pt;\n    font-weight: bold;\n    border-bottom: 4px solid rgb(57, 110, 158);\n    padding-bottom: 0.25rem;\n  }\n  h2 {\n    font-size: 18pt;\n    border-bottom: 2px solid rgb(57, 110, 158);\n    margin-top: 0.5em;\n    padding-bottom: 0.25rem;\n  }\n  h3 {\n    font-size: 16pt;\n  }\n  h4 {\n    font-weight: bold;\n    font-size: 12pt;\n  }\n  h5 {\n    font-weight: bold;\n    font-size: 12pt;\n  }\n  p {\n    break-inside: \"avoid-column\";\n    page-break-inside: avoid; /* For Firefox. */\n    -webkit-column-break-inside: avoid; /* For Chrome & friends. */\n    break-inside: avoid; /* For standard browsers like IE. :-) */\n  }\n`;\n\nexport default function QuickRules(props) {\n  const [{ data: nope }] = useContext(DataContext);\n  const { updates } = nope;\n  const mdRenderer = React.useMemo(() => (MarkdownRenderer({useToc: false})), []);\n  return (\n    <Container>\n      <>\n      <Typography variant=\"h3\" align=\"center\" sx={{ mb: 4 }}>{`Game Updates`}</Typography>\n        <div className=\"unit-card\" style={{ marginBottom: '15px', borderColor: 'rgb(57, 110, 158)' }}>\n          <div className=\"unit-card-body\">\n            <StyledRules className=\"rule-text\">\n              <ReactMarkdown components={mdRenderer} children={updates} />\n            </StyledRules>\n          </div>\n        </div>\n      </>\n    </Container>\n  );\n}\n","import Box from '@mui/material/Box';\nimport Container from '@mui/material/Container';\nimport { Footer } from \"components/footer\";\nimport { MainNav } from \"components/MainNav\";\nimport { usePageTitle } from 'hooks';\nimport { get } from \"lodash\";\nimport React from \"react\";\nimport { Route, Switch, useHistory } from \"react-router-dom\";\nimport Faction from \"routes/faction\";\nimport Factions from \"routes/factions\";\nimport Games from \"routes/games\";\nimport Lists from \"routes/Lists\";\nimport PageNotFound from \"routes/PageNotFound\";\nimport Privacy from \"routes/Privacy\";\nimport Rosters from \"routes/rosters\";\nimport Rules from \"routes/Rules\";\nimport Splash from \"routes/Splash\";\nimport Updates from \"routes/Updates\";\n\nexport default function Core(props) {\n  const history = useHistory();\n  const path = get(history, \"location.pathname\", \"/\");\n\n  const title = usePageTitle();\n  React.useEffect(() => {\n    document.title = `Battle Forge - ${title}`\n  }, [title]);\n\n  return (\n    <>\n      <MainNav />\n      <div className=\"main\">\n        {path !== \"/\" && (\n          <Container>\n            <Box sx={{ pt: 2, pb: 2 }}>\n              {/* <Breadcrumbs /> */}\n            </Box>\n          </Container>\n        )}\n        <Switch>\n          <Route exact path=\"/\" component={Splash} />\n          <Route exact path=\"/privacy\" component={Privacy} />\n          <Route exact path=\"/rules\" component={Rules} />\n          <Route exact path=\"/updates\" component={Updates} />\n          <Route\n            exact\n            path=\"/games/:gameName/:factionName\"\n            component={Faction}\n          />\n          <Route exact path=\"/games/:gameName\" component={Factions} />\n          <Route exact path=\"/games\" component={Games} />\n          <Route exact path=\"/lists\" component={Rosters} />\n          <Route\n            exact\n            path=\"/lists/:listId\"\n            component={Lists}\n          />\n          <Route component={PageNotFound} />\n        </Switch>\n        <Footer className=\"footer\" />\n      </div>\n    </>\n  );\n}\n","// @ts-nocheck\n\nimport CloseIcon from '@mui/icons-material/Close';\nimport { IconButton } from '@mui/material';\nimport CssBaseline from '@mui/material/CssBaseline';\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\nimport useMediaQuery from '@mui/material/useMediaQuery';\nimport 'App.css';\nimport ErrorBoundry from 'components/error-boundry';\nimport { useDataFetcher } from 'hooks';\nimport { SnackbarProvider } from 'notistack';\nimport React from 'react';\nimport { HashRouter, Route, Switch } from 'react-router-dom';\nimport Core from 'routes/Core';\nimport { createClient, Provider as URQLProvider } from 'urql';\nimport { getColor } from 'utils/colors';\nimport { BASE_THEME } from 'utils/constants';\nimport { DataContext, ModalProvider, PointsCacheContext, usePointsCache } from './hooks';\n\nexport default React.memo(() => {\n  const cache = usePointsCache();\n  const dataFetcher = useDataFetcher();\n  const [{ userPrefs }] = dataFetcher;\n  const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)');\n  const browserTheme = prefersDarkMode ? 'dark' : 'light';\n  const userTheme = userPrefs?.theme;\n  const themeId = (!userTheme || userTheme === 'system') ? browserTheme : userTheme;\n  const userPrimaryColor = getColor(userPrefs?.primaryColor)?.import || getColor('blue')?.import;\n  const theme = createTheme({\n    ...BASE_THEME,\n    palette: {\n      mode: themeId,\n      primary: userPrimaryColor\n    }\n  });\n\n  const notistackRef = React.createRef();\n  const onClickDismiss = key => () => {\n    notistackRef.current.closeSnackbar(key);\n  }\n\n  const serverUrl = process.env.REACT_APP_API || `${window.location.origin}/api`;\n  const client = createClient({\n    url: `${serverUrl}/graphql`,\n  });\n\n  return (\n    <URQLProvider value={client}>\n      <ThemeProvider theme={theme}>\n        <ModalProvider>\n          <SnackbarProvider\n            ref={notistackRef}\n            maxSnack={3}\n            action={(key) => (\n              <IconButton sx={{ color: 'inherit' }} onClick={onClickDismiss(key)}>\n                <CloseIcon />\n              </IconButton>\n            )}\n          >\n            <PointsCacheContext.Provider value={cache}>\n              <DataContext.Provider value={dataFetcher}>\n                <CssBaseline />\n                <ErrorBoundry>\n                  <HashRouter>\n                    <Switch>\n                      <Route component={Core} />\n                    </Switch>\n                  </HashRouter>\n                </ErrorBoundry>\n              </DataContext.Provider>\n            </PointsCacheContext.Provider>\n          </SnackbarProvider>\n        </ModalProvider>\n      </ThemeProvider>\n    </URQLProvider>\n  );\n});","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport { HashRouter } from 'react-router-dom';\nimport * as serviceWorker from './serviceWorker';\nimport 'react-app-polyfill/ie11';\nimport 'react-app-polyfill/stable';\n//import './theme.css';\nimport './index.css';\n//import './theming.css';\n\nReactDOM.render(\n    <HashRouter basename={process.env.PUBLIC_URL}>\n        <App />\n    </HashRouter>,\ndocument.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}